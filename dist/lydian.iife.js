(function(){"use strict";const b0='@import"https://fonts.googleapis.com/css2?family=Antic&family=Antic+Didone&display=swap";*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.m-4{margin:1rem}.mb-4{margin-bottom:1rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.inline{display:inline}.flex{display:flex}.table{display:table}.hidden{display:none}.h-12{height:3rem}.h-6{height:1.5rem}.h-64{height:16rem}.min-h-\\[200px\\]{min-height:200px}.w-12{width:3rem}.w-64{width:16rem}.w-full{width:100%}.max-w-32{max-width:8rem}.table-fixed{table-layout:fixed}.border-separate{border-collapse:separate}@keyframes spin{to{transform:rotate(1turn)}}.animate-spin{animation:spin 1s linear infinite}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(.5rem*var(--tw-space-x-reverse));margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem*var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem*var(--tw-space-y-reverse))}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-4{border-width:4px}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity,1))}.border-transparent{border-color:transparent}.border-t-blue-600{--tw-border-opacity:1;border-top-color:rgb(37 99 235/var(--tw-border-opacity,1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity,1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.p-2{padding:.5rem}.p-6{padding:1.5rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.text-center{text-align:center}.text-right{text-align:right}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.font-medium{font-weight:500}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity,1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity,1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity,1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity,1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.text-lydian-green{color:#044d57}.bg-lydian-green{background:#044d57}.bg-lydian-green:hover{background:#033c46}.bg-lydian-light-green{background:#009393}.bg-lydian-light-green:hover{background:#008282}.hover\\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity,1))}.hover\\:text-gray-700:hover{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity,1))}@media (min-width:640px){.sm\\:text-xl{font-size:1.25rem;line-height:1.75rem}}',v0=`<div class="font-antic">
  <div id="testCanvas"></div>
  <div id="containerPaymentSuccess" class="hidden flex flex-col items-center justify-center min-h-[200px]">
    <p class="text-gray-600 text-lg font-medium">Payment Success!</p>
    <img class="max-w-32 mt-4" src="https://tetherpay.com/images/475982cd-2f7b-4a57-c9b2-13b5014d7100/public"
      alt="Payment Approved!" />
  </div>

  <div id="containerPaymentFailure" class="hidden flex flex-col items-center justify-center">
    <p class="text-red-500 text-lg font-medium">Transaction Timed Out / Failed!</p>
  </div>

  <div id="containerQRCode" class="hidden flex flex-col items-center justify-center">
    <div class="m-4 text-center">
      <span id="displayScanText"></span>
    </div>
    <div class="border p-2 border-gray-500 h-64 w-64 rounded-xl">
      <div id="canvasQRCode"></div>
    </div>

    <div class="m-4 text-center">
      Approval will be shown above when complete
    </div>

    <table class="table-fixed w-full bg-gray-50 p-2 rounded-xl border-separate mt-5">
      <tbody>
      <tr>
        <td>Total</td>
        <td id="displayTotalAmount" class="text-right"></td>
      </tr>
      <tr>
        <td>Transaction ID</td>
        <td id="displayTransactionID" class="text-right"></td>
      </tr>
      <tr>
        <td>Total In Selected Asset</td>
        <td id="displayAssetTotal" class="text-right"></td>
      </tr>
      <tr>
        <td>QR Code Expires In</td>
        <td id="displayExpirationLeft" class="text-right">15:00</td>
      </tr>
      </tbody>
    </table>

    <p id="qrCodeAmount" class="text-lg text-gray-900 sm:text-xl text-center mt-4"></p>
    <button id="lydianBtnCancelCryptoPayment" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>

  </div>

  <div id="lydianProcessingContainer" class="hidden flex flex-col items-center justify-center min-h-[200px]">
    <div class="w-12 h-12 border-4 border-gray-300 border-t-blue-600 rounded-full animate-spin"></div>
    <p id="lydianProcessingText" class="mt-4 text-gray-600 text-lg font-medium text-center"></p>
  </div>

  <button type="button" id="btnAppPayment"
    class="hidden w-full rounded-md border border-transparent bg-lydian-green px-4 py-3 text-base font-medium mb-4 text-white shadow-md">
    Pay with Lydian
  </button>
  <button type="button" id="btnCryptoPayment"
    class="hidden w-full rounded-md border border-transparent bg-lydian-light-green px-4 py-3 text-base font-medium mb-4 text-white shadow-md">
    Pay With Crypto
  </button>

  <div id="containerCryptoPayment" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
    <div class="flex items-center space-x-2">
      <div class="text-lg font-medium">Select An Asset</div>
    </div>

    <div class="space-y-2">
      <div id="containerAssets" class="space-y-2">
      </div>
      <button id="btnMoreAssets" class="text-sm text-gray-500 underline hover:text-gray-700">
        More Assets
      </button>
      <div id="containerAssetsMore" class="space-y-2 hidden">
      </div>
    </div>

    <p class="text-xs text-red-500">
      Please ensure to select the correct network. Sending funds on the wrong
      network will result in a loss of your funds.
    </p>

    <button id="btnCancelCryptoPayment" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>
  </div>

  <div id="containerNetworks" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
    <div class="flex items-center space-x-2">
      <img id="assetImg" src="" class="h-6" />
      <div id="assetTitle" class="text-lg font-medium">USDT (Tether)</div>
    </div>

    <div class="text-sm font-medium">Select A Network</div>

    <div class="space-y-2">
      <div id="containerNetworkList" class="space-y-2">
      </div>
      <button id="btnMoreNetworks" class="text-sm text-gray-500 underline hover:text-gray-700">
        More Networks
      </button>
      <div id="containerMoreNetworks" class="space-y-2 hidden">
      </div>
    </div>

    <p class="text-xs text-red-500">
      Please ensure to select the correct network. Sending funds on the wrong
      network will result in a loss of your funds.
    </p>

    <button id="lydianBtnCancelUsdtPayment" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>
  </div>

  <!-- TODO: clear this container when going back or using loadInitialState -->
  <div id="connectWalletContainer" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
    <div class="flex items-center space-x-2">
      <div class="text-lg font-medium">Connect A Wallet</div>
    </div>

    <div class="space-y-2">
      <div id="containerWalletList" class="space-y-2">
      </div>
      <button id="btnMoreWallets" class="text-sm text-gray-500 underline hover:text-gray-700">
        More Wallets
      </button>
      <div id="containerMoreWallets" class="space-y-2 hidden">
      </div>
    </div>

    <div class="flex items-center justify-center space-x-2">
      <div class="text-lg font-medium text-center text">Or</div>
    </div>

    <div class="space-y-2">
      <div id="containerWalletManual" class="space-y-2"></div>
    </div>

    <p class="text-xs text-red-500">
      Please ensure to select the correct network. Sending funds on the wrong
      network will result in a loss of your funds.
    </p>

     <button id="lydianBtnCancelWalletConnect" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>
  </div>
</div>`,po=["USD","TRY"];function fu(t){return po.includes(t)}const E0="cbc90b58aec5c9ab2085a2d691461868",pu=1,x0="https://gateway.sandbox.lydian.com",_0="https://gateway.lydian.com",S0="aptos",A0="arbitrum",I0="avalanche",D0="base",O0="bitcoin",$0="celo",C0="eos",P0="ethereum",B0="hedara",T0="kaia",k0="linea",R0="near",N0="opmainnet",U0="polygon",F0="solana",L0="sonic",M0="sui",z0="tezos",j0="ton",q0="tron",H0="unichain",V0="uniswap",K0="zksync",W0="ARB",G0="BASE",gu="BTC",Y0="CELO",yu="DAI",wu="ETH",Q0="LINEA",Z0="OPMAINNET",J0="POLY",mu="PYUSD",bu="RLUSD",X0="SOL",ey="SONIC",ty="UNICHAIN",vu="USDC",Eu="USDe",xu="USDP",_u="USDS",Su="USDT",ny="ZKSYNC",Au={code:"USDT",title:"USDT (Tether)",img:"https://tetherpay.com/images/7065960c-8ebd-4d80-f352-8027ff2bb600/public",type:"token",networks:[]},Iu={code:"USDC",title:"USDC",img:"https://tetherpay.com/images/1a664446-0855-4d6d-256e-ad886acba300/public",type:"token",networks:[]},Du={code:"ETH",title:"Ethereum",img:"https://tetherpay.com/images/327ef8ac-bc72-46ea-2362-878e91c49300/public",type:"coin",networks:[]},ry={code:"SOL",title:"Solana",img:"https://tetherpay.com/images/5850fc57-4451-4f45-b053-3857b1d54e00/public"},Ou={code:"BTC",title:"Bitcoin",img:"https://tetherpay.com/images/7f89f493-190a-41da-2410-a19b46a68900/public",type:"coin",networks:[]},iy={code:"ARB",title:"Arbitrum",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/64d896c2-6ac6-4837-e6bf-e05c53a5f500/public",type:"coin",networks:[]},sy={code:"BASE",title:"Base",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/3fc7c8ef-6863-43e6-967d-de68e14d4600/public",type:"coin",networks:[]},oy={code:"CELO",title:"Celo ",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/7373a7f6-b5dd-4d16-0b98-cbaf9e666300/public",type:"coin",networks:[]},ay={code:"linea",title:"Linea",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/410a3ea8-d59b-4e88-1c1a-ffa77c157600/public",type:"coin",networks:[]},cy={code:"opmainnet",title:"OP Mainnet",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/cd28b090-e932-478e-2a40-7b7d61672d00/public",type:"coin",networks:[]},uy={code:"polygon",title:"Polygon",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/386bebc7-3782-4358-978d-ae2b2d4fbf00/public",type:"coin",networks:[]},ly={code:"sonic",title:"Sonic",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/e9eaf9b0-3093-4239-d20b-a0c5934ec200/public",type:"coin",networks:[]},hy={code:"unichain",title:"Unichain",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/f4c4d2e6-d9a4-4910-febc-ed6de61bd400/public",type:"coin",networks:[]},dy={code:"zksync",title:"ZKsync",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/540fbd94-e1d0-4dda-c6d1-426181f37e00/public",type:"coin",networks:[]},$u={code:"RLUSD",title:"RLUSD (Ripple USD)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/b71545a6-eab8-4fa2-5888-f26c22ce7f00/public",type:"token",networks:[]},Cu={code:"PYUSD",title:"PYUSD (PayPal USD)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/3897aafa-0fd9-4914-ef54-e6312aea9a00/public",type:"token",networks:[]},Pu={code:"USDe",title:"USDe (Ethena USDe)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/76760e01-ce5a-482b-88e0-842f18370d00/public",type:"token",networks:[]},Bu={code:"USDS",title:"USDS (Sky Dollar)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/ee62374d-99a1-46c7-9fc6-eb5907a32600/public",type:"token",networks:[]},Tu={code:"DAI",title:"DAI",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/970875a7-3ae3-4171-4afe-cc1340bf9500/public",type:"token",networks:[]},ku={code:"USDP",title:"USDP (Pax Dollar)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/970875a7-3ae3-4171-4afe-cc1340bf9500/public",type:"token",networks:[]},fy={code:"bitcoin",name:"Bitcoin",img:"https://tetherpay.com/images/7f89f493-190a-41da-2410-a19b46a68900/public"},py={code:"ethereum",name:"Ethereum",img:"https://tetherpay.com/images/327ef8ac-bc72-46ea-2362-878e91c49300/public"},gy={code:"tron",name:"Tron",img:"https://tetherpay.com/images/b51f79ea-c12b-4c01-246d-592c51214000/public"},yy={code:"solana",name:"Solana",img:"https://tetherpay.com/images/5850fc57-4451-4f45-b053-3857b1d54e00/public"},wy={code:"ton",name:"Ton",img:"https://tetherpay.com/images/a741a20b-6124-4c69-e678-4578b81a5f00/public"},my={code:"avalanche",name:"Avalanche",img:"https://tetherpay.com/images/ebd47494-9bae-4687-7762-19a4184e5400/public"},by={code:"aptos",name:"Aptos",img:"https://tetherpay.com/images/f2b2a145-2c37-4082-5f18-6271081d1500/public"},vy={code:"arbitrum",name:"Arbitrum",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/64d896c2-6ac6-4837-e6bf-e05c53a5f500/public"},Ey={code:"base",name:"Base",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/3fc7c8ef-6863-43e6-967d-de68e14d4600/public"},xy={code:"celo",name:"Celo",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/7373a7f6-b5dd-4d16-0b98-cbaf9e666300/public"},_y={code:"linea",name:"Linea",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/410a3ea8-d59b-4e88-1c1a-ffa77c157600/public"},Sy={code:"opmainnet",name:"OP Mainnet",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/cd28b090-e932-478e-2a40-7b7d61672d00/public"},Ay={code:"polygon",name:"Polygon",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/386bebc7-3782-4358-978d-ae2b2d4fbf00/public"},Iy={code:"sonic",name:"Sonic",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/e9eaf9b0-3093-4239-d20b-a0c5934ec200/public"},Dy={code:"unichain",name:"Unichain",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/f4c4d2e6-d9a4-4910-febc-ed6de61bd400/public"},Oy={code:"zksync",name:"ZKSync",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/540fbd94-e1d0-4dda-c6d1-426181f37e00/public"},$y={code:"sui",name:"Sui",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/b9ea70f3-4850-49de-ea4b-e1c4b1ae8700/public"},Cy={code:"tezos",name:"Tezos",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/77878400-8af3-45c2-d1e9-2f159c206b00/public"},Py={code:"kaia",name:"Kaia",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/ab53d357-f47b-4285-7ef7-dd9a912cf500/public"},By={code:"eos",name:"Eos",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/49e27a4b-2bd4-4911-5c24-f1f99cd41700/public"},Ty={code:"uniswap",name:"Uniswap",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/b88526db-ae1a-4b67-e6f5-7d7e74c8ed00/public"},ky={code:"hedara",name:"Hedara",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/f6195004-ce8e-4a19-9fbc-46394952a200/public"},Ry={code:"near",name:"Near",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/4f35d901-0541-440a-7e55-2f06c0dd4300/public"};class es{constructor(e,n){if(this.baseUri=e,this.publishableKey=n,this.clusterBaseUri="",!this.baseUri)throw new Error("baseUri is required");if(!this.publishableKey)throw new Error("publishableKey is required")}async request(e,n){const r=`${this.baseUri}${e}`,i={"Content-Type":"application/json","X-Publishable-Key":`${this.publishableKey}`},s=Object.assign({},n,{headers:i}),o=await fetch(r,s);if(o.ok)return await o.json();throw new Error(o.statusText)}async requestCluster(e,n){const r=`${this.clusterBaseUri}${e}`,s=Object.assign({},n,{headers:{"Content-Type":"application/json"}}),o=await fetch(r,s);if(o.ok)return await o.json();throw new Error(o.statusText)}setClusterBaseUri(e){if(this.clusterBaseUri=e,!this.clusterBaseUri)throw new Error("clusterBaseUri is required")}}const Ru="transaction";class Ny extends es{async createCryptoTransaction(e){return await this.request(`/${Ru}`,{method:"POST",body:JSON.stringify(e)})}async getCryptoTransaction(e){return await this.request(`/${Ru}/${e}`)}}function Uy(t,e){e.forEach(n=>{Object.getOwnPropertyNames(n.prototype).forEach(r=>{const i=Object.getOwnPropertyDescriptor(n.prototype,r);i&&Object.defineProperty(t.prototype,r,i)})})}const Fy="config";class Ly extends es{async getSDKConfig(){return await this.request(`/${Fy}`)}}const Nu="transaction";class My extends es{async createClusterTransaction(e){return await this.requestCluster(`/${Nu}`,{method:"POST",body:JSON.stringify(e)})}async getClusterTransaction(e){return await this.requestCluster(`/${Nu}/${e}`)}}class Uu extends es{}Uy(Uu,[Ly,Ny,My]);var Ar=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ts(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Fu(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var Jr={exports:{}},Lu;function zy(){if(Lu)return Jr.exports;Lu=1,Jr.exports=r,Jr.exports.isMobile=r,Jr.exports.default=r;const t=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|redmi|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,e=/CrOS/,n=/android|ipad|playbook|silk/i;function r(i){i||(i={});let s=i.ua;if(!s&&typeof navigator<"u"&&(s=navigator.userAgent),s&&s.headers&&typeof s.headers["user-agent"]=="string"&&(s=s.headers["user-agent"]),typeof s!="string")return!1;let o=t.test(s)&&!e.test(s)||!!i.tablet&&n.test(s);return!o&&i.tablet&&i.featureDetect&&navigator&&navigator.maxTouchPoints>1&&s.indexOf("Macintosh")!==-1&&s.indexOf("Safari")!==-1&&(o=!0),o}return Jr.exports}var jy=zy();const qy=ts(jy);var Wn={},In={},ns={},Gn={},go={},Mu;function Hy(){return Mu||(Mu=1,Object.defineProperty(go,"__esModule",{value:!0})),go}var yo={},zu;function Vy(){return zu||(zu=1,Object.defineProperty(yo,"__esModule",{value:!0})),yo}var wo={},ju;function Ky(){return ju||(ju=1,Object.defineProperty(wo,"__esModule",{value:!0})),wo}var mo={},qu;function Wy(){return qu||(qu=1,Object.defineProperty(mo,"__esModule",{value:!0})),mo}var bo={},Hu;function Gy(){return Hu||(Hu=1,Object.defineProperty(bo,"__esModule",{value:!0})),bo}var rs={},Vu;function Yy(){if(Vu)return rs;Vu=1,Object.defineProperty(rs,"__esModule",{value:!0}),rs.classnames=s;const t=o=>Object.entries(o).map(([a,c])=>c&&a),e=o=>!!o,n=(o,a,c)=>c.indexOf(o)===a,r=[];function i(o){return o?typeof o=="string"?[o]:Array.isArray(o)?o.flatMap(i).filter(e):t(o).filter(e):r}function s(o){const a=i(o).filter(n);return a.length>0?a.join(" "):void 0}return rs}var Ku;function Qy(){return Ku||(Ku=1,function(t){var e=Gn&&Gn.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),n=Gn&&Gn.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(Hy(),t),n(Vy(),t),n(Ky(),t),n(Wy(),t),n(Gy(),t),n(Yy(),t)}(Gn)),Gn}var Wu;function Gu(){if(Wu)return ns;Wu=1,Object.defineProperty(ns,"__esModule",{value:!0}),ns.setAttributes=r;const t=Qy();function e(i,s){for(const o of Object.keys(i))o in s&&(s[o]=i[o])}const n=new RegExp("^on\\p{Lu}","u");function r(i,s){for(const o of Object.keys(s)){if(o==="__source"||o==="__self"||o==="tsxTag")continue;const a=s[o];if(o==="class"){const c=(0,t.classnames)(a);c&&i.setAttribute(o,c)}else if(o==="ref")a.current=i;else if(n.test(o)){const c=o.replace(/Capture$/,""),u=o!==c,l=c.toLowerCase().substring(2);i.addEventListener(l,a,u)}else o==="style"&&typeof a!="string"?e(a,i.style):o==="dangerouslySetInnerHTML"?i.innerHTML=a:a===!0?i.setAttribute(o,o):(a||a===0||a==="")&&i.setAttribute(o,a.toString())}}return ns}var Ir={},Yu;function Qu(){if(Yu)return Ir;Yu=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.applyChildren=e,Ir.createDomElement=n,Ir.applyTsxTag=r;function t(i,s){s instanceof Element?i.appendChild(s):typeof s=="string"||typeof s=="number"?i.appendChild(document.createTextNode(s.toString())):console.warn("Unknown type to append: ",s)}function e(i,s){for(const o of s)!o&&o!==0||(Array.isArray(o)?e(i,o):t(i,o))}function n(i,s){const o=s!=null&&s.is?{is:s.is}:void 0;return s!=null&&s.xmlns?document.createElementNS(s.xmlns,i,o):document.createElement(i,o)}function r(i,s){let o=i,a=s;return a&&"tsxTag"in a&&(o=a.tsxTag,!a.is&&i.includes("-")&&(a={...a,is:i})),{finalTag:o,finalAttrs:a}}return Ir}var Zu;function Zy(){if(Zu)return In;Zu=1,Object.defineProperty(In,"__esModule",{value:!0}),In.createRef=In.h=void 0,In.createElement=n;const t=Gu(),e=Qu();function n(i,s,...o){if(typeof i=="function")return i({...s,children:o});const{finalTag:a,finalAttrs:c}=(0,e.applyTsxTag)(i,s),u=(0,e.createDomElement)(a,c);return c&&(0,t.setAttributes)(u,c),(0,e.applyChildren)(u,o),u}In.h=n;const r=()=>({current:null});return In.createRef=r,In}var is={},Dr={},Ju;function Xu(){if(Ju)return Dr;Ju=1,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.jsx=n,Dr.jsxs=n,Dr.jsxDEV=n;const t=Gu(),e=Qu();function n(r,i){if(typeof r=="function")return r(i);const{children:s,...o}=i,{finalTag:a,finalAttrs:c}=(0,e.applyTsxTag)(r,o),u=(0,e.createDomElement)(a,c);return(0,t.setAttributes)(u,c),(0,e.applyChildren)(u,[s]),u}return Dr}var el;function Jy(){if(el)return is;el=1,Object.defineProperty(is,"__esModule",{value:!0}),is.defineCustomElement=e;const t=Xu();function e(n,r,i){return customElements.define(n,r,i),s=>(0,t.jsx)(n,s)}return is}var vo={},tl;function Xy(){return tl||(tl=1,Object.defineProperty(vo,"__esModule",{value:!0})),vo}var nl;function ew(){return nl||(nl=1,function(t){var e=Wn&&Wn.__createBinding||(Object.create?function(r,i,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(i,s);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[s]}}),Object.defineProperty(r,o,a)}:function(r,i,s,o){o===void 0&&(o=s),r[o]=i[s]}),n=Wn&&Wn.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(Zy(),t),n(Jy(),t),n(Xu(),t),n(Xy(),t)}(Wn)),Wn}var Dt=ew();function zt(t){const e=`btnAsset${t.code}`;return Dt.h("button",{id:e,class:"w-full flex items-center space-x-2 border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50"},Dt.h("img",{src:t.img,alt:t.title,style:"height: 34px; width: 44px;"}),Dt.h("span",null,t.title)).outerHTML}function Pe(t){const e=`btnNetwork${t.code}`;return Dt.h("button",{id:e,class:"w-full flex items-center space-x-2 border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50"},Dt.h("img",{src:t.img,alt:t.name,style:"height: 34px; width: 44px;"}),Dt.h("span",null,t.name)).outerHTML}var ss={exports:{}},rl;function tw(){if(rl)return ss.exports;rl=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(A,S,F){return Function.prototype.apply.call(A,S,F)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(A){return Object.getOwnPropertyNames(A).concat(Object.getOwnPropertySymbols(A))}:n=function(A){return Object.getOwnPropertyNames(A)};function r(_){console&&console.warn&&console.warn(_)}var i=Number.isNaN||function(A){return A!==A};function s(){s.init.call(this)}ss.exports=s,ss.exports.once=$,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(_){if(typeof _!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof _)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(_){if(typeof _!="number"||_<0||i(_))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+_+".");o=_}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(A){if(typeof A!="number"||A<0||i(A))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+A+".");return this._maxListeners=A,this};function c(_){return _._maxListeners===void 0?s.defaultMaxListeners:_._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(A){for(var S=[],F=1;F<arguments.length;F++)S.push(arguments[F]);var j=A==="error",O=this._events;if(O!==void 0)j=j&&O.error===void 0;else if(!j)return!1;if(j){var M;if(S.length>0&&(M=S[0]),M instanceof Error)throw M;var z=new Error("Unhandled error."+(M?" ("+M.message+")":""));throw z.context=M,z}var q=O[A];if(q===void 0)return!1;if(typeof q=="function")e(q,this,S);else for(var C=q.length,B=f(q,C),F=0;F<C;++F)e(B[F],this,S);return!0};function u(_,A,S,F){var j,O,M;if(a(S),O=_._events,O===void 0?(O=_._events=Object.create(null),_._eventsCount=0):(O.newListener!==void 0&&(_.emit("newListener",A,S.listener?S.listener:S),O=_._events),M=O[A]),M===void 0)M=O[A]=S,++_._eventsCount;else if(typeof M=="function"?M=O[A]=F?[S,M]:[M,S]:F?M.unshift(S):M.push(S),j=c(_),j>0&&M.length>j&&!M.warned){M.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+M.length+" "+String(A)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.emitter=_,z.type=A,z.count=M.length,r(z)}return _}s.prototype.addListener=function(A,S){return u(this,A,S,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(A,S){return u(this,A,S,!0)};function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(_,A,S){var F={fired:!1,wrapFn:void 0,target:_,type:A,listener:S},j=l.bind(F);return j.listener=S,F.wrapFn=j,j}s.prototype.once=function(A,S){return a(S),this.on(A,h(this,A,S)),this},s.prototype.prependOnceListener=function(A,S){return a(S),this.prependListener(A,h(this,A,S)),this},s.prototype.removeListener=function(A,S){var F,j,O,M,z;if(a(S),j=this._events,j===void 0)return this;if(F=j[A],F===void 0)return this;if(F===S||F.listener===S)--this._eventsCount===0?this._events=Object.create(null):(delete j[A],j.removeListener&&this.emit("removeListener",A,F.listener||S));else if(typeof F!="function"){for(O=-1,M=F.length-1;M>=0;M--)if(F[M]===S||F[M].listener===S){z=F[M].listener,O=M;break}if(O<0)return this;O===0?F.shift():g(F,O),F.length===1&&(j[A]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",A,z||S)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(A){var S,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[A]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete F[A]),this;if(arguments.length===0){var O=Object.keys(F),M;for(j=0;j<O.length;++j)M=O[j],M!=="removeListener"&&this.removeAllListeners(M);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(S=F[A],typeof S=="function")this.removeListener(A,S);else if(S!==void 0)for(j=S.length-1;j>=0;j--)this.removeListener(A,S[j]);return this};function d(_,A,S){var F=_._events;if(F===void 0)return[];var j=F[A];return j===void 0?[]:typeof j=="function"?S?[j.listener||j]:[j]:S?I(j):f(j,j.length)}s.prototype.listeners=function(A){return d(this,A,!0)},s.prototype.rawListeners=function(A){return d(this,A,!1)},s.listenerCount=function(_,A){return typeof _.listenerCount=="function"?_.listenerCount(A):y.call(_,A)},s.prototype.listenerCount=y;function y(_){var A=this._events;if(A!==void 0){var S=A[_];if(typeof S=="function")return 1;if(S!==void 0)return S.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function f(_,A){for(var S=new Array(A),F=0;F<A;++F)S[F]=_[F];return S}function g(_,A){for(;A+1<_.length;A++)_[A]=_[A+1];_.pop()}function I(_){for(var A=new Array(_.length),S=0;S<A.length;++S)A[S]=_[S].listener||_[S];return A}function $(_,A){return new Promise(function(S,F){function j(M){_.removeListener(A,O),F(M)}function O(){typeof _.removeListener=="function"&&_.removeListener("error",j),S([].slice.call(arguments))}D(_,A,O,{once:!0}),A!=="error"&&R(_,j,{once:!0})})}function R(_,A,S){typeof _.on=="function"&&D(_,"error",A,S)}function D(_,A,S,F){if(typeof _.on=="function")F.once?_.once(A,S):_.on(A,S);else if(typeof _.addEventListener=="function")_.addEventListener(A,function j(O){F.once&&_.removeEventListener(A,j),S(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof _)}return ss.exports}var jt=tw();const il=ts(jt);var Eo={};/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var xo=function(t,e){return xo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},xo(t,e)};function nw(t,e){xo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var _o=function(){return _o=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_o.apply(this,arguments)};function rw(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function iw(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function sw(t,e){return function(n,r){e(n,r,t)}}function ow(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function aw(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function cw(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function uw(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function lw(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function So(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function sl(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function hw(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(sl(arguments[e]));return t}function dw(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Xr(t){return this instanceof Xr?(this.v=t,this):new Xr(t)}function fw(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(y){return new Promise(function(f,g){s.push([d,y,f,g])>1||a(d,y)})})}function a(d,y){try{c(r[d](y))}catch(f){h(s[0][3],f)}}function c(d){d.value instanceof Xr?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,y){d(y),s.shift(),s.length&&a(s[0][0],s[0][1])}}function pw(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Xr(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function gw(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof So=="function"?So(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function yw(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function ww(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function mw(t){return t&&t.__esModule?t:{default:t}}function bw(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function vw(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const os=Fu(Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return _o},__asyncDelegator:pw,__asyncGenerator:fw,__asyncValues:gw,__await:Xr,__awaiter:aw,__classPrivateFieldGet:bw,__classPrivateFieldSet:vw,__createBinding:uw,__decorate:iw,__exportStar:lw,__extends:nw,__generator:cw,__importDefault:mw,__importStar:ww,__makeTemplateObject:yw,__metadata:ow,__param:sw,__read:sl,__rest:rw,__spread:hw,__spreadArrays:dw,__values:So},Symbol.toStringTag,{value:"Module"})));var Ao={},ei={},ol;function Ew(){if(ol)return ei;ol=1,Object.defineProperty(ei,"__esModule",{value:!0}),ei.delay=void 0;function t(e){return new Promise(n=>{setTimeout(()=>{n(!0)},e)})}return ei.delay=t,ei}var Yn={},Io={},Qn={},al;function xw(){return al||(al=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.ONE_THOUSAND=Qn.ONE_HUNDRED=void 0,Qn.ONE_HUNDRED=100,Qn.ONE_THOUSAND=1e3),Qn}var Do={},cl;function _w(){return cl||(cl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Do)),Do}var ul;function ll(){return ul||(ul=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=os;e.__exportStar(xw(),t),e.__exportStar(_w(),t)}(Io)),Io}var hl;function Sw(){if(hl)return Yn;hl=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.fromMiliseconds=Yn.toMiliseconds=void 0;const t=ll();function e(r){return r*t.ONE_THOUSAND}Yn.toMiliseconds=e;function n(r){return Math.floor(r/t.ONE_THOUSAND)}return Yn.fromMiliseconds=n,Yn}var dl;function Aw(){return dl||(dl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=os;e.__exportStar(Ew(),t),e.__exportStar(Sw(),t)}(Ao)),Ao}var Or={},fl;function Iw(){if(fl)return Or;fl=1,Object.defineProperty(Or,"__esModule",{value:!0}),Or.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const r=this.get(n);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const i=Date.now()-r.started;this.timestamps.set(n,{started:r.started,elapsed:i})}get(n){const r=this.timestamps.get(n);if(typeof r>"u")throw new Error(`No timestamp found for label: ${n}`);return r}elapsed(n){const r=this.get(n);return r.elapsed||Date.now()-r.started}}return Or.Watch=t,Or.default=t,Or}var Oo={},ti={},pl;function Dw(){if(pl)return ti;pl=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.IWatch=void 0;class t{}return ti.IWatch=t,ti}var gl;function Ow(){return gl||(gl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),os.__exportStar(Dw(),t)}(Oo)),Oo}var yl;function $w(){return yl||(yl=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=os;e.__exportStar(Aw(),t),e.__exportStar(Iw(),t),e.__exportStar(Ow(),t),e.__exportStar(ll(),t)}(Eo)),Eo}var ee=$w();class Zn{}let Cw=class extends Zn{constructor(e){super()}};const wl=ee.FIVE_SECONDS,Jn={pulse:"heartbeat_pulse"};let Pw=class g0 extends Cw{constructor(e){super(e),this.events=new jt.EventEmitter,this.interval=wl,this.interval=(e==null?void 0:e.interval)||wl}static async init(e){const n=new g0(e);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),ee.toMiliseconds(this.interval))}pulse(){this.events.emit(Jn.pulse)}};const Bw=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Tw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,kw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Rw(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Nw(t);return}return e}function Nw(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function as(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!kw.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Bw.test(t)||Tw.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Rw)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}function Uw(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ze(t,...e){try{return Uw(t(...e))}catch(n){return Promise.reject(n)}}function Fw(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Lw(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function cs(t){if(Fw(t))return String(t);if(Lw(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return cs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const $o="base64:";function Mw(t){return typeof t=="string"?t:$o+qw(t)}function zw(t){return typeof t!="string"||!t.startsWith($o)?t:jw(t.slice($o.length))}function jw(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function qw(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function ut(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Hw(...t){return ut(t.join(":"))}function us(t){return t=ut(t),t?t+":":""}function Vw(t,e){if(e===void 0)return!0;let n=0,r=t.indexOf(":");for(;r>-1;)n++,r=t.indexOf(":",r+1);return n<=e}function Kw(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function TO(t){return t}const Ww="memory",Gw=()=>{const t=new Map;return{name:Ww,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,n){t.set(e,n)},setItemRaw(e,n){t.set(e,n)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Yw(t={}){const e={mounts:{"":t.driver||Gw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},r=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=ut(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await ml(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const d=new Map,y=f=>{let g=d.get(f.base);return g||(g={driver:f.driver,base:f.base,items:[]},d.set(f.base,g)),g};for(const f of u){const g=typeof f=="string",I=ut(g?f:f.key),$=g?void 0:f.value,R=g||!f.options?l:{...l,...f.options},D=n(I);y(D).items.push({key:I,value:$,relativeKey:D.relativeKey,options:R})}return Promise.all([...d.values()].map(f=>h(f))).then(f=>f.flat())},c={hasItem(u,l={}){u=ut(u);const{relativeKey:h,driver:d}=n(u);return ze(d.hasItem,h,l)},getItem(u,l={}){u=ut(u);const{relativeKey:h,driver:d}=n(u);return ze(d.getItem,h,l).then(y=>as(y))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?ze(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(y=>({key:Hw(h.base,y.key),value:as(y.value)}))):Promise.all(h.items.map(d=>ze(h.driver.getItem,d.relativeKey,d.options).then(y=>({key:d.key,value:as(y)})))))},getItemRaw(u,l={}){u=ut(u);const{relativeKey:h,driver:d}=n(u);return d.getItemRaw?ze(d.getItemRaw,h,l):ze(d.getItem,h,l).then(y=>zw(y))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=ut(u);const{relativeKey:d,driver:y}=n(u);y.setItem&&(await ze(y.setItem,d,cs(l),h),y.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return ze(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:cs(d.value),options:d.options})),l);h.driver.setItem&&await Promise.all(h.items.map(d=>ze(h.driver.setItem,d.relativeKey,cs(d.value),d.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=ut(u);const{relativeKey:d,driver:y}=n(u);if(y.setItemRaw)await ze(y.setItemRaw,d,l,h);else if(y.setItem)await ze(y.setItem,d,Mw(l),h);else return;y.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=ut(u);const{relativeKey:h,driver:d}=n(u);d.removeItem&&(await ze(d.removeItem,h,l),(l.removeMeta||l.removeMata)&&await ze(d.removeItem,h+"$",l),d.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=ut(u);const{relativeKey:h,driver:d}=n(u),y=Object.create(null);if(d.getMeta&&Object.assign(y,await ze(d.getMeta,h,l)),!l.nativeOnly){const f=await ze(d.getItem,h+"$",l).then(g=>as(g));f&&typeof f=="object"&&(typeof f.atime=="string"&&(f.atime=new Date(f.atime)),typeof f.mtime=="string"&&(f.mtime=new Date(f.mtime)),Object.assign(y,f))}return y},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){var I;u=us(u);const h=r(u,!0);let d=[];const y=[];let f=!0;for(const $ of h){(I=$.driver.flags)!=null&&I.maxDepth||(f=!1);const R=await ze($.driver.getKeys,$.relativeBase,l);for(const D of R){const _=$.mountpoint+ut(D);d.some(A=>_.startsWith(A))||y.push(_)}d=[$.mountpoint,...d.filter(D=>!D.startsWith($.mountpoint))]}const g=l.maxDepth!==void 0&&!f;return y.filter($=>(!g||Vw($,l.maxDepth))&&Kw($,u))},async clear(u,l={}){u=us(u),await Promise.all(r(u,!1).map(async h=>{if(h.driver.clear)return ze(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(d.map(y=>h.driver.removeItem(y,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>bl(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=us(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(ml(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){var h,d;u=us(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&((d=(h=e.unwatch)[u])==null||d.call(h),delete e.unwatch[u]),l&&await bl(e.mounts[u]),e.mountpoints=e.mountpoints.filter(y=>y!==u),delete e.mounts[u])},getMount(u=""){u=ut(u)+":";const l=n(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=ut(u),r(u,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function ml(t,e,n){return t.watch?t.watch((r,i)=>e(r,n+i)):()=>{}}async function bl(t){typeof t.dispose=="function"&&await ze(t.dispose)}function Xn(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function vl(t,e){let n;const r=()=>{if(n)return n;const i=indexedDB.open(t);return i.onupgradeneeded=()=>i.result.createObjectStore(e),n=Xn(i),n.then(s=>{s.onclose=()=>n=void 0},()=>{}),n};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let Co;function ni(){return Co||(Co=vl("keyval-store","keyval")),Co}function El(t,e=ni()){return e("readonly",n=>Xn(n.get(t)))}function Qw(t,e,n=ni()){return n("readwrite",r=>(r.put(e,t),Xn(r.transaction)))}function Zw(t,e=ni()){return e("readwrite",n=>(n.delete(t),Xn(n.transaction)))}function Jw(t=ni()){return t("readwrite",e=>(e.clear(),Xn(e.transaction)))}function Xw(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Xn(t.transaction)}function e1(t=ni()){return t("readonly",e=>{if(e.getAllKeys)return Xn(e.getAllKeys());const n=[];return Xw(e,r=>n.push(r.key)).then(()=>n)})}const t1=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),n1=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function $r(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return n1(t)}catch{return t}}function er(t){return typeof t=="string"?t:t1(t)||""}const r1="idb-keyval";var i1=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",n=i=>e+i;let r;return t.dbName&&t.storeName&&(r=vl(t.dbName,t.storeName)),{name:r1,options:t,async hasItem(i){return!(typeof await El(n(i),r)>"u")},async getItem(i){return await El(n(i),r)??null},setItem(i,s){return Qw(n(i),s,r)},removeItem(i){return Zw(n(i),r)},getKeys(){return e1(r)},clear(){return Jw(r)}}};const s1="WALLET_CONNECT_V2_INDEXED_DB",o1="keyvaluestorage";let a1=class{constructor(){this.indexedDb=Yw({driver:i1({dbName:s1,storeName:o1})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const n=await this.indexedDb.getItem(e);if(n!==null)return n}async setItem(e,n){await this.indexedDb.setItem(e,er(n))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ls={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},t.prototype.setItem=function(n,r){this[n]=String(r)},t.prototype.removeItem=function(n){delete this[n]},t.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(r){n[r]=void 0,delete n[r]})},t.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Po<"u"&&Po.localStorage?ls.exports=Po.localStorage:typeof window<"u"&&window.localStorage?ls.exports=window.localStorage:ls.exports=new e})();function c1(t){var e;return[t[0],$r((e=t[1])!=null?e:"")]}let u1=class{constructor(){this.localStorage=ls.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(c1)}async getItem(e){const n=this.localStorage.getItem(e);if(n!==null)return $r(n)}async setItem(e,n){this.localStorage.setItem(e,er(n))}async removeItem(e){this.localStorage.removeItem(e)}};const l1="wc_storage_version",xl=1,h1=async(t,e,n)=>{const r=l1,i=await e.getItem(r);if(i&&i>=xl){n(e);return}const s=await t.getKeys();if(!s.length){n(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(r,xl),n(e),d1(t,o)},d1=async(t,e)=>{e.length&&e.forEach(async n=>{await t.removeItem(n)})};let f1=class{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const e=new u1;this.storage=e;try{const n=new a1;h1(e,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,n){return await this.initialize(),this.storage.setItem(e,n)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),e())},20)})}};var Bo,_l;function p1(){if(_l)return Bo;_l=1;function t(n){try{return JSON.stringify(n)}catch{return'"[Circular]"'}}Bo=e;function e(n,r,i){var s=i&&i.stringify||t,o=1;if(typeof n=="object"&&n!==null){var a=r.length+o;if(a===1)return n;var c=new Array(a);c[0]=s(n);for(var u=1;u<a;u++)c[u]=s(r[u]);return c.join(" ")}if(typeof n!="string")return n;var l=r.length;if(l===0)return n;for(var h="",d=1-o,y=-1,f=n&&n.length||0,g=0;g<f;){if(n.charCodeAt(g)===37&&g+1<f){switch(y=y>-1?y:0,n.charCodeAt(g+1)){case 100:case 102:if(d>=l||r[d]==null)break;y<g&&(h+=n.slice(y,g)),h+=Number(r[d]),y=g+2,g++;break;case 105:if(d>=l||r[d]==null)break;y<g&&(h+=n.slice(y,g)),h+=Math.floor(Number(r[d])),y=g+2,g++;break;case 79:case 111:case 106:if(d>=l||r[d]===void 0)break;y<g&&(h+=n.slice(y,g));var I=typeof r[d];if(I==="string"){h+="'"+r[d]+"'",y=g+2,g++;break}if(I==="function"){h+=r[d].name||"<anonymous>",y=g+2,g++;break}h+=s(r[d]),y=g+2,g++;break;case 115:if(d>=l)break;y<g&&(h+=n.slice(y,g)),h+=String(r[d]),y=g+2,g++;break;case 37:y<g&&(h+=n.slice(y,g)),h+="%",y=g+2,g++,d--;break}++d}++g}return y===-1?n:(y<f&&(h+=n.slice(y)),h)}return Bo}var To,Sl;function g1(){if(Sl)return To;Sl=1;const t=p1();To=i;const e=A().console||{},n={mapHttpRequest:f,mapHttpResponse:f,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:f,res:f,err:d};function r(S,F){return Array.isArray(S)?S.filter(function(O){return O!=="!stdSerializers.err"}):S===!0?Object.keys(F):!1}function i(S){S=S||{},S.browser=S.browser||{};const F=S.browser.transmit;if(F&&typeof F.send!="function")throw Error("pino: transmit option must have a send function");const j=S.browser.write||e;S.browser.write&&(S.browser.asObject=!0);const O=S.serializers||{},M=r(S.browser.serialize,O);let z=S.browser.serialize;Array.isArray(S.browser.serialize)&&S.browser.serialize.indexOf("!stdSerializers.err")>-1&&(z=!1);const q=["error","fatal","warn","info","debug","trace"];typeof j=="function"&&(j.error=j.fatal=j.warn=j.info=j.debug=j.trace=j),S.enabled===!1&&(S.level="silent");const C=S.level||"info",B=Object.create(j);B.log||(B.log=I),Object.defineProperty(B,"levelVal",{get:w}),Object.defineProperty(B,"level",{get:E,set:T});const x={transmit:F,serialize:M,asObject:S.browser.asObject,levels:q,timestamp:y(S)};B.levels=i.levels,B.level=C,B.setMaxListeners=B.getMaxListeners=B.emit=B.addListener=B.on=B.prependListener=B.once=B.prependOnceListener=B.removeListener=B.removeAllListeners=B.listeners=B.listenerCount=B.eventNames=B.write=B.flush=I,B.serializers=O,B._serialize=M,B._stdErrSerialize=z,B.child=N,F&&(B._logEvent=h());function w(){return this.level==="silent"?1/0:this.levels.values[this.level]}function E(){return this._level}function T(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,s(x,B,"error","log"),s(x,B,"fatal","error"),s(x,B,"warn","error"),s(x,B,"info","log"),s(x,B,"debug","log"),s(x,B,"trace","log")}function N(U,H){if(!U)throw new Error("missing bindings for child Pino");H=H||{},M&&U.serializers&&(H.serializers=U.serializers);const G=H.serializers;if(M&&G){var Y=Object.assign({},O,G),J=S.browser.serialize===!0?Object.keys(Y):M;delete U.serializers,c([U],J,Y,this._stdErrSerialize)}function X(ie){this._childLevel=(ie._childLevel|0)+1,this.error=u(ie,U,"error"),this.fatal=u(ie,U,"fatal"),this.warn=u(ie,U,"warn"),this.info=u(ie,U,"info"),this.debug=u(ie,U,"debug"),this.trace=u(ie,U,"trace"),Y&&(this.serializers=Y,this._serialize=J),F&&(this._logEvent=h([].concat(ie._logEvent.bindings,U)))}return X.prototype=this,new X(this)}return B}i.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},i.stdSerializers=n,i.stdTimeFunctions=Object.assign({},{nullTime:$,epochTime:R,unixTime:D,isoTime:_});function s(S,F,j,O){const M=Object.getPrototypeOf(F);F[j]=F.levelVal>F.levels.values[j]?I:M[j]?M[j]:e[j]||e[O]||I,o(S,F,j)}function o(S,F,j){!S.transmit&&F[j]===I||(F[j]=function(O){return function(){const z=S.timestamp(),q=new Array(arguments.length),C=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var B=0;B<q.length;B++)q[B]=arguments[B];if(S.serialize&&!S.asObject&&c(q,this._serialize,this.serializers,this._stdErrSerialize),S.asObject?O.call(C,a(this,j,q,z)):O.apply(C,q),S.transmit){const x=S.transmit.level||F.level,w=i.levels.values[x],E=i.levels.values[j];if(E<w)return;l(this,{ts:z,methodLevel:j,methodValue:E,transmitValue:i.levels.values[S.transmit.level||F.level],send:S.transmit.send,val:F.levelVal},q)}}}(F[j]))}function a(S,F,j,O){S._serialize&&c(j,S._serialize,S.serializers,S._stdErrSerialize);const M=j.slice();let z=M[0];const q={};O&&(q.time=O),q.level=i.levels.values[F];let C=(S._childLevel|0)+1;if(C<1&&(C=1),z!==null&&typeof z=="object"){for(;C--&&typeof M[0]=="object";)Object.assign(q,M.shift());z=M.length?t(M.shift(),M):void 0}else typeof z=="string"&&(z=t(M.shift(),M));return z!==void 0&&(q.msg=z),q}function c(S,F,j,O){for(const M in S)if(O&&S[M]instanceof Error)S[M]=i.stdSerializers.err(S[M]);else if(typeof S[M]=="object"&&!Array.isArray(S[M]))for(const z in S[M])F&&F.indexOf(z)>-1&&z in j&&(S[M][z]=j[z](S[M][z]))}function u(S,F,j){return function(){const O=new Array(1+arguments.length);O[0]=F;for(var M=1;M<O.length;M++)O[M]=arguments[M-1];return S[j].apply(this,O)}}function l(S,F,j){const O=F.send,M=F.ts,z=F.methodLevel,q=F.methodValue,C=F.val,B=S._logEvent.bindings;c(j,S._serialize||Object.keys(S.serializers),S.serializers,S._stdErrSerialize===void 0?!0:S._stdErrSerialize),S._logEvent.ts=M,S._logEvent.messages=j.filter(function(x){return B.indexOf(x)===-1}),S._logEvent.level.label=z,S._logEvent.level.value=q,O(z,S._logEvent,C),S._logEvent=h(B)}function h(S){return{ts:0,messages:[],bindings:S||[],level:{label:"",value:0}}}function d(S){const F={type:S.constructor.name,msg:S.message,stack:S.stack};for(const j in S)F[j]===void 0&&(F[j]=S[j]);return F}function y(S){return typeof S.timestamp=="function"?S.timestamp:S.timestamp===!1?$:R}function f(){return{}}function g(S){return S}function I(){}function $(){return!1}function R(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function _(){return new Date(Date.now()).toISOString()}function A(){function S(F){return typeof F<"u"&&F}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return S(self)||S(window)||S(this)||{}}}return To}var Cr=g1();const hs=ts(Cr),y1={level:"info"},ri="custom_context",ko=1e3*1024;let w1=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Al=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const n=new w1(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const n=e.value;return e=e.next,{done:!1,value:n}}}}},Il=class{constructor(e,n=ko){this.level=e??"error",this.levelValue=Cr.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new Al(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===Cr.levels.values.error?console.error(e):n===Cr.levels.values.warn?console.warn(e):n===Cr.levels.values.debug?console.debug(e):n===Cr.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(er({timestamp:new Date().toISOString(),log:e}));const n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new Al(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const n=this.getLogArray();return n.push(er({extraMetadata:e})),new Blob(n,{type:"application/json"})}},m1=class{constructor(e,n=ko){this.baseChunkLogger=new Il(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const n=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}},b1=class{constructor(e,n=ko){this.baseChunkLogger=new Il(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var v1=Object.defineProperty,E1=Object.defineProperties,x1=Object.getOwnPropertyDescriptors,Dl=Object.getOwnPropertySymbols,_1=Object.prototype.hasOwnProperty,S1=Object.prototype.propertyIsEnumerable,Ol=(t,e,n)=>e in t?v1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ds=(t,e)=>{for(var n in e||(e={}))_1.call(e,n)&&Ol(t,n,e[n]);if(Dl)for(var n of Dl(e))S1.call(e,n)&&Ol(t,n,e[n]);return t},fs=(t,e)=>E1(t,x1(e));function Ro(t){return fs(ds({},t),{level:(t==null?void 0:t.level)||y1.level})}function A1(t,e=ri){return t[e]||""}function I1(t,e,n=ri){return t[n]=e,t}function lt(t,e=ri){let n="";return typeof t.bindings>"u"?n=A1(t,e):n=t.bindings().context||"",n}function D1(t,e,n=ri){const r=lt(t,n);return r.trim()?`${r}/${e}`:e}function st(t,e,n=ri){const r=D1(t,e,n),i=t.child({context:r});return I1(i,r,n)}function O1(t){var e,n;const r=new m1((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hs(fs(ds({},t.opts),{level:"trace",browser:fs(ds({},(n=t.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function $1(t){var e;const n=new b1((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hs(fs(ds({},t.opts),{level:"trace"}),n),chunkLoggerController:n}}function C1(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?O1(t):$1(t)}var P1=Object.defineProperty,B1=(t,e,n)=>e in t?P1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$l=(t,e,n)=>B1(t,typeof e!="symbol"?e+"":e,n);let T1=class extends Zn{constructor(e){super(),this.opts=e,$l(this,"protocol","wc"),$l(this,"version",2)}};var k1=Object.defineProperty,R1=(t,e,n)=>e in t?k1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,N1=(t,e,n)=>R1(t,e+"",n);let U1=class extends Zn{constructor(e,n){super(),this.core=e,this.logger=n,N1(this,"records",new Map)}},F1=class{constructor(e,n){this.logger=e,this.core=n}};class L1 extends Zn{constructor(e,n){super(),this.relayer=e,this.logger=n}}let M1=class extends Zn{constructor(e){super()}},z1=class{constructor(e,n,r,i){this.core=e,this.logger=n,this.name=r}},j1=class extends Zn{constructor(e,n){super(),this.relayer=e,this.logger=n}},q1=class extends Zn{constructor(e,n){super(),this.core=e,this.logger=n}},H1=class{constructor(e,n,r){this.core=e,this.logger=n,this.store=r}},V1=class{constructor(e,n){this.projectId=e,this.logger=n}};class K1{constructor(e,n,r){this.core=e,this.logger=n,this.telemetryEnabled=r}}var W1=Object.defineProperty,G1=(t,e,n)=>e in t?W1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Cl=(t,e,n)=>G1(t,typeof e!="symbol"?e+"":e,n);let Y1=class{constructor(e){this.opts=e,Cl(this,"protocol","wc"),Cl(this,"version",2)}},Q1=class{constructor(e){this.client=e}};function Z1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pl(t,...e){if(!Z1(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Bl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function J1(t,e){Pl(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const Pr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const No=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function X1(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Tl(t){return typeof t=="string"&&(t=X1(t)),Pl(t),t}let em=class{clone(){return this._cloneInto()}};function tm(t){const e=r=>t().update(Tl(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function kl(t=32){if(Pr&&typeof Pr.getRandomValues=="function")return Pr.getRandomValues(new Uint8Array(t));if(Pr&&typeof Pr.randomBytes=="function")return Pr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function nm(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}let rm=class extends em{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=No(this.buffer)}update(e){Bl(this);const{view:n,buffer:r,blockLen:i}=this;e=Tl(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=No(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Bl(this),J1(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;nm(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=No(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const ps=BigInt(2**32-1),Uo=BigInt(32);function Rl(t,e=!1){return e?{h:Number(t&ps),l:Number(t>>Uo&ps)}:{h:Number(t>>Uo&ps)|0,l:Number(t&ps)|0}}function im(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Rl(t[i],e);[n[i],r[i]]=[s,o]}return[n,r]}const sm=(t,e)=>BigInt(t>>>0)<<Uo|BigInt(e>>>0),om=(t,e,n)=>t>>>n,am=(t,e,n)=>t<<32-n|e>>>n,cm=(t,e,n)=>t>>>n|e<<32-n,um=(t,e,n)=>t<<32-n|e>>>n,lm=(t,e,n)=>t<<64-n|e>>>n-32,hm=(t,e,n)=>t>>>n-32|e<<64-n,dm=(t,e)=>e,fm=(t,e)=>t,pm=(t,e,n)=>t<<n|e>>>32-n,gm=(t,e,n)=>e<<n|t>>>32-n,ym=(t,e,n)=>e<<n-32|t>>>64-n,wm=(t,e,n)=>t<<n-32|e>>>64-n;function mm(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const bm=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),vm=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,Em=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),xm=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,_m=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),Sm=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,ye={fromBig:Rl,split:im,toBig:sm,shrSH:om,shrSL:am,rotrSH:cm,rotrSL:um,rotrBH:lm,rotrBL:hm,rotr32H:dm,rotr32L:fm,rotlSH:pm,rotlSL:gm,rotlBH:ym,rotlBL:wm,add:mm,add3L:bm,add3H:vm,add4L:Em,add4H:xm,add5H:Sm,add5L:_m},[Am,Im]=ye.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Dn=new Uint32Array(80),On=new Uint32Array(80);let Dm=class extends rm{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:y,Gl:f,Hh:g,Hl:I}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I]}set(e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=I|0}process(e,n){for(let D=0;D<16;D++,n+=4)Dn[D]=e.getUint32(n),On[D]=e.getUint32(n+=4);for(let D=16;D<80;D++){const _=Dn[D-15]|0,A=On[D-15]|0,S=ye.rotrSH(_,A,1)^ye.rotrSH(_,A,8)^ye.shrSH(_,A,7),F=ye.rotrSL(_,A,1)^ye.rotrSL(_,A,8)^ye.shrSL(_,A,7),j=Dn[D-2]|0,O=On[D-2]|0,M=ye.rotrSH(j,O,19)^ye.rotrBH(j,O,61)^ye.shrSH(j,O,6),z=ye.rotrSL(j,O,19)^ye.rotrBL(j,O,61)^ye.shrSL(j,O,6),q=ye.add4L(F,z,On[D-7],On[D-16]),C=ye.add4H(q,S,M,Dn[D-7],Dn[D-16]);Dn[D]=C|0,On[D]=q|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:y,Fl:f,Gh:g,Gl:I,Hh:$,Hl:R}=this;for(let D=0;D<80;D++){const _=ye.rotrSH(h,d,14)^ye.rotrSH(h,d,18)^ye.rotrBH(h,d,41),A=ye.rotrSL(h,d,14)^ye.rotrSL(h,d,18)^ye.rotrBL(h,d,41),S=h&y^~h&g,F=d&f^~d&I,j=ye.add5L(R,A,F,Im[D],On[D]),O=ye.add5H(j,$,_,S,Am[D],Dn[D]),M=j|0,z=ye.rotrSH(r,i,28)^ye.rotrBH(r,i,34)^ye.rotrBH(r,i,39),q=ye.rotrSL(r,i,28)^ye.rotrBL(r,i,34)^ye.rotrBL(r,i,39),C=r&s^r&a^s&a,B=i&o^i&c^o&c;$=g|0,R=I|0,g=y|0,I=f|0,y=h|0,f=d|0,{h,l:d}=ye.add(u|0,l|0,O|0,M|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const x=ye.add3L(M,q,B);r=ye.add3H(x,O,z,C),i=x|0}({h:r,l:i}=ye.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=ye.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ye.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=ye.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=ye.add(this.Eh|0,this.El|0,h|0,d|0),{h:y,l:f}=ye.add(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:I}=ye.add(this.Gh|0,this.Gl|0,g|0,I|0),{h:$,l:R}=ye.add(this.Hh|0,this.Hl|0,$|0,R|0),this.set(r,i,s,o,a,c,u,l,h,d,y,f,g,I,$,R)}roundClean(){Dn.fill(0),On.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Om=tm(()=>new Dm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fo=BigInt(0),Nl=BigInt(1),$m=BigInt(2);function Lo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Mo(t){if(!Lo(t))throw new Error("Uint8Array expected")}function zo(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const Cm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function jo(t){Mo(t);let e="";for(let n=0;n<t.length;n++)e+=Cm[t[n]];return e}function Ul(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Fo:BigInt("0x"+t)}const cn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Fl(t){if(t>=cn._0&&t<=cn._9)return t-cn._0;if(t>=cn.A&&t<=cn.F)return t-(cn.A-10);if(t>=cn.a&&t<=cn.f)return t-(cn.a-10)}function Ll(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Fl(t.charCodeAt(s)),a=Fl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Pm(t){return Ul(jo(t))}function gs(t){return Mo(t),Ul(jo(Uint8Array.from(t).reverse()))}function Ml(t,e){return Ll(t.toString(16).padStart(e*2,"0"))}function qo(t,e){return Ml(t,e).reverse()}function un(t,e,n){let r;if(typeof e=="string")try{r=Ll(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Lo(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function zl(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Mo(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const Ho=t=>typeof t=="bigint"&&Fo<=t;function Bm(t,e,n){return Ho(t)&&Ho(e)&&Ho(n)&&e<=t&&t<n}function ii(t,e,n,r){if(!Bm(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Tm(t){let e;for(e=0;t>Fo;t>>=Nl,e+=1);return e}const km=t=>($m<<BigInt(t-1))-Nl,Rm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Lo(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Vo(t,e,n={}){const r=(i,s,o)=>{const a=Rm[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}function jl(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const je=BigInt(0),Te=BigInt(1),tr=BigInt(2),Nm=BigInt(3),Ko=BigInt(4),ql=BigInt(5),Hl=BigInt(8);function Ue(t,e){const n=t%e;return n>=je?n:e+n}function Um(t,e,n){if(e<je)throw new Error("invalid exponent, negatives unsupported");if(n<=je)throw new Error("invalid modulus");if(n===Te)return je;let r=Te;for(;e>je;)e&Te&&(r=r*t%n),t=t*t%n,e>>=Te;return r}function Zt(t,e,n){let r=t;for(;e-- >je;)r*=r,r%=n;return r}function Vl(t,e){if(t===je)throw new Error("invert: expected non-zero number");if(e<=je)throw new Error("invert: expected positive modulus, got "+e);let n=Ue(t,e),r=e,i=je,s=Te;for(;n!==je;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==Te)throw new Error("invert: does not exist");return Ue(i,e)}function Fm(t){const e=(t-Te)/tr;let n,r,i;for(n=t-Te,r=0;n%tr===je;n/=tr,r++);for(i=tr;i<t&&Um(i,e,t)!==t-Te;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+Te)/Ko;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(n+Te)/tr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,u=o.pow(o.mul(o.ONE,i),n),l=o.pow(a,s),h=o.pow(a,n);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let f=o.sqr(h);d<c&&!o.eql(f,o.ONE);d++)f=o.sqr(f);const y=o.pow(u,Te<<BigInt(c-d-1));u=o.sqr(y),l=o.mul(l,y),h=o.mul(h,u),c=d}return l}}function Lm(t){if(t%Ko===Nm){const e=(t+Te)/Ko;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Hl===ql){const e=(t-ql)/Hl;return function(n,r){const i=n.mul(r,tr),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,tr),s),c=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(c),r))throw new Error("Cannot find square root");return c}}return Fm(t)}const Mm=(t,e)=>(Ue(t,e)&Te)===Te,zm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function jm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=zm.reduce((r,i)=>(r[i]="function",r),e);return Vo(t,n)}function qm(t,e,n){if(n<je)throw new Error("invalid exponent, negatives unsupported");if(n===je)return t.ONE;if(n===Te)return e;let r=t.ONE,i=e;for(;n>je;)n&Te&&(r=t.mul(r,i)),i=t.sqr(i),n>>=Te;return r}function Hm(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function Kl(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Wl(t,e,n=!1,r={}){if(t<=je)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Kl(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:km(i),ZERO:je,ONE:Te,create:c=>Ue(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return je<=c&&c<t},is0:c=>c===je,isOdd:c=>(c&Te)===Te,neg:c=>Ue(-c,t),eql:(c,u)=>c===u,sqr:c=>Ue(c*c,t),add:(c,u)=>Ue(c+u,t),sub:(c,u)=>Ue(c-u,t),mul:(c,u)=>Ue(c*u,t),pow:(c,u)=>qm(a,c,u),div:(c,u)=>Ue(c*Vl(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Vl(c,t),sqrt:r.sqrt||(c=>(o||(o=Lm(t)),o(a,c))),invertBatch:c=>Hm(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>n?qo(c,s):Ml(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?gs(c):Pm(c)}});return Object.freeze(a)}const Gl=BigInt(0),ys=BigInt(1);function Wo(t,e){const n=e.negate();return t?n:e}function Yl(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Go(t,e){Yl(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1);return{windows:n,windowSize:r}}function Vm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function Km(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const Yo=new WeakMap,Ql=new WeakMap;function Qo(t){return Ql.get(t)||1}function Wm(t,e){return{constTimeNegate:Wo,hasPrecomputes(n){return Qo(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>Gl;)r&ys&&(i=i.add(s)),s=s.double(),r>>=ys;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=Go(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){const{windows:s,windowSize:o}=Go(n,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**n-1),l=2**n,h=BigInt(n);for(let d=0;d<s;d++){const y=d*o;let f=Number(i&u);i>>=h,f>o&&(f-=l,i+=ys);const g=y,I=y+Math.abs(f)-1,$=d%2!==0,R=f<0;f===0?c=c.add(Wo($,r[g])):a=a.add(Wo(R,r[I]))}return{p:a,f:c}},wNAFUnsafe(n,r,i,s=t.ZERO){const{windows:o,windowSize:a}=Go(n,e),c=BigInt(2**n-1),u=2**n,l=BigInt(n);for(let h=0;h<o;h++){const d=h*a;if(i===Gl)break;let y=Number(i&c);if(i>>=l,y>a&&(y-=u,i+=ys),y===0)continue;let f=r[d+Math.abs(y)-1];y<0&&(f=f.negate()),s=s.add(f)}return s},getPrecomputes(n,r,i){let s=Yo.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Yo.set(r,i(s))),s},wNAFCached(n,r,i){const s=Qo(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Qo(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){Yl(r,e),Ql.set(n,r),Yo.delete(n)}}}function Gm(t,e,n,r){if(Vm(n,t),Km(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=Tm(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let y=0;y<r.length;y++){const f=r[y],g=Number(f>>BigInt(h)&BigInt(a));c[g]=c[g].add(n[y])}let d=i;for(let y=c.length-1,f=i;y>0;y--)f=f.add(c[y]),d=d.add(f);if(l=l.add(d),h!==0)for(let y=0;y<o;y++)l=l.double()}return l}function Ym(t){return jm(t.Fp),Vo(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Kl(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const qt=BigInt(0),ht=BigInt(1),ws=BigInt(2),Qm=BigInt(8),Zm={zip215:!0};function Jm(t){const e=Ym(t);return Vo(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Xm(t){const e=Jm(t),{Fp:n,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=ws<<BigInt(a*8)-ht,l=n.create,h=Wl(e.n,e.nBitLength),d=e.uvRatio||((x,w)=>{try{return{isValid:!0,value:n.sqrt(x*n.inv(w))}}catch{return{isValid:!1,value:qt}}}),y=e.adjustScalarBytes||(x=>x),f=e.domain||((x,w,E)=>{if(zo("phflag",E),w.length||E)throw new Error("Contexts/pre-hash are not supported");return x});function g(x,w){ii("coordinate "+x,w,qt,u)}function I(x){if(!(x instanceof D))throw new Error("ExtendedPoint expected")}const $=jl((x,w)=>{const{ex:E,ey:T,ez:N}=x,U=x.is0();w==null&&(w=U?Qm:n.inv(N));const H=l(E*w),G=l(T*w),Y=l(N*w);if(U)return{x:qt,y:ht};if(Y!==ht)throw new Error("invZ was invalid");return{x:H,y:G}}),R=jl(x=>{const{a:w,d:E}=e;if(x.is0())throw new Error("bad point: ZERO");const{ex:T,ey:N,ez:U,et:H}=x,G=l(T*T),Y=l(N*N),J=l(U*U),X=l(J*J),ie=l(G*w),ue=l(J*l(ie+Y)),fe=l(X+l(E*l(G*Y)));if(ue!==fe)throw new Error("bad point: equation left != right (1)");const le=l(T*N),ce=l(U*H);if(le!==ce)throw new Error("bad point: equation left != right (2)");return!0});class D{constructor(w,E,T,N){this.ex=w,this.ey=E,this.ez=T,this.et=N,g("x",w),g("y",E),g("z",T),g("t",N),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof D)throw new Error("extended point not allowed");const{x:E,y:T}=w||{};return g("x",E),g("y",T),new D(E,T,ht,l(E*T))}static normalizeZ(w){const E=n.invertBatch(w.map(T=>T.ez));return w.map((T,N)=>T.toAffine(E[N])).map(D.fromAffine)}static msm(w,E){return Gm(D,h,w,E)}_setWindowSize(w){S.setWindowSize(this,w)}assertValidity(){R(this)}equals(w){I(w);const{ex:E,ey:T,ez:N}=this,{ex:U,ey:H,ez:G}=w,Y=l(E*G),J=l(U*N),X=l(T*G),ie=l(H*N);return Y===J&&X===ie}is0(){return this.equals(D.ZERO)}negate(){return new D(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:w}=e,{ex:E,ey:T,ez:N}=this,U=l(E*E),H=l(T*T),G=l(ws*l(N*N)),Y=l(w*U),J=E+T,X=l(l(J*J)-U-H),ie=Y+H,ue=ie-G,fe=Y-H,le=l(X*ue),ce=l(ie*fe),P=l(X*fe),p=l(ue*ie);return new D(le,ce,p,P)}add(w){I(w);const{a:E,d:T}=e,{ex:N,ey:U,ez:H,et:G}=this,{ex:Y,ey:J,ez:X,et:ie}=w;if(E===BigInt(-1)){const W=l((U-N)*(J+Y)),Q=l((U+N)*(J-Y)),V=l(Q-W);if(V===qt)return this.double();const se=l(H*ws*ie),pe=l(G*ws*X),he=pe+se,ne=Q+W,re=pe-se,be=l(he*V),De=l(ne*re),ae=l(he*re),ve=l(V*ne);return new D(be,De,ve,ae)}const ue=l(N*Y),fe=l(U*J),le=l(G*T*ie),ce=l(H*X),P=l((N+U)*(Y+J)-ue-fe),p=ce-le,m=ce+le,b=l(fe-E*ue),v=l(P*p),L=l(m*b),k=l(P*b),K=l(p*m);return new D(v,L,K,k)}subtract(w){return this.add(w.negate())}wNAF(w){return S.wNAFCached(this,w,D.normalizeZ)}multiply(w){const E=w;ii("scalar",E,ht,r);const{p:T,f:N}=this.wNAF(E);return D.normalizeZ([T,N])[0]}multiplyUnsafe(w,E=D.ZERO){const T=w;return ii("scalar",T,qt,r),T===qt?A:this.is0()||T===ht?this:S.wNAFCachedUnsafe(this,T,D.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return S.unsafeLadder(this,r).is0()}toAffine(w){return $(this,w)}clearCofactor(){const{h:w}=e;return w===ht?this:this.multiplyUnsafe(w)}static fromHex(w,E=!1){const{d:T,a:N}=e,U=n.BYTES;w=un("pointHex",w,U),zo("zip215",E);const H=w.slice(),G=w[U-1];H[U-1]=G&-129;const Y=gs(H),J=E?u:n.ORDER;ii("pointHex.y",Y,qt,J);const X=l(Y*Y),ie=l(X-ht),ue=l(T*X-N);let{isValid:fe,value:le}=d(ie,ue);if(!fe)throw new Error("Point.fromHex: invalid y coordinate");const ce=(le&ht)===ht,P=(G&128)!==0;if(!E&&le===qt&&P)throw new Error("Point.fromHex: x=0 and x_0=1");return P!==ce&&(le=l(-le)),D.fromAffine({x:le,y:Y})}static fromPrivateKey(w){return O(w).point}toRawBytes(){const{x:w,y:E}=this.toAffine(),T=qo(E,n.BYTES);return T[T.length-1]|=w&ht?128:0,T}toHex(){return jo(this.toRawBytes())}}D.BASE=new D(e.Gx,e.Gy,ht,l(e.Gx*e.Gy)),D.ZERO=new D(qt,ht,ht,qt);const{BASE:_,ZERO:A}=D,S=Wm(D,a*8);function F(x){return Ue(x,r)}function j(x){return F(gs(x))}function O(x){const w=n.BYTES;x=un("private key",x,w);const E=un("hashed private key",s(x),2*w),T=y(E.slice(0,w)),N=E.slice(w,2*w),U=j(T),H=_.multiply(U),G=H.toRawBytes();return{head:T,prefix:N,scalar:U,point:H,pointBytes:G}}function M(x){return O(x).pointBytes}function z(x=new Uint8Array,...w){const E=zl(...w);return j(s(f(E,un("context",x),!!i)))}function q(x,w,E={}){x=un("message",x),i&&(x=i(x));const{prefix:T,scalar:N,pointBytes:U}=O(w),H=z(E.context,T,x),G=_.multiply(H).toRawBytes(),Y=z(E.context,G,U,x),J=F(H+Y*N);ii("signature.s",J,qt,r);const X=zl(G,qo(J,n.BYTES));return un("result",X,n.BYTES*2)}const C=Zm;function B(x,w,E,T=C){const{context:N,zip215:U}=T,H=n.BYTES;x=un("signature",x,2*H),w=un("message",w),E=un("publicKey",E,H),U!==void 0&&zo("zip215",U),i&&(w=i(w));const G=gs(x.slice(H,2*H));let Y,J,X;try{Y=D.fromHex(E,U),J=D.fromHex(x.slice(0,H),U),X=_.multiplyUnsafe(G)}catch{return!1}if(!U&&Y.isSmallOrder())return!1;const ie=z(N,J.toRawBytes(),Y.toRawBytes(),w);return J.add(Y.multiplyUnsafe(ie)).subtract(X).clearCofactor().equals(D.ZERO)}return _._setWindowSize(8),{CURVE:e,getPublicKey:M,sign:q,verify:B,ExtendedPoint:D,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>o(n.BYTES),precompute(x=8,w=D.BASE){return w._setWindowSize(x),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const Zo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Zl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const eb=BigInt(1),Jl=BigInt(2);BigInt(3);const tb=BigInt(5),nb=BigInt(8);function rb(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=Zo,o=t*t%s*t%s,a=Zt(o,Jl,s)*o%s,c=Zt(a,eb,s)*t%s,u=Zt(c,tb,s)*c%s,l=Zt(u,e,s)*u%s,h=Zt(l,n,s)*l%s,d=Zt(h,r,s)*h%s,y=Zt(d,i,s)*d%s,f=Zt(y,i,s)*d%s,g=Zt(f,e,s)*u%s;return{pow_p_5_8:Zt(g,Jl,s)*t%s,b2:o}}function ib(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function sb(t,e){const n=Zo,r=Ue(e*e*e,n),i=Ue(r*r*e,n),s=rb(t*i).pow_p_5_8;let o=Ue(t*r*s,n);const a=Ue(e*o*o,n),c=o,u=Ue(o*Zl,n),l=a===t,h=a===Ue(-t,n),d=a===Ue(-t*Zl,n);return l&&(o=c),(h||d)&&(o=u),Mm(o,n)&&(o=Ue(-o,n)),{isValid:l||h,value:o}}const ob=Wl(Zo,void 0,!0),ab={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ob,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:nb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Om,randomBytes:kl,adjustScalarBytes:ib,uvRatio:sb},Xl=Xm(ab),cb="EdDSA",ub="JWT",ms=".",bs="base64url",eh="utf8",th="utf8",lb=":",hb="did",db="key",nh="base58btc",fb="z",pb="K36",gb=32;function Jo(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function rh(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Jo(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ih(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=rh(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return Jo(n)}function yb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,I=0,$=0,R=f.length;$!==R&&f[$]===0;)$++,g++;for(var D=(R-$)*l+1>>>0,_=new Uint8Array(D);$!==R;){for(var A=f[$],S=0,F=D-1;(A!==0||S<I)&&F!==-1;F--,S++)A+=256*_[F]>>>0,_[F]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");I=S,$++}for(var j=D-I;j!==D&&_[j]===0;)j++;for(var O=c.repeat(g);j<D;++j)O+=t.charAt(_[j]);return O}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var I=0,$=0;f[g]===c;)I++,g++;for(var R=(f.length-g)*u+1>>>0,D=new Uint8Array(R);f[g];){var _=n[f.charCodeAt(g)];if(_===255)return;for(var A=0,S=R-1;(_!==0||A<$)&&S!==-1;S--,A++)_+=a*D[S]>>>0,D[S]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");$=A,g++}if(f[g]!==" "){for(var F=R-$;F!==R&&D[F]===0;)F++;for(var j=new Uint8Array(I+(R-F)),O=I;F!==R;)j[O++]=D[F++];return j}}}function y(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var wb=yb,mb=wb;const sh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},bb=t=>new TextEncoder().encode(t),vb=t=>new TextDecoder().decode(t);let Eb=class{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},xb=class{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oh(this,e)}},_b=class{constructor(e){this.decoders=e}or(e){return oh(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const oh=(t,e)=>new _b({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Sb=class{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new Eb(e,n,r),this.decoder=new xb(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const vs=({name:t,prefix:e,encode:n,decode:r})=>new Sb(t,e,n,r),si=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=mb(n,e);return vs({prefix:t,name:e,encode:r,decode:s=>sh(i(s))})},Ab=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ib=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Ge=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>vs({prefix:e,name:t,encode(i){return Ib(i,r,n)},decode(i){return Ab(i,r,n,t)}}),Db=vs({prefix:"\0",name:"identity",encode:t=>vb(t),decode:t=>bb(t)});var Ob=Object.freeze({__proto__:null,identity:Db});const $b=Ge({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Cb=Object.freeze({__proto__:null,base2:$b});const Pb=Ge({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Bb=Object.freeze({__proto__:null,base8:Pb});const Tb=si({prefix:"9",name:"base10",alphabet:"0123456789"});var kb=Object.freeze({__proto__:null,base10:Tb});const Rb=Ge({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Nb=Ge({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ub=Object.freeze({__proto__:null,base16:Rb,base16upper:Nb});const Fb=Ge({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Lb=Ge({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Mb=Ge({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zb=Ge({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jb=Ge({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qb=Ge({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hb=Ge({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vb=Ge({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Kb=Ge({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Wb=Object.freeze({__proto__:null,base32:Fb,base32upper:Lb,base32pad:Mb,base32padupper:zb,base32hex:jb,base32hexupper:qb,base32hexpad:Hb,base32hexpadupper:Vb,base32z:Kb});const Gb=si({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Yb=si({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Qb=Object.freeze({__proto__:null,base36:Gb,base36upper:Yb});const Zb=si({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jb=si({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xb=Object.freeze({__proto__:null,base58btc:Zb,base58flickr:Jb});const e2=Ge({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),t2=Ge({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),n2=Ge({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),r2=Ge({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var i2=Object.freeze({__proto__:null,base64:e2,base64pad:t2,base64url:n2,base64urlpad:r2});const ah=Array.from(""),s2=ah.reduce((t,e,n)=>(t[n]=e,t),[]),o2=ah.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function a2(t){return t.reduce((e,n)=>(e+=s2[n],e),"")}function c2(t){const e=[];for(const n of t){const r=o2[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const u2=vs({prefix:"",name:"base256emoji",encode:a2,decode:c2});var l2=Object.freeze({__proto__:null,base256emoji:u2}),h2=uh,ch=128,d2=-128,f2=Math.pow(2,31);function uh(t,e,n){e=e||[],n=n||0;for(var r=n;t>=f2;)e[n++]=t&255|ch,t/=128;for(;t&d2;)e[n++]=t&255|ch,t>>>=7;return e[n]=t|0,uh.bytes=n-r+1,e}var p2=Xo,g2=128,lh=127;function Xo(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw Xo.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&lh)<<i:(o&lh)*Math.pow(2,i),i+=7}while(o>=g2);return Xo.bytes=s-r,n}var y2=Math.pow(2,7),w2=Math.pow(2,14),m2=Math.pow(2,21),b2=Math.pow(2,28),v2=Math.pow(2,35),E2=Math.pow(2,42),x2=Math.pow(2,49),_2=Math.pow(2,56),S2=Math.pow(2,63),A2=function(t){return t<y2?1:t<w2?2:t<m2?3:t<b2?4:t<v2?5:t<E2?6:t<x2?7:t<_2?8:t<S2?9:10},I2={encode:h2,decode:p2,encodingLength:A2},hh=I2;const dh=(t,e,n=0)=>(hh.encode(t,e,n),e),fh=t=>hh.encodingLength(t),ea=(t,e)=>{const n=e.byteLength,r=fh(t),i=r+fh(n),s=new Uint8Array(i+n);return dh(t,s,0),dh(n,s,r),s.set(e,i),new D2(t,n,e,s)};let D2=class{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}};const ph=({name:t,code:e,encode:n})=>new O2(t,e,n);let O2=class{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?ea(this.code,n):n.then(r=>ea(this.code,r))}else throw Error("Unknown type, must be binary type")}};const gh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),$2=ph({name:"sha2-256",code:18,encode:gh("SHA-256")}),C2=ph({name:"sha2-512",code:19,encode:gh("SHA-512")});var P2=Object.freeze({__proto__:null,sha256:$2,sha512:C2});const yh=0,B2="identity",wh=sh;var T2=Object.freeze({__proto__:null,identity:{code:yh,name:B2,encode:wh,digest:t=>ea(yh,wh(t))}});new TextEncoder,new TextDecoder;const mh={...Ob,...Cb,...Bb,...kb,...Ub,...Wb,...Qb,...Xb,...i2,...l2};({...P2,...T2});function bh(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const vh=bh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ta=bh("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=rh(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Eh={utf8:vh,"utf-8":vh,hex:mh.base16,latin1:ta,ascii:ta,binary:ta,...mh};function Es(t,e="utf8"){const n=Eh[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}function Br(t,e="utf8"){const n=Eh[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Jo(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function xh(t){return $r(Es(Br(t,bs),eh))}function xs(t){return Es(Br(er(t),eh),bs)}function _h(t){const e=Br(pb,nh),n=fb+Es(ih([e,t]),nh);return[hb,db,n].join(lb)}function k2(t){return Es(t,bs)}function R2(t){return Br(t,bs)}function N2(t){return Br([xs(t.header),xs(t.payload)].join(ms),th)}function U2(t){return[xs(t.header),xs(t.payload),k2(t.signature)].join(ms)}function na(t){const e=t.split(ms),n=xh(e[0]),r=xh(e[1]),i=R2(e[2]),s=Br(e.slice(0,2).join(ms),th);return{header:n,payload:r,signature:i,data:s}}function Sh(t=kl(gb)){const e=Xl.getPublicKey(t);return{secretKey:ih([t,e]),publicKey:e}}async function F2(t,e,n,r,i=ee.fromMiliseconds(Date.now())){const s={alg:cb,typ:ub},o=_h(r.publicKey),a=i+n,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=N2({header:s,payload:c}),l=Xl.sign(u,r.secretKey.slice(0,32));return U2({header:s,payload:c,signature:l})}var Ah=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},L2=function(){function t(e,n,r){this.name=e,this.version=n,this.os=r,this.type="browser"}return t}(),M2=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),z2=function(){function t(e,n,r,i){this.name=e,this.version=n,this.os=r,this.bot=i,this.type="bot-device"}return t}(),j2=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),q2=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),H2=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,V2=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ih=3,K2=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",H2]],Dh=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function W2(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new q2:typeof navigator<"u"?Y2(navigator.userAgent):Z2()}function G2(t){return t!==""&&K2.reduce(function(e,n){var r=n[0],i=n[1];if(e)return e;var s=i.exec(t);return!!s&&[r,s]},!1)}function Y2(t){var e=G2(t);if(!e)return null;var n=e[0],r=e[1];if(n==="searchbot")return new j2;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<Ih&&(i=Ah(Ah([],i,!0),J2(Ih-i.length),!0)):i=[];var s=i.join("."),o=Q2(t),a=V2.exec(t);return a&&a[1]?new z2(n,s,o,a[1]):new L2(n,s,o)}function Q2(t){for(var e=0,n=Dh.length;e<n;e++){var r=Dh[e],i=r[0],s=r[1],o=s.exec(t);if(o)return i}return null}function Z2(){var t=typeof process<"u"&&process.version;return t?new M2(process.version.slice(1)):null}function J2(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}var Ae={},Oh;function $h(){if(Oh)return Ae;Oh=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.getLocalStorage=Ae.getLocalStorageOrThrow=Ae.getCrypto=Ae.getCryptoOrThrow=Ae.getLocation=Ae.getLocationOrThrow=Ae.getNavigator=Ae.getNavigatorOrThrow=Ae.getDocument=Ae.getDocumentOrThrow=Ae.getFromWindowOrThrow=Ae.getFromWindow=void 0;function t(d){let y;return typeof window<"u"&&typeof window[d]<"u"&&(y=window[d]),y}Ae.getFromWindow=t;function e(d){const y=t(d);if(!y)throw new Error(`${d} is not defined in Window`);return y}Ae.getFromWindowOrThrow=e;function n(){return e("document")}Ae.getDocumentOrThrow=n;function r(){return t("document")}Ae.getDocument=r;function i(){return e("navigator")}Ae.getNavigatorOrThrow=i;function s(){return t("navigator")}Ae.getNavigator=s;function o(){return e("location")}Ae.getLocationOrThrow=o;function a(){return t("location")}Ae.getLocation=a;function c(){return e("crypto")}Ae.getCryptoOrThrow=c;function u(){return t("crypto")}Ae.getCrypto=u;function l(){return e("localStorage")}Ae.getLocalStorageOrThrow=l;function h(){return t("localStorage")}return Ae.getLocalStorage=h,Ae}var ln=$h(),oi={},Ch;function X2(){if(Ch)return oi;Ch=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.getWindowMetadata=void 0;const t=$h();function e(){let n,r;try{n=t.getDocumentOrThrow(),r=t.getLocationOrThrow()}catch{return null}function i(){const y=n.getElementsByTagName("link"),f=[];for(let g=0;g<y.length;g++){const I=y[g],$=I.getAttribute("rel");if($&&$.toLowerCase().indexOf("icon")>-1){const R=I.getAttribute("href");if(R)if(R.toLowerCase().indexOf("https:")===-1&&R.toLowerCase().indexOf("http:")===-1&&R.indexOf("//")!==0){let D=r.protocol+"//"+r.host;if(R.indexOf("/")===0)D+=R;else{const _=r.pathname.split("/");_.pop();const A=_.join("/");D+=A+"/"+R}f.push(D)}else if(R.indexOf("//")===0){const D=r.protocol+R;f.push(D)}else f.push(R)}}return f}function s(...y){const f=n.getElementsByTagName("meta");for(let g=0;g<f.length;g++){const I=f[g],$=["itemprop","property","name"].map(R=>I.getAttribute(R)).filter(R=>R?y.includes(R):!1);if($.length&&$){const R=I.getAttribute("content");if(R)return R}}return""}function o(){let y=s("name","og:site_name","og:title","twitter:title");return y||(y=n.title),y}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),u=a(),l=r.origin,h=i();return{description:u,url:l,icons:h,name:c}}return oi.getWindowMetadata=e,oi}var ev=X2();function tv(t,e){const n=t.exec(e);return n==null?void 0:n.groups}const Ph=/^tuple(?<array>(\[(\d*)\])*)$/;function ra(t){let e=t.type;if(Ph.test(t.type)&&"components"in t){e="(";const n=t.components.length;for(let i=0;i<n;i++){const s=t.components[i];e+=ra(s),i<n-1&&(e+=", ")}const r=tv(Ph,t.type);return e+=`)${(r==null?void 0:r.array)??""}`,ra({...t,type:e})}return"indexed"in t&&t.indexed&&(e=`${e} indexed`),t.name?`${e} ${t.name}`:e}function ai(t){let e="";const n=t.length;for(let r=0;r<n;r++){const i=t[r];e+=ra(i),r!==n-1&&(e+=", ")}return e}function nv(t){var e;return t.type==="function"?`function ${t.name}(${ai(t.inputs)})${t.stateMutability&&t.stateMutability!=="nonpayable"?` ${t.stateMutability}`:""}${(e=t.outputs)!=null&&e.length?` returns (${ai(t.outputs)})`:""}`:t.type==="event"?`event ${t.name}(${ai(t.inputs)})`:t.type==="error"?`error ${t.name}(${ai(t.inputs)})`:t.type==="constructor"?`constructor(${ai(t.inputs)})${t.stateMutability==="payable"?" payable":""}`:t.type==="fallback"?`fallback() external${t.stateMutability==="payable"?" payable":""}`:"receive() external payable"}function ci(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function ia(t){return ci(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Bh="2.31.0";let ui={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${Bh}`},_s=class du extends Error{constructor(e,n={}){var a;const r=(()=>{var c;return n.cause instanceof du?n.cause.details:(c=n.cause)!=null&&c.message?n.cause.message:n.details})(),i=n.cause instanceof du&&n.cause.docsPath||n.docsPath,s=(a=ui.getDocsUrl)==null?void 0:a.call(ui,{...n,docsPath:i}),o=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...r?[`Details: ${r}`]:[],...ui.version?[`Version: ${ui.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=Bh}walk(e){return Th(this,e)}};function Th(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Th(t.cause,e):e?null:t}let kh=class extends _s{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}};function Tr(t,{dir:e,size:n=32}={}){return typeof t=="string"?rv(t,{dir:e,size:n}):iv(t,{dir:e,size:n})}function rv(t,{dir:e,size:n=32}={}){if(n===null)return t;const r=t.replace("0x","");if(r.length>n*2)throw new kh({size:Math.ceil(r.length/2),targetSize:n,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function iv(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new kh({size:t.length,targetSize:n,type:"bytes"});const r=new Uint8Array(n);for(let i=0;i<n;i++){const s=e==="right";r[s?i:n-i-1]=t[s?i:t.length-i-1]}return r}let sv=class extends _s{constructor({max:e,min:n,signed:r,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${i*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}},ov=class extends _s{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}};function kr(t,{size:e}){if(ia(t)>e)throw new ov({givenSize:ia(t),maxSize:e})}function sa(t,e={}){const{signed:n}=e;e.size&&kr(t,{size:e.size});const r=BigInt(t);if(!n)return r;const i=(t.length-2)/2,s=(1n<<BigInt(i)*8n-1n)-1n;return r<=s?r:r-BigInt(`0x${"f".padStart(i*2,"f")}`)-1n}function av(t,e={}){return Number(sa(t,e))}const cv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function oa(t,e={}){return typeof t=="number"||typeof t=="bigint"?Nh(t,e):typeof t=="string"?hv(t,e):typeof t=="boolean"?uv(t,e):Rh(t,e)}function uv(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(kr(n,{size:e.size}),Tr(n,{size:e.size})):n}function Rh(t,e={}){let n="";for(let i=0;i<t.length;i++)n+=cv[t[i]];const r=`0x${n}`;return typeof e.size=="number"?(kr(r,{size:e.size}),Tr(r,{dir:"right",size:e.size})):r}function Nh(t,e={}){const{signed:n,size:r}=e,i=BigInt(t);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const c=typeof t=="bigint"?"n":"";throw new sv({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:n,size:r,value:`${t}${c}`})}const a=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?Tr(a,{size:r}):a}const lv=new TextEncoder;function hv(t,e={}){const n=lv.encode(t);return Rh(n,e)}const dv=new TextEncoder;function fv(t,e={}){return typeof t=="number"||typeof t=="bigint"?gv(t,e):typeof t=="boolean"?pv(t,e):ci(t)?Fh(t,e):Lh(t,e)}function pv(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(kr(n,{size:e.size}),Tr(n,{size:e.size})):n}const hn={zero:48,nine:57,A:65,F:70,a:97,f:102};function Uh(t){if(t>=hn.zero&&t<=hn.nine)return t-hn.zero;if(t>=hn.A&&t<=hn.F)return t-(hn.A-10);if(t>=hn.a&&t<=hn.f)return t-(hn.a-10)}function Fh(t,e={}){let n=t;e.size&&(kr(n,{size:e.size}),n=Tr(n,{dir:"right",size:e.size}));let r=n.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,s=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=Uh(r.charCodeAt(a++)),u=Uh(r.charCodeAt(a++));if(c===void 0||u===void 0)throw new _s(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);s[o]=c*16+u}return s}function gv(t,e){const n=Nh(t,e);return Fh(n)}function Lh(t,e={}){const n=dv.encode(t);return typeof e.size=="number"?(kr(n,{size:e.size}),Tr(n,{dir:"right",size:e.size})):n}const Ss=BigInt(2**32-1),Mh=BigInt(32);function yv(t,e=!1){return e?{h:Number(t&Ss),l:Number(t>>Mh&Ss)}:{h:Number(t>>Mh&Ss)|0,l:Number(t&Ss)|0}}function wv(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=yv(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const mv=(t,e,n)=>t<<n|e>>>32-n,bv=(t,e,n)=>e<<n|t>>>32-n,vv=(t,e,n)=>e<<n-32|t>>>64-n,Ev=(t,e,n)=>t<<n-32|e>>>64-n,Rr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function li(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function nr(t,...e){if(!xv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function _v(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");li(t.outputLen),li(t.blockLen)}function Nr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zh(t,e){nr(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Sv(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ur(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function aa(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Jt(t,e){return t<<32-e|t>>>e}const Av=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Iv(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Dv(t){for(let e=0;e<t.length;e++)t[e]=Iv(t[e]);return t}const jh=Av?t=>t:Dv;function Ov(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function As(t){return typeof t=="string"&&(t=Ov(t)),nr(t),t}function $v(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];nr(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}class ca{}function qh(t){const e=r=>t().update(As(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Cv(t=32){if(Rr&&typeof Rr.getRandomValues=="function")return Rr.getRandomValues(new Uint8Array(t));if(Rr&&typeof Rr.randomBytes=="function")return Uint8Array.from(Rr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Pv=BigInt(0),hi=BigInt(1),Bv=BigInt(2),Tv=BigInt(7),kv=BigInt(256),Rv=BigInt(113),Hh=[],Vh=[],Kh=[];for(let t=0,e=hi,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Hh.push(2*(5*r+n)),Vh.push((t+1)*(t+2)/2%64);let i=Pv;for(let s=0;s<7;s++)e=(e<<hi^(e>>Tv)*Rv)%kv,e&Bv&&(i^=hi<<(hi<<BigInt(s))-hi);Kh.push(i)}const Wh=wv(Kh,!0),Nv=Wh[0],Uv=Wh[1],Gh=(t,e,n)=>n>32?vv(t,e,n):mv(t,e,n),Yh=(t,e,n)=>n>32?Ev(t,e,n):bv(t,e,n);function Fv(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=Gh(u,l,1)^n[a],d=Yh(u,l,1)^n[a+1];for(let y=0;y<50;y+=10)t[o+y]^=h,t[o+y+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Vh[o],c=Gh(i,s,a),u=Yh(i,s,a),l=Hh[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=Nv[r],t[1]^=Uv[r]}Ur(n)}class ua extends ca{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,li(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Sv(this.state)}clone(){return this._cloneInto()}keccak(){jh(this.state32),Fv(this.state32,this.rounds),jh(this.state32),this.posOut=0,this.pos=0}update(e){Nr(this),e=As(e),nr(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Nr(this,!1),nr(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return li(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(zh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ur(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new ua(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Lv=(t,e,n)=>qh(()=>new ua(e,t,n)),Qh=Lv(1,136,256/8);function Zh(t,e){const n=e||"hex",r=Qh(ci(t,{strict:!1})?fv(t):t);return n==="bytes"?r:oa(r)}let Mv=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}};const la=new Mv(8192);function zv(t,e){if(la.has(`${t}.${e}`))return la.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),r=Zh(Lh(n),"bytes"),i=n.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(r[o>>1]&15)>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const s=`0x${i.join("")}`;return la.set(`${t}.${e}`,s),s}function jv(t){const e=Zh(`0x${t.substring(4)}`).substring(26);return zv(`0x${e}`)}async function qv({hash:t,signature:e}){const n=ci(t)?t:oa(t),{secp256k1:r}=await Promise.resolve().then(()=>IE);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:u,s:l,v:h,yParity:d}=e,y=Number(d??h),f=Jh(y);return new r.Signature(sa(u),sa(l)).addRecoveryBit(f)}const o=ci(e)?e:oa(e);if(ia(o)!==65)throw new Error("invalid signature length");const a=av(`0x${o.slice(130)}`),c=Jh(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(n.substring(2)).toHex(!1)}`}function Jh(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function Hv({hash:t,signature:e}){return jv(await qv({hash:t,signature:e}))}function Vv(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function Kv(t,e,n){return t&e^~t&n}function Wv(t,e,n){return t&e^t&n^e&n}class Gv extends ca{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=aa(this.buffer)}update(e){Nr(this),e=As(e),nr(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=aa(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nr(this),zh(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,Ur(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;Vv(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=aa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const $n=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Yv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Cn=new Uint32Array(64);class Qv extends Gv{constructor(e=32){super(64,e,8,!1),this.A=$n[0]|0,this.B=$n[1]|0,this.C=$n[2]|0,this.D=$n[3]|0,this.E=$n[4]|0,this.F=$n[5]|0,this.G=$n[6]|0,this.H=$n[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)Cn[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=Cn[h-15],y=Cn[h-2],f=Jt(d,7)^Jt(d,18)^d>>>3,g=Jt(y,17)^Jt(y,19)^y>>>10;Cn[h]=g+Cn[h-7]+f+Cn[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=Jt(a,6)^Jt(a,11)^Jt(a,25),y=l+d+Kv(a,c,u)+Yv[h]+Cn[h]|0,g=(Jt(r,2)^Jt(r,13)^Jt(r,22))+Wv(r,i,s)|0;l=u,u=c,c=a,a=o+y|0,o=s,s=i,i=r,r=y+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){Ur(Cn)}destroy(){this.set(0,0,0,0,0,0,0,0),Ur(this.buffer)}}const Zv=qh(()=>new Qv);class Xh extends ca{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,_v(e);const r=As(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Ur(s)}update(e){return Nr(this),this.iHash.update(e),this}digestInto(e){Nr(this),nr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ed=(t,e,n)=>new Xh(t,e).update(n).digest();ed.create=(t,e)=>new Xh(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ha=BigInt(0),da=BigInt(1);function di(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fa(t){if(!di(t))throw new Error("Uint8Array expected")}function fi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Is(t){const e=t.toString(16);return e.length&1?"0"+e:e}function td(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ha:BigInt("0x"+t)}const nd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Jv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function pi(t){if(fa(t),nd)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Jv[t[n]];return e}const dn={_0:48,_9:57,A:65,F:70,a:97,f:102};function rd(t){if(t>=dn._0&&t<=dn._9)return t-dn._0;if(t>=dn.A&&t<=dn.F)return t-(dn.A-10);if(t>=dn.a&&t<=dn.f)return t-(dn.a-10)}function Ds(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(nd)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=rd(t.charCodeAt(s)),a=rd(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function rr(t){return td(pi(t))}function id(t){return fa(t),td(pi(Uint8Array.from(t).reverse()))}function gi(t,e){return Ds(t.toString(16).padStart(e*2,"0"))}function sd(t,e){return gi(t,e).reverse()}function Ot(t,e,n){let r;if(typeof e=="string")try{r=Ds(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(di(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function Os(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];fa(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const pa=t=>typeof t=="bigint"&&ha<=t;function ga(t,e,n){return pa(t)&&pa(e)&&pa(n)&&e<=t&&t<n}function Fr(t,e,n,r){if(!ga(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Xv(t){let e;for(e=0;t>ha;t>>=da,e+=1);return e}const $s=t=>(da<<BigInt(t))-da,ya=t=>new Uint8Array(t),od=t=>Uint8Array.from(t);function eE(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=ya(t),i=ya(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...h)=>n(i,r,...h),c=(h=ya(0))=>{i=a(od([0]),h),r=a(),h.length!==0&&(i=a(od([1]),h),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){r=a();const y=r.slice();d.push(y),h+=r.length}return Os(...d)};return(h,d)=>{o(),c(h);let y;for(;!(y=d(u()));)c();return o(),y}}const tE={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||di(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Cs(t,e,n={}){const r=(i,s,o)=>{const a=tE[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}function ad(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dt=BigInt(0),ot=BigInt(1),ir=BigInt(2),nE=BigInt(3),cd=BigInt(4),ud=BigInt(5),ld=BigInt(8);function ft(t,e){const n=t%e;return n>=dt?n:e+n}function $t(t,e,n){let r=t;for(;e-- >dt;)r*=r,r%=n;return r}function wa(t,e){if(t===dt)throw new Error("invert: expected non-zero number");if(e<=dt)throw new Error("invert: expected positive modulus, got "+e);let n=ft(t,e),r=e,i=dt,s=ot;for(;n!==dt;){const a=r/n,c=r%n,u=i-s*a;r=n,n=c,i=s,s=u}if(r!==ot)throw new Error("invert: does not exist");return ft(i,e)}function hd(t,e){const n=(t.ORDER+ot)/cd,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function rE(t,e){const n=(t.ORDER-ud)/ld,r=t.mul(e,ir),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,ir),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function iE(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-ot,n=0;for(;e%ir===dt;)e/=ir,n++;let r=ir;const i=ma(t);for(;fd(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return hd;let s=i.pow(r,e);const o=(e+ot)/ir;return function(c,u){if(c.is0(u))return u;if(fd(c,u)!==1)throw new Error("Cannot find square root");let l=n,h=c.mul(c.ONE,s),d=c.pow(u,e),y=c.pow(u,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let f=1,g=c.sqr(d);for(;!c.eql(g,c.ONE);)if(f++,g=c.sqr(g),f===l)throw new Error("Cannot find square root");const I=ot<<BigInt(l-f-1),$=c.pow(h,I);l=f,h=c.sqr($),d=c.mul(d,h),y=c.mul(y,$)}return y}}function sE(t){return t%cd===nE?hd:t%ld===ud?rE:iE(t)}const oE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function aE(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=oE.reduce((r,i)=>(r[i]="function",r),e);return Cs(t,n)}function cE(t,e,n){if(n<dt)throw new Error("invalid exponent, negatives unsupported");if(n===dt)return t.ONE;if(n===ot)return e;let r=t.ONE,i=e;for(;n>dt;)n&ot&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ot;return r}function dd(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function fd(t,e){const n=(t.ORDER-ot)/ir,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function pd(t,e){e!==void 0&&li(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function ma(t,e,n=!1,r={}){if(t<=dt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=pd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:$s(i),ZERO:dt,ONE:ot,create:c=>ft(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return dt<=c&&c<t},is0:c=>c===dt,isOdd:c=>(c&ot)===ot,neg:c=>ft(-c,t),eql:(c,u)=>c===u,sqr:c=>ft(c*c,t),add:(c,u)=>ft(c+u,t),sub:(c,u)=>ft(c-u,t),mul:(c,u)=>ft(c*u,t),pow:(c,u)=>cE(a,c,u),div:(c,u)=>ft(c*wa(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>wa(c,t),sqrt:r.sqrt||(c=>(o||(o=sE(t)),o(a,c))),toBytes:c=>n?sd(c,s):gi(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?id(c):rr(c)},invertBatch:c=>dd(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function gd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function yd(t){const e=gd(t);return e+Math.ceil(e/2)}function uE(t,e,n=!1){const r=t.length,i=gd(e),s=yd(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?id(t):rr(t),a=ft(o,e-ot)+ot;return n?sd(a,i):gi(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wd=BigInt(0),ba=BigInt(1);function va(t,e){const n=e.negate();return t?n:e}function md(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ea(t,e){md(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=$s(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function bd(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=ba);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,y=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:y,offsetF:u}}function lE(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function hE(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const xa=new WeakMap,vd=new WeakMap;function _a(t){return vd.get(t)||1}function dE(t,e){return{constTimeNegate:va,hasPrecomputes(n){return _a(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>wd;)r&ba&&(i=i.add(s)),s=s.double(),r>>=ba;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=Ea(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){let s=t.ZERO,o=t.BASE;const a=Ea(n,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:d,isNegF:y,offsetF:f}=bd(i,c,a);i=u,h?o=o.add(va(y,r[f])):s=s.add(va(d,r[l]))}return{p:s,f:o}},wNAFUnsafe(n,r,i,s=t.ZERO){const o=Ea(n,e);for(let a=0;a<o.windows&&i!==wd;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=bd(i,a,o);if(i=c,!l){const d=r[u];s=s.add(h?d.negate():d)}}return s},getPrecomputes(n,r,i){let s=xa.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&xa.set(r,i(s))),s},wNAFCached(n,r,i){const s=_a(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=_a(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){md(r,e),vd.set(n,r),xa.delete(n)}}}function fE(t,e,n,r){lE(n,t),hE(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Xv(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=$s(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let y=h;y>=0;y-=c){l.fill(o);for(let g=0;g<s;g++){const I=r[g],$=Number(I>>BigInt(y)&u);l[$]=l[$].add(n[g])}let f=o;for(let g=l.length-1,I=o;g>0;g--)I=I.add(l[g]),f=f.add(I);if(d=d.add(f),y!==0)for(let g=0;g<c;g++)d=d.double()}return d}function Ed(t){return aE(t.Fp),Cs(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...pd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xd(t){t.lowS!==void 0&&fi("lowS",t.lowS),t.prehash!==void 0&&fi("prehash",t.prehash)}function pE(t){const e=Ed(t);Cs(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class gE extends Error{constructor(e=""){super(e)}}const fn={Err:gE,_tlv:{encode:(t,e)=>{const{Err:n}=fn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=Is(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Is(i.length/2|128):"";return Is(t)+s+i+e},decode(t,e){const{Err:n}=fn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=fn;if(t<pn)throw new e("integer: negative integers are not allowed");let n=Is(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=fn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return rr(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=fn,i=Ot("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=fn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}};function Sa(t,e){return pi(gi(t,e))}const pn=BigInt(0),qe=BigInt(1);BigInt(2);const Aa=BigInt(3),yE=BigInt(4);function wE(t){const e=pE(t),{Fp:n}=e,r=ma(e.n,e.nBitLength),i=e.toBytes||((D,_,A)=>{const S=_.toAffine();return Os(Uint8Array.from([4]),n.toBytes(S.x),n.toBytes(S.y))}),s=e.fromBytes||(D=>{const _=D.subarray(1),A=n.fromBytes(_.subarray(0,n.BYTES)),S=n.fromBytes(_.subarray(n.BYTES,2*n.BYTES));return{x:A,y:S}});function o(D){const{a:_,b:A}=e,S=n.sqr(D),F=n.mul(S,D);return n.add(n.add(F,n.mul(D,_)),A)}function a(D,_){const A=n.sqr(_),S=o(D);return n.eql(A,S)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=n.mul(n.pow(e.a,Aa),yE),u=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(c,u)))throw new Error("bad curve params: a or b");function l(D){return ga(D,qe,e.n)}function h(D){const{allowedPrivateKeyLengths:_,nByteLength:A,wrapPrivateKey:S,n:F}=e;if(_&&typeof D!="bigint"){if(di(D)&&(D=pi(D)),typeof D!="string"||!_.includes(D.length))throw new Error("invalid private key");D=D.padStart(A*2,"0")}let j;try{j=typeof D=="bigint"?D:rr(Ot("private key",D,A))}catch{throw new Error("invalid private key, expected hex or "+A+" bytes, got "+typeof D)}return S&&(j=ft(j,F)),Fr("private key",j,qe,F),j}function d(D){if(!(D instanceof g))throw new Error("ProjectivePoint expected")}const y=ad((D,_)=>{const{px:A,py:S,pz:F}=D;if(n.eql(F,n.ONE))return{x:A,y:S};const j=D.is0();_==null&&(_=j?n.ONE:n.inv(F));const O=n.mul(A,_),M=n.mul(S,_),z=n.mul(F,_);if(j)return{x:n.ZERO,y:n.ZERO};if(!n.eql(z,n.ONE))throw new Error("invZ was invalid");return{x:O,y:M}}),f=ad(D=>{if(D.is0()){if(e.allowInfinityPoint&&!n.is0(D.py))return;throw new Error("bad point: ZERO")}const{x:_,y:A}=D.toAffine();if(!n.isValid(_)||!n.isValid(A))throw new Error("bad point: x or y not FE");if(!a(_,A))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(_,A,S){if(_==null||!n.isValid(_))throw new Error("x required");if(A==null||!n.isValid(A)||n.is0(A))throw new Error("y required");if(S==null||!n.isValid(S))throw new Error("z required");this.px=_,this.py=A,this.pz=S,Object.freeze(this)}static fromAffine(_){const{x:A,y:S}=_||{};if(!_||!n.isValid(A)||!n.isValid(S))throw new Error("invalid affine point");if(_ instanceof g)throw new Error("projective point not allowed");const F=j=>n.eql(j,n.ZERO);return F(A)&&F(S)?g.ZERO:new g(A,S,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(_){const A=dd(n,_.map(S=>S.pz));return _.map((S,F)=>S.toAffine(A[F])).map(g.fromAffine)}static fromHex(_){const A=g.fromAffine(s(Ot("pointHex",_)));return A.assertValidity(),A}static fromPrivateKey(_){return g.BASE.multiply(h(_))}static msm(_,A){return fE(g,r,_,A)}_setWindowSize(_){R.setWindowSize(this,_)}assertValidity(){f(this)}hasEvenY(){const{y:_}=this.toAffine();if(n.isOdd)return!n.isOdd(_);throw new Error("Field doesn't support isOdd")}equals(_){d(_);const{px:A,py:S,pz:F}=this,{px:j,py:O,pz:M}=_,z=n.eql(n.mul(A,M),n.mul(j,F)),q=n.eql(n.mul(S,M),n.mul(O,F));return z&&q}negate(){return new g(this.px,n.neg(this.py),this.pz)}double(){const{a:_,b:A}=e,S=n.mul(A,Aa),{px:F,py:j,pz:O}=this;let M=n.ZERO,z=n.ZERO,q=n.ZERO,C=n.mul(F,F),B=n.mul(j,j),x=n.mul(O,O),w=n.mul(F,j);return w=n.add(w,w),q=n.mul(F,O),q=n.add(q,q),M=n.mul(_,q),z=n.mul(S,x),z=n.add(M,z),M=n.sub(B,z),z=n.add(B,z),z=n.mul(M,z),M=n.mul(w,M),q=n.mul(S,q),x=n.mul(_,x),w=n.sub(C,x),w=n.mul(_,w),w=n.add(w,q),q=n.add(C,C),C=n.add(q,C),C=n.add(C,x),C=n.mul(C,w),z=n.add(z,C),x=n.mul(j,O),x=n.add(x,x),C=n.mul(x,w),M=n.sub(M,C),q=n.mul(x,B),q=n.add(q,q),q=n.add(q,q),new g(M,z,q)}add(_){d(_);const{px:A,py:S,pz:F}=this,{px:j,py:O,pz:M}=_;let z=n.ZERO,q=n.ZERO,C=n.ZERO;const B=e.a,x=n.mul(e.b,Aa);let w=n.mul(A,j),E=n.mul(S,O),T=n.mul(F,M),N=n.add(A,S),U=n.add(j,O);N=n.mul(N,U),U=n.add(w,E),N=n.sub(N,U),U=n.add(A,F);let H=n.add(j,M);return U=n.mul(U,H),H=n.add(w,T),U=n.sub(U,H),H=n.add(S,F),z=n.add(O,M),H=n.mul(H,z),z=n.add(E,T),H=n.sub(H,z),C=n.mul(B,U),z=n.mul(x,T),C=n.add(z,C),z=n.sub(E,C),C=n.add(E,C),q=n.mul(z,C),E=n.add(w,w),E=n.add(E,w),T=n.mul(B,T),U=n.mul(x,U),E=n.add(E,T),T=n.sub(w,T),T=n.mul(B,T),U=n.add(U,T),w=n.mul(E,U),q=n.add(q,w),w=n.mul(H,U),z=n.mul(N,z),z=n.sub(z,w),w=n.mul(N,E),C=n.mul(H,C),C=n.add(C,w),new g(z,q,C)}subtract(_){return this.add(_.negate())}is0(){return this.equals(g.ZERO)}wNAF(_){return R.wNAFCached(this,_,g.normalizeZ)}multiplyUnsafe(_){const{endo:A,n:S}=e;Fr("scalar",_,pn,S);const F=g.ZERO;if(_===pn)return F;if(this.is0()||_===qe)return this;if(!A||R.hasPrecomputes(this))return R.wNAFCachedUnsafe(this,_,g.normalizeZ);let{k1neg:j,k1:O,k2neg:M,k2:z}=A.splitScalar(_),q=F,C=F,B=this;for(;O>pn||z>pn;)O&qe&&(q=q.add(B)),z&qe&&(C=C.add(B)),B=B.double(),O>>=qe,z>>=qe;return j&&(q=q.negate()),M&&(C=C.negate()),C=new g(n.mul(C.px,A.beta),C.py,C.pz),q.add(C)}multiply(_){const{endo:A,n:S}=e;Fr("scalar",_,qe,S);let F,j;if(A){const{k1neg:O,k1:M,k2neg:z,k2:q}=A.splitScalar(_);let{p:C,f:B}=this.wNAF(M),{p:x,f:w}=this.wNAF(q);C=R.constTimeNegate(O,C),x=R.constTimeNegate(z,x),x=new g(n.mul(x.px,A.beta),x.py,x.pz),F=C.add(x),j=B.add(w)}else{const{p:O,f:M}=this.wNAF(_);F=O,j=M}return g.normalizeZ([F,j])[0]}multiplyAndAddUnsafe(_,A,S){const F=g.BASE,j=(M,z)=>z===pn||z===qe||!M.equals(F)?M.multiplyUnsafe(z):M.multiply(z),O=j(this,A).add(j(_,S));return O.is0()?void 0:O}toAffine(_){return y(this,_)}isTorsionFree(){const{h:_,isTorsionFree:A}=e;if(_===qe)return!0;if(A)return A(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:_,clearCofactor:A}=e;return _===qe?this:A?A(g,this):this.multiplyUnsafe(e.h)}toRawBytes(_=!0){return fi("isCompressed",_),this.assertValidity(),i(g,this,_)}toHex(_=!0){return fi("isCompressed",_),pi(this.toRawBytes(_))}}g.BASE=new g(e.Gx,e.Gy,n.ONE),g.ZERO=new g(n.ZERO,n.ONE,n.ZERO);const{endo:I,nBitLength:$}=e,R=dE(g,I?Math.ceil($/2):$);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function mE(t){const e=Ed(t);return Cs(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function bE(t){const e=mE(t),{Fp:n,n:r,nByteLength:i,nBitLength:s}=e,o=n.BYTES+1,a=2*n.BYTES+1;function c(x){return ft(x,r)}function u(x){return wa(x,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:y}=wE({...e,toBytes(x,w,E){const T=w.toAffine(),N=n.toBytes(T.x),U=Os;return fi("isCompressed",E),E?U(Uint8Array.from([w.hasEvenY()?2:3]),N):U(Uint8Array.from([4]),N,n.toBytes(T.y))},fromBytes(x){const w=x.length,E=x[0],T=x.subarray(1);if(w===o&&(E===2||E===3)){const N=rr(T);if(!ga(N,qe,n.ORDER))throw new Error("Point is not on curve");const U=d(N);let H;try{H=n.sqrt(U)}catch(J){const X=J instanceof Error?": "+J.message:"";throw new Error("Point is not on curve"+X)}const G=(H&qe)===qe;return(E&1)===1!==G&&(H=n.neg(H)),{x:N,y:H}}else if(w===a&&E===4){const N=n.fromBytes(T.subarray(0,n.BYTES)),U=n.fromBytes(T.subarray(n.BYTES,2*n.BYTES));return{x:N,y:U}}else{const N=o,U=a;throw new Error("invalid Point, expected length of "+N+", or uncompressed "+U+", got "+w)}}});function f(x){const w=r>>qe;return x>w}function g(x){return f(x)?c(-x):x}const I=(x,w,E)=>rr(x.slice(w,E));class ${constructor(w,E,T){Fr("r",w,qe,r),Fr("s",E,qe,r),this.r=w,this.s=E,T!=null&&(this.recovery=T),Object.freeze(this)}static fromCompact(w){const E=i;return w=Ot("compactSignature",w,E*2),new $(I(w,0,E),I(w,E,2*E))}static fromDER(w){const{r:E,s:T}=fn.toSig(Ot("DER",w));return new $(E,T)}assertValidity(){}addRecoveryBit(w){return new $(this.r,this.s,w)}recoverPublicKey(w){const{r:E,s:T,recovery:N}=this,U=F(Ot("msgHash",w));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const H=N===2||N===3?E+e.n:E;if(H>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const G=(N&1)===0?"02":"03",Y=l.fromHex(G+Sa(H,n.BYTES)),J=u(H),X=c(-U*J),ie=c(T*J),ue=l.BASE.multiplyAndAddUnsafe(Y,X,ie);if(!ue)throw new Error("point at infinify");return ue.assertValidity(),ue}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new $(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ds(this.toDERHex())}toDERHex(){return fn.hexFromSig(this)}toCompactRawBytes(){return Ds(this.toCompactHex())}toCompactHex(){const w=i;return Sa(this.r,w)+Sa(this.s,w)}}const R={isValidPrivateKey(x){try{return h(x),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const x=yd(e.n);return uE(e.randomBytes(x),e.n)},precompute(x=8,w=l.BASE){return w._setWindowSize(x),w.multiply(BigInt(3)),w}};function D(x,w=!0){return l.fromPrivateKey(x).toRawBytes(w)}function _(x){if(typeof x=="bigint")return!1;if(x instanceof l)return!0;const E=Ot("key",x).length,T=n.BYTES,N=T+1,U=2*T+1;if(!(e.allowedPrivateKeyLengths||i===N))return E===N||E===U}function A(x,w,E=!0){if(_(x)===!0)throw new Error("first arg must be private key");if(_(w)===!1)throw new Error("second arg must be public key");return l.fromHex(w).multiply(h(x)).toRawBytes(E)}const S=e.bits2int||function(x){if(x.length>8192)throw new Error("input is too large");const w=rr(x),E=x.length*8-s;return E>0?w>>BigInt(E):w},F=e.bits2int_modN||function(x){return c(S(x))},j=$s(s);function O(x){return Fr("num < 2^"+s,x,pn,j),gi(x,i)}function M(x,w,E=z){if(["recovered","canonical"].some(le=>le in E))throw new Error("sign() legacy options not supported");const{hash:T,randomBytes:N}=e;let{lowS:U,prehash:H,extraEntropy:G}=E;U==null&&(U=!0),x=Ot("msgHash",x),xd(E),H&&(x=Ot("prehashed msgHash",T(x)));const Y=F(x),J=h(w),X=[O(J),O(Y)];if(G!=null&&G!==!1){const le=G===!0?N(n.BYTES):G;X.push(Ot("extraEntropy",le))}const ie=Os(...X),ue=Y;function fe(le){const ce=S(le);if(!y(ce))return;const P=u(ce),p=l.BASE.multiply(ce).toAffine(),m=c(p.x);if(m===pn)return;const b=c(P*c(ue+m*J));if(b===pn)return;let v=(p.x===m?0:2)|Number(p.y&qe),L=b;return U&&f(b)&&(L=g(b),v^=1),new $(m,L,v)}return{seed:ie,k2sig:fe}}const z={lowS:e.lowS,prehash:!1},q={lowS:e.lowS,prehash:!1};function C(x,w,E=z){const{seed:T,k2sig:N}=M(x,w,E),U=e;return eE(U.hash.outputLen,U.nByteLength,U.hmac)(T,N)}l.BASE._setWindowSize(8);function B(x,w,E,T=q){var v;const N=x;w=Ot("msgHash",w),E=Ot("publicKey",E);const{lowS:U,prehash:H,format:G}=T;if(xd(T),"strict"in T)throw new Error("options.strict was renamed to lowS");if(G!==void 0&&G!=="compact"&&G!=="der")throw new Error("format must be compact or der");const Y=typeof N=="string"||di(N),J=!Y&&!G&&typeof N=="object"&&N!==null&&typeof N.r=="bigint"&&typeof N.s=="bigint";if(!Y&&!J)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let X,ie;try{if(J&&(X=new $(N.r,N.s)),Y){try{G!=="compact"&&(X=$.fromDER(N))}catch(L){if(!(L instanceof fn.Err))throw L}!X&&G!=="der"&&(X=$.fromCompact(N))}ie=l.fromHex(E)}catch{return!1}if(!X||U&&X.hasHighS())return!1;H&&(w=e.hash(w));const{r:ue,s:fe}=X,le=F(w),ce=u(fe),P=c(le*ce),p=c(ue*ce),m=(v=l.BASE.multiplyAndAddUnsafe(ie,P,p))==null?void 0:v.toAffine();return m?c(m.x)===ue:!1}return{CURVE:e,getPublicKey:D,getSharedSecret:A,sign:C,verify:B,ProjectivePoint:l,Signature:$,utils:R}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vE(t){return{hash:t,hmac:(e,...n)=>ed(t,e,$v(...n)),randomBytes:Cv}}function EE(t,e){const n=r=>bE({...t,...vE(r)});return{...n(e),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _d=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Sd=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),xE=BigInt(0),_E=BigInt(1),Ia=BigInt(2),Ad=(t,e)=>(t+e/Ia)/e;function SE(t){const e=_d,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=$t(l,n,e)*l%e,d=$t(h,n,e)*l%e,y=$t(d,Ia,e)*u%e,f=$t(y,i,e)*y%e,g=$t(f,s,e)*f%e,I=$t(g,a,e)*g%e,$=$t(I,c,e)*I%e,R=$t($,a,e)*g%e,D=$t(R,n,e)*l%e,_=$t(D,o,e)*f%e,A=$t(_,r,e)*u%e,S=$t(A,Ia,e);if(!Da.eql(Da.sqr(S),t))throw new Error("Cannot find square root");return S}const Da=ma(_d,void 0,void 0,{sqrt:SE}),AE=EE({a:xE,b:BigInt(7),Fp:Da,n:Sd,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Sd,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_E*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Ad(s*t,e),c=Ad(-r*t,e);let u=ft(t-a*n-c*i,e),l=ft(-a*r-c*s,e);const h=u>o,d=l>o;if(h&&(u=e-u),d&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:d,k2:l}}}},Zv),IE=Object.freeze(Object.defineProperty({__proto__:null,secp256k1:AE},Symbol.toStringTag,{value:"Module"}));function DE(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0;const y=u.length;for(;d!==y&&u[d]===0;)d++,l++;const f=(y-d)*s+1>>>0,g=new Uint8Array(f);for(;d!==y;){let R=u[d],D=0;for(let _=f-1;(R!==0||D<h)&&_!==-1;_--,D++)R+=256*g[_]>>>0,g[_]=R%n>>>0,R=R/n>>>0;if(R!==0)throw new Error("Non-zero carry");h=D,d++}let I=f-h;for(;I!==f&&g[I]===0;)I++;let $=r.repeat(l);for(;I<f;++I)$+=t.charAt(g[I]);return $}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===r;)h++,l++;const y=(u.length-l)*i+1>>>0,f=new Uint8Array(y);for(;l<u.length;){const R=u.charCodeAt(l);if(R>255)return;let D=e[R];if(D===255)return;let _=0;for(let A=y-1;(D!==0||_<d)&&A!==-1;A--,_++)D+=n*f[A]>>>0,f[A]=D%256>>>0,D=D/256>>>0;if(D!==0)throw new Error("Non-zero carry");d=_,l++}let g=y-d;for(;g!==y&&f[g]===0;)g++;const I=new Uint8Array(h+(y-g));let $=h;for(;g!==y;)I[$++]=f[g++];return I}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var OE="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const yi=DE(OE);function $E(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.charCodeAt(r++);if((i&4294967168)===0){n++;continue}else if((i&4294965248)===0)n+=2;else{if(i>=55296&&i<=56319&&r<e){const s=t.charCodeAt(r);(s&64512)===56320&&(++r,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?n+=3:n+=4}}return n}function CE(t,e,n){const r=t.length;let i=n,s=0;for(;s<r;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const PE=new TextEncoder,BE=50;function TE(t,e,n){PE.encodeInto(t,e.subarray(n))}function kE(t,e,n){t.length>BE?TE(t,e,n):CE(t,e,n)}const RE=4096;function Id(t,e,n){let r=e;const i=r+n,s=[];let o="";for(;r<i;){const a=t[r++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[r++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[r++]&63,u=t[r++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[r++]&63,u=t[r++]&63,l=t[r++]&63;let h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=RE&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const NE=new TextDecoder,UE=200;function FE(t,e,n){const r=t.subarray(e,e+n);return NE.decode(r)}function LE(t,e,n){return n>UE?FE(t,e,n):Id(t,e,n)}class Ps{constructor(e,n){this.type=e,this.data=n}}class xt extends Error{constructor(e){super(e);const n=Object.create(xt.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:xt.name})}}const wi=4294967295;function ME(t,e,n){const r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Dd(t,e,n){const r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function Od(t,e){const n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function zE(t,e){const n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}const jE=-1,qE=4294967296-1,HE=17179869184-1;function VE({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=HE)if(e===0&&t<=qE){const n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t),n}else{const n=t/4294967296,r=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|n&3),s.setUint32(4,r),i}else{const n=new Uint8Array(12),r=new DataView(n.buffer);return r.setUint32(0,e),Dd(r,4,t),n}}function KE(t){const e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function WE(t){if(t instanceof Date){const e=KE(t);return VE(e)}else return null}function GE(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const n=e.getUint32(0),r=e.getUint32(4),i=(n&3)*4294967296+r,s=n>>>2;return{sec:i,nsec:s}}case 12:{const n=Od(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new xt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function YE(t){const e=GE(t);return new Date(e.sec*1e3+e.nsec/1e6)}const QE={type:jE,encode:WE,decode:YE};class Bs{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(QE)}register({type:e,encode:n,decode:r}){if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{const i=-1-e;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}}tryToEncode(e,n){for(let r=0;r<this.builtInEncoders.length;r++){const i=this.builtInEncoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=-1-r;return new Ps(o,s)}}}for(let r=0;r<this.encoders.length;r++){const i=this.encoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=r;return new Ps(o,s)}}}return e instanceof Ps?e:null}decode(e,n,r){const i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new Ps(n,e)}}Bs.defaultCodec=new Bs;function ZE(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Oa(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):ZE(t)?new Uint8Array(t):Uint8Array.from(t)}const JE=100,XE=2048;let ex=class y0{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Bs.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??JE,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??XE,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new y0({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,n){if(n>this.maxDepth)throw new Error(`Too deep objects in depth ${n}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)}ensureBufferSizeToWrite(e){const n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)}resizeBuffer(e){const n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const r=$E(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),kE(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,n){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error(`Too large binary: ${n}`);const r=Oa(e);this.writeU8a(r)}encodeArray(e,n){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const i of e)this.doEncode(i,n+1)}countWithoutUndefined(e,n){let r=0;for(const i of n)e[i]!==void 0&&r++;return r}encodeMap(e,n){const r=Object.keys(e);this.sortKeys&&r.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of r){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,n+1))}}encodeExtension(e){if(typeof e.data=="function"){const r=e.data(this.pos+6),i=r.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(r);return}const n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error(`Too large extension object: ${n}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),ME(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Dd(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function tx(t,e){return new ex(e).encodeSharedRef(t)}function $a(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const nx=16,rx=16;class ix{constructor(e=nx,n=rx){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=n,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,n,r){const i=this.caches[r-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<r;a++)if(o[a]!==e[n+a])continue e;return s.str}return null}store(e,n){const r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,n,r){const i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;const s=Id(e,n,r),o=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(o,s),s}}const Ca="array",mi="map_key",$d="map_value",sx=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new xt("The type of key must be string or number but "+typeof t)};class ox{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const n=this.getUninitializedStateFromPool();n.type=Ca,n.position=0,n.size=e,n.array=new Array(e)}pushMapState(e){const n=this.getUninitializedStateFromPool();n.type=mi,n.readCount=0,n.size=e,n.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Ca){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===mi||e.type===$d){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const bi=-1,Pa=new DataView(new ArrayBuffer(0)),ax=new Uint8Array(Pa.buffer);try{Pa.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Cd=new RangeError("Insufficient data"),cx=new ix;let ux=class w0{constructor(e){this.totalPos=0,this.pos=0,this.view=Pa,this.bytes=ax,this.headByte=bi,this.stack=new ox,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Bs.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??wi,this.maxBinLength=(e==null?void 0:e.maxBinLength)??wi,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??wi,this.maxMapLength=(e==null?void 0:e.maxMapLength)??wi,this.maxExtLength=(e==null?void 0:e.maxExtLength)??wi,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:cx,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??sx}clone(){return new w0({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=bi,this.stack.reset()}setBuffer(e){const n=Oa(e);this.bytes=n,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===bi&&!this.hasRemaining(1))this.setBuffer(e);else{const n=this.bytes.subarray(this.pos),r=Oa(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:n,pos:r}=this;return new RangeError(`Extra ${n.byteLength-r} of ${n.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let n=!1,r;for await(const a of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{r=this.doDecodeSync(),n=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return r}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${$a(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,n){if(this.entered){yield*this.clone().decodeMultiAsync(e,n);return}try{this.entered=!0;let r=n,i=-1;for await(const s of e){if(n&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),r&&(i=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let n;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else{const i=e-160;n=this.decodeString(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){const i=this.lookU8();n=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();n=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();n=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===196){const i=this.lookU8();n=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();n=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();n=this.decodeBinary(i,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();n=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();n=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();n=this.decodeExtension(i,4)}else throw new xt(`Unrecognized type byte: ${$a(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const i=r.top();if(i.type===Ca)if(i.array[i.position]=n,i.position++,i.position===i.size)n=i.array,r.release(i);else continue e;else if(i.type===mi){if(n==="__proto__")throw new xt("The key __proto__ is not allowed");i.key=this.mapKeyConverter(n),i.type=$d;continue e}else if(i.map[i.key]=n,i.readCount++,i.readCount===i.size)n=i.map,r.release(i);else{i.key=null,i.type=mi;continue e}}return n}}readHeadByte(){return this.headByte===bi&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=bi}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new xt(`Unrecognized array type byte: ${$a(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new xt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new xt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,n){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,n):this.decodeBinary(e,n)}decodeUtf8String(e,n){var s;if(e>this.maxStrLength)throw new xt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+n+e)throw Cd;const r=this.pos+n;let i;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,r,e):i=LE(this.bytes,r,e),this.pos+=n+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===mi:!1}decodeBinary(e,n){if(e>this.maxBinLength)throw new xt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+n))throw Cd;const r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i}decodeExtension(e,n){if(e>this.maxExtLength)throw new xt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=zE(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Od(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function lx(t,e){return new ux(e).decode(t)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hx(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pd(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function Ts(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Ba(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Ta(t){if(!Array.isArray(t))throw new Error("array expected")}function ks(t,e){if(!Pd(!0,e))throw new Error(`${t}: array of strings expected`)}function dx(t,e){if(!Pd(!1,e))throw new Error(`${t}: array of numbers expected`)}function fx(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function px(t){const e=typeof t=="string"?t.split(""):t,n=e.length;ks("alphabet",e);const r=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(Ta(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(Ta(i),i.map(s=>{Ts("alphabet.decode",s);const o=r.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function gx(t=""){return Ts("join",t),{encode:e=>(ks("join.decode",e),e.join(t)),decode:e=>(Ts("join.decode",e),e.split(t))}}function yx(t,e="="){return Ba(t),Ts("padding",e),{encode(n){for(ks("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){ks("padding.decode",n);let r=n.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if((r-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}const Bd=(t,e)=>e===0?t:Bd(e,t%e),Rs=(t,e)=>t+(e-Bd(t,e)),ka=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Td(t,e,n,r){if(Ta(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Rs(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Rs(e,n)}`);let i=0,s=0;const o=ka[e],a=ka[n]-1,c=[];for(const u of t){if(Ba(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const l=ka[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<n-s&a,!r&&s>=e)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function wx(t,e=!1){if(Ba(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Rs(8,t)>32||Rs(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!hx(n))throw new Error("radix2.encode input should be Uint8Array");return Td(Array.from(n),8,t,!e)},decode:n=>(dx("radix2.decode",n),Uint8Array.from(Td(n,t,8,e)))}}const mx=fx(wx(5),px("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),yx(5),gx(""));function Ra(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function kd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ra(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function vi(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=kd(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return Ra(n)}function bx(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,I=0,$=0,R=f.length;$!==R&&f[$]===0;)$++,g++;for(var D=(R-$)*l+1>>>0,_=new Uint8Array(D);$!==R;){for(var A=f[$],S=0,F=D-1;(A!==0||S<I)&&F!==-1;F--,S++)A+=256*_[F]>>>0,_[F]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");I=S,$++}for(var j=D-I;j!==D&&_[j]===0;)j++;for(var O=c.repeat(g);j<D;++j)O+=t.charAt(_[j]);return O}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var I=0,$=0;f[g]===c;)I++,g++;for(var R=(f.length-g)*u+1>>>0,D=new Uint8Array(R);f[g];){var _=n[f.charCodeAt(g)];if(_===255)return;for(var A=0,S=R-1;(_!==0||A<$)&&S!==-1;S--,A++)_+=a*D[S]>>>0,D[S]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");$=A,g++}if(f[g]!==" "){for(var F=R-$;F!==R&&D[F]===0;)F++;for(var j=new Uint8Array(I+(R-F)),O=I;F!==R;)j[O++]=D[F++];return j}}}function y(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var vx=bx,Ex=vx;const xx=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},_x=t=>new TextEncoder().encode(t),Sx=t=>new TextDecoder().decode(t);class Ax{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ix{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Rd(this,e)}}class Dx{constructor(e){this.decoders=e}or(e){return Rd(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Rd=(t,e)=>new Dx({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Ox{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new Ax(e,n,r),this.decoder=new Ix(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ns=({name:t,prefix:e,encode:n,decode:r})=>new Ox(t,e,n,r),Ei=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=Ex(n,e);return Ns({prefix:t,name:e,encode:r,decode:s=>xx(i(s))})},$x=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Cx=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Ye=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Ns({prefix:e,name:t,encode(i){return Cx(i,r,n)},decode(i){return $x(i,r,n,t)}}),Px=Ns({prefix:"\0",name:"identity",encode:t=>Sx(t),decode:t=>_x(t)}),Bx=Object.freeze(Object.defineProperty({__proto__:null,identity:Px},Symbol.toStringTag,{value:"Module"})),Tx=Ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),kx=Object.freeze(Object.defineProperty({__proto__:null,base2:Tx},Symbol.toStringTag,{value:"Module"})),Rx=Ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Nx=Object.freeze(Object.defineProperty({__proto__:null,base8:Rx},Symbol.toStringTag,{value:"Module"})),Ux=Ei({prefix:"9",name:"base10",alphabet:"0123456789"}),Fx=Object.freeze(Object.defineProperty({__proto__:null,base10:Ux},Symbol.toStringTag,{value:"Module"})),Lx=Ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Mx=Ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),zx=Object.freeze(Object.defineProperty({__proto__:null,base16:Lx,base16upper:Mx},Symbol.toStringTag,{value:"Module"})),jx=Ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qx=Ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Hx=Ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Vx=Ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Kx=Ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Wx=Ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Gx=Ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Yx=Ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Qx=Ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Zx=Object.freeze(Object.defineProperty({__proto__:null,base32:jx,base32hex:Kx,base32hexpad:Gx,base32hexpadupper:Yx,base32hexupper:Wx,base32pad:Hx,base32padupper:Vx,base32upper:qx,base32z:Qx},Symbol.toStringTag,{value:"Module"})),Jx=Ei({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Xx=Ei({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),e3=Object.freeze(Object.defineProperty({__proto__:null,base36:Jx,base36upper:Xx},Symbol.toStringTag,{value:"Module"})),t3=Ei({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),n3=Ei({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),r3=Object.freeze(Object.defineProperty({__proto__:null,base58btc:t3,base58flickr:n3},Symbol.toStringTag,{value:"Module"})),i3=Ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s3=Ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o3=Ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),a3=Ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),c3=Object.freeze(Object.defineProperty({__proto__:null,base64:i3,base64pad:s3,base64url:o3,base64urlpad:a3},Symbol.toStringTag,{value:"Module"})),Nd=Array.from(""),u3=Nd.reduce((t,e,n)=>(t[n]=e,t),[]),l3=Nd.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function h3(t){return t.reduce((e,n)=>(e+=u3[n],e),"")}function d3(t){const e=[];for(const n of t){const r=l3[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const f3=Ns({prefix:"",name:"base256emoji",encode:h3,decode:d3}),p3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:f3},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const Ud={...Bx,...kx,...Nx,...Fx,...zx,...Zx,...e3,...r3,...c3,...p3};function Fd(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const Ld=Fd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Na=Fd("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=kd(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Md={utf8:Ld,"utf-8":Ld,hex:Ud.base16,latin1:Na,ascii:Na,binary:Na,...Ud};function Ct(t,e="utf8"){const n=Md[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ra(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function pt(t,e="utf8"){const n=Md[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}const g3={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Ua,zd;function jd(){if(zd)return Ua;zd=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function n(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function r(o){return(4294967296+o).toString(16).substring(1)}function i(o,a,c){let u=`
`+o+" = ";for(let l=0;l<a.length;l+=2){if(c===32)u+=r(a[l]).toUpperCase(),u+=" ",u+=r(a[l+1]).toUpperCase();else if(c===64)u+=r(a[l+1]).toUpperCase(),u+=r(a[l]).toUpperCase();else throw new Error("Invalid size "+c);l%6===4?u+=`
`+new Array(o.length+4).join(" "):l<a.length-2&&(u+=" ")}console.log(u)}function s(o,a,c){let u=new Date().getTime();const l=new Uint8Array(a);for(let d=0;d<a;d++)l[d]=d%256;const h=new Date().getTime();console.log("Generated random input in "+(h-u)+"ms"),u=h;for(let d=0;d<c;d++){const y=o(l),f=new Date().getTime(),g=f-u;u=f,console.log("Hashed in "+g+"ms: "+y.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return Ua={normalizeInput:e,toHex:n,debugPrint:i,testSpeed:s},Ua}var Fa,qd;function y3(){if(qd)return Fa;qd=1;const t=jd();function e($,R,D){const _=$[R]+$[D];let A=$[R+1]+$[D+1];_>=4294967296&&A++,$[R]=_,$[R+1]=A}function n($,R,D,_){let A=$[R]+D;D<0&&(A+=4294967296);let S=$[R+1]+_;A>=4294967296&&S++,$[R]=A,$[R+1]=S}function r($,R){return $[R]^$[R+1]<<8^$[R+2]<<16^$[R+3]<<24}function i($,R,D,_,A,S){const F=u[A],j=u[A+1],O=u[S],M=u[S+1];e(c,$,R),n(c,$,F,j);let z=c[_]^c[$],q=c[_+1]^c[$+1];c[_]=q,c[_+1]=z,e(c,D,_),z=c[R]^c[D],q=c[R+1]^c[D+1],c[R]=z>>>24^q<<8,c[R+1]=q>>>24^z<<8,e(c,$,R),n(c,$,O,M),z=c[_]^c[$],q=c[_+1]^c[$+1],c[_]=z>>>16^q<<16,c[_+1]=q>>>16^z<<16,e(c,D,_),z=c[R]^c[D],q=c[R+1]^c[D+1],c[R]=q>>>31^z<<1,c[R+1]=z>>>31^q<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function($){return $*2})),c=new Uint32Array(32),u=new Uint32Array(32);function l($,R){let D=0;for(D=0;D<16;D++)c[D]=$.h[D],c[D+16]=s[D];for(c[24]=c[24]^$.t,c[25]=c[25]^$.t/4294967296,R&&(c[28]=~c[28],c[29]=~c[29]),D=0;D<32;D++)u[D]=r($.b,4*D);for(D=0;D<12;D++)i(0,8,16,24,a[D*16+0],a[D*16+1]),i(2,10,18,26,a[D*16+2],a[D*16+3]),i(4,12,20,28,a[D*16+4],a[D*16+5]),i(6,14,22,30,a[D*16+6],a[D*16+7]),i(0,10,20,30,a[D*16+8],a[D*16+9]),i(2,12,22,24,a[D*16+10],a[D*16+11]),i(4,14,16,26,a[D*16+12],a[D*16+13]),i(6,8,18,28,a[D*16+14],a[D*16+15]);for(D=0;D<16;D++)$.h[D]=$.h[D]^c[D]^c[D+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function d($,R,D,_){if($===0||$>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(R&&R.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(D&&D.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(_&&_.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const A={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:$};h.fill(0),h[0]=$,R&&(h[1]=R.length),h[2]=1,h[3]=1,D&&h.set(D,32),_&&h.set(_,48);for(let S=0;S<16;S++)A.h[S]=s[S]^r(h,S*4);return R&&(y(A,R),A.c=128),A}function y($,R){for(let D=0;D<R.length;D++)$.c===128&&($.t+=$.c,l($,!1),$.c=0),$.b[$.c++]=R[D]}function f($){for($.t+=$.c;$.c<128;)$.b[$.c++]=0;l($,!0);const R=new Uint8Array($.outlen);for(let D=0;D<$.outlen;D++)R[D]=$.h[D>>2]>>8*(D&3);return R}function g($,R,D,_,A){D=D||64,$=t.normalizeInput($),_&&(_=t.normalizeInput(_)),A&&(A=t.normalizeInput(A));const S=d(D,R,_,A);return y(S,$),f(S)}function I($,R,D,_,A){const S=g($,R,D,_,A);return t.toHex(S)}return Fa={blake2b:g,blake2bHex:I,blake2bInit:d,blake2bUpdate:y,blake2bFinal:f},Fa}var La,Hd;function w3(){if(Hd)return La;Hd=1;const t=jd();function e(f,g){return f[g]^f[g+1]<<8^f[g+2]<<16^f[g+3]<<24}function n(f,g,I,$,R,D){o[f]=o[f]+o[g]+R,o[$]=r(o[$]^o[f],16),o[I]=o[I]+o[$],o[g]=r(o[g]^o[I],12),o[f]=o[f]+o[g]+D,o[$]=r(o[$]^o[f],8),o[I]=o[I]+o[$],o[g]=r(o[g]^o[I],7)}function r(f,g){return f>>>g^f<<32-g}const i=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(f,g){let I=0;for(I=0;I<8;I++)o[I]=f.h[I],o[I+8]=i[I];for(o[12]^=f.t,o[13]^=f.t/4294967296,g&&(o[14]=~o[14]),I=0;I<16;I++)a[I]=e(f.b,4*I);for(I=0;I<10;I++)n(0,4,8,12,a[s[I*16+0]],a[s[I*16+1]]),n(1,5,9,13,a[s[I*16+2]],a[s[I*16+3]]),n(2,6,10,14,a[s[I*16+4]],a[s[I*16+5]]),n(3,7,11,15,a[s[I*16+6]],a[s[I*16+7]]),n(0,5,10,15,a[s[I*16+8]],a[s[I*16+9]]),n(1,6,11,12,a[s[I*16+10]],a[s[I*16+11]]),n(2,7,8,13,a[s[I*16+12]],a[s[I*16+13]]),n(3,4,9,14,a[s[I*16+14]],a[s[I*16+15]]);for(I=0;I<8;I++)f.h[I]^=o[I]^o[I+8]}function u(f,g){if(!(f>0&&f<=32))throw new Error("Incorrect output length, should be in [1, 32]");const I=g?g.length:0;if(g&&!(I>0&&I<=32))throw new Error("Incorrect key length, should be in [1, 32]");const $={h:new Uint32Array(i),b:new Uint8Array(64),c:0,t:0,outlen:f};return $.h[0]^=16842752^I<<8^f,I>0&&(l($,g),$.c=64),$}function l(f,g){for(let I=0;I<g.length;I++)f.c===64&&(f.t+=f.c,c(f,!1),f.c=0),f.b[f.c++]=g[I]}function h(f){for(f.t+=f.c;f.c<64;)f.b[f.c++]=0;c(f,!0);const g=new Uint8Array(f.outlen);for(let I=0;I<f.outlen;I++)g[I]=f.h[I>>2]>>8*(I&3)&255;return g}function d(f,g,I){I=I||32,f=t.normalizeInput(f);const $=u(I,g);return l($,f),h($)}function y(f,g,I){const $=d(f,g,I);return t.toHex($)}return La={blake2s:d,blake2sHex:y,blake2sInit:u,blake2sUpdate:l,blake2sFinal:h},La}var Ma,Vd;function m3(){if(Vd)return Ma;Vd=1;const t=y3(),e=w3();return Ma={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Ma}var b3=m3();const v3=":";function Us(t){const[e,n]=t.split(v3);return{namespace:e,reference:n}}function Kd(t,e){return t.includes(":")?[t]:e.chains||[]}var E3=Object.defineProperty,x3=Object.defineProperties,_3=Object.getOwnPropertyDescriptors,Wd=Object.getOwnPropertySymbols,S3=Object.prototype.hasOwnProperty,A3=Object.prototype.propertyIsEnumerable,Gd=(t,e,n)=>e in t?E3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yd=(t,e)=>{for(var n in e||(e={}))S3.call(e,n)&&Gd(t,n,e[n]);if(Wd)for(var n of Wd(e))A3.call(e,n)&&Gd(t,n,e[n]);return t},I3=(t,e)=>x3(t,_3(e));const D3="ReactNative",_t={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},O3="js";function Fs(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Pn(){return!ln.getDocument()&&!!ln.getNavigator()&&navigator.product===D3}function $3(){return Pn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function C3(){return Pn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Lr(){return!Fs()&&!!ln.getNavigator()&&!!ln.getDocument()}function xi(){return Pn()?_t.reactNative:Fs()?_t.node:Lr()?_t.browser:_t.unknown}function Qd(){var t;try{return Pn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function P3(t,e){const n=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const i=e[r];i!==void 0&&n.set(r,i)}return n.toString()}function B3(t){var e,n;const r=Zd();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),I3(Yd(Yd({},r),t),{url:(t==null?void 0:t.url)||r.url,name:(t==null?void 0:t.name)||r.name,description:(t==null?void 0:t.description)||r.description,icons:(n=t==null?void 0:t.icons)!=null&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function Zd(){return ev.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function T3(){if(xi()===_t.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const t=W2();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function k3(){var t;const e=xi();return e===_t.browser?[e,((t=ln.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Jd(t,e,n){const r=T3(),i=k3();return[[t,e].join("-"),[O3,n].join("-"),r,i].join("/")}function R3({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=n.split("?"),l=Jd(t,e,r),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=P3(u[1]||"",h);return u[0]+"?"+d}function sr(t,e){return t.filter(n=>e.includes(n)).length===t.length}function za(t){return Object.fromEntries(t.entries())}function ja(t){return new Map(Object.entries(t))}function or(t=ee.FIVE_MINUTES,e){const n=ee.toMiliseconds(t||ee.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},n),r=a,i=c})}}function Bn(t,e,n){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(new Error(n)),e);try{const o=await t;r(o)}catch(o){i(o)}clearTimeout(s)})}function Xd(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function N3(t){return Xd("topic",t)}function U3(t){return Xd("id",t)}function ef(t){const[e,n]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")r.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return r}function Fe(t,e){return ee.fromMiliseconds(Date.now()+ee.toMiliseconds(t))}function Tn(t){return Date.now()>=ee.toMiliseconds(t)}function _e(t,e){return`${t}${e?`:${e}`:""}`}function ar(t=[],e=[]){return[...new Set([...t,...e])]}async function F3({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;const i=typeof n=="string"?JSON.parse(n):n,s=i==null?void 0:i.href;if(typeof s!="string")return;const o=L3(s,t,e),a=xi();if(a===_t.browser){if(!((r=ln.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}M3(o)}else a===_t.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function L3(t,e,n){const r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${H3(r,!0)}`}else i=`${i}/wc?${r}`;return i}function M3(t){let e="_self";q3()?e="_top":(j3()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function z3(t,e){let n="";try{if(Lr()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function tf(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function nf(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function qa(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function j3(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function q3(){try{return window.self!==window.top}catch{return!1}}function H3(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function rf(t){return Buffer.from(t,"base64").toString("utf-8")}function V3(t){return new Promise(e=>setTimeout(e,t))}const Ls=BigInt(2**32-1),sf=BigInt(32);function of(t,e=!1){return e?{h:Number(t&Ls),l:Number(t>>sf&Ls)}:{h:Number(t>>sf&Ls)|0,l:Number(t&Ls)|0}}function af(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=of(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const cf=(t,e,n)=>t>>>n,uf=(t,e,n)=>t<<32-n|e>>>n,kn=(t,e,n)=>t>>>n|e<<32-n,Rn=(t,e,n)=>t<<32-n|e>>>n,_i=(t,e,n)=>t<<64-n|e>>>n-32,Si=(t,e,n)=>t>>>n-32|e<<64-n,K3=(t,e)=>e,W3=(t,e)=>t,G3=(t,e,n)=>t<<n|e>>>32-n,Y3=(t,e,n)=>e<<n|t>>>32-n,Q3=(t,e,n)=>e<<n-32|t>>>64-n,Z3=(t,e,n)=>t<<n-32|e>>>64-n;function Ht(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const Ha=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Va=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,J3=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),X3=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,e4=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),t4=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,Mr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ka(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function gn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Pt(t,...e){if(!Ka(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Wa(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");gn(t.outputLen),gn(t.blockLen)}function Nn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ga(t,e){Pt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Ai(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Bt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Ya(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Xt(t,e){return t<<32-e|t>>>e}const lf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function hf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const yn=lf?t=>t:t=>hf(t);function n4(t){for(let e=0;e<t.length;e++)t[e]=hf(t[e]);return t}const Un=lf?t=>t:n4,df=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",r4=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ii(t){if(Pt(t),df)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=r4[t[n]];return e}const wn={_0:48,_9:57,A:65,F:70,a:97,f:102};function ff(t){if(t>=wn._0&&t<=wn._9)return t-wn._0;if(t>=wn.A&&t<=wn.F)return t-(wn.A-10);if(t>=wn.a&&t<=wn.f)return t-(wn.a-10)}function Qa(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(df)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=ff(t.charCodeAt(s)),a=ff(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function i4(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Vt(t){return typeof t=="string"&&(t=i4(t)),Pt(t),t}function cr(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Pt(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let Ms=class{};function Di(t){const e=r=>t().update(Vt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function s4(t){const e=(r,i)=>t(i).update(Vt(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function zr(t=32){if(Mr&&typeof Mr.getRandomValues=="function")return Mr.getRandomValues(new Uint8Array(t));if(Mr&&typeof Mr.randomBytes=="function")return Uint8Array.from(Mr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const o4=BigInt(0),Oi=BigInt(1),a4=BigInt(2),c4=BigInt(7),u4=BigInt(256),l4=BigInt(113),pf=[],gf=[],yf=[];for(let t=0,e=Oi,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],pf.push(2*(5*r+n)),gf.push((t+1)*(t+2)/2%64);let i=o4;for(let s=0;s<7;s++)e=(e<<Oi^(e>>c4)*l4)%u4,e&a4&&(i^=Oi<<(Oi<<BigInt(s))-Oi);yf.push(i)}const wf=af(yf,!0),h4=wf[0],d4=wf[1],mf=(t,e,n)=>n>32?Q3(t,e,n):G3(t,e,n),bf=(t,e,n)=>n>32?Z3(t,e,n):Y3(t,e,n);function f4(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],l=n[c+1],h=mf(u,l,1)^n[a],d=bf(u,l,1)^n[a+1];for(let y=0;y<50;y+=10)t[o+y]^=h,t[o+y+1]^=d}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=gf[o],c=mf(i,s,a),u=bf(i,s,a),l=pf[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=h4[r],t[1]^=d4[r]}Bt(n)}let p4=class m0 extends Ms{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,gn(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ai(this.state)}clone(){return this._cloneInto()}keccak(){Un(this.state32),f4(this.state32,this.rounds),Un(this.state32),this.posOut=0,this.pos=0}update(e){Nn(this),e=Vt(e),Pt(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Nn(this,!1),Pt(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return gn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ga(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Bt(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new m0(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const g4=(t,e,n)=>Di(()=>new p4(e,t,n)),y4=g4(1,136,256/8);function w4(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+u,a,r)}function m4(t,e,n){return t&e^~t&n}function b4(t,e,n){return t&e^t&n^e&n}let vf=class extends Ms{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Ya(this.buffer)}update(e){Nn(this),e=Vt(e),Pt(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Ya(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nn(this),Ga(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,Bt(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;w4(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Ya(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}};const Fn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),tt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),nt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),v4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ln=new Uint32Array(64);let E4=class extends vf{constructor(e=32){super(64,e,8,!1),this.A=Fn[0]|0,this.B=Fn[1]|0,this.C=Fn[2]|0,this.D=Fn[3]|0,this.E=Fn[4]|0,this.F=Fn[5]|0,this.G=Fn[6]|0,this.H=Fn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)Ln[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=Ln[h-15],y=Ln[h-2],f=Xt(d,7)^Xt(d,18)^d>>>3,g=Xt(y,17)^Xt(y,19)^y>>>10;Ln[h]=g+Ln[h-7]+f+Ln[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const d=Xt(a,6)^Xt(a,11)^Xt(a,25),y=l+d+m4(a,c,u)+v4[h]+Ln[h]|0,f=(Xt(r,2)^Xt(r,13)^Xt(r,22))+b4(r,i,s)|0;l=u,u=c,c=a,a=o+y|0,o=s,s=i,i=r,r=y+f|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(r,i,s,o,a,c,u,l)}roundClean(){Bt(Ln)}destroy(){this.set(0,0,0,0,0,0,0,0),Bt(this.buffer)}};const Ef=af(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),x4=Ef[0],_4=Ef[1],Mn=new Uint32Array(80),zn=new Uint32Array(80);let Za=class extends vf{constructor(e=64){super(128,e,16,!1),this.Ah=nt[0]|0,this.Al=nt[1]|0,this.Bh=nt[2]|0,this.Bl=nt[3]|0,this.Ch=nt[4]|0,this.Cl=nt[5]|0,this.Dh=nt[6]|0,this.Dl=nt[7]|0,this.Eh=nt[8]|0,this.El=nt[9]|0,this.Fh=nt[10]|0,this.Fl=nt[11]|0,this.Gh=nt[12]|0,this.Gl=nt[13]|0,this.Hh=nt[14]|0,this.Hl=nt[15]|0}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:y,Gl:f,Hh:g,Hl:I}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I]}set(e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=I|0}process(e,n){for(let D=0;D<16;D++,n+=4)Mn[D]=e.getUint32(n),zn[D]=e.getUint32(n+=4);for(let D=16;D<80;D++){const _=Mn[D-15]|0,A=zn[D-15]|0,S=kn(_,A,1)^kn(_,A,8)^cf(_,A,7),F=Rn(_,A,1)^Rn(_,A,8)^uf(_,A,7),j=Mn[D-2]|0,O=zn[D-2]|0,M=kn(j,O,19)^_i(j,O,61)^cf(j,O,6),z=Rn(j,O,19)^Si(j,O,61)^uf(j,O,6),q=J3(F,z,zn[D-7],zn[D-16]),C=X3(q,S,M,Mn[D-7],Mn[D-16]);Mn[D]=C|0,zn[D]=q|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:y,Fl:f,Gh:g,Gl:I,Hh:$,Hl:R}=this;for(let D=0;D<80;D++){const _=kn(h,d,14)^kn(h,d,18)^_i(h,d,41),A=Rn(h,d,14)^Rn(h,d,18)^Si(h,d,41),S=h&y^~h&g,F=d&f^~d&I,j=e4(R,A,F,_4[D],zn[D]),O=t4(j,$,_,S,x4[D],Mn[D]),M=j|0,z=kn(r,i,28)^_i(r,i,34)^_i(r,i,39),q=Rn(r,i,28)^Si(r,i,34)^Si(r,i,39),C=r&s^r&a^s&a,B=i&o^i&c^o&c;$=g|0,R=I|0,g=y|0,I=f|0,y=h|0,f=d|0,{h,l:d}=Ht(u|0,l|0,O|0,M|0),u=a|0,l=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const x=Ha(M,q,B);r=Va(x,O,z,C),i=x|0}({h:r,l:i}=Ht(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Ht(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ht(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Ht(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=Ht(this.Eh|0,this.El|0,h|0,d|0),{h:y,l:f}=Ht(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:I}=Ht(this.Gh|0,this.Gl|0,g|0,I|0),{h:$,l:R}=Ht(this.Hh|0,this.Hl|0,$|0,R|0),this.set(r,i,s,o,a,c,u,l,h,d,y,f,g,I,$,R)}roundClean(){Bt(Mn,zn)}destroy(){Bt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},S4=class extends Za{constructor(){super(48),this.Ah=tt[0]|0,this.Al=tt[1]|0,this.Bh=tt[2]|0,this.Bl=tt[3]|0,this.Ch=tt[4]|0,this.Cl=tt[5]|0,this.Dh=tt[6]|0,this.Dl=tt[7]|0,this.Eh=tt[8]|0,this.El=tt[9]|0,this.Fh=tt[10]|0,this.Fl=tt[11]|0,this.Gh=tt[12]|0,this.Gl=tt[13]|0,this.Hh=tt[14]|0,this.Hl=tt[15]|0}};const rt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let A4=class extends Za{constructor(){super(32),this.Ah=rt[0]|0,this.Al=rt[1]|0,this.Bh=rt[2]|0,this.Bl=rt[3]|0,this.Ch=rt[4]|0,this.Cl=rt[5]|0,this.Dh=rt[6]|0,this.Dl=rt[7]|0,this.Eh=rt[8]|0,this.El=rt[9]|0,this.Fh=rt[10]|0,this.Fl=rt[11]|0,this.Gh=rt[12]|0,this.Gl=rt[13]|0,this.Hh=rt[14]|0,this.Hl=rt[15]|0}};const zs=Di(()=>new E4),I4=Di(()=>new Za),D4=Di(()=>new S4),O4=Di(()=>new A4),$4=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Le=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),oe=new Uint32Array(32);function jn(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=oe[2*t],u=oe[2*t+1],l=oe[2*e],h=oe[2*e+1],d=oe[2*n],y=oe[2*n+1],f=oe[2*r],g=oe[2*r+1],I=Ha(c,l,o);u=Va(I,u,h,a),c=I|0,{Dh:g,Dl:f}={Dh:g^u,Dl:f^c},{Dh:g,Dl:f}={Dh:K3(g,f),Dl:W3(g)},{h:y,l:d}=Ht(y,d,g,f),{Bh:h,Bl:l}={Bh:h^y,Bl:l^d},{Bh:h,Bl:l}={Bh:kn(h,l,24),Bl:Rn(h,l,24)},oe[2*t]=c,oe[2*t+1]=u,oe[2*e]=l,oe[2*e+1]=h,oe[2*n]=d,oe[2*n+1]=y,oe[2*r]=f,oe[2*r+1]=g}function qn(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=oe[2*t],u=oe[2*t+1],l=oe[2*e],h=oe[2*e+1],d=oe[2*n],y=oe[2*n+1],f=oe[2*r],g=oe[2*r+1],I=Ha(c,l,o);u=Va(I,u,h,a),c=I|0,{Dh:g,Dl:f}={Dh:g^u,Dl:f^c},{Dh:g,Dl:f}={Dh:kn(g,f,16),Dl:Rn(g,f,16)},{h:y,l:d}=Ht(y,d,g,f),{Bh:h,Bl:l}={Bh:h^y,Bl:l^d},{Bh:h,Bl:l}={Bh:_i(h,l,63),Bl:Si(h,l,63)},oe[2*t]=c,oe[2*t+1]=u,oe[2*e]=l,oe[2*e+1]=h,oe[2*n]=d,oe[2*n+1]=y,oe[2*r]=f,oe[2*r+1]=g}function C4(t,e={},n,r,i){if(gn(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class P4 extends Ms{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,gn(e),gn(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=Ai(this.buffer)}update(e){Nn(this),e=Vt(e),Pt(e);const{blockLen:n,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(Un(i),this.compress(i,0,!1),Un(i),this.pos=0);const u=Math.min(n-this.pos,s-c),l=o+c;if(u===n&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));Un(h);for(let d=0;c+n<s;d+=i.length,c+=n)this.length+=n,this.compress(h,d,!1);Un(h);continue}r.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Nn(this),Ga(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,Bt(this.buffer.subarray(n)),Un(r),this.compress(r,0,!0),Un(r);const i=Ai(e);this.get().forEach((s,o)=>i[o]=yn(s))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class B4 extends P4{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=Le[0]|0,this.v0h=Le[1]|0,this.v1l=Le[2]|0,this.v1h=Le[3]|0,this.v2l=Le[4]|0,this.v2h=Le[5]|0,this.v3l=Le[6]|0,this.v3h=Le[7]|0,this.v4l=Le[8]|0,this.v4h=Le[9]|0,this.v5l=Le[10]|0,this.v5h=Le[11]|0,this.v6l=Le[12]|0,this.v6h=Le[13]|0,this.v7l=Le[14]|0,this.v7h=Le[15]|0,C4(n,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(r!==void 0&&(r=Vt(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Vt(s);const a=Ai(s);this.v4l^=yn(a[0]),this.v4h^=yn(a[1]),this.v5l^=yn(a[2]),this.v5h^=yn(a[3])}if(i!==void 0){i=Vt(i);const a=Ai(i);this.v6l^=yn(a[0]),this.v6h^=yn(a[1]),this.v7l^=yn(a[2]),this.v7h^=yn(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:d,v6l:y,v6h:f,v7l:g,v7h:I}=this;return[e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I]}set(e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=d|0,this.v6l=y|0,this.v6h=f|0,this.v7l=g|0,this.v7h=I|0}compress(e,n,r){this.get().forEach((c,u)=>oe[u]=c),oe.set(Le,16);let{h:i,l:s}=of(BigInt(this.length));oe[24]=Le[8]^s,oe[25]=Le[9]^i,r&&(oe[28]=~oe[28],oe[29]=~oe[29]);let o=0;const a=$4;for(let c=0;c<12;c++)jn(0,4,8,12,e,n+2*a[o++]),qn(0,4,8,12,e,n+2*a[o++]),jn(1,5,9,13,e,n+2*a[o++]),qn(1,5,9,13,e,n+2*a[o++]),jn(2,6,10,14,e,n+2*a[o++]),qn(2,6,10,14,e,n+2*a[o++]),jn(3,7,11,15,e,n+2*a[o++]),qn(3,7,11,15,e,n+2*a[o++]),jn(0,5,10,15,e,n+2*a[o++]),qn(0,5,10,15,e,n+2*a[o++]),jn(1,6,11,12,e,n+2*a[o++]),qn(1,6,11,12,e,n+2*a[o++]),jn(2,7,8,13,e,n+2*a[o++]),qn(2,7,8,13,e,n+2*a[o++]),jn(3,4,9,14,e,n+2*a[o++]),qn(3,4,9,14,e,n+2*a[o++]);this.v0l^=oe[0]^oe[16],this.v0h^=oe[1]^oe[17],this.v1l^=oe[2]^oe[18],this.v1h^=oe[3]^oe[19],this.v2l^=oe[4]^oe[20],this.v2h^=oe[5]^oe[21],this.v3l^=oe[6]^oe[22],this.v3h^=oe[7]^oe[23],this.v4l^=oe[8]^oe[24],this.v4h^=oe[9]^oe[25],this.v5l^=oe[10]^oe[26],this.v5h^=oe[11]^oe[27],this.v6l^=oe[12]^oe[28],this.v6h^=oe[13]^oe[29],this.v7l^=oe[14]^oe[30],this.v7h^=oe[15]^oe[31],Bt(oe)}destroy(){this.destroyed=!0,Bt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const T4=s4(t=>new B4(t)),k4="https://rpc.walletconnect.org/v1";function xf(t){const e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(y4(n)).toString("hex")}async function R4(t,e,n,r,i,s){switch(n.t){case"eip191":return await N4(t,e,n.s);case"eip1271":return await U4(t,e,n.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}async function N4(t,e,n){return(await Hv({hash:xf(e),signature:n})).toLowerCase()===t.toLowerCase()}async function U4(t,e,n,r,i,s){const o=Us(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=n.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:xf(e)).substring(2),d=a+h+c+l+u,y=await fetch(`${s||k4}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:F4(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:f}=await y.json();return f?f.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function F4(){return Date.now()+Math.floor(Math.random()*1e3)}function L4(t){const e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);const r=n[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(n.length<i)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return yi.encode(s)}function M4(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);const i=T4(r,{dkLen:32});return yi.encode(i)}function _f(t){const e=new Uint8Array(zs(z4(t)));return yi.encode(e)}function z4(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Sf(t){const e=Buffer.from(t,"base64"),n=lx(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const r=tx(n),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=O4(s);return mx.encode(o).replace(/=+$/,"")}function Ja(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function j4(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(Ja(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(Ja(n.length)),i.push(n),i.push(Buffer.from([26])),i.push(Ja(r.length)),i.push(r);const s=Buffer.concat(i),o=zs(s);return Buffer.from(o).toString("hex").toUpperCase()}var q4=Object.defineProperty,H4=Object.defineProperties,V4=Object.getOwnPropertyDescriptors,Af=Object.getOwnPropertySymbols,K4=Object.prototype.hasOwnProperty,W4=Object.prototype.propertyIsEnumerable,If=(t,e,n)=>e in t?q4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,G4=(t,e)=>{for(var n in e||(e={}))K4.call(e,n)&&If(t,n,e[n]);if(Af)for(var n of Af(e))W4.call(e,n)&&If(t,n,e[n]);return t},Y4=(t,e)=>H4(t,V4(e));const Q4="did:pkh:",Xa=t=>t==null?void 0:t.split(":"),Z4=t=>{const e=t&&Xa(t);if(e)return t.includes(Q4)?e[3]:e[1]},ec=t=>{const e=t&&Xa(t);if(e)return e[2]+":"+e[3]},js=t=>{const e=t&&Xa(t);if(e)return e.pop()};async function Df(t){const{cacao:e,projectId:n}=t,{s:r,p:i}=e,s=Of(i,i.iss),o=js(i.iss);return await R4(o,s,r,ec(i.iss),n)}const Of=(t,e)=>{const n=`${t.domain} wants you to sign in with your Ethereum account:`,r=js(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${Z4(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,y=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,f=qs(t.resources);if(f){const g=$i(f);i=o_(i,g)}return[n,r,"",i,"",s,o,a,c,u,l,h,d,y].filter(g=>g!=null).join(`
`)};function J4(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function X4(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function ur(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{const r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(i=>{const s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function e_(t,e,n,r={}){return n==null||n.sort((i,s)=>i.localeCompare(s)),{att:{[t]:t_(e,n,r)}}}function t_(t,e,n={}){e=e==null?void 0:e.sort((i,s)=>i.localeCompare(s));const r=e.map(i=>({[`${t}/${i}`]:[n]}));return Object.assign({},...r)}function $f(t){return ur(t),`urn:recap:${J4(t).replace(/=/g,"")}`}function $i(t){const e=X4(t.replace("urn:recap:",""));return ur(e),e}function n_(t,e,n){const r=e_(t,e,n);return $f(r)}function r_(t){return t&&t.includes("urn:recap:")}function i_(t,e){const n=$i(t),r=$i(e),i=s_(n,r);return $f(i)}function s_(t,e){ur(t),ur(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return n.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;r.att[i]=Y4(G4({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((u=e.att[i])==null?void 0:u[a])})})}),r}function o_(t="",e){ur(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(i++,`(${i}) '${h}': '${u[h].join("', '")}' for '${a}'.`));r.push(l.join(", ").replace(".,","."))});const s=r.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function Cf(t){var e;const n=$i(t);ur(n);const r=(e=n.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function Pf(t){const e=$i(t);ur(e);const n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;(s=i==null?void 0:i[0])!=null&&s.chains&&n.push(i[0].chains)})}),[...new Set(n.flat())]}function qs(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return r_(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Bf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tc(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function nc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function gt(t,...e){if(!Bf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Tf(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function a_(t,e){gt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Hn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function jr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function c_(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const u_=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function l_(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function rc(t){if(typeof t=="string")t=l_(t);else if(Bf(t))t=ic(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function h_(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function d_(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const f_=(t,e)=>{function n(r,...i){if(gt(r),!u_)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?gt(u):gt(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&gt(i[1]);const o=e(r,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");gt(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,gt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(gt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(n,t),n};function kf(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!g_(e))throw new Error("invalid output, must be aligned");return e}function Rf(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function p_(t,e,n){tc(n);const r=new Uint8Array(16),i=c_(r);return Rf(i,0,BigInt(e),n),Rf(i,8,BigInt(t),n),r}function g_(t){return t.byteOffset%4===0}function ic(t){return Uint8Array.from(t)}const Nf=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),y_=Nf("expand 16-byte k"),w_=Nf("expand 32-byte k"),m_=Hn(y_),b_=Hn(w_);function Ee(t,e){return t<<e|t>>>32-e}function sc(t){return t.byteOffset%4===0}const Hs=64,v_=16,Uf=2**32-1,Ff=new Uint32Array;function E_(t,e,n,r,i,s,o,a){const c=i.length,u=new Uint8Array(Hs),l=Hn(u),h=sc(i)&&sc(s),d=h?Hn(i):Ff,y=h?Hn(s):Ff;for(let f=0;f<c;o++){if(t(e,n,r,l,o,a),o>=Uf)throw new Error("arx: counter overflow");const g=Math.min(Hs,c-f);if(h&&g===Hs){const I=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let $=0,R;$<v_;$++)R=I+$,y[R]=d[R]^l[$];f+=Hs;continue}for(let I=0,$;I<g;I++)$=f+I,s[$]=i[$]^u[I];f+=g}}function x_(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=h_({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return nc(i),nc(o),tc(s),tc(n),(a,c,u,l,h=0)=>{gt(a),gt(c),gt(u);const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),gt(l),nc(h),h<0||h>=Uf)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const y=[];let f=a.length,g,I;if(f===32)y.push(g=ic(a)),I=b_;else if(f===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),I=m_,y.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);sc(c)||y.push(c=ic(c));const $=Hn(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(I,$,Hn(c.subarray(0,16)),$),c=c.subarray(16)}const R=16-i;if(R!==c.length)throw new Error(`arx: nonce must be ${R} or 16 bytes`);if(R!==12){const _=new Uint8Array(12);_.set(c,s?0:12-c.length),c=_,y.push(c)}const D=Hn(c);return E_(t,I,$,D,u,l,h,o),jr(...y),l}}const Qe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class __{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=rc(e),gt(e,32);const n=Qe(e,0),r=Qe(e,2),i=Qe(e,4),s=Qe(e,6),o=Qe(e,8),a=Qe(e,10),c=Qe(e,12),u=Qe(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Qe(e,16+2*l)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],y=o[6],f=o[7],g=o[8],I=o[9],$=Qe(e,n+0),R=Qe(e,n+2),D=Qe(e,n+4),_=Qe(e,n+6),A=Qe(e,n+8),S=Qe(e,n+10),F=Qe(e,n+12),j=Qe(e,n+14);let O=s[0]+($&8191),M=s[1]+(($>>>13|R<<3)&8191),z=s[2]+((R>>>10|D<<6)&8191),q=s[3]+((D>>>7|_<<9)&8191),C=s[4]+((_>>>4|A<<12)&8191),B=s[5]+(A>>>1&8191),x=s[6]+((A>>>14|S<<2)&8191),w=s[7]+((S>>>11|F<<5)&8191),E=s[8]+((F>>>8|j<<8)&8191),T=s[9]+(j>>>5|i),N=0,U=N+O*a+M*(5*I)+z*(5*g)+q*(5*f)+C*(5*y);N=U>>>13,U&=8191,U+=B*(5*d)+x*(5*h)+w*(5*l)+E*(5*u)+T*(5*c),N+=U>>>13,U&=8191;let H=N+O*c+M*a+z*(5*I)+q*(5*g)+C*(5*f);N=H>>>13,H&=8191,H+=B*(5*y)+x*(5*d)+w*(5*h)+E*(5*l)+T*(5*u),N+=H>>>13,H&=8191;let G=N+O*u+M*c+z*a+q*(5*I)+C*(5*g);N=G>>>13,G&=8191,G+=B*(5*f)+x*(5*y)+w*(5*d)+E*(5*h)+T*(5*l),N+=G>>>13,G&=8191;let Y=N+O*l+M*u+z*c+q*a+C*(5*I);N=Y>>>13,Y&=8191,Y+=B*(5*g)+x*(5*f)+w*(5*y)+E*(5*d)+T*(5*h),N+=Y>>>13,Y&=8191;let J=N+O*h+M*l+z*u+q*c+C*a;N=J>>>13,J&=8191,J+=B*(5*I)+x*(5*g)+w*(5*f)+E*(5*y)+T*(5*d),N+=J>>>13,J&=8191;let X=N+O*d+M*h+z*l+q*u+C*c;N=X>>>13,X&=8191,X+=B*a+x*(5*I)+w*(5*g)+E*(5*f)+T*(5*y),N+=X>>>13,X&=8191;let ie=N+O*y+M*d+z*h+q*l+C*u;N=ie>>>13,ie&=8191,ie+=B*c+x*a+w*(5*I)+E*(5*g)+T*(5*f),N+=ie>>>13,ie&=8191;let ue=N+O*f+M*y+z*d+q*h+C*l;N=ue>>>13,ue&=8191,ue+=B*u+x*c+w*a+E*(5*I)+T*(5*g),N+=ue>>>13,ue&=8191;let fe=N+O*g+M*f+z*y+q*d+C*h;N=fe>>>13,fe&=8191,fe+=B*l+x*u+w*c+E*a+T*(5*I),N+=fe>>>13,fe&=8191;let le=N+O*I+M*g+z*f+q*y+C*d;N=le>>>13,le&=8191,le+=B*h+x*l+w*u+E*c+T*a,N+=le>>>13,le&=8191,N=(N<<2)+N|0,N=N+U|0,U=N&8191,N=N>>>13,H+=N,s[0]=U,s[1]=H,s[2]=G,s[3]=Y,s[4]=J,s[5]=X,s[6]=ie,s[7]=ue,s[8]=fe,s[9]=le}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;jr(r)}update(e){Tf(this),e=rc(e),gt(e);const{buffer:n,blockLen:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){jr(this.h,this.r,this.buffer,this.pad)}digestInto(e){Tf(this),a_(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}function S_(t){const e=(r,i)=>t(i).update(rc(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}const A_=S_(t=>new __(t));function I_(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],d=e[2],y=e[3],f=e[4],g=e[5],I=e[6],$=e[7],R=i,D=n[0],_=n[1],A=n[2],S=o,F=a,j=c,O=u,M=l,z=h,q=d,C=y,B=f,x=g,w=I,E=$,T=R,N=D,U=_,H=A;for(let Y=0;Y<s;Y+=2)S=S+M|0,T=Ee(T^S,16),B=B+T|0,M=Ee(M^B,12),S=S+M|0,T=Ee(T^S,8),B=B+T|0,M=Ee(M^B,7),F=F+z|0,N=Ee(N^F,16),x=x+N|0,z=Ee(z^x,12),F=F+z|0,N=Ee(N^F,8),x=x+N|0,z=Ee(z^x,7),j=j+q|0,U=Ee(U^j,16),w=w+U|0,q=Ee(q^w,12),j=j+q|0,U=Ee(U^j,8),w=w+U|0,q=Ee(q^w,7),O=O+C|0,H=Ee(H^O,16),E=E+H|0,C=Ee(C^E,12),O=O+C|0,H=Ee(H^O,8),E=E+H|0,C=Ee(C^E,7),S=S+z|0,H=Ee(H^S,16),w=w+H|0,z=Ee(z^w,12),S=S+z|0,H=Ee(H^S,8),w=w+H|0,z=Ee(z^w,7),F=F+q|0,T=Ee(T^F,16),E=E+T|0,q=Ee(q^E,12),F=F+q|0,T=Ee(T^F,8),E=E+T|0,q=Ee(q^E,7),j=j+C|0,N=Ee(N^j,16),B=B+N|0,C=Ee(C^B,12),j=j+C|0,N=Ee(N^j,8),B=B+N|0,C=Ee(C^B,7),O=O+M|0,U=Ee(U^O,16),x=x+U|0,M=Ee(M^x,12),O=O+M|0,U=Ee(U^O,8),x=x+U|0,M=Ee(M^x,7);let G=0;r[G++]=o+S|0,r[G++]=a+F|0,r[G++]=c+j|0,r[G++]=u+O|0,r[G++]=l+M|0,r[G++]=h+z|0,r[G++]=d+q|0,r[G++]=y+C|0,r[G++]=f+B|0,r[G++]=g+x|0,r[G++]=I+w|0,r[G++]=$+E|0,r[G++]=R+T|0,r[G++]=D+N|0,r[G++]=_+U|0,r[G++]=A+H|0}const D_=x_(I_,{counterRight:!1,counterLength:4,allowShortKeys:!1}),O_=new Uint8Array(16),Lf=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(O_.subarray(n))},$_=new Uint8Array(32);function Mf(t,e,n,r,i){const s=t(e,n,$_),o=A_.create(s);i&&Lf(o,i),Lf(o,r);const a=p_(r.length,i?i.length:0,!0);o.update(a);const c=o.digest();return jr(s,a),c}const C_=t=>(e,n,r)=>({encrypt(i,s){const o=i.length;s=kf(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,n,a,a,1);const c=Mf(t,e,n,a,r);return s.set(c,o),jr(c),s},decrypt(i,s){s=kf(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=Mf(t,e,n,o,r);if(!d_(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),jr(c),s}}),zf=f_({blockSize:64,nonceLength:12,tagLength:16},C_(D_));let jf=class extends Ms{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Wa(e);const r=Vt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Bt(s)}update(e){return Nn(this),this.iHash.update(e),this}digestInto(e){Nn(this),Pt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Vs=(t,e,n)=>new jf(t,e).update(n).digest();Vs.create=(t,e)=>new jf(t,e);function P_(t,e,n){return Wa(t),n===void 0&&(n=new Uint8Array(t.outputLen)),Vs(t,Vt(n),Vt(e))}const oc=Uint8Array.from([0]),qf=Uint8Array.of();function B_(t,e,n,r=32){Wa(t),gn(r);const i=t.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0&&(n=qf);const o=new Uint8Array(s*i),a=Vs.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)oc[0]=l+1,c.update(l===0?qf:u).update(n).update(oc).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),Bt(u,oc),o.slice(0,r)}const T_=(t,e,n,r,i)=>B_(t,P_(t,e,n),r,i),Ks=zs,ac=BigInt(0),cc=BigInt(1);function Ws(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Gs(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Hf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ac:BigInt("0x"+t)}function Ys(t){return Hf(Ii(t))}function Qs(t){return Pt(t),Hf(Ii(Uint8Array.from(t).reverse()))}function uc(t,e){return Qa(t.toString(16).padStart(e*2,"0"))}function lc(t,e){return uc(t,e).reverse()}function yt(t,e,n){let r;if(typeof e=="string")try{r=Qa(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ka(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}const hc=t=>typeof t=="bigint"&&ac<=t;function k_(t,e,n){return hc(t)&&hc(e)&&hc(n)&&e<=t&&t<n}function dc(t,e,n,r){if(!k_(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function R_(t){let e;for(e=0;t>ac;t>>=cc,e+=1);return e}const Zs=t=>(cc<<BigInt(t))-cc;function N_(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=d=>new Uint8Array(d),i=d=>Uint8Array.of(d);let s=r(t),o=r(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...d)=>n(o,s,...d),l=(d=r(0))=>{o=u(i(0),d),s=u(),d.length!==0&&(o=u(i(1),d),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const y=[];for(;d<e;){s=u();const f=s.slice();y.push(f),d+=s.length}return cr(...y)};return(d,y)=>{c(),l(d);let f;for(;!(f=y(h()));)l();return c(),f}}function Js(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function Vf(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const wt=BigInt(0),at=BigInt(1),lr=BigInt(2),U_=BigInt(3),Kf=BigInt(4),Wf=BigInt(5),Gf=BigInt(8);function Tt(t,e){const n=t%e;return n>=wt?n:e+n}function Kt(t,e,n){let r=t;for(;e-- >wt;)r*=r,r%=n;return r}function Yf(t,e){if(t===wt)throw new Error("invert: expected non-zero number");if(e<=wt)throw new Error("invert: expected positive modulus, got "+e);let n=Tt(t,e),r=e,i=wt,s=at;for(;n!==wt;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==at)throw new Error("invert: does not exist");return Tt(i,e)}function Qf(t,e){const n=(t.ORDER+at)/Kf,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function F_(t,e){const n=(t.ORDER-Wf)/Gf,r=t.mul(e,lr),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,lr),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function L_(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-at,n=0;for(;e%lr===wt;)e/=lr,n++;let r=lr;const i=qr(t);for(;Jf(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Qf;let s=i.pow(r,e);const o=(e+at)/lr;return function(a,c){if(a.is0(c))return c;if(Jf(a,c)!==1)throw new Error("Cannot find square root");let u=n,l=a.mul(a.ONE,s),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let y=1,f=a.sqr(h);for(;!a.eql(f,a.ONE);)if(y++,f=a.sqr(f),y===u)throw new Error("Cannot find square root");const g=at<<BigInt(u-y-1),I=a.pow(l,g);u=y,l=a.sqr(I),h=a.mul(h,l),d=a.mul(d,I)}return d}}function M_(t){return t%Kf===U_?Qf:t%Gf===Wf?F_:L_(t)}const z_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function j_(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=z_.reduce((r,i)=>(r[i]="function",r),e);return Js(t,n),t}function q_(t,e,n){if(n<wt)throw new Error("invalid exponent, negatives unsupported");if(n===wt)return t.ONE;if(n===at)return e;let r=t.ONE,i=e;for(;n>wt;)n&at&&(r=t.mul(r,i)),i=t.sqr(i),n>>=at;return r}function Zf(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function Jf(t,e){const n=(t.ORDER-at)/lr,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function H_(t,e){e!==void 0&&gn(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function qr(t,e,n=!1,r={}){if(t<=wt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const l=e;l.BITS&&(i=l.BITS),l.sqrt&&(s=l.sqrt),typeof l.isLE=="boolean"&&(n=l.isLE)}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:o,nByteLength:a}=H_(t,i);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const u=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:a,MASK:Zs(o),ZERO:wt,ONE:at,create:l=>Tt(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return wt<=l&&l<t},is0:l=>l===wt,isValidNot0:l=>!u.is0(l)&&u.isValid(l),isOdd:l=>(l&at)===at,neg:l=>Tt(-l,t),eql:(l,h)=>l===h,sqr:l=>Tt(l*l,t),add:(l,h)=>Tt(l+h,t),sub:(l,h)=>Tt(l-h,t),mul:(l,h)=>Tt(l*h,t),pow:(l,h)=>q_(u,l,h),div:(l,h)=>Tt(l*Yf(h,t),t),sqrN:l=>l*l,addN:(l,h)=>l+h,subN:(l,h)=>l-h,mulN:(l,h)=>l*h,inv:l=>Yf(l,t),sqrt:s||(l=>(c||(c=M_(t)),c(u,l))),toBytes:l=>n?lc(l,a):uc(l,a),fromBytes:l=>{if(l.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+l.length);return n?Qs(l):Ys(l)},invertBatch:l=>Zf(u,l),cmov:(l,h,d)=>d?h:l});return Object.freeze(u)}function Xf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ep(t){const e=Xf(t);return e+Math.ceil(e/2)}function V_(t,e,n=!1){const r=t.length,i=Xf(e),s=ep(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?Qs(t):Ys(t),a=Tt(o,e-at)+at;return n?lc(a,i):uc(a,i)}const Hr=BigInt(0),hr=BigInt(1);function Ci(t,e){const n=e.negate();return t?n:e}function K_(t,e,n){const r=s=>s.pz,i=Zf(t.Fp,n.map(r));return n.map((s,o)=>s.toAffine(i[o])).map(t.fromAffine)}function tp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function fc(t,e){tp(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Zs(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function np(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=hr);const u=e*r,l=u+Math.abs(a)-1,h=a===0,d=a<0,y=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:y,offsetF:u}}function W_(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function G_(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const pc=new WeakMap,rp=new WeakMap;function gc(t){return rp.get(t)||1}function ip(t){if(t!==Hr)throw new Error("invalid wNAF")}function Y_(t,e){return{constTimeNegate:Ci,hasPrecomputes(n){return gc(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>Hr;)r&hr&&(i=i.add(s)),s=s.double(),r>>=hr;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=fc(r,e),o=[];let a=n,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){let s=t.ZERO,o=t.BASE;const a=fc(n,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:d,isNegF:y,offsetF:f}=np(i,c,a);i=u,h?o=o.add(Ci(y,r[f])):s=s.add(Ci(d,r[l]))}return ip(i),{p:s,f:o}},wNAFUnsafe(n,r,i,s=t.ZERO){const o=fc(n,e);for(let a=0;a<o.windows&&i!==Hr;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=np(i,a,o);if(i=c,!l){const d=r[u];s=s.add(h?d.negate():d)}}return ip(i),s},getPrecomputes(n,r,i){let s=pc.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&(typeof i=="function"&&(s=i(s)),pc.set(r,s))),s},wNAFCached(n,r,i){const s=gc(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=gc(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){tp(r,e),rp.set(n,r),pc.delete(n)}}}function Q_(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>Hr||r>Hr;)n&hr&&(s=s.add(i)),r&hr&&(o=o.add(i)),i=i.double(),n>>=hr,r>>=hr;return{p1:s,p2:o}}function Z_(t,e,n,r){W_(n,t),G_(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=R_(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Zs(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let y=h;y>=0;y-=c){l.fill(o);for(let g=0;g<s;g++){const I=r[g],$=Number(I>>BigInt(y)&u);l[$]=l[$].add(n[g])}let f=o;for(let g=l.length-1,I=o;g>0;g--)I=I.add(l[g]),f=f.add(I);if(d=d.add(f),y!==0)for(let g=0;g<c;g++)d=d.double()}return d}function sp(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return j_(e),e}else return qr(t)}function J_(t,e,n={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const o of["p","n","h"]){const a=e[o];if(!(typeof a=="bigint"&&a>Hr))throw new Error(`CURVE.${o} must be positive bigint`)}const r=sp(e.p,n.Fp),i=sp(e.n,n.Fn),s=["Gx","Gy","a","b"];for(const o of s)if(!r.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:r,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Pi=BigInt(0),Vr=BigInt(1),Xs=BigInt(2);function X_(t){return Js(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function e8(t){const e=X_(t),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const c=o||zr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),y=a?Xs**BigInt(254):Xs**BigInt(447),f=a?BigInt(8)*Xs**BigInt(251)-Vr:BigInt(4)*Xs**BigInt(445)-Vr,g=y+f+Vr,I=O=>Tt(O,n),$=R(h);function R(O){return lc(I(O),l)}function D(O){const M=yt("u coordinate",O,l);return a&&(M[31]&=127),I(Qs(M))}function _(O){return Qs(i(yt("scalar",O,l)))}function A(O,M){const z=j(D(M),_(O));if(z===Pi)throw new Error("invalid private or public key received");return R(z)}function S(O){return A(O,$)}function F(O,M,z){const q=I(O*(M-z));return M=I(M-q),z=I(z+q),{x_2:M,x_3:z}}function j(O,M){dc("u",O,Pi,n),dc("scalar",M,y,g);const z=M,q=O;let C=Vr,B=Pi,x=O,w=Vr,E=Pi;for(let N=BigInt(u-1);N>=Pi;N--){const U=z>>N&Vr;E^=U,{x_2:C,x_3:x}=F(E,C,x),{x_2:B,x_3:w}=F(E,B,w),E=U;const H=C+B,G=I(H*H),Y=C-B,J=I(Y*Y),X=G-J,ie=x+w,ue=x-w,fe=I(ue*H),le=I(ie*Y),ce=fe+le,P=fe-le;x=I(ce*ce),w=I(q*I(P*P)),C=I(G*J),B=I(X*(G+I(d*X)))}({x_2:C,x_3:x}=F(E,C,x)),{x_2:B,x_3:w}=F(E,B,w);const T=s(B);return I(C*T)}return{scalarMult:A,scalarMultBase:S,getSharedSecret:(O,M)=>A(O,M),getPublicKey:O=>S(O),utils:{randomPrivateKey:()=>c(l)},GuBytes:$.slice()}}BigInt(0);const t8=BigInt(1),op=BigInt(2),n8=BigInt(3),r8=BigInt(5);BigInt(8);const ap={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function i8(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=ap.p,o=t*t%s*t%s,a=Kt(o,op,s)*o%s,c=Kt(a,t8,s)*t%s,u=Kt(c,r8,s)*c%s,l=Kt(u,e,s)*u%s,h=Kt(l,n,s)*l%s,d=Kt(h,r,s)*h%s,y=Kt(d,i,s)*d%s,f=Kt(y,i,s)*d%s,g=Kt(f,e,s)*u%s;return{pow_p_5_8:Kt(g,op,s)*t%s,b2:o}}function s8(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const yc=(()=>{const t=ap.p;return e8({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:r}=i8(e);return Tt(Kt(n,n8,t)*r,t)},adjustScalarBytes:s8})})();function cp(t){t.lowS!==void 0&&Ws("lowS",t.lowS),t.prehash!==void 0&&Ws("prehash",t.prehash)}class o8 extends Error{constructor(e=""){super(e)}}const mn={Err:o8,_tlv:{encode:(t,e)=>{const{Err:n}=mn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=Gs(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Gs(i.length/2|128):"";return Gs(t)+s+i+e},decode(t,e){const{Err:n}=mn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new n("tlv.decode: length bytes not complete");if(u[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=mn;if(t<Bi)throw new e("integer: negative integers are not allowed");let n=Gs(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=mn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ys(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=mn,i=yt("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(t){const{_tlv:e,_int:n}=mn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},Bi=BigInt(0),Ti=BigInt(1),a8=BigInt(2),eo=BigInt(3),c8=BigInt(4);function u8(t,e,n){function r(i){const s=t.sqr(i),o=t.mul(s,i);return t.add(t.add(o,t.mul(i,e)),n)}return r}function up(t,e,n){const{BYTES:r}=t;function i(s){let o;if(typeof s=="bigint")o=s;else{let a=yt("private key",s);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(r);c.set(a,c.length-a.length),a=c}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof s}`)}}if(n&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return i}function l8(t,e={}){const{Fp:n,Fn:r}=J_("weierstrass",t,e),{h:i,n:s}=t;Js(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!n.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(j,O,M){const{x:z,y:q}=O.toAffine(),C=n.toBytes(z);if(Ws("isCompressed",M),M){a();const B=!n.isOdd(q);return cr(lp(B),C)}else return cr(Uint8Array.of(4),C,n.toBytes(q))}function u(j){Pt(j);const O=n.BYTES,M=O+1,z=2*O+1,q=j.length,C=j[0],B=j.subarray(1);if(q===M&&(C===2||C===3)){const x=n.fromBytes(B);if(!n.isValid(x))throw new Error("bad point: is not on curve, wrong x");const w=d(x);let E;try{E=n.sqrt(w)}catch(N){const U=N instanceof Error?": "+N.message:"";throw new Error("bad point: is not on curve, sqrt error"+U)}a();const T=n.isOdd(E);return(C&1)===1!==T&&(E=n.neg(E)),{x,y:E}}else if(q===z&&C===4){const x=n.fromBytes(B.subarray(O*0,O*1)),w=n.fromBytes(B.subarray(O*1,O*2));if(!y(x,w))throw new Error("bad point: is not on curve");return{x,y:w}}else throw new Error(`bad point: got length ${q}, expected compressed=${M} or uncompressed=${z}`)}const l=e.toBytes||c,h=e.fromBytes||u,d=u8(n,t.a,t.b);function y(j,O){const M=n.sqr(O),z=d(j);return n.eql(M,z)}if(!y(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const f=n.mul(n.pow(t.a,eo),c8),g=n.mul(n.sqr(t.b),BigInt(27));if(n.is0(n.add(f,g)))throw new Error("bad curve params: a or b");function I(j,O,M=!1){if(!n.isValid(O)||M&&n.is0(O))throw new Error(`bad point coordinate ${j}`);return O}function $(j){if(!(j instanceof A))throw new Error("ProjectivePoint expected")}const R=Vf((j,O)=>{const{px:M,py:z,pz:q}=j;if(n.eql(q,n.ONE))return{x:M,y:z};const C=j.is0();O==null&&(O=C?n.ONE:n.inv(q));const B=n.mul(M,O),x=n.mul(z,O),w=n.mul(q,O);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(w,n.ONE))throw new Error("invZ was invalid");return{x:B,y:x}}),D=Vf(j=>{if(j.is0()){if(e.allowInfinityPoint&&!n.is0(j.py))return;throw new Error("bad point: ZERO")}const{x:O,y:M}=j.toAffine();if(!n.isValid(O)||!n.isValid(M))throw new Error("bad point: x or y not field elements");if(!y(O,M))throw new Error("bad point: equation left != right");if(!j.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function _(j,O,M,z,q){return M=new A(n.mul(M.px,j),M.py,M.pz),O=Ci(z,O),M=Ci(q,M),O.add(M)}class A{constructor(O,M,z){this.px=I("x",O),this.py=I("y",M,!0),this.pz=I("z",z),Object.freeze(this)}static fromAffine(O){const{x:M,y:z}=O||{};if(!O||!n.isValid(M)||!n.isValid(z))throw new Error("invalid affine point");if(O instanceof A)throw new Error("projective point not allowed");return n.is0(M)&&n.is0(z)?A.ZERO:new A(M,z,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(O){return K_(A,"pz",O)}static fromBytes(O){return Pt(O),A.fromHex(O)}static fromHex(O){const M=A.fromAffine(h(yt("pointHex",O)));return M.assertValidity(),M}static fromPrivateKey(O){const M=up(r,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return A.BASE.multiply(M(O))}static msm(O,M){return Z_(A,r,O,M)}precompute(O=8,M=!0){return F.setWindowSize(this,O),M||this.multiply(eo),this}_setWindowSize(O){this.precompute(O)}assertValidity(){D(this)}hasEvenY(){const{y:O}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(O)}equals(O){$(O);const{px:M,py:z,pz:q}=this,{px:C,py:B,pz:x}=O,w=n.eql(n.mul(M,x),n.mul(C,q)),E=n.eql(n.mul(z,x),n.mul(B,q));return w&&E}negate(){return new A(this.px,n.neg(this.py),this.pz)}double(){const{a:O,b:M}=t,z=n.mul(M,eo),{px:q,py:C,pz:B}=this;let x=n.ZERO,w=n.ZERO,E=n.ZERO,T=n.mul(q,q),N=n.mul(C,C),U=n.mul(B,B),H=n.mul(q,C);return H=n.add(H,H),E=n.mul(q,B),E=n.add(E,E),x=n.mul(O,E),w=n.mul(z,U),w=n.add(x,w),x=n.sub(N,w),w=n.add(N,w),w=n.mul(x,w),x=n.mul(H,x),E=n.mul(z,E),U=n.mul(O,U),H=n.sub(T,U),H=n.mul(O,H),H=n.add(H,E),E=n.add(T,T),T=n.add(E,T),T=n.add(T,U),T=n.mul(T,H),w=n.add(w,T),U=n.mul(C,B),U=n.add(U,U),T=n.mul(U,H),x=n.sub(x,T),E=n.mul(U,N),E=n.add(E,E),E=n.add(E,E),new A(x,w,E)}add(O){$(O);const{px:M,py:z,pz:q}=this,{px:C,py:B,pz:x}=O;let w=n.ZERO,E=n.ZERO,T=n.ZERO;const N=t.a,U=n.mul(t.b,eo);let H=n.mul(M,C),G=n.mul(z,B),Y=n.mul(q,x),J=n.add(M,z),X=n.add(C,B);J=n.mul(J,X),X=n.add(H,G),J=n.sub(J,X),X=n.add(M,q);let ie=n.add(C,x);return X=n.mul(X,ie),ie=n.add(H,Y),X=n.sub(X,ie),ie=n.add(z,q),w=n.add(B,x),ie=n.mul(ie,w),w=n.add(G,Y),ie=n.sub(ie,w),T=n.mul(N,X),w=n.mul(U,Y),T=n.add(w,T),w=n.sub(G,T),T=n.add(G,T),E=n.mul(w,T),G=n.add(H,H),G=n.add(G,H),Y=n.mul(N,Y),X=n.mul(U,X),G=n.add(G,Y),Y=n.sub(H,Y),Y=n.mul(N,Y),X=n.add(X,Y),H=n.mul(G,X),E=n.add(E,H),H=n.mul(ie,X),w=n.mul(J,w),w=n.sub(w,H),H=n.mul(J,G),T=n.mul(ie,T),T=n.add(T,H),new A(w,E,T)}subtract(O){return this.add(O.negate())}is0(){return this.equals(A.ZERO)}multiply(O){const{endo:M}=e;if(!r.isValidNot0(O))throw new Error("invalid scalar: out of range");let z,q;const C=B=>F.wNAFCached(this,B,A.normalizeZ);if(M){const{k1neg:B,k1:x,k2neg:w,k2:E}=M.splitScalar(O),{p:T,f:N}=C(x),{p:U,f:H}=C(E);q=N.add(H),z=_(M.beta,T,U,B,w)}else{const{p:B,f:x}=C(O);z=B,q=x}return A.normalizeZ([z,q])[0]}multiplyUnsafe(O){const{endo:M}=e,z=this;if(!r.isValid(O))throw new Error("invalid scalar: out of range");if(O===Bi||z.is0())return A.ZERO;if(O===Ti)return z;if(F.hasPrecomputes(this))return this.multiply(O);if(M){const{k1neg:q,k1:C,k2neg:B,k2:x}=M.splitScalar(O),{p1:w,p2:E}=Q_(A,z,C,x);return _(M.beta,w,E,q,B)}else return F.wNAFCachedUnsafe(z,O)}multiplyAndAddUnsafe(O,M,z){const q=this.multiplyUnsafe(M).add(O.multiplyUnsafe(z));return q.is0()?void 0:q}toAffine(O){return R(this,O)}isTorsionFree(){const{isTorsionFree:O}=e;return i===Ti?!0:O?O(A,this):F.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){const{clearCofactor:O}=e;return i===Ti?this:O?O(A,this):this.multiplyUnsafe(i)}toBytes(O=!0){return Ws("isCompressed",O),this.assertValidity(),l(A,this,O)}toRawBytes(O=!0){return this.toBytes(O)}toHex(O=!0){return Ii(this.toBytes(O))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}A.BASE=new A(t.Gx,t.Gy,n.ONE),A.ZERO=new A(n.ZERO,n.ONE,n.ZERO),A.Fp=n,A.Fn=r;const S=r.BITS,F=Y_(A,e.endo?Math.ceil(S/2):S);return A}function lp(t){return Uint8Array.of(t?2:3)}function h8(t,e,n={}){Js(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=e.randomBytes||zr,i=e.hmac||((z,...q)=>Vs(e.hash,z,cr(...q))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o;function u(z){const q=a>>Ti;return z>q}function l(z){return u(z)?o.neg(z):z}function h(z,q){if(!o.isValidNot0(q))throw new Error(`invalid signature ${z}: out of range 1..CURVE.n`)}class d{constructor(q,C,B){h("r",q),h("s",C),this.r=q,this.s=C,B!=null&&(this.recovery=B),Object.freeze(this)}static fromCompact(q){const C=o.BYTES,B=yt("compactSignature",q,C*2);return new d(o.fromBytes(B.subarray(0,C)),o.fromBytes(B.subarray(C,C*2)))}static fromDER(q){const{r:C,s:B}=mn.toSig(yt("DER",q));return new d(C,B)}assertValidity(){}addRecoveryBit(q){return new d(this.r,this.s,q)}recoverPublicKey(q){const C=s.ORDER,{r:B,s:x,recovery:w}=this;if(w==null||![0,1,2,3].includes(w))throw new Error("recovery id invalid");if(a*a8<C&&w>1)throw new Error("recovery id is ambiguous for h>1 curve");const E=w===2||w===3?B+a:B;if(!s.isValid(E))throw new Error("recovery id 2 or 3 invalid");const T=s.toBytes(E),N=t.fromHex(cr(lp((w&1)===0),T)),U=o.inv(E),H=D(yt("msgHash",q)),G=o.create(-H*U),Y=o.create(x*U),J=t.BASE.multiplyUnsafe(G).add(N.multiplyUnsafe(Y));if(J.is0())throw new Error("point at infinify");return J.assertValidity(),J}hasHighS(){return u(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o.neg(this.s),this.recovery):this}toBytes(q){if(q==="compact")return cr(o.toBytes(this.r),o.toBytes(this.s));if(q==="der")return Qa(mn.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ii(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ii(this.toBytes("compact"))}}const y=up(o,n.allowedPrivateKeyLengths,n.wrapPrivateKey),f={isValidPrivateKey(z){try{return y(z),!0}catch{return!1}},normPrivateKeyToScalar:y,randomPrivateKey:()=>{const z=a;return V_(r(ep(z)),z)},precompute(z=8,q=t.BASE){return q.precompute(z,!1)}};function g(z,q=!0){return t.fromPrivateKey(z).toBytes(q)}function I(z){if(typeof z=="bigint")return!1;if(z instanceof t)return!0;const q=yt("key",z).length,C=s.BYTES,B=C+1,x=2*C+1;if(!(n.allowedPrivateKeyLengths||o.BYTES===B))return q===B||q===x}function $(z,q,C=!0){if(I(z)===!0)throw new Error("first arg must be private key");if(I(q)===!1)throw new Error("second arg must be public key");return t.fromHex(q).multiply(y(z)).toBytes(C)}const R=e.bits2int||function(z){if(z.length>8192)throw new Error("input is too large");const q=Ys(z),C=z.length*8-c;return C>0?q>>BigInt(C):q},D=e.bits2int_modN||function(z){return o.create(R(z))},_=Zs(c);function A(z){return dc("num < 2^"+c,z,Bi,_),o.toBytes(z)}function S(z,q,C=F){if(["recovered","canonical"].some(J=>J in C))throw new Error("sign() legacy options not supported");const{hash:B}=e;let{lowS:x,prehash:w,extraEntropy:E}=C;x==null&&(x=!0),z=yt("msgHash",z),cp(C),w&&(z=yt("prehashed msgHash",B(z)));const T=D(z),N=y(q),U=[A(N),A(T)];if(E!=null&&E!==!1){const J=E===!0?r(s.BYTES):E;U.push(yt("extraEntropy",J))}const H=cr(...U),G=T;function Y(J){const X=R(J);if(!o.isValidNot0(X))return;const ie=o.inv(X),ue=t.BASE.multiply(X).toAffine(),fe=o.create(ue.x);if(fe===Bi)return;const le=o.create(ie*o.create(G+fe*N));if(le===Bi)return;let ce=(ue.x===fe?0:2)|Number(ue.y&Ti),P=le;return x&&u(le)&&(P=l(le),ce^=1),new d(fe,P,ce)}return{seed:H,k2sig:Y}}const F={lowS:e.lowS,prehash:!1},j={lowS:e.lowS,prehash:!1};function O(z,q,C=F){const{seed:B,k2sig:x}=S(z,q,C);return N_(e.hash.outputLen,o.BYTES,i)(B,x)}t.BASE.precompute(8);function M(z,q,C,B=j){const x=z;q=yt("msgHash",q),C=yt("publicKey",C),cp(B);const{lowS:w,prehash:E,format:T}=B;if("strict"in B)throw new Error("options.strict was renamed to lowS");if(T!==void 0&&!["compact","der","js"].includes(T))throw new Error('format must be "compact", "der" or "js"');const N=typeof x=="string"||Ka(x),U=!N&&!T&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!N&&!U)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let H,G;try{if(U)if(T===void 0||T==="js")H=new d(x.r,x.s);else throw new Error("invalid format");if(N){try{T!=="compact"&&(H=d.fromDER(x))}catch(ce){if(!(ce instanceof mn.Err))throw ce}!H&&T!=="der"&&(H=d.fromCompact(x))}G=t.fromHex(C)}catch{return!1}if(!H||w&&H.hasHighS())return!1;E&&(q=e.hash(q));const{r:Y,s:J}=H,X=D(q),ie=o.inv(J),ue=o.create(X*ie),fe=o.create(Y*ie),le=t.BASE.multiplyUnsafe(ue).add(G.multiplyUnsafe(fe));return le.is0()?!1:o.create(le.x)===Y}return Object.freeze({getPublicKey:g,getSharedSecret:$,sign:O,verify:M,utils:f,Point:t,Signature:d})}function d8(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp,r=qr(e.n,t.nBitLength),i={Fp:n,Fn:r,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function f8(t){const{CURVE:e,curveOpts:n}=d8(t),r={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,ecdsaOpts:r}}function p8(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function g8(t){const{CURVE:e,curveOpts:n,ecdsaOpts:r}=f8(t),i=l8(e,n),s=h8(i,r,n);return p8(t,s)}function wc(t,e){const n=r=>g8({...t,hash:r});return{...n(e),create:n}}const hp={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},dp={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},fp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},y8=qr(hp.p),w8=qr(dp.p),m8=qr(fp.p),b8=wc({...hp,Fp:y8,lowS:!1},zs);wc({...dp,Fp:w8,lowS:!1},D4),wc({...fp,Fp:m8,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},I4);const v8=b8,pp="base10",ct="base16",Wt="base64pad",Vn="base64url",ki="utf8",gp=0,bn=1,Ri=2,E8=0,yp=1,Ni=12,mc=32;function x8(){const t=yc.utils.randomPrivateKey(),e=yc.getPublicKey(t);return{privateKey:pt(t,ct),publicKey:pt(e,ct)}}function bc(){const t=zr(mc);return pt(t,ct)}function _8(t,e){const n=yc.getSharedSecret(Ct(t,ct),Ct(e,ct)),r=T_(Ks,n,void 0,void 0,mc);return pt(r,ct)}function to(t){const e=Ks(Ct(t,ct));return pt(e,ct)}function en(t){const e=Ks(Ct(t,ki));return pt(e,ct)}function wp(t){return Ct(`${t}`,pp)}function dr(t){return Number(pt(t,pp))}function mp(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function bp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function S8(t){const e=wp(typeof t.type<"u"?t.type:gp);if(dr(e)===bn&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?Ct(t.senderPublicKey,ct):void 0,r=typeof t.iv<"u"?Ct(t.iv,ct):zr(Ni),i=Ct(t.symKey,ct),s=zf(i,r).encrypt(Ct(t.message,ki)),o=vp({type:e,sealed:s,iv:r,senderPublicKey:n});return t.encoding===Vn?mp(o):o}function A8(t){const e=Ct(t.symKey,ct),{sealed:n,iv:r}=Ui({encoded:t.encoded,encoding:t.encoding}),i=zf(e,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return pt(i,ki)}function I8(t,e){const n=wp(Ri),r=zr(Ni),i=Ct(t,ki),s=vp({type:n,sealed:i,iv:r});return e===Vn?mp(s):s}function D8(t,e){const{sealed:n}=Ui({encoded:t,encoding:e});return pt(n,ki)}function vp(t){if(dr(t.type)===Ri)return pt(vi([t.type,t.sealed]),Wt);if(dr(t.type)===bn){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return pt(vi([t.type,t.senderPublicKey,t.iv,t.sealed]),Wt)}return pt(vi([t.type,t.iv,t.sealed]),Wt)}function Ui(t){const e=(t.encoding||Wt)===Vn?bp(t.encoded):t.encoded,n=Ct(e,Wt),r=n.slice(E8,yp),i=yp;if(dr(r)===bn){const c=i+mc,u=c+Ni,l=n.slice(i,c),h=n.slice(c,u),d=n.slice(u);return{type:r,sealed:d,iv:h,senderPublicKey:l}}if(dr(r)===Ri){const c=n.slice(i),u=zr(Ni);return{type:r,sealed:c,iv:u}}const s=i+Ni,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function O8(t,e){const n=Ui({encoded:t,encoding:e==null?void 0:e.encoding});return Ep({type:dr(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?pt(n.senderPublicKey,ct):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ep(t){const e=(t==null?void 0:t.type)||gp;if(e===bn){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function xp(t){return t.type===bn&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function _p(t){return t.type===Ri}function $8(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return vi([new Uint8Array([4]),e,n])}function C8(t,e){const[n,r,i]=t.split("."),s=Buffer.from(bp(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,u=Ks(c),l=$8(e);if(!v8.verify(vi([o,a]),u,l))throw new Error("Invalid signature");return na(t).payload}const P8="irn";function no(t){return(t==null?void 0:t.relay)||{protocol:P8}}function Fi(t){const e=g3[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function B8(t,e="-"){const n={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,""),o=t[i];n[s]=o}}),n}function Sp(t){if(!t.includes("wc:")){const u=rf(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:T8(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:B8(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function T8(t){return t.startsWith("//")?t.substring(2):t}function k8(t,e="-"){const n="relay",r={};return Object.keys(t).forEach(i=>{const s=i,o=n+e+s;t[s]&&(r[o]=t[s])}),r}function Ap(t){const e=new URLSearchParams,n=k8(t.relay);Object.keys(n).sort().forEach(i=>{e.set(i,n[i])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}function ro(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var R8=Object.defineProperty,N8=Object.defineProperties,U8=Object.getOwnPropertyDescriptors,Ip=Object.getOwnPropertySymbols,F8=Object.prototype.hasOwnProperty,L8=Object.prototype.propertyIsEnumerable,Dp=(t,e,n)=>e in t?R8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M8=(t,e)=>{for(var n in e||(e={}))F8.call(e,n)&&Dp(t,n,e[n]);if(Ip)for(var n of Ip(e))L8.call(e,n)&&Dp(t,n,e[n]);return t},z8=(t,e)=>N8(t,U8(e));function Kr(t){const e=[];return t.forEach(n=>{const[r,i]=n.split(":");e.push(`${r}:${i}`)}),e}function j8(t){const e=[];return Object.values(t).forEach(n=>{e.push(...Kr(n.accounts))}),e}function q8(t,e){const n=[];return Object.values(t).forEach(r=>{Kr(r.accounts).includes(e)&&n.push(...r.methods)}),n}function H8(t,e){const n=[];return Object.values(t).forEach(r=>{Kr(r.accounts).includes(e)&&n.push(...r.events)}),n}function Op(t){return t.includes(":")}function V8(t){return Op(t)?t.split(":")[0]:t}function $p(t){var e,n,r;const i={};if(!Li(t))return i;for(const[s,o]of Object.entries(t)){const a=Op(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=V8(s);i[l]=z8(M8({},i[l]),{chains:ar(a,(e=i[l])==null?void 0:e.chains),methods:ar(c,(n=i[l])==null?void 0:n.methods),events:ar(u,(r=i[l])==null?void 0:r.events)})}return i}function K8(t){const e={};return t==null||t.forEach(n=>{var r;const[i,s]=n.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(n),(r=e[i].chains)==null||r.push(`${i}:${s}`)}),e}function Cp(t,e){e=e.map(r=>r.replace("did:pkh:",""));const n=K8(e);for(const[r,i]of Object.entries(n))i.methods?i.methods=ar(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return n}function W8(t,e){var n,r,i,s,o,a;const c=$p(t),u=$p(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const d of h)l[d]={chains:ar((n=c[d])==null?void 0:n.chains,(r=u[d])==null?void 0:r.chains),methods:ar((i=c[d])==null?void 0:i.methods,(s=u[d])==null?void 0:s.methods),events:ar((o=c[d])==null?void 0:o.events,(a=u[d])==null?void 0:a.events)};return l}const G8={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Y8={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function te(t,e){const{message:n,code:r}=Y8[t];return{message:e?`${n} ${e}`:n,code:r}}function Be(t,e){const{message:n,code:r}=G8[t];return{message:e?`${n} ${e}`:n,code:r}}function Wr(t,e){return!!Array.isArray(t)}function Li(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ze(t){return typeof t>"u"}function ke(t,e){return e&&Ze(t)?!0:typeof t=="string"&&!!t.trim().length}function vc(t,e){return e&&Ze(t)?!0:typeof t=="number"&&!isNaN(t)}function Q8(t,e){const{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),i=Object.keys(n);let s=!0;return sr(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=Kr(a),h=n[o];(!sr(Kd(o,h),l)||!sr(h.methods,c)||!sr(h.events,u))&&(s=!1)}),s):!1}function io(t){return ke(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Z8(t){if(ke(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const n=e[0]+":"+e[1];return!!e[2]&&io(n)}}return!1}function J8(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(ke(t,!1)){if(e(t))return!0;const n=rf(t);return e(n)}}catch{}return!1}function X8(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function e6(t){return t==null?void 0:t.topic}function t6(t,e){let n=null;return ke(t==null?void 0:t.publicKey,!1)||(n=te("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function Pp(t){let e=!0;return Wr(t)?t.length&&(e=t.every(n=>ke(n,!1))):e=!1,e}function n6(t,e,n){let r=null;return Wr(e)&&e.length?e.forEach(i=>{r||io(i)||(r=Be("UNSUPPORTED_CHAINS",`${n}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):io(t)||(r=Be("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function r6(t,e,n){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const o=n6(i,Kd(i,s),`${e} ${n}`);o&&(r=o)}),r}function i6(t,e){let n=null;return Wr(t)?t.forEach(r=>{n||Z8(r)||(n=Be("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=Be("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function s6(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=i6(r==null?void 0:r.accounts,`${e} namespace`);i&&(n=i)}),n}function o6(t,e){let n=null;return Pp(t==null?void 0:t.methods)?Pp(t==null?void 0:t.events)||(n=Be("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=Be("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function Bp(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=o6(r,`${e}, namespace`);i&&(n=i)}),n}function a6(t,e,n){let r=null;if(t&&Li(t)){const i=Bp(t,e);i&&(r=i);const s=r6(t,e,n);s&&(r=s)}else r=te("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function Ec(t,e){let n=null;if(t&&Li(t)){const r=Bp(t,e);r&&(n=r);const i=s6(t,e);i&&(n=i)}else n=te("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function Tp(t){return ke(t.protocol,!0)}function c6(t,e){let n=!1;return t?t&&Wr(t)&&t.length&&t.forEach(r=>{n=Tp(r)}):n=!0,n}function u6(t){return typeof t=="number"}function mt(t){return typeof t<"u"&&typeof t!==null}function l6(t){return!(!t||typeof t!="object"||!t.code||!vc(t.code,!1)||!t.message||!ke(t.message,!1))}function h6(t){return!(Ze(t)||!ke(t.method,!1))}function d6(t){return!(Ze(t)||Ze(t.result)&&Ze(t.error)||!vc(t.id,!1)||!ke(t.jsonrpc,!1))}function f6(t){return!(Ze(t)||!ke(t.name,!1))}function kp(t,e){return!(!io(e)||!j8(t).includes(e))}function p6(t,e,n){return ke(n,!1)?q8(t,e).includes(n):!1}function g6(t,e,n){return ke(n,!1)?H8(t,e).includes(n):!1}function Rp(t,e,n){let r=null;const i=y6(t),s=w6(e),o=Object.keys(i),a=Object.keys(s),c=Np(Object.keys(t)),u=Np(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(r=te("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),sr(o,a)||(r=te("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const d=Kr(e[h].accounts);d.includes(h)||(r=te("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(sr(i[h].methods,s[h].methods)?sr(i[h].events,s[h].events)||(r=te("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${h}`)):r=te("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function y6(t){const e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:(r=t[n].chains)==null||r.forEach(i=>{e[i]={methods:t[n].methods,events:t[n].events}})}),e}function Np(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function w6(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const r=Kr(t[n].accounts);r==null||r.forEach(i=>{e[i]={accounts:t[n].accounts.filter(s=>s.includes(`${i}:`)),methods:t[n].methods,events:t[n].events}})}}),e}function m6(t,e){return vc(t,!1)&&t<=e.max&&t>=e.min}function Up(){const t=xi();return new Promise(e=>{switch(t){case _t.browser:e(b6());break;case _t.reactNative:e(v6());break;case _t.node:e(E6());break;default:e(!0)}})}function b6(){return Lr()&&(navigator==null?void 0:navigator.onLine)}async function v6(){if(Pn()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function E6(){return!0}function x6(t){switch(xi()){case _t.browser:_6(t);break;case _t.reactNative:S6(t);break}}function _6(t){!Pn()&&Lr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function S6(t){Pn()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function A6(){var t;return Lr()&&ln.getDocument()?((t=ln.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const xc={};class Mi{static get(e){return xc[e]}static set(e,n){xc[e]=n}static delete(e){delete xc[e]}}function I6(t){const e=yi.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function D6({publicKey:t,signature:e,payload:n}){var r;const i=_c(n.method),s=128|parseInt(((r=n.version)==null?void 0:r.toString())||"4"),o=C6(n.address),a=n.era==="00"?new Uint8Array([0]):_c(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(n.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${$6(n.tip)}`),h=B6(l),d=new Uint8Array([0,...t,o,...e,...a,...u,...h,...i]),y=P6(d.length+1);return new Uint8Array([...y,s,...d])}function O6(t){const e=_c(t),n=b3.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function _c(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function $6(t){return t.startsWith("0x")?t.slice(2):t}function C6(t){const e=yi.decode(t)[0];return e===42?0:e===60?2:1}function P6(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function B6(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function T6(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=I6(t.transaction.address),r=D6({publicKey:n,signature:e,payload:t.transaction}),i=Buffer.from(r).toString("hex");return O6(i)}const k6="PARSE_ERROR",R6="INVALID_REQUEST",N6="METHOD_NOT_FOUND",U6="INVALID_PARAMS",Fp="INTERNAL_ERROR",Sc="SERVER_ERROR",F6=[-32700,-32600,-32601,-32602,-32603],zi={[k6]:{code:-32700,message:"Parse error"},[R6]:{code:-32600,message:"Invalid Request"},[N6]:{code:-32601,message:"Method not found"},[U6]:{code:-32602,message:"Invalid params"},[Fp]:{code:-32603,message:"Internal error"},[Sc]:{code:-32e3,message:"Server error"}},Lp=Sc;function L6(t){return F6.includes(t)}function Mp(t){return Object.keys(zi).includes(t)?zi[t]:zi[Lp]}function M6(t){const e=Object.values(zi).find(n=>n.code===t);return e||zi[Lp]}function z6(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var Ac={};/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var Ic=function(t,e){return Ic=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},Ic(t,e)};function j6(t,e){Ic(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Dc=function(){return Dc=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Dc.apply(this,arguments)};function q6(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function H6(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function V6(t,e){return function(n,r){e(n,r,t)}}function K6(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function W6(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(l){try{u(r.next(l))}catch(h){o(h)}}function c(l){try{u(r.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((r=r.apply(t,e||[])).next())})}function G6(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Y6(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function Q6(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Oc(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zp(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Z6(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(zp(arguments[e]));return t}function J6(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function ji(t){return this instanceof ji?(this.v=t,this):new ji(t)}function X6(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(d){r[d]&&(i[d]=function(y){return new Promise(function(f,g){s.push([d,y,f,g])>1||a(d,y)})})}function a(d,y){try{c(r[d](y))}catch(f){h(s[0][3],f)}}function c(d){d.value instanceof ji?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,y){d(y),s.shift(),s.length&&a(s[0][0],s[0][1])}}function eS(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:ji(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function tS(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Oc=="function"?Oc(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function nS(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function rS(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function iS(t){return t&&t.__esModule?t:{default:t}}function sS(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function oS(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const aS=Fu(Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Dc},__asyncDelegator:eS,__asyncGenerator:X6,__asyncValues:tS,__await:ji,__awaiter:W6,__classPrivateFieldGet:sS,__classPrivateFieldSet:oS,__createBinding:Y6,__decorate:H6,__exportStar:Q6,__extends:j6,__generator:G6,__importDefault:iS,__importStar:rS,__makeTemplateObject:nS,__metadata:K6,__param:V6,__read:zp,__rest:q6,__spread:Z6,__spreadArrays:J6,__values:Oc},Symbol.toStringTag,{value:"Module"})));var vn={},jp;function cS(){if(jp)return vn;jp=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.isBrowserCryptoAvailable=vn.getSubtleCrypto=vn.getBrowerCrypto=void 0;function t(){return(Ar==null?void 0:Ar.crypto)||(Ar==null?void 0:Ar.msCrypto)||{}}vn.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}vn.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return vn.isBrowserCryptoAvailable=n,vn}var En={},qp;function uS(){if(qp)return En;qp=1,Object.defineProperty(En,"__esModule",{value:!0}),En.isBrowser=En.isNode=En.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}En.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}En.isNode=e;function n(){return!t()&&!e()}return En.isBrowser=n,En}var Hp;function lS(){return Hp||(Hp=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=aS;e.__exportStar(cS(),t),e.__exportStar(uS(),t)}(Ac)),Ac}var hS=lS();function tn(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function fr(t=6){return BigInt(tn(t))}function pr(t,e,n){return{id:n||tn(),jsonrpc:"2.0",method:t,params:e}}function $c(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Cc(t,e,n){return{id:t,jsonrpc:"2.0",error:dS(e)}}function dS(t,e){return typeof t>"u"?Mp(Fp):(typeof t=="string"&&(t=Object.assign(Object.assign({},Mp(Sc)),{message:t})),L6(t.code)&&(t=M6(t.code)),t)}class fS{}class pS extends fS{constructor(){super()}}class gS extends pS{constructor(e){super()}}const yS="^wss?:";function wS(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function mS(t,e){const n=wS(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function Vp(t){return mS(t,yS)}function bS(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Kp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Pc(t){return Kp(t)&&"method"in t}function so(t){return Kp(t)&&(nn(t)||kt(t))}function nn(t){return"result"in t}function kt(t){return"error"in t}class vS extends gS{constructor(e){super(e),this.events=new jt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(pr(e.method,e.params||[],e.id||fr().toString()),n)}async requestStrict(e,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{kt(s)?i(s.error):r(s.result)});try{await this.connection.send(e,n)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),so(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const ES=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),xS=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Wp=t=>t.split("?")[0],Gp=10,_S=ES();let SS=class{constructor(e){if(this.url=e,this.events=new jt.EventEmitter,this.registering=!1,!Vp(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(er(e))}catch(n){this.onError(e.id,n)}}register(e=this.url){if(!Vp(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((n,r)=>{const i=hS.isReactNative()?void 0:{rejectUnauthorized:!bS(e)},s=new _S(e,[],i);xS()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(e){e.onmessage=n=>this.onPayload(n),e.onclose=n=>this.onClose(n),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?$r(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const r=this.parseError(n),i=r.message||r.toString(),s=Cc(e,i);this.events.emit("payload",s)}parseError(e,n=this.url){return z6(e,Wp(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Gp&&this.events.setMaxListeners(Gp)}emitError(e){const n=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Wp(this.url)}`));return this.events.emit("register_error",n),n}};const Yp="wc",Qp=2,Bc="core",rn=`${Yp}@2:${Bc}:`,AS={logger:"error"},IS={database:":memory:"},DS="crypto",Zp="client_ed25519_seed",OS=ee.ONE_DAY,$S="keychain",CS="0.3",PS="messages",BS="0.3",Jp=ee.SIX_HOURS,TS="publisher",Xp="irn",kS="error",eg="wss://relay.walletconnect.org",RS="relayer",He={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},NS="_subscription",Rt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},US=.1,Tc="2.21.3",$e={link_mode:"link_mode",relay:"relay"},oo={inbound:"inbound",outbound:"outbound"},FS="0.3",LS="WALLETCONNECT_CLIENT_ID",tg="WALLETCONNECT_LINK_MODE_APPS",St={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},MS="subscription",zS="0.3",jS="pairing",qS="0.3",qi={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},gr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Gt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},HS="history",VS="0.3",KS="expirer",Nt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},WS="0.3",GS="verify-api",YS="https://verify.walletconnect.com",ng="https://verify.walletconnect.org",Hi=ng,QS=`${Hi}/v3`,ZS=[YS,ng],JS="echo",XS="https://echo.walletconnect.com",sn={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},xn={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Yt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},yr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},wr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Vi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},e5=.1,t5="event-client",n5=86400,r5="https://pulse.walletconnect.org/batch";function i5(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,I=0,$=0,R=f.length;$!==R&&f[$]===0;)$++,g++;for(var D=(R-$)*l+1>>>0,_=new Uint8Array(D);$!==R;){for(var A=f[$],S=0,F=D-1;(A!==0||S<I)&&F!==-1;F--,S++)A+=256*_[F]>>>0,_[F]=A%a>>>0,A=A/a>>>0;if(A!==0)throw new Error("Non-zero carry");I=S,$++}for(var j=D-I;j!==D&&_[j]===0;)j++;for(var O=c.repeat(g);j<D;++j)O+=t.charAt(_[j]);return O}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var I=0,$=0;f[g]===c;)I++,g++;for(var R=(f.length-g)*u+1>>>0,D=new Uint8Array(R);f[g];){var _=n[f.charCodeAt(g)];if(_===255)return;for(var A=0,S=R-1;(_!==0||A<$)&&S!==-1;S--,A++)_+=a*D[S]>>>0,D[S]=_%256>>>0,_=_/256>>>0;if(_!==0)throw new Error("Non-zero carry");$=A,g++}if(f[g]!==" "){for(var F=R-$;F!==R&&D[F]===0;)F++;for(var j=new Uint8Array(I+(R-F)),O=I;F!==R;)j[O++]=D[F++];return j}}}function y(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var s5=i5,o5=s5;const rg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},a5=t=>new TextEncoder().encode(t),c5=t=>new TextDecoder().decode(t);class u5{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class l5{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ig(this,e)}}class h5{constructor(e){this.decoders=e}or(e){return ig(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ig=(t,e)=>new h5({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class d5{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new u5(e,n,r),this.decoder=new l5(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ao=({name:t,prefix:e,encode:n,decode:r})=>new d5(t,e,n,r),Ki=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=o5(n,e);return ao({prefix:t,name:e,encode:r,decode:s=>rg(i(s))})},f5=(t,e,n,r)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},p5=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Je=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>ao({prefix:e,name:t,encode(i){return p5(i,r,n)},decode(i){return f5(i,r,n,t)}}),g5=ao({prefix:"\0",name:"identity",encode:t=>c5(t),decode:t=>a5(t)});var y5=Object.freeze({__proto__:null,identity:g5});const w5=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var m5=Object.freeze({__proto__:null,base2:w5});const b5=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var v5=Object.freeze({__proto__:null,base8:b5});const E5=Ki({prefix:"9",name:"base10",alphabet:"0123456789"});var x5=Object.freeze({__proto__:null,base10:E5});const _5=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),S5=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var A5=Object.freeze({__proto__:null,base16:_5,base16upper:S5});const I5=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),D5=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),O5=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$5=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),C5=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),P5=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),B5=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),T5=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),k5=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var R5=Object.freeze({__proto__:null,base32:I5,base32upper:D5,base32pad:O5,base32padupper:$5,base32hex:C5,base32hexupper:P5,base32hexpad:B5,base32hexpadupper:T5,base32z:k5});const N5=Ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),U5=Ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var F5=Object.freeze({__proto__:null,base36:N5,base36upper:U5});const L5=Ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M5=Ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var z5=Object.freeze({__proto__:null,base58btc:L5,base58flickr:M5});const j5=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),q5=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),H5=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),V5=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var K5=Object.freeze({__proto__:null,base64:j5,base64pad:q5,base64url:H5,base64urlpad:V5});const sg=Array.from(""),W5=sg.reduce((t,e,n)=>(t[n]=e,t),[]),G5=sg.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function Y5(t){return t.reduce((e,n)=>(e+=W5[n],e),"")}function Q5(t){const e=[];for(const n of t){const r=G5[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const Z5=ao({prefix:"",name:"base256emoji",encode:Y5,decode:Q5});var J5=Object.freeze({__proto__:null,base256emoji:Z5}),X5=ag,og=128,eA=-128,tA=Math.pow(2,31);function ag(t,e,n){e=e||[],n=n||0;for(var r=n;t>=tA;)e[n++]=t&255|og,t/=128;for(;t&eA;)e[n++]=t&255|og,t>>>=7;return e[n]=t|0,ag.bytes=n-r+1,e}var nA=kc,rA=128,cg=127;function kc(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw kc.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&cg)<<i:(o&cg)*Math.pow(2,i),i+=7}while(o>=rA);return kc.bytes=s-r,n}var iA=Math.pow(2,7),sA=Math.pow(2,14),oA=Math.pow(2,21),aA=Math.pow(2,28),cA=Math.pow(2,35),uA=Math.pow(2,42),lA=Math.pow(2,49),hA=Math.pow(2,56),dA=Math.pow(2,63),fA=function(t){return t<iA?1:t<sA?2:t<oA?3:t<aA?4:t<cA?5:t<uA?6:t<lA?7:t<hA?8:t<dA?9:10},pA={encode:X5,decode:nA,encodingLength:fA},ug=pA;const lg=(t,e,n=0)=>(ug.encode(t,e,n),e),hg=t=>ug.encodingLength(t),Rc=(t,e)=>{const n=e.byteLength,r=hg(t),i=r+hg(n),s=new Uint8Array(i+n);return lg(t,s,0),lg(n,s,r),s.set(e,i),new gA(t,n,e,s)};class gA{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const dg=({name:t,code:e,encode:n})=>new yA(t,e,n);class yA{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Rc(this.code,n):n.then(r=>Rc(this.code,r))}else throw Error("Unknown type, must be binary type")}}const fg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),wA=dg({name:"sha2-256",code:18,encode:fg("SHA-256")}),mA=dg({name:"sha2-512",code:19,encode:fg("SHA-512")});var bA=Object.freeze({__proto__:null,sha256:wA,sha512:mA});const pg=0,vA="identity",gg=rg;var EA=Object.freeze({__proto__:null,identity:{code:pg,name:vA,encode:gg,digest:t=>Rc(pg,gg(t))}});new TextEncoder,new TextDecoder;const yg={...y5,...m5,...v5,...x5,...A5,...R5,...F5,...z5,...K5,...J5};({...bA,...EA});function wg(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function xA(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?wg(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function mg(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const bg=mg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Nc=mg("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=xA(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),_A={utf8:bg,"utf-8":bg,hex:yg.base16,latin1:Nc,ascii:Nc,binary:Nc,...yg};function SA(t,e="utf8"){const n=_A[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wg(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var AA=Object.defineProperty,IA=(t,e,n)=>e in t?AA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,on=(t,e,n)=>IA(t,typeof e!="symbol"?e+"":e,n);class DA{constructor(e,n){this.core=e,this.logger=n,on(this,"keychain",new Map),on(this,"name",$S),on(this,"version",CS),on(this,"initialized",!1),on(this,"storagePrefix",rn),on(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),on(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),on(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),on(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:s}=te("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),on(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=st(n,this.name)}get context(){return lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,za(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ja(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var OA=Object.defineProperty,$A=(t,e,n)=>e in t?OA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xe=(t,e,n)=>$A(t,typeof e!="symbol"?e+"":e,n);class CA{constructor(e,n,r){this.core=e,this.logger=n,Xe(this,"name",DS),Xe(this,"keychain"),Xe(this,"randomSessionIdentifier",bc()),Xe(this,"initialized",!1),Xe(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Xe(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),Xe(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=Sh(i);return _h(s.publicKey)}),Xe(this,"generateKeyPair",()=>{this.isInitialized();const i=x8();return this.setPrivateKey(i.publicKey,i.privateKey)}),Xe(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=Sh(s),a=this.randomSessionIdentifier;return await F2(a,i,OS,o)}),Xe(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=_8(a,s);return this.setSymKey(c,o)}),Xe(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||to(i);return await this.keychain.set(o,i),o}),Xe(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),Xe(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),Xe(this,"encode",async(i,s,o)=>{this.isInitialized();const a=Ep(o),c=er(s);if(_p(a))return I8(c,o==null?void 0:o.encoding);if(xp(a)){const d=a.senderPublicKey,y=a.receiverPublicKey;i=await this.generateSharedKey(d,y)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return S8({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Xe(this,"decode",async(i,s,o)=>{this.isInitialized();const a=O8(s,o);if(_p(a)){const c=D8(s,o==null?void 0:o.encoding);return $r(c)}if(xp(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=A8({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return $r(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Xe(this,"getPayloadType",(i,s=Wt)=>{const o=Ui({encoded:i,encoding:s});return dr(o.type)}),Xe(this,"getPayloadSenderPublicKey",(i,s=Wt)=>{const o=Ui({encoded:i,encoding:s});return o.senderPublicKey?pt(o.senderPublicKey,ct):void 0}),this.core=e,this.logger=st(n,this.name),this.keychain=r||new DA(this.core,this.logger)}get context(){return lt(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Zp)}catch{e=bc(),await this.keychain.set(Zp,e)}return SA(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var PA=Object.defineProperty,BA=Object.defineProperties,TA=Object.getOwnPropertyDescriptors,vg=Object.getOwnPropertySymbols,kA=Object.prototype.hasOwnProperty,RA=Object.prototype.propertyIsEnumerable,Uc=(t,e,n)=>e in t?PA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,NA=(t,e)=>{for(var n in e||(e={}))kA.call(e,n)&&Uc(t,n,e[n]);if(vg)for(var n of vg(e))RA.call(e,n)&&Uc(t,n,e[n]);return t},UA=(t,e)=>BA(t,TA(e)),At=(t,e,n)=>Uc(t,typeof e!="symbol"?e+"":e,n);class FA extends F1{constructor(e,n){super(e,n),this.logger=e,this.core=n,At(this,"messages",new Map),At(this,"messagesWithoutClientAck",new Map),At(this,"name",PS),At(this,"version",BS),At(this,"initialized",!1),At(this,"storagePrefix",rn),At(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),At(this,"set",async(r,i,s)=>{this.isInitialized();const o=en(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===oo.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,UA(NA({},c),{[o]:i}))}return await this.persist(),o}),At(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),At(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),At(this,"has",(r,i)=>{this.isInitialized();const s=this.get(r),o=en(i);return typeof s[o]<"u"}),At(this,"ack",async(r,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=en(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),At(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=st(e,this.name),this.core=n}get context(){return lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,za(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,za(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ja(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ja(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var LA=Object.defineProperty,MA=Object.defineProperties,zA=Object.getOwnPropertyDescriptors,Eg=Object.getOwnPropertySymbols,jA=Object.prototype.hasOwnProperty,qA=Object.prototype.propertyIsEnumerable,Fc=(t,e,n)=>e in t?LA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,co=(t,e)=>{for(var n in e||(e={}))jA.call(e,n)&&Fc(t,n,e[n]);if(Eg)for(var n of Eg(e))qA.call(e,n)&&Fc(t,n,e[n]);return t},Lc=(t,e)=>MA(t,zA(e)),Qt=(t,e,n)=>Fc(t,typeof e!="symbol"?e+"":e,n);class HA extends L1{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Qt(this,"events",new jt.EventEmitter),Qt(this,"name",TS),Qt(this,"queue",new Map),Qt(this,"publishTimeout",ee.toMiliseconds(ee.ONE_MINUTE)),Qt(this,"initialPublishTimeout",ee.toMiliseconds(ee.ONE_SECOND*15)),Qt(this,"needsTransportRestart",!1),Qt(this,"publish",async(r,i,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});const a=(s==null?void 0:s.ttl)||Jp,c=no(s),u=(s==null?void 0:s.prompt)||!1,l=(s==null?void 0:s.tag)||0,h=(s==null?void 0:s.id)||fr().toString(),d={topic:r,message:i,opts:{ttl:a,relay:c,prompt:u,tag:l,id:h,attestation:s==null?void 0:s.attestation,tvf:s==null?void 0:s.tvf}},y=`Failed to publish payload, please try again. id:${h} tag:${l}`;try{const f=new Promise(async g=>{const I=({id:R})=>{d.opts.id===R&&(this.removeRequestFromQueue(R),this.relayer.events.removeListener(He.publish,I),g(d))};this.relayer.events.on(He.publish,I);const $=Bn(new Promise((R,D)=>{this.rpcPublish({topic:r,message:i,ttl:a,prompt:u,tag:l,id:h,attestation:s==null?void 0:s.attestation,tvf:s==null?void 0:s.tvf}).then(R).catch(_=>{this.logger.warn(_,_==null?void 0:_.message),D(_)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${l}`);try{await $,this.events.removeListener(He.publish,I)}catch(R){this.queue.set(h,Lc(co({},d),{attempt:1})),this.logger.warn(R,R==null?void 0:R.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:r,message:i,opts:s}}),await Bn(f,this.publishTimeout,y)}catch(f){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(f),(o=s==null?void 0:s.internal)!=null&&o.throwOnFailedPublish)throw f}finally{this.queue.delete(h)}}),Qt(this,"on",(r,i)=>{this.events.on(r,i)}),Qt(this,"once",(r,i)=>{this.events.once(r,i)}),Qt(this,"off",(r,i)=>{this.events.off(r,i)}),Qt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=st(n,this.name),this.registerEventListeners()}get context(){return lt(this.logger)}async rpcPublish(e){var n,r,i,s;const{topic:o,message:a,ttl:c=Jp,prompt:u,tag:l,id:h,attestation:d,tvf:y}=e,f={method:Fi(no().protocol).publish,params:co({topic:o,message:a,ttl:c,prompt:u,tag:l,attestation:d},y),id:h};Ze((n=f.params)==null?void 0:n.prompt)&&((r=f.params)==null||delete r.prompt),Ze((i=f.params)==null?void 0:i.tag)&&((s=f.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:f});const g=await this.relayer.request(f);return this.relayer.events.emit(He.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{const r=e.attempt+1;this.queue.set(n,Lc(co({},e),{attempt:r}));const{topic:i,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${r}`),await this.rpcPublish(Lc(co({},e),{topic:i,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Jn.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(He.connection_stalled);return}this.checkQueue()}),this.relayer.on(He.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var VA=Object.defineProperty,KA=(t,e,n)=>e in t?VA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Gr=(t,e,n)=>KA(t,typeof e!="symbol"?e+"":e,n);class WA{constructor(){Gr(this,"map",new Map),Gr(this,"set",(e,n)=>{const r=this.get(e);this.exists(e,n)||this.map.set(e,[...r,n])}),Gr(this,"get",e=>this.map.get(e)||[]),Gr(this,"exists",(e,n)=>this.get(e).includes(n)),Gr(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,n))return;const i=r.filter(s=>s!==n);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Gr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var GA=Object.defineProperty,YA=Object.defineProperties,QA=Object.getOwnPropertyDescriptors,xg=Object.getOwnPropertySymbols,ZA=Object.prototype.hasOwnProperty,JA=Object.prototype.propertyIsEnumerable,Mc=(t,e,n)=>e in t?GA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wi=(t,e)=>{for(var n in e||(e={}))ZA.call(e,n)&&Mc(t,n,e[n]);if(xg)for(var n of xg(e))JA.call(e,n)&&Mc(t,n,e[n]);return t},zc=(t,e)=>YA(t,QA(e)),Ie=(t,e,n)=>Mc(t,typeof e!="symbol"?e+"":e,n);class XA extends j1{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Ie(this,"subscriptions",new Map),Ie(this,"topicMap",new WA),Ie(this,"events",new jt.EventEmitter),Ie(this,"name",MS),Ie(this,"version",zS),Ie(this,"pending",new Map),Ie(this,"cached",[]),Ie(this,"initialized",!1),Ie(this,"storagePrefix",rn),Ie(this,"subscribeTimeout",ee.toMiliseconds(ee.ONE_MINUTE)),Ie(this,"initialSubscribeTimeout",ee.toMiliseconds(ee.ONE_SECOND*15)),Ie(this,"clientId"),Ie(this,"batchSubscribeTopicsLimit",500),Ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ie(this,"subscribe",async(r,i)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const s=no(i),o={topic:r,relay:s,transportType:i==null?void 0:i.transportType};this.pending.set(r,o);const a=await this.rpcSubscribe(r,s,i);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),Ie(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),Ie(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),Ie(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),Ie(this,"on",(r,i)=>{this.events.on(r,i)}),Ie(this,"once",(r,i)=>{this.events.once(r,i)}),Ie(this,"off",(r,i)=>{this.events.off(r,i)}),Ie(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),Ie(this,"start",async()=>{await this.onConnect()}),Ie(this,"stop",async()=>{await this.onDisconnect()}),Ie(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ie(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),Ie(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Jn.pulse,async()=>{await this.checkPending()}),this.events.on(St.created,async r=>{const i=St.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(St.deleted,async r=>{const i=St.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=st(n,this.name),this.clientId=""}get context(){return lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let r=!1;try{r=this.getSubscription(e).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,n)))}async unsubscribeById(e,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}});try{const i=no(r);await this.restartToComplete({topic:e,id:n,relay:i}),await this.rpcUnsubscribe(e,n,i);const s=Be("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,n,r){var i;(!r||(r==null?void 0:r.transportType)===$e.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});const s={method:Fi(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((r==null?void 0:r.transportType)===$e.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(l=>this.logger.warn(l))},ee.toMiliseconds(ee.ONE_SECOND)),a;const c=new Promise(async l=>{const h=d=>{d.topic===e&&(this.events.removeListener(St.created,h),l(d.id))};this.events.on(St.created,h);try{const d=await Bn(new Promise((y,f)=>{this.relayer.request(s).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),f(g)}).then(y)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(St.created,h),l(d)}catch{}}),u=await Bn(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return u?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(He.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const n=e[0].relay,r={method:Fi(n.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await Bn(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(He.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const n=e[0].relay,r={method:Fi(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await Bn(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(He.connection_stalled)}return i}rpcUnsubscribe(e,n,r){const i={method:Fi(r.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,n){this.setSubscription(e,zc(Wi({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Wi({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Wi({},n)),this.topicMap.set(n.topic,e),this.events.emit(St.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const n=this.subscriptions.get(e);if(!n){const{message:r}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(St.deleted,zc(Wi({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(St.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(St.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>zc(Wi({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await V3(ee.toMiliseconds(ee.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return en(e+await this.getClientId())}}var eI=Object.defineProperty,_g=Object.getOwnPropertySymbols,tI=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,jc=(t,e,n)=>e in t?eI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sg=(t,e)=>{for(var n in e||(e={}))tI.call(e,n)&&jc(t,n,e[n]);if(_g)for(var n of _g(e))nI.call(e,n)&&jc(t,n,e[n]);return t},xe=(t,e,n)=>jc(t,typeof e!="symbol"?e+"":e,n);class rI extends M1{constructor(e){super(e),xe(this,"protocol","wc"),xe(this,"version",2),xe(this,"core"),xe(this,"logger"),xe(this,"events",new jt.EventEmitter),xe(this,"provider"),xe(this,"messages"),xe(this,"subscriber"),xe(this,"publisher"),xe(this,"name",RS),xe(this,"transportExplicitlyClosed",!1),xe(this,"initialized",!1),xe(this,"connectionAttemptInProgress",!1),xe(this,"relayUrl"),xe(this,"projectId"),xe(this,"packageName"),xe(this,"bundleId"),xe(this,"hasExperiencedNetworkDisruption",!1),xe(this,"pingTimeout"),xe(this,"heartBeatTimeout",ee.toMiliseconds(ee.THIRTY_SECONDS+ee.FIVE_SECONDS)),xe(this,"reconnectTimeout"),xe(this,"connectPromise"),xe(this,"reconnectInProgress",!1),xe(this,"requestsInFlight",[]),xe(this,"connectTimeout",ee.toMiliseconds(ee.ONE_SECOND*15)),xe(this,"request",async n=>{var r,i;this.logger.debug("Publishing Request Payload");const s=n.id||fr().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:n.method,topic:(r=n.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${s}:${((i=n.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),xe(this,"resetPingTimeout",()=>{Fs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,r,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(r=(n=this.provider)==null?void 0:n.connection)==null?void 0:r.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),xe(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),xe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(He.connect)}),xe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),xe(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(He.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),xe(this,"registerProviderListeners",()=>{this.provider.on(Rt.payload,this.onPayloadHandler),this.provider.on(Rt.connect,this.onConnectHandler),this.provider.on(Rt.disconnect,this.onDisconnectHandler),this.provider.on(Rt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?st(e.logger,this.name):hs(Ro({level:e.logger||kS})),this.messages=new FA(this.logger,e.core),this.subscriber=new XA(this,this.logger),this.publisher=new HA(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||eg,this.projectId=e.projectId,$3()?this.packageName=Qd():C3()&&(this.bundleId=Qd()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return lt(this.logger)}get connected(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,r){this.isInitialized(),await this.publisher.publish(e,n,r),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:$e.relay},oo.outbound)}async subscribe(e,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||(n==null?void 0:n.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((r=n==null?void 0:n.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(St.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(St.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,Sg({internal:{throwOnFailedPublish:o}},n)).catch(d=>{o&&h(d)})||a,l()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Bn(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(e).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Up())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){const{topic:r}=e;if(!n.sessionExists){const i=Fe(ee.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(He.message,e),await this.recordMessageEvent(e,oo.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(Rt.disconnect,s),await Bn(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(Rt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Rt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Rt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,ee.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,r,i,s;if(Fs())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new vS(new SS(R3({sdkVersion:Tc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){const{topic:r,message:i}=e;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(e){const{topic:n,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Pc(e)){if(!e.method.endsWith(NS))return;const n=e.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:$e.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Sg({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else so(e)&&this.events.emit(He.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,oo.inbound),this.events.emit(He.message,e))}async acknowledgePayload(e){const n=$c(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(Rt.payload,this.onPayloadHandler),this.provider.off(Rt.connect,this.onConnectHandler),this.provider.off(Rt.disconnect,this.onDisconnectHandler),this.provider.off(Rt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Up();x6(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r==null?void 0:r.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Jn.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&A6())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n==null?void 0:n.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(He.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},ee.toMiliseconds(US)))))}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function iI(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Ag(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ig(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const sI="[object RegExp]",oI="[object String]",aI="[object Number]",cI="[object Boolean]",Dg="[object Arguments]",uI="[object Symbol]",lI="[object Date]",hI="[object Map]",dI="[object Set]",fI="[object Array]",pI="[object Function]",gI="[object ArrayBuffer]",qc="[object Object]",yI="[object Error]",wI="[object DataView]",mI="[object Uint8Array]",bI="[object Uint8ClampedArray]",vI="[object Uint16Array]",EI="[object Uint32Array]",xI="[object BigUint64Array]",_I="[object Int8Array]",SI="[object Int16Array]",AI="[object Int32Array]",II="[object BigInt64Array]",DI="[object Float32Array]",OI="[object Float64Array]";function $I(){}function Og(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function CI(t,e,n){return Gi(t,e,void 0,void 0,void 0,void 0,n)}function Gi(t,e,n,r,i,s,o){const a=o(t,e,n,r,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Yi(t,e,s,o)}return Yi(t,e,s,o)}function Yi(t,e,n,r){if(Object.is(t,e))return!0;let i=Ig(t),s=Ig(e);if(i===Dg&&(i=qc),s===Dg&&(s=qc),i!==s)return!1;switch(i){case oI:return t.toString()===e.toString();case aI:{const c=t.valueOf(),u=e.valueOf();return iI(c,u)}case cI:case lI:case uI:return Object.is(t.valueOf(),e.valueOf());case sI:return t.source===e.source&&t.flags===e.flags;case pI:return t===e}n=n??new Map;const o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(i){case hI:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Gi(u,e.get(c),c,t,e,n,r))return!1;return!0}case dI:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],d=u.findIndex(y=>Gi(h,y,void 0,t,e,n,r));if(d===-1)return!1;u.splice(d,1)}return!0}case fI:case mI:case bI:case vI:case EI:case xI:case _I:case SI:case AI:case II:case DI:case OI:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Gi(t[c],e[c],c,t,e,n,r))return!1;return!0}case gI:return t.byteLength!==e.byteLength?!1:Yi(new Uint8Array(t),new Uint8Array(e),n,r);case wI:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Yi(new Uint8Array(t),new Uint8Array(e),n,r);case yI:return t.name===e.name&&t.message===e.message;case qc:{if(!(Yi(t.constructor,e.constructor,n,r)||Og(t)&&Og(e)))return!1;const c=[...Object.keys(t),...Ag(t)],u=[...Object.keys(e),...Ag(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],d=t[h];if(!Object.hasOwn(e,h))return!1;const y=e[h];if(!Gi(d,y,h,t,e,n,r))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function PI(t,e){return CI(t,e,$I)}var BI=Object.defineProperty,$g=Object.getOwnPropertySymbols,TI=Object.prototype.hasOwnProperty,kI=Object.prototype.propertyIsEnumerable,Hc=(t,e,n)=>e in t?BI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Cg=(t,e)=>{for(var n in e||(e={}))TI.call(e,n)&&Hc(t,n,e[n]);if($g)for(var n of $g(e))kI.call(e,n)&&Hc(t,n,e[n]);return t},bt=(t,e,n)=>Hc(t,typeof e!="symbol"?e+"":e,n);class mr extends z1{constructor(e,n,r,i=rn,s=void 0){super(e,n,r,i),this.core=e,this.logger=n,this.name=r,bt(this,"map",new Map),bt(this,"version",FS),bt(this,"cached",[]),bt(this,"initialized",!1),bt(this,"getKey"),bt(this,"storagePrefix",rn),bt(this,"recentlyDeleted",[]),bt(this,"recentlyDeletedLimit",200),bt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ze(o)?this.map.set(this.getKey(o),o):X8(o)?this.map.set(o.id,o):e6(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),bt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),bt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),bt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>PI(a[c],o[c]))):this.values)),bt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Cg(Cg({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),bt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=st(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){const{message:i}=te("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var RI=Object.defineProperty,NI=(t,e,n)=>e in t?RI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,we=(t,e,n)=>NI(t,typeof e!="symbol"?e+"":e,n);class UI{constructor(e,n){this.core=e,this.logger=n,we(this,"name",jS),we(this,"version",qS),we(this,"events",new il),we(this,"pairings"),we(this,"initialized",!1),we(this,"storagePrefix",rn),we(this,"ignoredPayloadTypes",[bn]),we(this,"registeredMethods",[]),we(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),we(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),we(this,"create",async r=>{this.isInitialized();const i=bc(),s=await this.core.crypto.setSymKey(i),o=Fe(ee.FIVE_MINUTES),a={protocol:Xp},c={topic:s,expiry:o,relay:a,active:!1,methods:r==null?void 0:r.methods},u=Ap({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r==null?void 0:r.methods});return this.events.emit(gr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r==null?void 0:r.transportType}),{topic:s,uri:u}}),we(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r==null?void 0:r.uri,trace:[sn.pairing_started]}});this.isValidPair(r,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Sp(r.uri);i.props.properties.topic=s,i.addTrace(sn.pairing_uri_validation_success),i.addTrace(sn.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(sn.existing_pairing),l.active)throw i.setError(xn.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(sn.pairing_not_expired)}const h=c||Fe(ee.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,d),i.addTrace(sn.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(gr.create,d),i.addTrace(sn.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(sn.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(xn.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(y){throw i.setError(xn.subscribe_pairing_topic_failure),y}return i.addTrace(sn.subscribe_pairing_topic_success),d}),we(this,"activate",async({topic:r})=>{this.isInitialized();const i=Fe(ee.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),we(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=or();this.events.once(_e("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),we(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),we(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),we(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),we(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Be("USER_DISCONNECTED")),await this.deletePairing(i))}),we(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return Ap({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),we(this,"sendRequest",async(r,i,s)=>{const o=pr(i,s),a=await this.core.crypto.encode(r,o),c=qi[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),we(this,"sendResult",async(r,i,s)=>{const o=$c(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,u=qi[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),we(this,"sendError",async(r,i,s)=>{const o=Cc(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,u=qi[c]?qi[c].res:qi.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),we(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Be("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),we(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>Tn(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),we(this,"onRelayEventRequest",async r=>{const{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),we(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),we(this,"onPairingPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(gr.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),we(this,"onPairingPingResponse",(r,i)=>{const{id:s}=i;setTimeout(()=>{nn(i)?this.events.emit(_e("pairing_ping",s),{}):kt(i)&&this.events.emit(_e("pairing_ping",s),{error:i.error})},500)}),we(this,"onPairingDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(gr.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),we(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Be("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),we(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(Be("WC_METHOD_UNSUPPORTED",r))}),we(this,"isValidPair",(r,i)=>{var s;if(!mt(r)){const{message:a}=te("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(xn.malformed_pairing_uri),new Error(a)}if(!J8(r.uri)){const{message:a}=te("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(xn.malformed_pairing_uri),new Error(a)}const o=Sp(r==null?void 0:r.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=te("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(xn.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=te("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(xn.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&ee.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(xn.pairing_expired);const{message:a}=te("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),we(this,"isValidPing",async r=>{if(!mt(r)){const{message:s}=te("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),we(this,"isValidDisconnect",async r=>{if(!mt(r)){const{message:s}=te("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),we(this,"isValidPairingTopic",async r=>{if(!ke(r,!1)){const{message:i}=te("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=te("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Tn(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=te("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=st(n,this.name),this.pairings=new mr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return lt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(He.message,async e=>{const{topic:n,message:r,transportType:i}=e;if(this.pairings.keys.includes(n)&&i!==$e.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(n,r);Pc(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):so(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Nt.expired,async e=>{const{topic:n}=ef(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(gr.expire,{topic:n}))})}}var FI=Object.defineProperty,LI=(t,e,n)=>e in t?FI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,et=(t,e,n)=>LI(t,typeof e!="symbol"?e+"":e,n);class MI extends U1{constructor(e,n){super(e,n),this.core=e,this.logger=n,et(this,"records",new Map),et(this,"events",new jt.EventEmitter),et(this,"name",HS),et(this,"version",VS),et(this,"cached",[]),et(this,"initialized",!1),et(this,"storagePrefix",rn),et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),et(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:Fe(ee.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Gt.created,o)}),et(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=kt(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(Gt.updated,i))}),et(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),et(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(Gt.deleted,s)}}),this.persist()}),et(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),et(this,"on",(r,i)=>{this.events.on(r,i)}),et(this,"once",(r,i)=>{this.events.once(r,i)}),et(this,"off",(r,i)=>{this.events.off(r,i)}),et(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=st(n,this.name)}get context(){return lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const r={topic:n.topic,request:pr(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const n=this.records.get(e);if(!n){const{message:r}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Gt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Gt.created,e=>{const n=Gt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Gt.updated,e=>{const n=Gt.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Gt.deleted,e=>{const n=Gt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(Jn.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{ee.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(Gt.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zI=Object.defineProperty,jI=(t,e,n)=>e in t?zI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,it=(t,e,n)=>jI(t,typeof e!="symbol"?e+"":e,n);class qI extends q1{constructor(e,n){super(e,n),this.core=e,this.logger=n,it(this,"expirations",new Map),it(this,"events",new jt.EventEmitter),it(this,"name",KS),it(this,"version",WS),it(this,"cached",[]),it(this,"initialized",!1),it(this,"storagePrefix",rn),it(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),it(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),it(this,"set",(r,i)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Nt.created,{target:s,expiration:o})}),it(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),it(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Nt.deleted,{target:i,expiration:s})}}),it(this,"on",(r,i)=>{this.events.on(r,i)}),it(this,"once",(r,i)=>{this.events.once(r,i)}),it(this,"off",(r,i)=>{this.events.off(r,i)}),it(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=st(n,this.name)}get context(){return lt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return N3(e);if(typeof e=="number")return U3(e);const{message:n}=te("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Nt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const n=this.expirations.get(e);if(!n){const{message:r}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(e,n){const{expiry:r}=n;ee.toMiliseconds(r)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(Nt.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(Jn.pulse,()=>this.checkExpirations()),this.events.on(Nt.created,e=>{const n=Nt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Nt.expired,e=>{const n=Nt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Nt.deleted,e=>{const n=Nt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var HI=Object.defineProperty,VI=(t,e,n)=>e in t?HI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Re=(t,e,n)=>VI(t,typeof e!="symbol"?e+"":e,n);class KI extends H1{constructor(e,n,r){super(e,n,r),this.core=e,this.logger=n,this.store=r,Re(this,"name",GS),Re(this,"abortController"),Re(this,"isDevEnv"),Re(this,"verifyUrlV3",QS),Re(this,"storagePrefix",rn),Re(this,"version",Qp),Re(this,"publicKey"),Re(this,"fetchPromise"),Re(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&ee.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Re(this,"register",async i=>{if(!Lr()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=ln.getDocument(),l=this.startAbortTimer(ee.ONE_SECOND*5),h=await new Promise((d,y)=>{const f=()=>{window.removeEventListener("message",I),u.body.removeChild(g),y("attestation aborted")};this.abortController.signal.addEventListener("abort",f);const g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",f,{signal:this.abortController.signal});const I=$=>{if($.data&&typeof $.data=="string")try{const R=JSON.parse($.data);if(R.type==="verify_attestation"){if(na(R.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",f),window.removeEventListener("message",I),d(R.attestation===null?"":R.attestation)}}catch(R){this.logger.warn(R)}};u.body.appendChild(g),window.addEventListener("message",I,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),Re(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(na(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),Re(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(ee.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Re(this,"getVerifyUrl",i=>{let s=i||Hi;return ZS.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Hi}`),s=Hi),s}),Re(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(ee.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),Re(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),Re(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Re(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Re(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Re(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),Re(this,"validateAttestation",(i,s)=>{const o=C8(i,s.publicKey),a={hasExpired:ee.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=st(n,this.name),this.abortController=new AbortController,this.isDevEnv=qa(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return lt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ee.toMiliseconds(e))}}var WI=Object.defineProperty,GI=(t,e,n)=>e in t?WI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Pg=(t,e,n)=>GI(t,typeof e!="symbol"?e+"":e,n);class YI extends V1{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,Pg(this,"context",JS),Pg(this,"registerDeviceToken",async r=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${XS}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=st(n,this.context)}}var QI=Object.defineProperty,Bg=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,JI=Object.prototype.propertyIsEnumerable,Vc=(t,e,n)=>e in t?QI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qi=(t,e)=>{for(var n in e||(e={}))ZI.call(e,n)&&Vc(t,n,e[n]);if(Bg)for(var n of Bg(e))JI.call(e,n)&&Vc(t,n,e[n]);return t},Ve=(t,e,n)=>Vc(t,typeof e!="symbol"?e+"":e,n);class XI extends K1{constructor(e,n,r=!0){super(e,n,r),this.core=e,this.logger=n,Ve(this,"context",t5),Ve(this,"storagePrefix",rn),Ve(this,"storageVersion",e5),Ve(this,"events",new Map),Ve(this,"shouldPersist",!1),Ve(this,"init",async()=>{if(!qa())try{const i={eventId:nf(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Jd(this.core.relayer.protocol,this.core.relayer.version,Tc)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Ve(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=nf(),l=this.core.projectId||"",h=Date.now(),d=Qi({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),Ve(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Qi(Qi({},a),this.setMethods(a.eventId))}),Ve(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Ve(this,"setEventListeners",()=>{this.core.heartbeat.on(Jn.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{ee.fromMiliseconds(Date.now())-ee.fromMiliseconds(i.timestamp)>n5&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Ve(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Ve(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Ve(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Ve(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ve(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Qi(Qi({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Ve(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ve(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${r5}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Tc}${s}`,{method:"POST",body:JSON.stringify(i)})}),Ve(this,"getAppDomain",()=>Zd().url),this.logger=st(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var eD=Object.defineProperty,Tg=Object.getOwnPropertySymbols,tD=Object.prototype.hasOwnProperty,nD=Object.prototype.propertyIsEnumerable,Kc=(t,e,n)=>e in t?eD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kg=(t,e)=>{for(var n in e||(e={}))tD.call(e,n)&&Kc(t,n,e[n]);if(Tg)for(var n of Tg(e))nD.call(e,n)&&Kc(t,n,e[n]);return t},Oe=(t,e,n)=>Kc(t,typeof e!="symbol"?e+"":e,n);class Wc extends T1{constructor(e){var n;super(e),Oe(this,"protocol",Yp),Oe(this,"version",Qp),Oe(this,"name",Bc),Oe(this,"relayUrl"),Oe(this,"projectId"),Oe(this,"customStoragePrefix"),Oe(this,"events",new jt.EventEmitter),Oe(this,"logger"),Oe(this,"heartbeat"),Oe(this,"relayer"),Oe(this,"crypto"),Oe(this,"storage"),Oe(this,"history"),Oe(this,"expirer"),Oe(this,"pairing"),Oe(this,"verify"),Oe(this,"echoClient"),Oe(this,"linkModeSupportedApps"),Oe(this,"eventClient"),Oe(this,"initialized",!1),Oe(this,"logChunkController"),Oe(this,"on",(a,c)=>this.events.on(a,c)),Oe(this,"once",(a,c)=>this.events.once(a,c)),Oe(this,"off",(a,c)=>this.events.off(a,c)),Oe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Oe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:$e.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const r=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||eg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Ro({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:AS.logger,name:Bc}),{logger:s,chunkLoggerController:o}=C1({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=st(s,this.name),this.heartbeat=new Pw,this.crypto=new CA(this,this.logger,e==null?void 0:e.keychain),this.history=new MI(this,this.logger),this.expirer=new qI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new f1(kg(kg({},IS),e==null?void 0:e.storageOptions)),this.relayer=new rI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new UI(this,this.logger),this.verify=new KI(this,this.logger,this.storage),this.echoClient=new YI(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new XI(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const n=new Wc(e);await n.initialize();const r=await n.crypto.getClientId();return await n.storage.setItem(LS,r),n}get context(){return lt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(tg,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(tg)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${e}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const rD=Wc,Rg="wc",Ng=2,Ug="client",Gc=`${Rg}@${Ng}:${Ug}:`,Yc={name:Ug,logger:"error"},Fg="WALLETCONNECT_DEEPLINK_CHOICE",iD="proposal",Lg="Proposal expired",sD="session",Yr=ee.SEVEN_DAYS,oD="engine",Ke={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ee.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ee.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1119}}},Qc={min:ee.FIVE_MINUTES,max:ee.SEVEN_DAYS},an={idle:"IDLE",active:"ACTIVE"},aD={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},cD="request",uD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],lD="wc",hD="auth",dD="authKeys",fD="pairingTopics",pD="requests",uo=`${lD}@${1.5}:${hD}:`,lo=`${uo}:PUB_KEY`;var gD=Object.defineProperty,yD=Object.defineProperties,wD=Object.getOwnPropertyDescriptors,Mg=Object.getOwnPropertySymbols,mD=Object.prototype.hasOwnProperty,bD=Object.prototype.propertyIsEnumerable,Zc=(t,e,n)=>e in t?gD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ce=(t,e)=>{for(var n in e||(e={}))mD.call(e,n)&&Zc(t,n,e[n]);if(Mg)for(var n of Mg(e))bD.call(e,n)&&Zc(t,n,e[n]);return t},vt=(t,e)=>yD(t,wD(e)),Z=(t,e,n)=>Zc(t,typeof e!="symbol"?e+"":e,n);class vD extends Q1{constructor(e){super(e),Z(this,"name",oD),Z(this,"events",new il),Z(this,"initialized",!1),Z(this,"requestQueue",{state:an.idle,queue:[]}),Z(this,"sessionRequestQueue",{state:an.idle,queue:[]}),Z(this,"requestQueueDelay",ee.ONE_SECOND),Z(this,"expectedPairingMethodMap",new Map),Z(this,"recentlyDeletedMap",new Map),Z(this,"recentlyDeletedLimit",200),Z(this,"relayMessageCache",[]),Z(this,"pendingSessions",new Map),Z(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ke)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ee.toMiliseconds(this.requestQueueDelay)))}),Z(this,"connect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=vt(Ce({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=W8(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=r;let l=i,h,d=!1;try{if(l){const S=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=S.active}}catch(S){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),S}if(!l||!d){const{topic:S,uri:F}=await this.client.core.pairing.create();l=S,h=F}if(!l){const{message:S}=te("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(S)}const y=await this.client.core.crypto.generateKeyPair(),f=Ke.wc_sessionPropose.req.ttl||ee.FIVE_MINUTES,g=Fe(f),I=vt(Ce(Ce({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:Xp}],proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:tn()}),$=_e("session_connect",I.id),{reject:R,resolve:D,done:_}=or(f,Lg),A=({id:S})=>{S===I.id&&(this.client.events.off("proposal_expire",A),this.pendingSessions.delete(I.id),this.events.emit($,{error:{message:Lg,code:0}}))};return this.client.events.on("proposal_expire",A),this.events.once($,({error:S,session:F})=>{this.client.events.off("proposal_expire",A),S?R(S):F&&D(F)}),await this.sendRequest({topic:l,method:"wc_sessionPropose",params:I,throwOnFailedPublish:!0,clientRpcId:I.id}),await this.setProposal(I.id,I),{uri:h,approval:_}}),Z(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(r){throw this.client.logger.error("pair() failed"),r}}),Z(this,"approve",async n=>{var r,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=n==null?void 0:n.id)==null?void 0:r.toString(),trace:[Yt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(O){throw o.setError(yr.no_internet_connection),O}try{await this.isValidProposalId(n==null?void 0:n.id)}catch(O){throw this.client.logger.error(`approve() -> proposal.get(${n==null?void 0:n.id}) failed`),o.setError(yr.proposal_not_found),O}try{await this.isValidApprove(n)}catch(O){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(yr.session_approve_namespace_validation_failure),O}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=n,y=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:f,proposer:g,requiredNamespaces:I,optionalNamespaces:$}=y;let R=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:f});R||(R=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:Yt.session_approve_started,properties:{topic:f,trace:[Yt.session_approve_started,Yt.session_namespaces_validation_success]}}));const D=await this.client.core.crypto.generateKeyPair(),_=g.publicKey,A=await this.client.core.crypto.generateSharedKey(D,_),S=Ce(Ce(Ce({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:D,metadata:this.client.metadata},expiry:Fe(Yr)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),F=$e.relay;R.addTrace(Yt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(A,{transportType:F})}catch(O){throw R.setError(yr.subscribe_session_topic_failure),O}R.addTrace(Yt.subscribe_session_topic_success);const j=vt(Ce({},S),{topic:A,requiredNamespaces:I,optionalNamespaces:$,pairingTopic:f,acknowledged:!1,self:S.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:D,transportType:$e.relay});await this.client.session.set(A,j),R.addTrace(Yt.store_session);try{R.addTrace(Yt.publishing_session_settle),await this.sendRequest({topic:A,method:"wc_sessionSettle",params:S,throwOnFailedPublish:!0}).catch(O=>{throw R==null||R.setError(yr.session_settle_publish_failure),O}),R.addTrace(Yt.session_settle_publish_success),R.addTrace(Yt.publishing_session_approve),await this.sendResult({id:a,topic:f,result:{relay:{protocol:c??"irn"},responderPublicKey:D},throwOnFailedPublish:!0}).catch(O=>{throw R==null||R.setError(yr.session_approve_publish_failure),O}),R.addTrace(Yt.session_approve_publish_success)}catch(O){throw this.client.logger.error(O),this.client.session.delete(A,Be("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(A),O}return this.client.core.eventClient.deleteEvent({eventId:R.eventId}),await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:f}),await this.setExpiry(A,Fe(Yr)),{topic:A,acknowledged:()=>Promise.resolve(this.client.session.get(A))}}),Z(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=n;let s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&await this.sendError({id:r,topic:s,error:i,rpcOpts:Ke.wc_sessionPropose.reject}),await this.deleteProposal(r)}),Z(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:i}=n,{done:s,resolve:o,reject:a}=or(),c=tn(),u=fr().toString(),l=this.client.session.get(r).namespaces;return this.events.once(_e("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:l}),a(h)}),{acknowledged:s}}),Z(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=n,i=tn(),{done:s,resolve:o,reject:a}=or();return this.events.once(_e("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,Fe(Yr)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),Z(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(I){throw this.client.logger.error("request() -> isValidRequest() failed"),I}const{chainId:r,request:i,topic:s,expiry:o=Ke.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);(a==null?void 0:a.transportType)===$e.relay&&await this.confirmOnlineStateOrThrow();const c=tn(),u=fr().toString(),{done:l,resolve:h,reject:d}=or(o,"Request expired. Please try again.");this.events.once(_e("session_request",c),({error:I,result:$})=>{I?d(I):h($)});const y="wc_sessionRequest",f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:y,params:{request:vt(Ce({},i),{expiryTimestamp:Fe(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:f}).catch(I=>d(I)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),await l();const g={request:vt(Ce({},i),{expiryTimestamp:Fe(o)}),chainId:r};return await Promise.all([new Promise(async I=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:y,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch($=>d($)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),I()}),new Promise(async I=>{var $;if(!(($=a.sessionConfig)!=null&&$.disableDeepLink)){const R=await z3(this.client.core.storage,Fg);await F3({id:c,topic:s,wcDeepLink:R})}I()}),l()]).then(I=>I[2])}),Z(this,"respond",async n=>{this.isInitialized(),await this.isValidRespond(n);const{topic:r,response:i}=n,{id:s}=i,o=this.client.session.get(r);o.transportType===$e.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);nn(i)?await this.sendResult({id:s,topic:r,result:i.result,throwOnFailedPublish:!0,appLink:a}):kt(i)&&await this.sendError({id:s,topic:r,error:i.error,appLink:a}),this.cleanupAfterResponse(n)}),Z(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=n;if(this.client.session.keys.includes(r)){const i=tn(),s=fr().toString(),{done:o,resolve:a,reject:c}=or();this.events.once(_e("session_ping",i),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),Z(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);const{topic:r,event:i,chainId:s}=n,o=fr().toString(),a=tn();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),Z(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);const{topic:r}=n;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:Be("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=te("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),Z(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(r=>Q8(r,n)))),Z(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),Z(this,"authenticate",async(n,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(n);const s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?$e.link_mode:$e.relay;o===$e.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:d,exp:y,nbf:f,methods:g=[],expiry:I}=n,$=[...n.resources||[]],{topic:R,uri:D}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:R,uri:D}});const _=await this.client.core.crypto.generateKeyPair(),A=to(_);if(await Promise.all([this.client.auth.authKeys.set(lo,{responseTopic:A,publicKey:_}),this.client.auth.pairingTopics.set(A,{topic:A,pairingTopic:R})]),await this.client.core.relayer.subscribe(A,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${R}`),g.length>0){const{namespace:N}=Us(a[0]);let U=n_(N,"request",g);qs($)&&(U=i_(U,$.pop())),$.push(U)}const S=I&&I>Ke.wc_sessionAuthenticate.req.ttl?I:Ke.wc_sessionAuthenticate.req.ttl,F={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:y,nbf:f,resources:$},requester:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:Fe(S)},j={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},O={requiredNamespaces:{},optionalNamespaces:j,relays:[{protocol:"irn"}],pairingTopic:R,proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:Fe(Ke.wc_sessionPropose.req.ttl),id:tn()},{done:M,resolve:z,reject:q}=or(S,"Request expired"),C=tn(),B=_e("session_connect",O.id),x=_e("session_request",C),w=async({error:N,session:U})=>{this.events.off(x,E),N?q(N):U&&z({session:U})},E=async N=>{var U,H,G;if(await this.deletePendingAuthRequest(C,{message:"fulfilled",code:0}),N.error){const le=Be("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return N.error.code===le.code?void 0:(this.events.off(B,w),q(N.error.message))}await this.deleteProposal(O.id),this.events.off(B,w);const{cacaos:Y,responder:J}=N.result,X=[],ie=[];for(const le of Y){await Df({cacao:le,projectId:this.client.core.projectId})||(this.client.logger.error(le,"Signature verification failed"),q(Be("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ce}=le,P=qs(ce.resources),p=[ec(ce.iss)],m=js(ce.iss);if(P){const b=Cf(P),v=Pf(P);X.push(...b),p.push(...v)}for(const b of p)ie.push(`${b}:${m}`)}const ue=await this.client.core.crypto.generateSharedKey(_,J.publicKey);let fe;X.length>0&&(fe={topic:ue,acknowledged:!0,self:{publicKey:_,metadata:this.client.metadata},peer:J,controller:J.publicKey,expiry:Fe(Yr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:R,namespaces:Cp([...new Set(X)],[...new Set(ie)]),transportType:o},await this.client.core.relayer.subscribe(ue,{transportType:o}),await this.client.session.set(ue,fe),R&&await this.client.core.pairing.updateMetadata({topic:R,metadata:J.metadata}),fe=this.client.session.get(ue)),(U=this.client.metadata.redirect)!=null&&U.linkMode&&(H=J.metadata.redirect)!=null&&H.linkMode&&(G=J.metadata.redirect)!=null&&G.universal&&r&&(this.client.core.addLinkModeSupportedApp(J.metadata.redirect.universal),this.client.session.update(ue,{transportType:$e.link_mode})),z({auths:Y,session:fe})};this.events.once(B,w),this.events.once(x,E);let T;try{if(s){const N=pr("wc_sessionAuthenticate",F,C);this.client.core.history.set(R,N);const U=await this.client.core.crypto.encode("",N,{type:Ri,encoding:Vn});T=ro(r,R,U)}else await Promise.all([this.sendRequest({topic:R,method:"wc_sessionAuthenticate",params:F,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:C}),this.sendRequest({topic:R,method:"wc_sessionPropose",params:O,expiry:Ke.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:O.id})])}catch(N){throw this.events.off(B,w),this.events.off(x,E),N}return await this.setProposal(O.id,O),await this.setAuthRequest(C,{request:vt(Ce({},F),{verifyContext:{}}),pairingTopic:R,transportType:o}),{uri:T??D,response:M}}),Z(this,"approveSessionAuthenticate",async n=>{const{id:r,auths:i}=n,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[wr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(I){throw s.setError(Vi.no_internet_connection),I}const o=this.getPendingAuthRequest(r);if(!o)throw s.setError(Vi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||$e.relay;a===$e.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=to(c),h={type:bn,receiverPublicKey:c,senderPublicKey:u},d=[],y=[];for(const I of i){if(!await Df({cacao:I,projectId:this.client.core.projectId})){s.setError(Vi.invalid_cacao);const A=Be("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:l,error:A,encodeOpts:h}),new Error(A.message)}s.addTrace(wr.cacaos_verified);const{p:$}=I,R=qs($.resources),D=[ec($.iss)],_=js($.iss);if(R){const A=Cf(R),S=Pf(R);d.push(...A),D.push(...S)}for(const A of D)y.push(`${A}:${_}`)}const f=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(wr.create_authenticated_session_topic);let g;if((d==null?void 0:d.length)>0){g={topic:f,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Fe(Yr),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Cp([...new Set(d)],[...new Set(y)]),transportType:a},s.addTrace(wr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(f,{transportType:a})}catch(I){throw s.setError(Vi.subscribe_authenticated_session_topic_failure),I}s.addTrace(wr.subscribe_authenticated_session_topic_success),await this.client.session.set(f,g),s.addTrace(wr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(wr.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:r,result:{cacaos:i,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(I){throw s.setError(Vi.authenticated_session_approve_publish_failure),I}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),Z(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();const{id:r,reason:i}=n,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===$e.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=to(o),u={type:bn,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:u,rpcOpts:Ke.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),Z(this,"formatAuthMessage",n=>{this.isInitialized();const{request:r,iss:i}=n;return Of(r,i)}),Z(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),Z(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{const r=this.client.core.pairing.pairings.get(n.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),Z(this,"deleteSession",async n=>{var r;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Be("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Fg).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===i&&this.deletePendingSessionRequest(u.id,Be("USER_DISCONNECTED"))}),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=an.idle),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),Z(this,"deleteProposal",async(n,r)=>{if(r)try{const i=this.client.proposal.get(n),s=this.client.core.eventClient.getEvent({topic:i.pairingTopic});s==null||s.setError(yr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,Be("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),Z(this,"deletePendingSessionRequest",async(n,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),i&&(this.sessionRequestQueue.state=an.idle,this.client.events.emit("session_request_expire",{id:n}))}),Z(this,"deletePendingAuthRequest",async(n,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)])}),Z(this,"setExpiry",async(n,r)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,r),await this.client.session.update(n,{expiry:r}))}),Z(this,"setProposal",async(n,r)=>{this.client.core.expirer.set(n,Fe(Ke.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,r)}),Z(this,"setAuthRequest",async(n,r)=>{const{request:i,pairingTopic:s,transportType:o=$e.relay}=r;this.client.core.expirer.set(n,i.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:n,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),Z(this,"setPendingSessionRequest",async n=>{const{id:r,topic:i,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||Fe(Ke.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:s,verifyContext:o})}),Z(this,"sendRequest",async n=>{const{topic:r,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h}=n,d=pr(i,s,c);let y;const f=!!l;try{const $=f?Vn:Wt;y=await this.client.core.crypto.encode(r,d,{encoding:$})}catch($){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),$}let g;if(uD.includes(i)){const $=en(JSON.stringify(d)),R=en(y);g=await this.client.core.verify.register({id:R,decryptedId:$})}const I=Ke[i].req;if(I.attestation=g,o&&(I.ttl=o),a&&(I.id=a),this.client.core.history.set(r,d),f){const $=ro(l,r,y);await global.Linking.openURL($,this.client.name)}else{const $=Ke[i].req;o&&($.ttl=o),a&&($.id=a),$.tvf=vt(Ce({},h),{correlationId:d.id}),u?($.internal=vt(Ce({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,y,$)):this.client.core.relayer.publish(r,y,$).catch(R=>this.client.logger.error(R))}return d.id}),Z(this,"sendResult",async n=>{const{id:r,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,u=$c(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?Vn:Wt;l=await this.client.core.crypto.encode(i,u,vt(Ce({},a||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),f}let d,y;try{d=await this.client.core.history.get(i,r);const f=d.request;try{y=this.getTVFParams(r,f.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(f){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),f}if(h){const f=ro(c,i,l);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,g=Ke[f].res;g.tvf=vt(Ce({},y),{correlationId:r}),o?(g.internal=vt(Ce({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,l,g)):this.client.core.relayer.publish(i,l,g).catch(I=>this.client.logger.error(I))}await this.client.core.history.resolve(u)}),Z(this,"sendError",async n=>{const{id:r,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,u=Cc(r,s);let l;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const y=h?Vn:Wt;l=await this.client.core.crypto.encode(i,u,vt(Ce({},o||{}),{encoding:y}))}catch(y){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),y}let d;try{d=await this.client.core.history.get(i,r)}catch(y){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),y}if(h){const y=ro(c,i,l);await global.Linking.openURL(y,this.client.name)}else{const y=d.request.method,f=a||Ke[y].res;this.client.core.relayer.publish(i,l,f)}await this.client.core.history.resolve(u)}),Z(this,"cleanup",async()=>{const n=[],r=[];this.client.session.getAll().forEach(i=>{let s=!1;Tn(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&n.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{Tn(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...n.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),Z(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),Z(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),Z(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===an.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=an.active;const n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=an.idle}),Z(this,"processRequest",async n=>{const{topic:r,payload:i,attestation:s,transportType:o,encryptedId:a}=n,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),Z(this,"onRelayEventResponse",async n=>{const{topic:r,payload:i,transportType:s}=n,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),Z(this,"onRelayEventUnknownPayload",n=>{const{topic:r}=n,{message:i}=te("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),Z(this,"shouldIgnorePairingRequest",n=>{const{topic:r,requestMethod:i}=n,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),Z(this,"onSessionProposeRequest",async n=>{const{topic:r,payload:i,attestation:s,encryptedId:o}=n,{params:a,id:c}=i;try{const u=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u==null||u.setError(xn.proposal_listener_not_found)),this.isValidConnect(Ce({},i.params));const l=a.expiryTimestamp||Fe(Ke.wc_sessionPropose.req.ttl),h=Ce({id:c,pairingTopic:r,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:s,hash:en(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});u==null||u.addTrace(sn.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(u){await this.sendError({id:c,topic:r,error:u,rpcOpts:Ke.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),Z(this,"onSessionProposeResponse",async(n,r,i)=>{const{id:s}=r;if(nn(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:n,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:n})}else if(kt(r)){await this.deleteProposal(s);const o=_e("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),Z(this,"onSessionSettleRequest",async(n,r)=>{const{id:i,params:s}=r;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=r.params,y=[...this.pendingSessions.values()].find(I=>I.sessionTopic===n);if(!y)return this.client.logger.error(`Pending session not found for topic ${n}`);const f=this.client.proposal.get(y.proposalId),g=vt(Ce(Ce(Ce({topic:n,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:y.pairingTopic,requiredNamespaces:f.requiredNamespaces,optionalNamespaces:f.optionalNamespaces,controller:a.publicKey,self:{publicKey:y.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:$e.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:y.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(_e("session_connect",y.proposalId),{session:g}),this.pendingSessions.delete(y.proposalId),this.deleteProposal(y.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:r.id,topic:n,result:!0})}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),Z(this,"onSessionSettleResponse",async(n,r)=>{const{id:i}=r;nn(r)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(_e("session_approve",i),{})):kt(r)&&(await this.client.session.delete(n,Be("USER_DISCONNECTED")),this.events.emit(_e("session_approve",i),{error:r.error}))}),Z(this,"onSessionUpdateRequest",async(n,r)=>{const{params:i,id:s}=r;try{const o=`${n}_session_update`,a=Mi.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:Be("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Ce({topic:n},i));try{Mi.set(o,s),await this.client.session.update(n,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw Mi.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:i})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),Z(this,"isRequestOutOfSync",(n,r)=>r.toString().slice(0,-3)<n.toString().slice(0,-3)),Z(this,"onSessionUpdateResponse",(n,r)=>{const{id:i}=r,s=_e("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);nn(r)?this.events.emit(_e("session_update",i),{}):kt(r)&&this.events.emit(_e("session_update",i),{error:r.error})}),Z(this,"onSessionExtendRequest",async(n,r)=>{const{id:i}=r;try{this.isValidExtend({topic:n}),await this.setExpiry(n,Fe(Yr)),await this.sendResult({id:i,topic:n,result:!0}),this.client.events.emit("session_extend",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),Z(this,"onSessionExtendResponse",(n,r)=>{const{id:i}=r,s=_e("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);nn(r)?this.events.emit(_e("session_extend",i),{}):kt(r)&&this.events.emit(_e("session_extend",i),{error:r.error})}),Z(this,"onSessionPingRequest",async(n,r)=>{const{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult({id:i,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),Z(this,"onSessionPingResponse",(n,r)=>{const{id:i}=r,s=_e("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);nn(r)?this.events.emit(_e("session_ping",i),{}):kt(r)&&this.events.emit(_e("session_ping",i),{error:r.error})},500)}),Z(this,"onSessionDeleteRequest",async(n,r)=>{const{id:i}=r;try{this.isValidDisconnect({topic:n,reason:r.params}),Promise.all([new Promise(s=>{this.client.core.relayer.once(He.publish,async()=>{s(await this.deleteSession({topic:n,id:i}))})}),this.sendResult({id:i,topic:n,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:n,error:Be("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),Z(this,"onSessionRequest",async n=>{var r,i,s;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=n,{id:h,params:d}=a;try{await this.isValidRequest(Ce({topic:o},d));const y=this.client.session.get(o),f=await this.getVerifyContext({attestationId:c,hash:en(JSON.stringify(pr("wc_sessionRequest",d,h))),encryptedId:u,metadata:y.peer.metadata,transportType:l}),g={id:h,topic:o,params:d,verifyContext:f};await this.setPendingSessionRequest(g),l===$e.link_mode&&(r=y.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=y.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(y){await this.sendError({id:h,topic:o,error:y}),this.client.logger.error(y)}}),Z(this,"onSessionRequestResponse",(n,r)=>{const{id:i}=r,s=_e("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);nn(r)?this.events.emit(_e("session_request",i),{result:r.result}):kt(r)&&this.events.emit(_e("session_request",i),{error:r.error})}),Z(this,"onSessionEventRequest",async(n,r)=>{const{id:i,params:s}=r;try{const o=`${n}_session_event_${s.event.name}`,a=Mi.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(Ce({topic:n},s)),this.client.events.emit("session_event",{id:i,topic:n,params:s}),Mi.set(o,i)}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),Z(this,"onSessionAuthenticateResponse",(n,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:r}),nn(r)?this.events.emit(_e("session_request",i),{result:r.result}):kt(r)&&this.events.emit(_e("session_request",i),{error:r.error})}),Z(this,"onSessionAuthenticateRequest",async n=>{var r;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{const{requester:u,authPayload:l,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:en(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),y={requester:u,pairingTopic:i,id:s.id,authPayload:l,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:y,pairingTopic:i,transportType:c}),c===$e.link_mode&&(r=u.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:d})}catch(u){this.client.logger.error(u);const l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),y={type:bn,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:u,encodeOpts:y,rpcOpts:Ke.wc_sessionAuthenticate.autoReject,appLink:d})}}),Z(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),Z(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=an.idle,this.processSessionRequestQueue()},ee.toMiliseconds(this.requestQueueDelay))}),Z(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=_e("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(_e("session_request",s.request.id),{error:r})})}),Z(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===an.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=an.active,this.emitSessionRequest(n)}catch(r){this.client.logger.error(r)}}),Z(this,"emitSessionRequest",n=>{this.client.events.emit("session_request",n)}),Z(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===n.topic);r&&this.onSessionProposeRequest({topic:n.topic,payload:pr("wc_sessionPropose",vt(Ce({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),Z(this,"isValidConnect",async n=>{if(!mt(n)){const{message:u}=te("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(u)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if(Ze(r)||await this.isValidPairingTopic(r),!c6(c)){const{message:u}=te("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!Ze(i)&&Li(i)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(i,"requiredNamespaces")}if(!Ze(s)&&Li(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Ze(o)||this.validateSessionProps(o,"sessionProperties"),!Ze(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),Z(this,"validateNamespaces",(n,r)=>{const i=a6(n,"connect()",r);if(i)throw new Error(i.message)}),Z(this,"isValidApprove",async n=>{if(!mt(n))throw new Error(te("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:r,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),u=Ec(i,"approve()");if(u)throw new Error(u.message);const l=Rp(c.requiredNamespaces,i,"approve()");if(l)throw new Error(l.message);if(!ke(s,!0)){const{message:h}=te("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(Ze(o)||this.validateSessionProps(o,"sessionProperties"),!Ze(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),Z(this,"isValidReject",async n=>{if(!mt(n)){const{message:s}=te("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}const{id:r,reason:i}=n;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!l6(i)){const{message:s}=te("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),Z(this,"isValidSessionSettleRequest",n=>{if(!mt(n)){const{message:u}=te("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(u)}const{relay:r,controller:i,namespaces:s,expiry:o}=n;if(!Tp(r)){const{message:u}=te("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=t6(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Ec(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Tn(o)){const{message:u}=te("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),Z(this,"isValidUpdate",async n=>{if(!mt(n)){const{message:c}=te("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}const{topic:r,namespaces:i}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const s=this.client.session.get(r),o=Ec(i,"update()");if(o)throw new Error(o.message);const a=Rp(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),Z(this,"isValidExtend",async n=>{if(!mt(n)){const{message:i}=te("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(i)}const{topic:r}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),Z(this,"isValidRequest",async n=>{if(!mt(n)){const{message:c}=te("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}const{topic:r,request:i,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!kp(a,s)){const{message:c}=te("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!h6(i)){const{message:c}=te("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!p6(a,s,i.method)){const{message:c}=te("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}if(o&&!m6(o,Qc)){const{message:c}=te("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Qc.min} and ${Qc.max}`);throw new Error(c)}}),Z(this,"isValidRespond",async n=>{var r;if(!mt(n)){const{message:o}=te("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(o)}const{topic:i,response:s}=n;try{await this.isValidSessionTopic(i)}catch(o){throw(r=n==null?void 0:n.response)!=null&&r.id&&this.cleanupAfterResponse(n),o}if(!d6(s)){const{message:o}=te("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),Z(this,"isValidPing",async n=>{if(!mt(n)){const{message:i}=te("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),Z(this,"isValidEmit",async n=>{if(!mt(n)){const{message:a}=te("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}const{topic:r,event:i,chainId:s}=n;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!kp(o,s)){const{message:a}=te("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!f6(i)){const{message:a}=te("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!g6(o,s,i.name)){const{message:a}=te("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),Z(this,"isValidDisconnect",async n=>{if(!mt(n)){const{message:i}=te("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),Z(this,"isValidAuthenticate",n=>{const{chains:r,uri:i,domain:s,nonce:o}=n;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!ke(i,!1))throw new Error("uri is required parameter");if(!ke(s,!1))throw new Error("domain is required parameter");if(!ke(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>Us(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Us(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),Z(this,"getVerifyContext",async n=>{const{attestationId:r,hash:i,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||Hi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===$e.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),Z(this,"validateSessionProps",(n,r)=>{Object.values(n).forEach((i,s)=>{if(i==null){const{message:o}=te("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),Z(this,"getPendingAuthRequest",n=>{const r=this.client.auth.requests.get(n);return typeof r=="object"?r:void 0}),Z(this,"addToRecentlyDeleted",(n,r)=>{if(this.recentlyDeletedMap.set(n,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),Z(this,"checkRecentlyDeleted",n=>{const r=this.recentlyDeletedMap.get(n);if(r){const{message:i}=te("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${n}`);throw new Error(i)}}),Z(this,"isLinkModeEnabled",(n,r)=>{var i,s,o,a,c,u,l,h,d;return!n||r!==$e.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=n==null?void 0:n.redirect)==null?void 0:l.universal)!==void 0&&((h=n==null?void 0:n.redirect)==null?void 0:h.universal)!==""&&((d=n==null?void 0:n.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),Z(this,"getAppLinkIfEnabled",(n,r)=>{var i;return this.isLinkModeEnabled(n,r)?(i=n==null?void 0:n.redirect)==null?void 0:i.universal:void 0}),Z(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;const r=tf(n,"topic")||"",i=decodeURIComponent(tf(n,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:$e.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:s})}),Z(this,"registerLinkModeListeners",async()=>{var n;if(qa()||Pn()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){const r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),Z(this,"getTVFParams",(n,r,i)=>{var s,o,a;if(!((s=r.request)!=null&&s.method))return{};const c={correlationId:n,rpcMethods:[r.request.method],chainId:r.chainId};try{const u=this.extractTxHashesFromResult(r.request,i);c.txHashes=u,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn("Error getting TVF params",u)}return c}),Z(this,"isValidContractData",n=>{var r;if(!n)return!1;try{const i=(n==null?void 0:n.data)||((r=n==null?void 0:n[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),Z(this,"extractTxHashesFromResult",(n,r)=>{var i;try{if(!r)return[];const s=n.method,o=aD[s];if(s==="sui_signTransaction")return[M4(r.transactionBytes)];if(s==="near_signTransaction")return[_f(r)];if(s==="near_signTransactions")return r.map(c=>_f(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=r.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[T6({transaction:n.params.transactionPayload,signature:r.signature})];if(s==="algo_signTxn")return Wr(r)?r.map(c=>Sf(c)):[Sf(r)];if(s==="cosmos_signDirect")return[j4(r)];if(typeof r=="string")return[r];const a=r[o.key];if(Wr(a))return s==="solana_signAllTransactions"?a.map(c=>L4(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(n))for(const s of i)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(He.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:n,message:r,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(lo)?this.client.auth.authKeys.get(lo):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(n,r,{receiverPublicKey:o,encoding:s===$e.link_mode?Vn:Wt});Pc(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:i,transportType:s,encryptedId:en(r)})):so(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(n,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Nt.expired,async e=>{const{topic:n,id:r}=ef(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,te("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,te("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(gr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(gr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ke(e,!1)){const{message:n}=te("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:n}=te("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(Tn(this.client.core.pairing.pairings.get(e).expiry)){const{message:n}=te("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!ke(e,!1)){const{message:n}=te("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:n}=te("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(Tn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:n}=te("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){const{message:n}=te("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ke(e,!1)){const{message:n}=te("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{const{message:n}=te("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!u6(e)){const{message:n}=te("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){const{message:n}=te("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(Tn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:n}=te("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}}class ED extends mr{constructor(e,n){super(e,n,iD,Gc),this.core=e,this.logger=n}}class xD extends mr{constructor(e,n){super(e,n,sD,Gc),this.core=e,this.logger=n}}class _D extends mr{constructor(e,n){super(e,n,cD,Gc,r=>r.id),this.core=e,this.logger=n}}class SD extends mr{constructor(e,n){super(e,n,dD,uo,()=>lo),this.core=e,this.logger=n}}class AD extends mr{constructor(e,n){super(e,n,fD,uo),this.core=e,this.logger=n}}class ID extends mr{constructor(e,n){super(e,n,pD,uo,r=>r.id),this.core=e,this.logger=n}}var DD=Object.defineProperty,OD=(t,e,n)=>e in t?DD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jc=(t,e,n)=>OD(t,typeof e!="symbol"?e+"":e,n);class $D{constructor(e,n){this.core=e,this.logger=n,Jc(this,"authKeys"),Jc(this,"pairingTopics"),Jc(this,"requests"),this.authKeys=new SD(this.core,this.logger),this.pairingTopics=new AD(this.core,this.logger),this.requests=new ID(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var CD=Object.defineProperty,PD=(t,e,n)=>e in t?CD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,me=(t,e,n)=>PD(t,typeof e!="symbol"?e+"":e,n);class Xc extends Y1{constructor(e){super(e),me(this,"protocol",Rg),me(this,"version",Ng),me(this,"name",Yc.name),me(this,"metadata"),me(this,"core"),me(this,"logger"),me(this,"events",new jt.EventEmitter),me(this,"engine"),me(this,"session"),me(this,"proposal"),me(this,"pendingRequest"),me(this,"auth"),me(this,"signConfig"),me(this,"on",(r,i)=>this.events.on(r,i)),me(this,"once",(r,i)=>this.events.once(r,i)),me(this,"off",(r,i)=>this.events.off(r,i)),me(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),me(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),me(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),me(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(s){throw this.logger.error(s.message),s}}),me(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),me(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Yc.name,this.metadata=B3(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const n=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:hs(Ro({level:(e==null?void 0:e.logger)||Yc.logger}));this.core=(e==null?void 0:e.core)||new rD(e),this.logger=st(n,this.name),this.session=new xD(this.core,this.logger),this.proposal=new ED(this.core,this.logger),this.pendingRequest=new _D(this.core,this.logger),this.engine=new vD(this),this.auth=new $D(this.core,this.logger)}static async init(e){const n=new Xc(e);return await n.initialize(),n}get context(){return lt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},ee.toMiliseconds(ee.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const BD=Xc;class TD{constructor({shadow:e}){this.shadow=e}get currentSession(){return this.session}set currentSession(e){this.session=e}restoreLastSession(){if(!this.client)throw new Error("wallet connect client not initialized");console.log("all sessions",this.client.session.getAll());const e=this.client.session.getAll().pop();return console.log("lastSession",e),e}findSession(e){if(!this.client)throw new Error("wallet connect client not initialized");return console.log("walletConnect findSession, all sessions:",this.client.session.getAll()),this.client.session.getAll().find(n=>n.peer.metadata.name===e.wcPeerName)}async init(){this.client=await BD.init({projectId:E0}),this.session=this.restoreLastSession(),this.client.on("session_event",e=>{console.log("session event",e)}),this.client.on("session_update",({topic:e,params:n})=>{var o;const{namespaces:r}=n,s={...(o=this.client)==null?void 0:o.session.get(e),namespaces:r};console.log("session updated:",s)}),this.client.on("session_delete",e=>{console.log("session deleted:",e)})}async connectWalletWithQrCode(){if(!this.client)throw new Error("wallet connect client not initialized");const{uri:e,approval:n}=await this.client.connect({requiredNamespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:["eip155:1"],events:["chainChanged","accountsChanged"]}}});return console.log("Connect with URI:",e),{uri:e,approval:n}}async sendEthTransaction(e,n){if(!this.client)throw new Error("wallet connect client not initialized");if(n=n||this.session,!n)throw new Error("wallet connect session not initialized");console.log("sending eth_sendTransaction request");const r=await this.client.request({chainId:"eip155:1",topic:n.topic,request:{method:"eth_sendTransaction",params:[e]}});return console.log("result:",r),r}getSessionAddress(e,n){var r;return(r=e.namespaces.eip155.accounts.find(i=>i.startsWith(n)))==null?void 0:r.split(":").pop()}}function kD(t){var e;return(e=t.split("?").pop())==null?void 0:e.split("&").reduce((n,r)=>{const[i,s]=r.split("=");return n[i]=s,n},{})}function eu(t,{includeName:e=!1}={}){if(t.type!=="function"&&t.type!=="event"&&t.type!=="error")throw new jD(t.type);return`${t.name}(${zg(t.inputs,{includeName:e})})`}function zg(t,{includeName:e=!1}={}){return t?t.map(n=>RD(n,{includeName:e})).join(e?", ":","):""}function RD(t,{includeName:e}){return t.type.startsWith("tuple")?`(${zg(t.components,{includeName:e})})${t.type.slice(5)}`:t.type+(e&&t.name?` ${t.name}`:"")}function Zi(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Ut(t){return Zi(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const jg="2.31.3";let Ji={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${jg}`};class Me extends Error{constructor(e,n={}){var a;const r=(()=>{var c;return n.cause instanceof Me?n.cause.details:(c=n.cause)!=null&&c.message?n.cause.message:n.details})(),i=n.cause instanceof Me&&n.cause.docsPath||n.docsPath,s=(a=Ji.getDocsUrl)==null?void 0:a.call(Ji,{...n,docsPath:i}),o=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...r?[`Details: ${r}`]:[],...Ji.version?[`Version: ${Ji.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=i,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=jg}walk(e){return qg(this,e)}}function qg(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?qg(t.cause,e):e?null:t}class ND extends Me{constructor({expectedLength:e,givenLength:n,type:r}){super([`ABI encoding array length mismatch for type ${r}.`,`Expected length: ${e}`,`Given length: ${n}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class UD extends Me{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${Ut(n)}) does not match expected size (bytes${e}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class FD extends Me{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${e}`,`Given length (values): ${n}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class Hg extends Me{constructor(e,{docsPath:n}={}){super([`Function ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionNotFoundError"})}}class LD extends Me{constructor(e,n){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${e.type}\` in \`${eu(e.abiItem)}\`, and`,`\`${n.type}\` in \`${eu(n.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class MD extends Me{constructor(e,{docsPath:n}){super([`Type "${e}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiEncodingType"})}}class zD extends Me{constructor(e){super([`Value "${e}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}}class jD extends Me{constructor(e){super([`"${e}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}class Vg extends Me{constructor({offset:e,position:n,size:r}){super(`Slice ${n==="start"?"starting":"ending"} at offset "${e}" is out-of-bounds (size: ${r}).`,{name:"SliceOffsetOutOfBoundsError"})}}class Kg extends Me{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}}function Qr(t,{dir:e,size:n=32}={}){return typeof t=="string"?Kn(t,{dir:e,size:n}):qD(t,{dir:e,size:n})}function Kn(t,{dir:e,size:n=32}={}){if(n===null)return t;const r=t.replace("0x","");if(r.length>n*2)throw new Kg({size:Math.ceil(r.length/2),targetSize:n,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function qD(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new Kg({size:t.length,targetSize:n,type:"bytes"});const r=new Uint8Array(n);for(let i=0;i<n;i++){const s=e==="right";r[s?i:n-i-1]=t[s?i:t.length-i-1]}return r}class Wg extends Me{constructor({max:e,min:n,signed:r,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${i*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}}class HD extends Me{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Xi(t,{size:e}){if(Ut(t)>e)throw new HD({givenSize:Ut(t),maxSize:e})}const VD=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function KD(t,e={}){return typeof t=="number"||typeof t=="bigint"?br(t,e):typeof t=="string"?Qg(t,e):typeof t=="boolean"?Gg(t,e):Yg(t,e)}function Gg(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(Xi(n,{size:e.size}),Qr(n,{size:e.size})):n}function Yg(t,e={}){let n="";for(let i=0;i<t.length;i++)n+=VD[t[i]];const r=`0x${n}`;return typeof e.size=="number"?(Xi(r,{size:e.size}),Qr(r,{dir:"right",size:e.size})):r}function br(t,e={}){const{signed:n,size:r}=e,i=BigInt(t);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const c=typeof t=="bigint"?"n":"";throw new Wg({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:n,size:r,value:`${t}${c}`})}const a=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?Qr(a,{size:r}):a}const WD=new TextEncoder;function Qg(t,e={}){const n=WD.encode(t);return Yg(n,e)}const GD=new TextEncoder;function Zg(t,e={}){return typeof t=="number"||typeof t=="bigint"?QD(t,e):typeof t=="boolean"?YD(t,e):Zi(t)?Xg(t,e):e0(t,e)}function YD(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(Xi(n,{size:e.size}),Qr(n,{size:e.size})):n}const _n={zero:48,nine:57,A:65,F:70,a:97,f:102};function Jg(t){if(t>=_n.zero&&t<=_n.nine)return t-_n.zero;if(t>=_n.A&&t<=_n.F)return t-(_n.A-10);if(t>=_n.a&&t<=_n.f)return t-(_n.a-10)}function Xg(t,e={}){let n=t;e.size&&(Xi(n,{size:e.size}),n=Qr(n,{dir:"right",size:e.size}));let r=n.slice(2);r.length%2&&(r=`0${r}`);const i=r.length/2,s=new Uint8Array(i);for(let o=0,a=0;o<i;o++){const c=Jg(r.charCodeAt(a++)),u=Jg(r.charCodeAt(a++));if(c===void 0||u===void 0)throw new Me(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);s[o]=c*16+u}return s}function QD(t,e){const n=br(t,e);return Xg(n)}function e0(t,e={}){const n=GD.encode(t);return typeof e.size=="number"?(Xi(n,{size:e.size}),Qr(n,{dir:"right",size:e.size})):n}function t0(t,e){const n=e||"hex",r=Qh(Zi(t,{strict:!1})?Zg(t):t);return n==="bytes"?r:KD(r)}const ZD=t=>t0(Zg(t));function JD(t){return ZD(t)}function XD(t){let e=!0,n="",r=0,i="",s=!1;for(let o=0;o<t.length;o++){const a=t[o];if(["(",")",","].includes(a)&&(e=!0),a==="("&&r++,a===")"&&r--,!!e){if(r===0){if(a===" "&&["event","function",""].includes(i))i="";else if(i+=a,a===")"){s=!0;break}continue}if(a===" "){t[o-1]!==","&&n!==","&&n!==",("&&(n="",e=!1);continue}i+=a,n+=a}}if(!s)throw new Me("Unable to normalize signature.");return i}const eO=t=>{const e=typeof t=="string"?t:nv(t);return XD(e)};function n0(t){return JD(eO(t))}const tO=n0;class nO extends Me{constructor({address:e}){super(`Address "${e}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class r0 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const tu=new r0(8192);function rO(t,e){if(tu.has(`${t}.${e}`))return tu.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),r=t0(e0(n),"bytes"),i=n.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&i[o]&&(i[o]=i[o].toUpperCase()),(r[o>>1]&15)>=8&&i[o+1]&&(i[o+1]=i[o+1].toUpperCase());const s=`0x${i.join("")}`;return tu.set(`${t}.${e}`,s),s}const iO=/^0x[a-fA-F0-9]{40}$/,nu=new r0(8192);function ho(t,e){const{strict:n=!0}=e??{},r=`${t}.${n}`;if(nu.has(r))return nu.get(r);const i=iO.test(t)?t.toLowerCase()===t?!0:n?rO(t)===t:!0:!1;return nu.set(r,i),i}function Zr(t){return typeof t[0]=="string"?i0(t):sO(t)}function sO(t){let e=0;for(const i of t)e+=i.length;const n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}function i0(t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function s0(t,e,n,{strict:r}={}){return Zi(t,{strict:!1})?aO(t,e,n,{strict:r}):oO(t,e,n,{strict:r})}function o0(t,e){if(typeof e=="number"&&e>0&&e>Ut(t)-1)throw new Vg({offset:e,position:"start",size:Ut(t)})}function a0(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Ut(t)!==n-e)throw new Vg({offset:n,position:"end",size:Ut(t)})}function oO(t,e,n,{strict:r}={}){o0(t,e);const i=t.slice(e,n);return r&&a0(i,e,n),i}function aO(t,e,n,{strict:r}={}){o0(t,e);const i=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return r&&a0(i,e,n),i}const cO=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function uO(t,e){if(t.length!==e.length)throw new FD({expectedLength:t.length,givenLength:e.length});const n=lO({params:t,values:e}),r=iu(n);return r.length===0?"0x":r}function lO({params:t,values:e}){const n=[];for(let r=0;r<t.length;r++)n.push(ru({param:t[r],value:e[r]}));return n}function ru({param:t,value:e}){const n=mO(t.type);if(n){const[r,i]=n;return dO(e,{length:r,param:{...t,type:i}})}if(t.type==="tuple")return wO(e,{param:t});if(t.type==="address")return hO(e);if(t.type==="bool")return pO(e);if(t.type.startsWith("uint")||t.type.startsWith("int")){const r=t.type.startsWith("int"),[,,i="256"]=cO.exec(t.type)??[];return gO(e,{signed:r,size:Number(i)})}if(t.type.startsWith("bytes"))return fO(e,{param:t});if(t.type==="string")return yO(e);throw new MD(t.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function iu(t){let e=0;for(let s=0;s<t.length;s++){const{dynamic:o,encoded:a}=t[s];o?e+=32:e+=Ut(a)}const n=[],r=[];let i=0;for(let s=0;s<t.length;s++){const{dynamic:o,encoded:a}=t[s];o?(n.push(br(e+i,{size:32})),r.push(a),i+=Ut(a)):n.push(a)}return Zr([...n,...r])}function hO(t){if(!ho(t))throw new nO({address:t});return{dynamic:!1,encoded:Kn(t.toLowerCase())}}function dO(t,{length:e,param:n}){const r=e===null;if(!Array.isArray(t))throw new zD(t);if(!r&&t.length!==e)throw new ND({expectedLength:e,givenLength:t.length,type:`${n.type}[${e}]`});let i=!1;const s=[];for(let o=0;o<t.length;o++){const a=ru({param:n,value:t[o]});a.dynamic&&(i=!0),s.push(a)}if(r||i){const o=iu(s);if(r){const a=br(s.length,{size:32});return{dynamic:!0,encoded:s.length>0?Zr([a,o]):a}}if(i)return{dynamic:!0,encoded:o}}return{dynamic:!1,encoded:Zr(s.map(({encoded:o})=>o))}}function fO(t,{param:e}){const[,n]=e.type.split("bytes"),r=Ut(t);if(!n){let i=t;return r%32!==0&&(i=Kn(i,{dir:"right",size:Math.ceil((t.length-2)/2/32)*32})),{dynamic:!0,encoded:Zr([Kn(br(r,{size:32})),i])}}if(r!==Number.parseInt(n))throw new UD({expectedSize:Number.parseInt(n),value:t});return{dynamic:!1,encoded:Kn(t,{dir:"right"})}}function pO(t){if(typeof t!="boolean")throw new Me(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:Kn(Gg(t))}}function gO(t,{signed:e,size:n=256}){if(typeof n=="number"){const r=2n**(BigInt(n)-(e?1n:0n))-1n,i=e?-r-1n:0n;if(t>r||t<i)throw new Wg({max:r.toString(),min:i.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:br(t,{size:32,signed:e})}}function yO(t){const e=Qg(t),n=Math.ceil(Ut(e)/32),r=[];for(let i=0;i<n;i++)r.push(Kn(s0(e,i*32,(i+1)*32),{dir:"right"}));return{dynamic:!0,encoded:Zr([Kn(br(Ut(e),{size:32})),...r])}}function wO(t,{param:e}){let n=!1;const r=[];for(let i=0;i<e.components.length;i++){const s=e.components[i],o=Array.isArray(t)?i:s.name,a=ru({param:s,value:t[o]});r.push(a),a.dynamic&&(n=!0)}return{dynamic:n,encoded:n?iu(r):Zr(r.map(({encoded:i})=>i))}}function mO(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}const c0=t=>s0(n0(t),0,4);function bO(t){const{abi:e,args:n=[],name:r}=t,i=Zi(r,{strict:!1}),s=e.filter(a=>i?a.type==="function"?c0(a)===r:a.type==="event"?tO(a)===r:!1:"name"in a&&a.name===r);if(s.length===0)return;if(s.length===1)return s[0];let o;for(const a of s){if(!("inputs"in a))continue;if(!n||n.length===0){if(!a.inputs||a.inputs.length===0)return a;continue}if(!a.inputs||a.inputs.length===0||a.inputs.length!==n.length)continue;if(n.every((u,l)=>{const h="inputs"in a&&a.inputs[l];return h?su(u,h):!1})){if(o&&"inputs"in o&&o.inputs){const u=u0(a.inputs,o.inputs,n);if(u)throw new LD({abiItem:a,type:u[0]},{abiItem:o,type:u[1]})}o=a}}return o||s[0]}function su(t,e){const n=typeof t,r=e.type;switch(r){case"address":return ho(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in e?Object.values(e.components).every((i,s)=>su(Object.values(t)[s],i)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(t)&&t.every(i=>su(i,{...e,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function u0(t,e,n){for(const r in t){const i=t[r],s=e[r];if(i.type==="tuple"&&s.type==="tuple"&&"components"in i&&"components"in s)return u0(i.components,s.components,n[r]);const o=[i.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?ho(n[r],{strict:!1}):o.includes("address")&&o.includes("bytes")?ho(n[r],{strict:!1}):!1)return o}}const l0="/docs/contract/encodeFunctionData";function vO(t){const{abi:e,args:n,functionName:r}=t;let i=e[0];if(r){const s=bO({abi:e,args:n,name:r});if(!s)throw new Hg(r,{docsPath:l0});i=s}if(i.type!=="function")throw new Hg(void 0,{docsPath:l0});return{abi:[i],functionName:c0(eu(i))}}function h0(t){const{args:e}=t,{abi:n,functionName:r}=(()=>{var a;return t.abi.length===1&&((a=t.functionName)!=null&&a.startsWith("0x"))?t:vO(t)})(),i=n[0],s=r,o="inputs"in i&&i.inputs?uO(i.inputs,e??[]):void 0;return i0([s,o??"0x"])}const d0={contractAddress:"0xdAC17F958D2ee523a2206206994597C13D831ec7",abi:[{inputs:[{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]};function EO({fromAddress:t,toAddress:e,uint256:n}){return{from:t,to:d0.contractAddress,data:h0({abi:d0.abi,functionName:"transfer",args:[e,n]})}}function f0(t,e){const n=`btnWallet${t.id}`;return Dt.h("button",{id:n,class:"w-full flex items-center space-x-2 border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50"},Dt.h("div",{style:{width:"44",paddingRight:"5px"}},Dt.h("img",{src:t.img,alt:t.name,style:"height: 34px; width: 44px;"})),Dt.h("div",{class:"flex w-full",style:"justify-content: space-between;"},Dt.h("span",null,t.name),Dt.h("span",{class:"text-lydian-green"},e?"Linked":""))).outerHTML}var fo={exports:{}},xO=fo.exports,p0;function _O(){return p0||(p0=1,function(t,e){(function(n,r){t.exports=r()})(xO,function(){return(()=>{var n={192:(s,o)=>{var a,c,u=function(){var l=function(C,B){var x=C,w=I[B],E=null,T=0,N=null,U=[],H={},G=function(P,p){E=function(m){for(var b=new Array(m),v=0;v<m;v+=1){b[v]=new Array(m);for(var L=0;L<m;L+=1)b[v][L]=null}return b}(T=4*x+17),Y(0,0),Y(T-7,0),Y(0,T-7),X(),J(),ue(P,p),x>=7&&ie(P),N==null&&(N=le(x,w,U)),fe(N,p)},Y=function(P,p){for(var m=-1;m<=7;m+=1)if(!(P+m<=-1||T<=P+m))for(var b=-1;b<=7;b+=1)p+b<=-1||T<=p+b||(E[P+m][p+b]=0<=m&&m<=6&&(b==0||b==6)||0<=b&&b<=6&&(m==0||m==6)||2<=m&&m<=4&&2<=b&&b<=4)},J=function(){for(var P=8;P<T-8;P+=1)E[P][6]==null&&(E[P][6]=P%2==0);for(var p=8;p<T-8;p+=1)E[6][p]==null&&(E[6][p]=p%2==0)},X=function(){for(var P=$.getPatternPosition(x),p=0;p<P.length;p+=1)for(var m=0;m<P.length;m+=1){var b=P[p],v=P[m];if(E[b][v]==null)for(var L=-2;L<=2;L+=1)for(var k=-2;k<=2;k+=1)E[b+L][v+k]=L==-2||L==2||k==-2||k==2||L==0&&k==0}},ie=function(P){for(var p=$.getBCHTypeNumber(x),m=0;m<18;m+=1){var b=!P&&(p>>m&1)==1;E[Math.floor(m/3)][m%3+T-8-3]=b}for(m=0;m<18;m+=1)b=!P&&(p>>m&1)==1,E[m%3+T-8-3][Math.floor(m/3)]=b},ue=function(P,p){for(var m=w<<3|p,b=$.getBCHTypeInfo(m),v=0;v<15;v+=1){var L=!P&&(b>>v&1)==1;v<6?E[v][8]=L:v<8?E[v+1][8]=L:E[T-15+v][8]=L}for(v=0;v<15;v+=1)L=!P&&(b>>v&1)==1,v<8?E[8][T-v-1]=L:v<9?E[8][15-v-1+1]=L:E[8][15-v-1]=L;E[T-8][8]=!P},fe=function(P,p){for(var m=-1,b=T-1,v=7,L=0,k=$.getMaskFunction(p),K=T-1;K>0;K-=2)for(K==6&&(K-=1);;){for(var W=0;W<2;W+=1)if(E[b][K-W]==null){var Q=!1;L<P.length&&(Q=(P[L]>>>v&1)==1),k(b,K-W)&&(Q=!Q),E[b][K-W]=Q,(v-=1)==-1&&(L+=1,v=7)}if((b+=m)<0||T<=b){b-=m,m=-m;break}}},le=function(P,p,m){for(var b=_.getRSBlocks(P,p),v=A(),L=0;L<m.length;L+=1){var k=m[L];v.put(k.getMode(),4),v.put(k.getLength(),$.getLengthInBits(k.getMode(),P)),k.write(v)}var K=0;for(L=0;L<b.length;L+=1)K+=b[L].dataCount;if(v.getLengthInBits()>8*K)throw"code length overflow. ("+v.getLengthInBits()+">"+8*K+")";for(v.getLengthInBits()+4<=8*K&&v.put(0,4);v.getLengthInBits()%8!=0;)v.putBit(!1);for(;!(v.getLengthInBits()>=8*K||(v.put(236,8),v.getLengthInBits()>=8*K));)v.put(17,8);return function(W,Q){for(var V=0,se=0,pe=0,he=new Array(Q.length),ne=new Array(Q.length),re=0;re<Q.length;re+=1){var be=Q[re].dataCount,De=Q[re].totalCount-be;se=Math.max(se,be),pe=Math.max(pe,De),he[re]=new Array(be);for(var ae=0;ae<he[re].length;ae+=1)he[re][ae]=255&W.getBuffer()[ae+V];V+=be;var ve=$.getErrorCorrectPolynomial(De),de=D(he[re],ve.getLength()-1).mod(ve);for(ne[re]=new Array(ve.getLength()-1),ae=0;ae<ne[re].length;ae+=1){var ge=ae+de.getLength()-ne[re].length;ne[re][ae]=ge>=0?de.getAt(ge):0}}var Ne=0;for(ae=0;ae<Q.length;ae+=1)Ne+=Q[ae].totalCount;var Ft=new Array(Ne),Se=0;for(ae=0;ae<se;ae+=1)for(re=0;re<Q.length;re+=1)ae<he[re].length&&(Ft[Se]=he[re][ae],Se+=1);for(ae=0;ae<pe;ae+=1)for(re=0;re<Q.length;re+=1)ae<ne[re].length&&(Ft[Se]=ne[re][ae],Se+=1);return Ft}(v,b)};H.addData=function(P,p){var m=null;switch(p=p||"Byte"){case"Numeric":m=S(P);break;case"Alphanumeric":m=F(P);break;case"Byte":m=j(P);break;case"Kanji":m=O(P);break;default:throw"mode:"+p}U.push(m),N=null},H.isDark=function(P,p){if(P<0||T<=P||p<0||T<=p)throw P+","+p;return E[P][p]},H.getModuleCount=function(){return T},H.make=function(){if(x<1){for(var P=1;P<40;P++){for(var p=_.getRSBlocks(P,w),m=A(),b=0;b<U.length;b++){var v=U[b];m.put(v.getMode(),4),m.put(v.getLength(),$.getLengthInBits(v.getMode(),P)),v.write(m)}var L=0;for(b=0;b<p.length;b++)L+=p[b].dataCount;if(m.getLengthInBits()<=8*L)break}x=P}G(!1,function(){for(var k=0,K=0,W=0;W<8;W+=1){G(!0,W);var Q=$.getLostPoint(H);(W==0||k>Q)&&(k=Q,K=W)}return K}())},H.createTableTag=function(P,p){P=P||2;var m="";m+='<table style="',m+=" border-width: 0px; border-style: none;",m+=" border-collapse: collapse;",m+=" padding: 0px; margin: "+(p=p===void 0?4*P:p)+"px;",m+='">',m+="<tbody>";for(var b=0;b<H.getModuleCount();b+=1){m+="<tr>";for(var v=0;v<H.getModuleCount();v+=1)m+='<td style="',m+=" border-width: 0px; border-style: none;",m+=" border-collapse: collapse;",m+=" padding: 0px; margin: 0px;",m+=" width: "+P+"px;",m+=" height: "+P+"px;",m+=" background-color: ",m+=H.isDark(b,v)?"#000000":"#ffffff",m+=";",m+='"/>';m+="</tr>"}return(m+="</tbody>")+"</table>"},H.createSvgTag=function(P,p,m,b){var v={};typeof arguments[0]=="object"&&(P=(v=arguments[0]).cellSize,p=v.margin,m=v.alt,b=v.title),P=P||2,p=p===void 0?4*P:p,(m=typeof m=="string"?{text:m}:m||{}).text=m.text||null,m.id=m.text?m.id||"qrcode-description":null,(b=typeof b=="string"?{text:b}:b||{}).text=b.text||null,b.id=b.text?b.id||"qrcode-title":null;var L,k,K,W,Q=H.getModuleCount()*P+2*p,V="";for(W="l"+P+",0 0,"+P+" -"+P+",0 0,-"+P+"z ",V+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',V+=v.scalable?"":' width="'+Q+'px" height="'+Q+'px"',V+=' viewBox="0 0 '+Q+" "+Q+'" ',V+=' preserveAspectRatio="xMinYMin meet"',V+=b.text||m.text?' role="img" aria-labelledby="'+ce([b.id,m.id].join(" ").trim())+'"':"",V+=">",V+=b.text?'<title id="'+ce(b.id)+'">'+ce(b.text)+"</title>":"",V+=m.text?'<description id="'+ce(m.id)+'">'+ce(m.text)+"</description>":"",V+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',V+='<path d="',k=0;k<H.getModuleCount();k+=1)for(K=k*P+p,L=0;L<H.getModuleCount();L+=1)H.isDark(k,L)&&(V+="M"+(L*P+p)+","+K+W);return(V+='" stroke="transparent" fill="black"/>')+"</svg>"},H.createDataURL=function(P,p){P=P||2,p=p===void 0?4*P:p;var m=H.getModuleCount()*P+2*p,b=p,v=m-p;return q(m,m,function(L,k){if(b<=L&&L<v&&b<=k&&k<v){var K=Math.floor((L-b)/P),W=Math.floor((k-b)/P);return H.isDark(W,K)?0:1}return 1})},H.createImgTag=function(P,p,m){P=P||2,p=p===void 0?4*P:p;var b=H.getModuleCount()*P+2*p,v="";return v+="<img",v+=' src="',v+=H.createDataURL(P,p),v+='"',v+=' width="',v+=b,v+='"',v+=' height="',v+=b,v+='"',m&&(v+=' alt="',v+=ce(m),v+='"'),v+"/>"};var ce=function(P){for(var p="",m=0;m<P.length;m+=1){var b=P.charAt(m);switch(b){case"<":p+="&lt;";break;case">":p+="&gt;";break;case"&":p+="&amp;";break;case'"':p+="&quot;";break;default:p+=b}}return p};return H.createASCII=function(P,p){if((P=P||1)<2)return function(he){he=he===void 0?2:he;var ne,re,be,De,ae,ve=1*H.getModuleCount()+2*he,de=he,ge=ve-he,Ne={"":""," ":""," ":"","  ":" "},Ft={"":""," ":""," ":" ","  ":" "},Se="";for(ne=0;ne<ve;ne+=2){for(be=Math.floor((ne-de)/1),De=Math.floor((ne+1-de)/1),re=0;re<ve;re+=1)ae="",de<=re&&re<ge&&de<=ne&&ne<ge&&H.isDark(be,Math.floor((re-de)/1))&&(ae=" "),de<=re&&re<ge&&de<=ne+1&&ne+1<ge&&H.isDark(De,Math.floor((re-de)/1))?ae+=" ":ae+="",Se+=he<1&&ne+1>=ge?Ft[ae]:Ne[ae];Se+=`
`}return ve%2&&he>0?Se.substring(0,Se.length-ve-1)+Array(ve+1).join(""):Se.substring(0,Se.length-1)}(p);P-=1,p=p===void 0?2*P:p;var m,b,v,L,k=H.getModuleCount()*P+2*p,K=p,W=k-p,Q=Array(P+1).join(""),V=Array(P+1).join("  "),se="",pe="";for(m=0;m<k;m+=1){for(v=Math.floor((m-K)/P),pe="",b=0;b<k;b+=1)L=1,K<=b&&b<W&&K<=m&&m<W&&H.isDark(v,Math.floor((b-K)/P))&&(L=0),pe+=L?Q:V;for(v=0;v<P;v+=1)se+=pe+`
`}return se.substring(0,se.length-1)},H.renderTo2dContext=function(P,p){p=p||2;for(var m=H.getModuleCount(),b=0;b<m;b++)for(var v=0;v<m;v++)P.fillStyle=H.isDark(b,v)?"black":"white",P.fillRect(b*p,v*p,p,p)},H};l.stringToBytes=(l.stringToBytesFuncs={default:function(C){for(var B=[],x=0;x<C.length;x+=1){var w=C.charCodeAt(x);B.push(255&w)}return B}}).default,l.createStringToBytes=function(C,B){var x=function(){for(var E=z(C),T=function(){var J=E.read();if(J==-1)throw"eof";return J},N=0,U={};;){var H=E.read();if(H==-1)break;var G=T(),Y=T()<<8|T();U[String.fromCharCode(H<<8|G)]=Y,N+=1}if(N!=B)throw N+" != "+B;return U}(),w=63;return function(E){for(var T=[],N=0;N<E.length;N+=1){var U=E.charCodeAt(N);if(U<128)T.push(U);else{var H=x[E.charAt(N)];typeof H=="number"?(255&H)==H?T.push(H):(T.push(H>>>8),T.push(255&H)):T.push(w)}}return T}};var h,d,y,f,g,I={L:1,M:0,Q:3,H:2},$=(h=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],d=1335,y=7973,g=function(C){for(var B=0;C!=0;)B+=1,C>>>=1;return B},(f={}).getBCHTypeInfo=function(C){for(var B=C<<10;g(B)-g(d)>=0;)B^=d<<g(B)-g(d);return 21522^(C<<10|B)},f.getBCHTypeNumber=function(C){for(var B=C<<12;g(B)-g(y)>=0;)B^=y<<g(B)-g(y);return C<<12|B},f.getPatternPosition=function(C){return h[C-1]},f.getMaskFunction=function(C){switch(C){case 0:return function(B,x){return(B+x)%2==0};case 1:return function(B,x){return B%2==0};case 2:return function(B,x){return x%3==0};case 3:return function(B,x){return(B+x)%3==0};case 4:return function(B,x){return(Math.floor(B/2)+Math.floor(x/3))%2==0};case 5:return function(B,x){return B*x%2+B*x%3==0};case 6:return function(B,x){return(B*x%2+B*x%3)%2==0};case 7:return function(B,x){return(B*x%3+(B+x)%2)%2==0};default:throw"bad maskPattern:"+C}},f.getErrorCorrectPolynomial=function(C){for(var B=D([1],0),x=0;x<C;x+=1)B=B.multiply(D([1,R.gexp(x)],0));return B},f.getLengthInBits=function(C,B){if(1<=B&&B<10)switch(C){case 1:return 10;case 2:return 9;case 4:case 8:return 8;default:throw"mode:"+C}else if(B<27)switch(C){case 1:return 12;case 2:return 11;case 4:return 16;case 8:return 10;default:throw"mode:"+C}else{if(!(B<41))throw"type:"+B;switch(C){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw"mode:"+C}}},f.getLostPoint=function(C){for(var B=C.getModuleCount(),x=0,w=0;w<B;w+=1)for(var E=0;E<B;E+=1){for(var T=0,N=C.isDark(w,E),U=-1;U<=1;U+=1)if(!(w+U<0||B<=w+U))for(var H=-1;H<=1;H+=1)E+H<0||B<=E+H||U==0&&H==0||N==C.isDark(w+U,E+H)&&(T+=1);T>5&&(x+=3+T-5)}for(w=0;w<B-1;w+=1)for(E=0;E<B-1;E+=1){var G=0;C.isDark(w,E)&&(G+=1),C.isDark(w+1,E)&&(G+=1),C.isDark(w,E+1)&&(G+=1),C.isDark(w+1,E+1)&&(G+=1),G!=0&&G!=4||(x+=3)}for(w=0;w<B;w+=1)for(E=0;E<B-6;E+=1)C.isDark(w,E)&&!C.isDark(w,E+1)&&C.isDark(w,E+2)&&C.isDark(w,E+3)&&C.isDark(w,E+4)&&!C.isDark(w,E+5)&&C.isDark(w,E+6)&&(x+=40);for(E=0;E<B;E+=1)for(w=0;w<B-6;w+=1)C.isDark(w,E)&&!C.isDark(w+1,E)&&C.isDark(w+2,E)&&C.isDark(w+3,E)&&C.isDark(w+4,E)&&!C.isDark(w+5,E)&&C.isDark(w+6,E)&&(x+=40);var Y=0;for(E=0;E<B;E+=1)for(w=0;w<B;w+=1)C.isDark(w,E)&&(Y+=1);return x+Math.abs(100*Y/B/B-50)/5*10},f),R=function(){for(var C=new Array(256),B=new Array(256),x=0;x<8;x+=1)C[x]=1<<x;for(x=8;x<256;x+=1)C[x]=C[x-4]^C[x-5]^C[x-6]^C[x-8];for(x=0;x<255;x+=1)B[C[x]]=x;return{glog:function(w){if(w<1)throw"glog("+w+")";return B[w]},gexp:function(w){for(;w<0;)w+=255;for(;w>=256;)w-=255;return C[w]}}}();function D(C,B){if(C.length===void 0)throw C.length+"/"+B;var x=function(){for(var E=0;E<C.length&&C[E]==0;)E+=1;for(var T=new Array(C.length-E+B),N=0;N<C.length-E;N+=1)T[N]=C[N+E];return T}(),w={getAt:function(E){return x[E]},getLength:function(){return x.length},multiply:function(E){for(var T=new Array(w.getLength()+E.getLength()-1),N=0;N<w.getLength();N+=1)for(var U=0;U<E.getLength();U+=1)T[N+U]^=R.gexp(R.glog(w.getAt(N))+R.glog(E.getAt(U)));return D(T,0)},mod:function(E){if(w.getLength()-E.getLength()<0)return w;for(var T=R.glog(w.getAt(0))-R.glog(E.getAt(0)),N=new Array(w.getLength()),U=0;U<w.getLength();U+=1)N[U]=w.getAt(U);for(U=0;U<E.getLength();U+=1)N[U]^=R.gexp(R.glog(E.getAt(U))+T);return D(N,0).mod(E)}};return w}var _=function(){var C=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],B=function(w,E){var T={};return T.totalCount=w,T.dataCount=E,T},x={getRSBlocks:function(w,E){var T=function(ie,ue){switch(ue){case I.L:return C[4*(ie-1)+0];case I.M:return C[4*(ie-1)+1];case I.Q:return C[4*(ie-1)+2];case I.H:return C[4*(ie-1)+3];default:return}}(w,E);if(T===void 0)throw"bad rs block @ typeNumber:"+w+"/errorCorrectionLevel:"+E;for(var N=T.length/3,U=[],H=0;H<N;H+=1)for(var G=T[3*H+0],Y=T[3*H+1],J=T[3*H+2],X=0;X<G;X+=1)U.push(B(Y,J));return U}};return x}(),A=function(){var C=[],B=0,x={getBuffer:function(){return C},getAt:function(w){var E=Math.floor(w/8);return(C[E]>>>7-w%8&1)==1},put:function(w,E){for(var T=0;T<E;T+=1)x.putBit((w>>>E-T-1&1)==1)},getLengthInBits:function(){return B},putBit:function(w){var E=Math.floor(B/8);C.length<=E&&C.push(0),w&&(C[E]|=128>>>B%8),B+=1}};return x},S=function(C){var B=C,x={getMode:function(){return 1},getLength:function(T){return B.length},write:function(T){for(var N=B,U=0;U+2<N.length;)T.put(w(N.substring(U,U+3)),10),U+=3;U<N.length&&(N.length-U==1?T.put(w(N.substring(U,U+1)),4):N.length-U==2&&T.put(w(N.substring(U,U+2)),7))}},w=function(T){for(var N=0,U=0;U<T.length;U+=1)N=10*N+E(T.charAt(U));return N},E=function(T){if("0"<=T&&T<="9")return T.charCodeAt(0)-48;throw"illegal char :"+T};return x},F=function(C){var B=C,x={getMode:function(){return 2},getLength:function(E){return B.length},write:function(E){for(var T=B,N=0;N+1<T.length;)E.put(45*w(T.charAt(N))+w(T.charAt(N+1)),11),N+=2;N<T.length&&E.put(w(T.charAt(N)),6)}},w=function(E){if("0"<=E&&E<="9")return E.charCodeAt(0)-48;if("A"<=E&&E<="Z")return E.charCodeAt(0)-65+10;switch(E){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+E}};return x},j=function(C){var B=l.stringToBytes(C);return{getMode:function(){return 4},getLength:function(x){return B.length},write:function(x){for(var w=0;w<B.length;w+=1)x.put(B[w],8)}}},O=function(C){var B=l.stringToBytesFuncs.SJIS;if(!B)throw"sjis not supported.";(function(E,T){var N=B("");if(N.length!=2||(N[0]<<8|N[1])!=38726)throw"sjis not supported."})();var x=B(C),w={getMode:function(){return 8},getLength:function(E){return~~(x.length/2)},write:function(E){for(var T=x,N=0;N+1<T.length;){var U=(255&T[N])<<8|255&T[N+1];if(33088<=U&&U<=40956)U-=33088;else{if(!(57408<=U&&U<=60351))throw"illegal char at "+(N+1)+"/"+U;U-=49472}U=192*(U>>>8&255)+(255&U),E.put(U,13),N+=2}if(N<T.length)throw"illegal char at "+(N+1)}};return w},M=function(){var C=[],B={writeByte:function(x){C.push(255&x)},writeShort:function(x){B.writeByte(x),B.writeByte(x>>>8)},writeBytes:function(x,w,E){w=w||0,E=E||x.length;for(var T=0;T<E;T+=1)B.writeByte(x[T+w])},writeString:function(x){for(var w=0;w<x.length;w+=1)B.writeByte(x.charCodeAt(w))},toByteArray:function(){return C},toString:function(){var x="";x+="[";for(var w=0;w<C.length;w+=1)w>0&&(x+=","),x+=C[w];return x+"]"}};return B},z=function(C){var B=C,x=0,w=0,E=0,T={read:function(){for(;E<8;){if(x>=B.length){if(E==0)return-1;throw"unexpected end of file./"+E}var U=B.charAt(x);if(x+=1,U=="=")return E=0,-1;U.match(/^\s$/)||(w=w<<6|N(U.charCodeAt(0)),E+=6)}var H=w>>>E-8&255;return E-=8,H}},N=function(U){if(65<=U&&U<=90)return U-65;if(97<=U&&U<=122)return U-97+26;if(48<=U&&U<=57)return U-48+52;if(U==43)return 62;if(U==47)return 63;throw"c:"+U};return T},q=function(C,B,x){for(var w=function(Y,J){var X=Y,ie=J,ue=new Array(Y*J),fe={setPixel:function(P,p,m){ue[p*X+P]=m},write:function(P){P.writeString("GIF87a"),P.writeShort(X),P.writeShort(ie),P.writeByte(128),P.writeByte(0),P.writeByte(0),P.writeByte(0),P.writeByte(0),P.writeByte(0),P.writeByte(255),P.writeByte(255),P.writeByte(255),P.writeString(","),P.writeShort(0),P.writeShort(0),P.writeShort(X),P.writeShort(ie),P.writeByte(0);var p=le(2);P.writeByte(2);for(var m=0;p.length-m>255;)P.writeByte(255),P.writeBytes(p,m,255),m+=255;P.writeByte(p.length-m),P.writeBytes(p,m,p.length-m),P.writeByte(0),P.writeString(";")}},le=function(P){for(var p=1<<P,m=1+(1<<P),b=P+1,v=ce(),L=0;L<p;L+=1)v.add(String.fromCharCode(L));v.add(String.fromCharCode(p)),v.add(String.fromCharCode(m));var k,K,W,Q=M(),V=(k=Q,K=0,W=0,{write:function(ne,re){if(ne>>>re)throw"length over";for(;K+re>=8;)k.writeByte(255&(ne<<K|W)),re-=8-K,ne>>>=8-K,W=0,K=0;W|=ne<<K,K+=re},flush:function(){K>0&&k.writeByte(W)}});V.write(p,b);var se=0,pe=String.fromCharCode(ue[se]);for(se+=1;se<ue.length;){var he=String.fromCharCode(ue[se]);se+=1,v.contains(pe+he)?pe+=he:(V.write(v.indexOf(pe),b),v.size()<4095&&(v.size()==1<<b&&(b+=1),v.add(pe+he)),pe=he)}return V.write(v.indexOf(pe),b),V.write(m,b),V.flush(),Q.toByteArray()},ce=function(){var P={},p=0,m={add:function(b){if(m.contains(b))throw"dup key:"+b;P[b]=p,p+=1},size:function(){return p},indexOf:function(b){return P[b]},contains:function(b){return P[b]!==void 0}};return m};return fe}(C,B),E=0;E<B;E+=1)for(var T=0;T<C;T+=1)w.setPixel(T,E,x(T,E));var N=M();w.write(N);for(var U=function(){var Y=0,J=0,X=0,ie="",ue={},fe=function(ce){ie+=String.fromCharCode(le(63&ce))},le=function(ce){if(!(ce<0)){if(ce<26)return 65+ce;if(ce<52)return ce-26+97;if(ce<62)return ce-52+48;if(ce==62)return 43;if(ce==63)return 47}throw"n:"+ce};return ue.writeByte=function(ce){for(Y=Y<<8|255&ce,J+=8,X+=1;J>=6;)fe(Y>>>J-6),J-=6},ue.flush=function(){if(J>0&&(fe(Y<<6-J),Y=0,J=0),X%3!=0)for(var ce=3-X%3,P=0;P<ce;P+=1)ie+="="},ue.toString=function(){return ie},ue}(),H=N.toByteArray(),G=0;G<H.length;G+=1)U.writeByte(H[G]);return U.flush(),"data:image/gif;base64,"+U};return l}();u.stringToBytesFuncs["UTF-8"]=function(l){return function(h){for(var d=[],y=0;y<h.length;y++){var f=h.charCodeAt(y);f<128?d.push(f):f<2048?d.push(192|f>>6,128|63&f):f<55296||f>=57344?d.push(224|f>>12,128|f>>6&63,128|63&f):(y++,f=65536+((1023&f)<<10|1023&h.charCodeAt(y)),d.push(240|f>>18,128|f>>12&63,128|f>>6&63,128|63&f))}return d}(l)},(c=typeof(a=function(){return u})=="function"?a.apply(o,[]):a)===void 0||(s.exports=c)},676:(s,o,a)=>{a.d(o,{default:()=>ce});const c="Numeric",u="Alphanumeric",l="Byte";var h=function(){return h=Object.assign||function(P){for(var p,m=1,b=arguments.length;m<b;m++)for(var v in p=arguments[m])Object.prototype.hasOwnProperty.call(p,v)&&(P[v]=p[v]);return P},h.apply(this,arguments)},d=function(){for(var P=0,p=0,m=arguments.length;p<m;p++)P+=arguments[p].length;var b=Array(P),v=0;for(p=0;p<m;p++)for(var L=arguments[p],k=0,K=L.length;k<K;k++,v++)b[v]=L[k];return b},y=function(P){return!!P&&typeof P=="object"&&!Array.isArray(P)};function f(P){for(var p=[],m=1;m<arguments.length;m++)p[m-1]=arguments[m];if(!p.length)return P;var b=p.shift();return b!==void 0&&y(P)&&y(b)?(P=h({},P),Object.keys(b).forEach(function(v){var L=P[v],k=b[v];Array.isArray(L)&&Array.isArray(k)?P[v]=k:y(L)&&y(k)?P[v]=f(Object.assign({},L),k):P[v]=k}),f.apply(void 0,d([P],p))):P}function g(P,p){var m=document.createElement("a");m.download=p,m.href=P,document.body.appendChild(m),m.click(),document.body.removeChild(m)}var I=function(P,p,m,b){return new(m||(m=Promise))(function(v,L){function k(Q){try{W(b.next(Q))}catch(V){L(V)}}function K(Q){try{W(b.throw(Q))}catch(V){L(V)}}function W(Q){var V;Q.done?v(Q.value):(V=Q.value,V instanceof m?V:new m(function(se){se(V)})).then(k,K)}W((b=b.apply(P,[])).next())})},$=function(P,p){var m,b,v,L,k={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return L={next:K(0),throw:K(1),return:K(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function K(W){return function(Q){return function(V){if(m)throw new TypeError("Generator is already executing.");for(;k;)try{if(m=1,b&&(v=2&V[0]?b.return:V[0]?b.throw||((v=b.return)&&v.call(b),0):b.next)&&!(v=v.call(b,V[1])).done)return v;switch(b=0,v&&(V=[2&V[0],v.value]),V[0]){case 0:case 1:v=V;break;case 4:return k.label++,{value:V[1],done:!1};case 5:k.label++,b=V[1],V=[0];continue;case 7:V=k.ops.pop(),k.trys.pop();continue;default:if(!((v=(v=k.trys).length>0&&v[v.length-1])||V[0]!==6&&V[0]!==2)){k=0;continue}if(V[0]===3&&(!v||V[1]>v[0]&&V[1]<v[3])){k.label=V[1];break}if(V[0]===6&&k.label<v[1]){k.label=v[1],v=V;break}if(v&&k.label<v[2]){k.label=v[2],k.ops.push(V);break}v[2]&&k.ops.pop(),k.trys.pop();continue}V=p.call(P,k)}catch(se){V=[6,se],b=0}finally{m=v=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([W,Q])}}};function R(P){return I(this,void 0,void 0,function(){return $(this,function(p){return[2,new Promise(function(m){var b=new XMLHttpRequest;b.onload=function(){var v=new FileReader;v.onloadend=function(){m(v.result)},v.readAsDataURL(b.response)},b.open("GET",P),b.responseType="blob",b.send()})]})})}const D={L:.07,M:.15,Q:.25,H:.3};var _=function(){return _=Object.assign||function(P){for(var p,m=1,b=arguments.length;m<b;m++)for(var v in p=arguments[m])Object.prototype.hasOwnProperty.call(p,v)&&(P[v]=p[v]);return P},_.apply(this,arguments)},A=function(){function P(p){var m=p.svg,b=p.type;this._svg=m,this._type=b}return P.prototype.draw=function(p,m,b,v){var L;switch(this._type){case"dots":L=this._drawDot;break;case"classy":L=this._drawClassy;break;case"classy-rounded":L=this._drawClassyRounded;break;case"rounded":L=this._drawRounded;break;case"extra-rounded":L=this._drawExtraRounded;break;default:L=this._drawSquare}L.call(this,{x:p,y:m,size:b,getNeighbor:v})},P.prototype._rotateFigure=function(p){var m,b=p.x,v=p.y,L=p.size,k=p.rotation,K=k===void 0?0:k,W=b+L/2,Q=v+L/2;(0,p.draw)(),(m=this._element)===null||m===void 0||m.setAttribute("transform","rotate("+180*K/Math.PI+","+W+","+Q+")")},P.prototype._basicDot=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(_(_({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","circle"),m._element.setAttribute("cx",String(v+b/2)),m._element.setAttribute("cy",String(L+b/2)),m._element.setAttribute("r",String(b/2))}}))},P.prototype._basicSquare=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(_(_({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","rect"),m._element.setAttribute("x",String(v)),m._element.setAttribute("y",String(L)),m._element.setAttribute("width",String(b)),m._element.setAttribute("height",String(b))}}))},P.prototype._basicSideRounded=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(_(_({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("d","M "+v+" "+L+"v "+b+"h "+b/2+"a "+b/2+" "+b/2+", 0, 0, 0, 0 "+-b)}}))},P.prototype._basicCornerRounded=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(_(_({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("d","M "+v+" "+L+"v "+b+"h "+b+"v "+-b/2+"a "+b/2+" "+b/2+", 0, 0, 0, "+-b/2+" "+-b/2)}}))},P.prototype._basicCornerExtraRounded=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(_(_({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("d","M "+v+" "+L+"v "+b+"h "+b+"a "+b+" "+b+", 0, 0, 0, "+-b+" "+-b)}}))},P.prototype._basicCornersRounded=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(_(_({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("d","M "+v+" "+L+"v "+b/2+"a "+b/2+" "+b/2+", 0, 0, 0, "+b/2+" "+b/2+"h "+b/2+"v "+-b/2+"a "+b/2+" "+b/2+", 0, 0, 0, "+-b/2+" "+-b/2)}}))},P.prototype._drawDot=function(p){var m=p.x,b=p.y,v=p.size;this._basicDot({x:m,y:b,size:v,rotation:0})},P.prototype._drawSquare=function(p){var m=p.x,b=p.y,v=p.size;this._basicSquare({x:m,y:b,size:v,rotation:0})},P.prototype._drawRounded=function(p){var m=p.x,b=p.y,v=p.size,L=p.getNeighbor,k=L?+L(-1,0):0,K=L?+L(1,0):0,W=L?+L(0,-1):0,Q=L?+L(0,1):0,V=k+K+W+Q;if(V!==0)if(V>2||k&&K||W&&Q)this._basicSquare({x:m,y:b,size:v,rotation:0});else{if(V===2){var se=0;return k&&W?se=Math.PI/2:W&&K?se=Math.PI:K&&Q&&(se=-Math.PI/2),void this._basicCornerRounded({x:m,y:b,size:v,rotation:se})}if(V===1)return se=0,W?se=Math.PI/2:K?se=Math.PI:Q&&(se=-Math.PI/2),void this._basicSideRounded({x:m,y:b,size:v,rotation:se})}else this._basicDot({x:m,y:b,size:v,rotation:0})},P.prototype._drawExtraRounded=function(p){var m=p.x,b=p.y,v=p.size,L=p.getNeighbor,k=L?+L(-1,0):0,K=L?+L(1,0):0,W=L?+L(0,-1):0,Q=L?+L(0,1):0,V=k+K+W+Q;if(V!==0)if(V>2||k&&K||W&&Q)this._basicSquare({x:m,y:b,size:v,rotation:0});else{if(V===2){var se=0;return k&&W?se=Math.PI/2:W&&K?se=Math.PI:K&&Q&&(se=-Math.PI/2),void this._basicCornerExtraRounded({x:m,y:b,size:v,rotation:se})}if(V===1)return se=0,W?se=Math.PI/2:K?se=Math.PI:Q&&(se=-Math.PI/2),void this._basicSideRounded({x:m,y:b,size:v,rotation:se})}else this._basicDot({x:m,y:b,size:v,rotation:0})},P.prototype._drawClassy=function(p){var m=p.x,b=p.y,v=p.size,L=p.getNeighbor,k=L?+L(-1,0):0,K=L?+L(1,0):0,W=L?+L(0,-1):0,Q=L?+L(0,1):0;k+K+W+Q!==0?k||W?K||Q?this._basicSquare({x:m,y:b,size:v,rotation:0}):this._basicCornerRounded({x:m,y:b,size:v,rotation:Math.PI/2}):this._basicCornerRounded({x:m,y:b,size:v,rotation:-Math.PI/2}):this._basicCornersRounded({x:m,y:b,size:v,rotation:Math.PI/2})},P.prototype._drawClassyRounded=function(p){var m=p.x,b=p.y,v=p.size,L=p.getNeighbor,k=L?+L(-1,0):0,K=L?+L(1,0):0,W=L?+L(0,-1):0,Q=L?+L(0,1):0;k+K+W+Q!==0?k||W?K||Q?this._basicSquare({x:m,y:b,size:v,rotation:0}):this._basicCornerExtraRounded({x:m,y:b,size:v,rotation:Math.PI/2}):this._basicCornerExtraRounded({x:m,y:b,size:v,rotation:-Math.PI/2}):this._basicCornersRounded({x:m,y:b,size:v,rotation:Math.PI/2})},P}();const S=A;var F=function(){return F=Object.assign||function(P){for(var p,m=1,b=arguments.length;m<b;m++)for(var v in p=arguments[m])Object.prototype.hasOwnProperty.call(p,v)&&(P[v]=p[v]);return P},F.apply(this,arguments)},j=function(){function P(p){var m=p.svg,b=p.type;this._svg=m,this._type=b}return P.prototype.draw=function(p,m,b,v){var L;switch(this._type){case"square":L=this._drawSquare;break;case"extra-rounded":L=this._drawExtraRounded;break;default:L=this._drawDot}L.call(this,{x:p,y:m,size:b,rotation:v})},P.prototype._rotateFigure=function(p){var m,b=p.x,v=p.y,L=p.size,k=p.rotation,K=k===void 0?0:k,W=b+L/2,Q=v+L/2;(0,p.draw)(),(m=this._element)===null||m===void 0||m.setAttribute("transform","rotate("+180*K/Math.PI+","+W+","+Q+")")},P.prototype._basicDot=function(p){var m=this,b=p.size,v=p.x,L=p.y,k=b/7;this._rotateFigure(F(F({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("clip-rule","evenodd"),m._element.setAttribute("d","M "+(v+b/2)+" "+L+"a "+b/2+" "+b/2+" 0 1 0 0.1 0zm 0 "+k+"a "+(b/2-k)+" "+(b/2-k)+" 0 1 1 -0.1 0Z")}}))},P.prototype._basicSquare=function(p){var m=this,b=p.size,v=p.x,L=p.y,k=b/7;this._rotateFigure(F(F({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("clip-rule","evenodd"),m._element.setAttribute("d","M "+v+" "+L+"v "+b+"h "+b+"v "+-b+"zM "+(v+k)+" "+(L+k)+"h "+(b-2*k)+"v "+(b-2*k)+"h "+(2*k-b)+"z")}}))},P.prototype._basicExtraRounded=function(p){var m=this,b=p.size,v=p.x,L=p.y,k=b/7;this._rotateFigure(F(F({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","path"),m._element.setAttribute("clip-rule","evenodd"),m._element.setAttribute("d","M "+v+" "+(L+2.5*k)+"v "+2*k+"a "+2.5*k+" "+2.5*k+", 0, 0, 0, "+2.5*k+" "+2.5*k+"h "+2*k+"a "+2.5*k+" "+2.5*k+", 0, 0, 0, "+2.5*k+" "+2.5*-k+"v "+-2*k+"a "+2.5*k+" "+2.5*k+", 0, 0, 0, "+2.5*-k+" "+2.5*-k+"h "+-2*k+"a "+2.5*k+" "+2.5*k+", 0, 0, 0, "+2.5*-k+" "+2.5*k+"M "+(v+2.5*k)+" "+(L+k)+"h "+2*k+"a "+1.5*k+" "+1.5*k+", 0, 0, 1, "+1.5*k+" "+1.5*k+"v "+2*k+"a "+1.5*k+" "+1.5*k+", 0, 0, 1, "+1.5*-k+" "+1.5*k+"h "+-2*k+"a "+1.5*k+" "+1.5*k+", 0, 0, 1, "+1.5*-k+" "+1.5*-k+"v "+-2*k+"a "+1.5*k+" "+1.5*k+", 0, 0, 1, "+1.5*k+" "+1.5*-k)}}))},P.prototype._drawDot=function(p){var m=p.x,b=p.y,v=p.size,L=p.rotation;this._basicDot({x:m,y:b,size:v,rotation:L})},P.prototype._drawSquare=function(p){var m=p.x,b=p.y,v=p.size,L=p.rotation;this._basicSquare({x:m,y:b,size:v,rotation:L})},P.prototype._drawExtraRounded=function(p){var m=p.x,b=p.y,v=p.size,L=p.rotation;this._basicExtraRounded({x:m,y:b,size:v,rotation:L})},P}();const O=j;var M=function(){return M=Object.assign||function(P){for(var p,m=1,b=arguments.length;m<b;m++)for(var v in p=arguments[m])Object.prototype.hasOwnProperty.call(p,v)&&(P[v]=p[v]);return P},M.apply(this,arguments)},z=function(){function P(p){var m=p.svg,b=p.type;this._svg=m,this._type=b}return P.prototype.draw=function(p,m,b,v){(this._type==="square"?this._drawSquare:this._drawDot).call(this,{x:p,y:m,size:b,rotation:v})},P.prototype._rotateFigure=function(p){var m,b=p.x,v=p.y,L=p.size,k=p.rotation,K=k===void 0?0:k,W=b+L/2,Q=v+L/2;(0,p.draw)(),(m=this._element)===null||m===void 0||m.setAttribute("transform","rotate("+180*K/Math.PI+","+W+","+Q+")")},P.prototype._basicDot=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(M(M({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","circle"),m._element.setAttribute("cx",String(v+b/2)),m._element.setAttribute("cy",String(L+b/2)),m._element.setAttribute("r",String(b/2))}}))},P.prototype._basicSquare=function(p){var m=this,b=p.size,v=p.x,L=p.y;this._rotateFigure(M(M({},p),{draw:function(){m._element=document.createElementNS("http://www.w3.org/2000/svg","rect"),m._element.setAttribute("x",String(v)),m._element.setAttribute("y",String(L)),m._element.setAttribute("width",String(b)),m._element.setAttribute("height",String(b))}}))},P.prototype._drawDot=function(p){var m=p.x,b=p.y,v=p.size,L=p.rotation;this._basicDot({x:m,y:b,size:v,rotation:L})},P.prototype._drawSquare=function(p){var m=p.x,b=p.y,v=p.size,L=p.rotation;this._basicSquare({x:m,y:b,size:v,rotation:L})},P}();const q=z,C="circle";var B=function(P,p,m,b){return new(m||(m=Promise))(function(v,L){function k(Q){try{W(b.next(Q))}catch(V){L(V)}}function K(Q){try{W(b.throw(Q))}catch(V){L(V)}}function W(Q){var V;Q.done?v(Q.value):(V=Q.value,V instanceof m?V:new m(function(se){se(V)})).then(k,K)}W((b=b.apply(P,[])).next())})},x=function(P,p){var m,b,v,L,k={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return L={next:K(0),throw:K(1),return:K(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function K(W){return function(Q){return function(V){if(m)throw new TypeError("Generator is already executing.");for(;k;)try{if(m=1,b&&(v=2&V[0]?b.return:V[0]?b.throw||((v=b.return)&&v.call(b),0):b.next)&&!(v=v.call(b,V[1])).done)return v;switch(b=0,v&&(V=[2&V[0],v.value]),V[0]){case 0:case 1:v=V;break;case 4:return k.label++,{value:V[1],done:!1};case 5:k.label++,b=V[1],V=[0];continue;case 7:V=k.ops.pop(),k.trys.pop();continue;default:if(!((v=(v=k.trys).length>0&&v[v.length-1])||V[0]!==6&&V[0]!==2)){k=0;continue}if(V[0]===3&&(!v||V[1]>v[0]&&V[1]<v[3])){k.label=V[1];break}if(V[0]===6&&k.label<v[1]){k.label=v[1],v=V;break}if(v&&k.label<v[2]){k.label=v[2],k.ops.push(V);break}v[2]&&k.ops.pop(),k.trys.pop();continue}V=p.call(P,k)}catch(se){V=[6,se],b=0}finally{m=v=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([W,Q])}}},w=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],E=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];const T=function(){function P(p){this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("width",String(p.width)),this._element.setAttribute("height",String(p.height)),this._defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this._element.appendChild(this._defs),this._instanceId=P.instanceCount++,this._options=p}return Object.defineProperty(P.prototype,"width",{get:function(){return this._options.width},enumerable:!1,configurable:!0}),Object.defineProperty(P.prototype,"height",{get:function(){return this._options.height},enumerable:!1,configurable:!0}),P.prototype.getElement=function(){return this._element},P.prototype.drawQR=function(p){return B(this,void 0,void 0,function(){var m,b,v,L,k,K,W,Q,V,se,pe=this;return x(this,function(he){switch(he.label){case 0:return m=p.getModuleCount(),b=Math.min(this._options.width,this._options.height)-2*this._options.margin,v=this._options.shape===C?b/Math.sqrt(2):b,L=v/m,k={hideXDots:0,hideYDots:0,width:0,height:0},this._qr=p,this._options.image?[4,this.loadImage()]:[3,2];case 1:if(he.sent(),!this._image)return[2];K=this._options,W=K.imageOptions,Q=K.qrOptions,V=W.imageSize*D[Q.errorCorrectionLevel],se=Math.floor(V*m*m),k=function(ne){var re=ne.originalHeight,be=ne.originalWidth,De=ne.maxHiddenDots,ae=ne.maxHiddenAxisDots,ve=ne.dotSize,de={x:0,y:0},ge={x:0,y:0};if(re<=0||be<=0||De<=0||ve<=0)return{height:0,width:0,hideYDots:0,hideXDots:0};var Ne=re/be;return de.x=Math.floor(Math.sqrt(De/Ne)),de.x<=0&&(de.x=1),ae&&ae<de.x&&(de.x=ae),de.x%2==0&&de.x--,ge.x=de.x*ve,de.y=1+2*Math.ceil((de.x*Ne-1)/2),ge.y=Math.round(ge.x*Ne),(de.y*de.x>De||ae&&ae<de.y)&&(ae&&ae<de.y?(de.y=ae,de.y%2==0&&de.x--):de.y-=2,ge.y=de.y*ve,de.x=1+2*Math.ceil((de.y/Ne-1)/2),ge.x=Math.round(ge.y/Ne)),{height:ge.y,width:ge.x,hideYDots:de.y,hideXDots:de.x}}({originalWidth:this._image.width,originalHeight:this._image.height,maxHiddenDots:se,maxHiddenAxisDots:m-14,dotSize:L}),he.label=2;case 2:return this.drawBackground(),this.drawDots(function(ne,re){var be,De,ae,ve,de,ge;return!(pe._options.imageOptions.hideBackgroundDots&&ne>=(m-k.hideXDots)/2&&ne<(m+k.hideXDots)/2&&re>=(m-k.hideYDots)/2&&re<(m+k.hideYDots)/2||!((be=w[ne])===null||be===void 0)&&be[re]||!((De=w[ne-m+7])===null||De===void 0)&&De[re]||!((ae=w[ne])===null||ae===void 0)&&ae[re-m+7]||!((ve=E[ne])===null||ve===void 0)&&ve[re]||!((de=E[ne-m+7])===null||de===void 0)&&de[re]||!((ge=E[ne])===null||ge===void 0)&&ge[re-m+7])}),this.drawCorners(),this._options.image?[4,this.drawImage({width:k.width,height:k.height,count:m,dotSize:L})]:[3,4];case 3:he.sent(),he.label=4;case 4:return[2]}})})},P.prototype.drawBackground=function(){var p,m,b,v=this._element,L=this._options;if(v){var k=(p=L.backgroundOptions)===null||p===void 0?void 0:p.gradient,K=(m=L.backgroundOptions)===null||m===void 0?void 0:m.color;if((k||K)&&this._createColor({options:k,color:K,additionalRotation:0,x:0,y:0,height:L.height,width:L.width,name:"background-color"}),(b=L.backgroundOptions)===null||b===void 0?void 0:b.round){var W=Math.min(L.width,L.height),Q=document.createElementNS("http://www.w3.org/2000/svg","rect");this._backgroundClipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._backgroundClipPath.setAttribute("id","clip-path-background-color"),this._defs.appendChild(this._backgroundClipPath),Q.setAttribute("x",String((L.width-W)/2)),Q.setAttribute("y",String((L.height-W)/2)),Q.setAttribute("width",String(W)),Q.setAttribute("height",String(W)),Q.setAttribute("rx",String(W/2*L.backgroundOptions.round)),this._backgroundClipPath.appendChild(Q)}}},P.prototype.drawDots=function(p){var m,b,v=this;if(!this._qr)throw"QR code is not defined";var L=this._options,k=this._qr.getModuleCount();if(k>L.width||k>L.height)throw"The canvas is too small.";var K=Math.min(L.width,L.height)-2*L.margin,W=(L.shape===C?K/Math.sqrt(2):K)/k,Q=(L.width-k*W)/2,V=(L.height-k*W)/2,se=new S({svg:this._element,type:L.dotsOptions.type});this._dotsClipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._dotsClipPath.setAttribute("id","clip-path-dot-color-"+this._instanceId),this._defs.appendChild(this._dotsClipPath),this._createColor({options:(m=L.dotsOptions)===null||m===void 0?void 0:m.gradient,color:L.dotsOptions.color,additionalRotation:0,x:0,y:0,height:L.height,width:L.width,name:"dot-color-"+this._instanceId});for(var pe=function(Se){for(var Sn=function(We){return p&&!p(Se,We)?"continue":!((b=he._qr)===null||b===void 0)&&b.isDark(Se,We)?(se.draw(Q+Se*W,V+We*W,W,function(It,Et){return!(Se+It<0||We+Et<0||Se+It>=k||We+Et>=k)&&!(p&&!p(Se+It,We+Et))&&!!v._qr&&v._qr.isDark(Se+It,We+Et)}),void(se._element&&he._dotsClipPath&&he._dotsClipPath.appendChild(se._element))):"continue"},Lt=0;Lt<k;Lt++)Sn(Lt)},he=this,ne=0;ne<k;ne++)pe(ne);if(L.shape===C){var re=Math.floor((K/W-k)/2),be=k+2*re,De=Q-re*W,ae=V-re*W,ve=[],de=Math.floor(be/2);for(ne=0;ne<be;ne++){ve[ne]=[];for(var ge=0;ge<be;ge++)ne>=re-1&&ne<=be-re&&ge>=re-1&&ge<=be-re||Math.sqrt((ne-de)*(ne-de)+(ge-de)*(ge-de))>de?ve[ne][ge]=0:ve[ne][ge]=this._qr.isDark(ge-2*re<0?ge:ge>=k?ge-2*re:ge-re,ne-2*re<0?ne:ne>=k?ne-2*re:ne-re)?1:0}var Ne=function(Se){for(var Sn=function(We){if(!ve[Se][We])return"continue";se.draw(De+Se*W,ae+We*W,W,function(It,Et){var Mt;return!!(!((Mt=ve[Se+It])===null||Mt===void 0)&&Mt[We+Et])}),se._element&&Ft._dotsClipPath&&Ft._dotsClipPath.appendChild(se._element)},Lt=0;Lt<be;Lt++)Sn(Lt)},Ft=this;for(ne=0;ne<be;ne++)Ne(ne)}},P.prototype.drawCorners=function(){var p=this;if(!this._qr)throw"QR code is not defined";var m=this._element,b=this._options;if(!m)throw"Element code is not defined";var v=this._qr.getModuleCount(),L=Math.min(b.width,b.height)-2*b.margin,k=(b.shape===C?L/Math.sqrt(2):L)/v,K=7*k,W=3*k,Q=(b.width-v*k)/2,V=(b.height-v*k)/2;[[0,0,0],[1,0,Math.PI/2],[0,1,-Math.PI/2]].forEach(function(se){var pe,he,ne,re,be,De,ae,ve,de,ge,Ne,Ft,Se=se[0],Sn=se[1],Lt=se[2],We=Q+Se*k*(v-7),It=V+Sn*k*(v-7),Et=p._dotsClipPath,Mt=p._dotsClipPath;if((!((pe=b.cornersSquareOptions)===null||pe===void 0)&&pe.gradient||!((he=b.cornersSquareOptions)===null||he===void 0)&&he.color)&&((Et=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id","clip-path-corners-square-color-"+Se+"-"+Sn),p._defs.appendChild(Et),p._cornersSquareClipPath=p._cornersDotClipPath=Mt=Et,p._createColor({options:(ne=b.cornersSquareOptions)===null||ne===void 0?void 0:ne.gradient,color:(re=b.cornersSquareOptions)===null||re===void 0?void 0:re.color,additionalRotation:Lt,x:We,y:It,height:K,width:K,name:"corners-square-color-"+Se+"-"+Sn})),(be=b.cornersSquareOptions)===null||be===void 0?void 0:be.type){var au=new O({svg:p._element,type:b.cornersSquareOptions.type});au.draw(We,It,K,Lt),au._element&&Et&&Et.appendChild(au._element)}else for(var vr=new S({svg:p._element,type:b.dotsOptions.type}),CO=function(An){for(var uu=function(_r){if(!(!((De=w[An])===null||De===void 0)&&De[_r]))return"continue";vr.draw(We+An*k,It+_r*k,k,function(lu,hu){var Sr;return!!(!((Sr=w[An+lu])===null||Sr===void 0)&&Sr[_r+hu])}),vr._element&&Et&&Et.appendChild(vr._element)},xr=0;xr<w[An].length;xr++)uu(xr)},Er=0;Er<w.length;Er++)CO(Er);if((!((ae=b.cornersDotOptions)===null||ae===void 0)&&ae.gradient||!((ve=b.cornersDotOptions)===null||ve===void 0)&&ve.color)&&((Mt=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id","clip-path-corners-dot-color-"+Se+"-"+Sn),p._defs.appendChild(Mt),p._cornersDotClipPath=Mt,p._createColor({options:(de=b.cornersDotOptions)===null||de===void 0?void 0:de.gradient,color:(ge=b.cornersDotOptions)===null||ge===void 0?void 0:ge.color,additionalRotation:Lt,x:We+2*k,y:It+2*k,height:W,width:W,name:"corners-dot-color-"+Se+"-"+Sn})),(Ne=b.cornersDotOptions)===null||Ne===void 0?void 0:Ne.type){var cu=new q({svg:p._element,type:b.cornersDotOptions.type});cu.draw(We+2*k,It+2*k,W,Lt),cu._element&&Mt&&Mt.appendChild(cu._element)}else{vr=new S({svg:p._element,type:b.dotsOptions.type});var PO=function(An){for(var uu=function(_r){if(!(!((Ft=E[An])===null||Ft===void 0)&&Ft[_r]))return"continue";vr.draw(We+An*k,It+_r*k,k,function(lu,hu){var Sr;return!!(!((Sr=E[An+lu])===null||Sr===void 0)&&Sr[_r+hu])}),vr._element&&Mt&&Mt.appendChild(vr._element)},xr=0;xr<E[An].length;xr++)uu(xr)};for(Er=0;Er<E.length;Er++)PO(Er)}})},P.prototype.loadImage=function(){var p=this;return new Promise(function(m,b){var v=p._options,L=new Image;if(!v.image)return b("Image is not defined");typeof v.imageOptions.crossOrigin=="string"&&(L.crossOrigin=v.imageOptions.crossOrigin),p._image=L,L.onload=function(){m()},L.src=v.image})},P.prototype.drawImage=function(p){var m=p.width,b=p.height,v=p.count,L=p.dotSize;return B(this,void 0,void 0,function(){var k,K,W,Q,V,se,pe,he,ne;return x(this,function(re){switch(re.label){case 0:return k=this._options,K=(k.width-v*L)/2,W=(k.height-v*L)/2,Q=K+k.imageOptions.margin+(v*L-m)/2,V=W+k.imageOptions.margin+(v*L-b)/2,se=m-2*k.imageOptions.margin,pe=b-2*k.imageOptions.margin,(he=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("x",String(Q)),he.setAttribute("y",String(V)),he.setAttribute("width",se+"px"),he.setAttribute("height",pe+"px"),[4,R(k.image||"")];case 1:return ne=re.sent(),he.setAttribute("href",ne||""),this._element.appendChild(he),[2]}})})},P.prototype._createColor=function(p){var m=p.options,b=p.color,v=p.additionalRotation,L=p.x,k=p.y,K=p.height,W=p.width,Q=p.name,V=W>K?W:K,se=document.createElementNS("http://www.w3.org/2000/svg","rect");if(se.setAttribute("x",String(L)),se.setAttribute("y",String(k)),se.setAttribute("height",String(K)),se.setAttribute("width",String(W)),se.setAttribute("clip-path","url('#clip-path-"+Q+"')"),m){var pe;if(m.type==="radial")(pe=document.createElementNS("http://www.w3.org/2000/svg","radialGradient")).setAttribute("id",Q),pe.setAttribute("gradientUnits","userSpaceOnUse"),pe.setAttribute("fx",String(L+W/2)),pe.setAttribute("fy",String(k+K/2)),pe.setAttribute("cx",String(L+W/2)),pe.setAttribute("cy",String(k+K/2)),pe.setAttribute("r",String(V/2));else{var he=((m.rotation||0)+v)%(2*Math.PI),ne=(he+2*Math.PI)%(2*Math.PI),re=L+W/2,be=k+K/2,De=L+W/2,ae=k+K/2;ne>=0&&ne<=.25*Math.PI||ne>1.75*Math.PI&&ne<=2*Math.PI?(re-=W/2,be-=K/2*Math.tan(he),De+=W/2,ae+=K/2*Math.tan(he)):ne>.25*Math.PI&&ne<=.75*Math.PI?(be-=K/2,re-=W/2/Math.tan(he),ae+=K/2,De+=W/2/Math.tan(he)):ne>.75*Math.PI&&ne<=1.25*Math.PI?(re+=W/2,be+=K/2*Math.tan(he),De-=W/2,ae-=K/2*Math.tan(he)):ne>1.25*Math.PI&&ne<=1.75*Math.PI&&(be+=K/2,re+=W/2/Math.tan(he),ae-=K/2,De-=W/2/Math.tan(he)),(pe=document.createElementNS("http://www.w3.org/2000/svg","linearGradient")).setAttribute("id",Q),pe.setAttribute("gradientUnits","userSpaceOnUse"),pe.setAttribute("x1",String(Math.round(re))),pe.setAttribute("y1",String(Math.round(be))),pe.setAttribute("x2",String(Math.round(De))),pe.setAttribute("y2",String(Math.round(ae)))}m.colorStops.forEach(function(ve){var de=ve.offset,ge=ve.color,Ne=document.createElementNS("http://www.w3.org/2000/svg","stop");Ne.setAttribute("offset",100*de+"%"),Ne.setAttribute("stop-color",ge),pe.appendChild(Ne)}),se.setAttribute("fill","url('#"+Q+"')"),this._defs.appendChild(pe)}else b&&se.setAttribute("fill",b);this._element.appendChild(se)},P.instanceCount=0,P}(),N="canvas";for(var U={},H=0;H<=40;H++)U[H]=H;const G={type:N,shape:"square",width:300,height:300,data:"",margin:0,qrOptions:{typeNumber:U[0],mode:void 0,errorCorrectionLevel:"Q"},imageOptions:{hideBackgroundDots:!0,imageSize:.4,crossOrigin:void 0,margin:0},dotsOptions:{type:"square",color:"#000"},backgroundOptions:{round:0,color:"#fff"}};var Y=function(){return Y=Object.assign||function(P){for(var p,m=1,b=arguments.length;m<b;m++)for(var v in p=arguments[m])Object.prototype.hasOwnProperty.call(p,v)&&(P[v]=p[v]);return P},Y.apply(this,arguments)};function J(P){var p=Y({},P);if(!p.colorStops||!p.colorStops.length)throw"Field 'colorStops' is required in gradient";return p.rotation?p.rotation=Number(p.rotation):p.rotation=0,p.colorStops=p.colorStops.map(function(m){return Y(Y({},m),{offset:Number(m.offset)})}),p}function X(P){var p=Y({},P);return p.width=Number(p.width),p.height=Number(p.height),p.margin=Number(p.margin),p.imageOptions=Y(Y({},p.imageOptions),{hideBackgroundDots:!!p.imageOptions.hideBackgroundDots,imageSize:Number(p.imageOptions.imageSize),margin:Number(p.imageOptions.margin)}),p.margin>Math.min(p.width,p.height)&&(p.margin=Math.min(p.width,p.height)),p.dotsOptions=Y({},p.dotsOptions),p.dotsOptions.gradient&&(p.dotsOptions.gradient=J(p.dotsOptions.gradient)),p.cornersSquareOptions&&(p.cornersSquareOptions=Y({},p.cornersSquareOptions),p.cornersSquareOptions.gradient&&(p.cornersSquareOptions.gradient=J(p.cornersSquareOptions.gradient))),p.cornersDotOptions&&(p.cornersDotOptions=Y({},p.cornersDotOptions),p.cornersDotOptions.gradient&&(p.cornersDotOptions.gradient=J(p.cornersDotOptions.gradient))),p.backgroundOptions&&(p.backgroundOptions=Y({},p.backgroundOptions),p.backgroundOptions.gradient&&(p.backgroundOptions.gradient=J(p.backgroundOptions.gradient))),p}var ie=a(192),ue=a.n(ie),fe=function(P,p,m,b){return new(m||(m=Promise))(function(v,L){function k(Q){try{W(b.next(Q))}catch(V){L(V)}}function K(Q){try{W(b.throw(Q))}catch(V){L(V)}}function W(Q){var V;Q.done?v(Q.value):(V=Q.value,V instanceof m?V:new m(function(se){se(V)})).then(k,K)}W((b=b.apply(P,[])).next())})},le=function(P,p){var m,b,v,L,k={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return L={next:K(0),throw:K(1),return:K(2)},typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function K(W){return function(Q){return function(V){if(m)throw new TypeError("Generator is already executing.");for(;k;)try{if(m=1,b&&(v=2&V[0]?b.return:V[0]?b.throw||((v=b.return)&&v.call(b),0):b.next)&&!(v=v.call(b,V[1])).done)return v;switch(b=0,v&&(V=[2&V[0],v.value]),V[0]){case 0:case 1:v=V;break;case 4:return k.label++,{value:V[1],done:!1};case 5:k.label++,b=V[1],V=[0];continue;case 7:V=k.ops.pop(),k.trys.pop();continue;default:if(!((v=(v=k.trys).length>0&&v[v.length-1])||V[0]!==6&&V[0]!==2)){k=0;continue}if(V[0]===3&&(!v||V[1]>v[0]&&V[1]<v[3])){k.label=V[1];break}if(V[0]===6&&k.label<v[1]){k.label=v[1],v=V;break}if(v&&k.label<v[2]){k.label=v[2],k.ops.push(V);break}v[2]&&k.ops.pop(),k.trys.pop();continue}V=p.call(P,k)}catch(se){V=[6,se],b=0}finally{m=v=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([W,Q])}}};const ce=function(){function P(p){this._options=p?X(f(G,p)):G,this.update()}return P._clearContainer=function(p){p&&(p.innerHTML="")},P.prototype._setupSvg=function(){var p=this;if(this._qr){var m=new T(this._options);this._svg=m.getElement(),this._svgDrawingPromise=m.drawQR(this._qr).then(function(){var b;p._svg&&((b=p._extension)===null||b===void 0||b.call(p,m.getElement(),p._options))})}},P.prototype._setupCanvas=function(){var p,m=this;this._qr&&(this._canvas=document.createElement("canvas"),this._canvas.width=this._options.width,this._canvas.height=this._options.height,this._setupSvg(),this._canvasDrawingPromise=(p=this._svgDrawingPromise)===null||p===void 0?void 0:p.then(function(){if(m._svg){var b=m._svg,v=new XMLSerializer().serializeToString(b),L="data:image/svg+xml;base64,"+btoa(v),k=new Image;return new Promise(function(K){k.onload=function(){var W,Q;(Q=(W=m._canvas)===null||W===void 0?void 0:W.getContext("2d"))===null||Q===void 0||Q.drawImage(k,0,0),K()},k.src=L})}}))},P.prototype._getElement=function(p){return p===void 0&&(p="png"),fe(this,void 0,void 0,function(){return le(this,function(m){switch(m.label){case 0:if(!this._qr)throw"QR code is empty";return p.toLowerCase()!=="svg"?[3,2]:(this._svg&&this._svgDrawingPromise||this._setupSvg(),[4,this._svgDrawingPromise]);case 1:return m.sent(),[2,this._svg];case 2:return this._canvas&&this._canvasDrawingPromise||this._setupCanvas(),[4,this._canvasDrawingPromise];case 3:return m.sent(),[2,this._canvas]}})})},P.prototype.update=function(p){P._clearContainer(this._container),this._options=p?X(f(this._options,p)):this._options,this._options.data&&(this._qr=ue()(this._options.qrOptions.typeNumber,this._options.qrOptions.errorCorrectionLevel),this._qr.addData(this._options.data,this._options.qrOptions.mode||function(m){switch(!0){case/^[0-9]*$/.test(m):return c;case/^[0-9A-Z $%*+\-./:]*$/.test(m):return u;default:return l}}(this._options.data)),this._qr.make(),this._options.type===N?this._setupCanvas():this._setupSvg(),this.append(this._container))},P.prototype.append=function(p){if(p){if(typeof p.appendChild!="function")throw"Container should be a single DOM node";this._options.type===N?this._canvas&&p.appendChild(this._canvas):this._svg&&p.appendChild(this._svg),this._container=p}},P.prototype.applyExtension=function(p){if(!p)throw"Extension function should be defined.";this._extension=p,this.update()},P.prototype.deleteExtension=function(){this._extension=void 0,this.update()},P.prototype.getRawData=function(p){return p===void 0&&(p="png"),fe(this,void 0,void 0,function(){var m,b,v;return le(this,function(L){switch(L.label){case 0:if(!this._qr)throw"QR code is empty";return[4,this._getElement(p)];case 1:return(m=L.sent())?p.toLowerCase()==="svg"?(b=new XMLSerializer,v=b.serializeToString(m),[2,new Blob([`<?xml version="1.0" standalone="no"?>\r
`+v],{type:"image/svg+xml"})]):[2,new Promise(function(k){return m.toBlob(k,"image/"+p,1)})]:[2,null]}})})},P.prototype.download=function(p){return fe(this,void 0,void 0,function(){var m,b,v,L,k;return le(this,function(K){switch(K.label){case 0:if(!this._qr)throw"QR code is empty";return m="png",b="qr",typeof p=="string"?(m=p,console.warn("Extension is deprecated as argument for 'download' method, please pass object { name: '...', extension: '...' } as argument")):typeof p=="object"&&p!==null&&(p.name&&(b=p.name),p.extension&&(m=p.extension)),[4,this._getElement(m)];case 1:return(v=K.sent())?(m.toLowerCase()==="svg"?(L=new XMLSerializer,k=`<?xml version="1.0" standalone="no"?>\r
`+(k=L.serializeToString(v)),g("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(k),b+".svg")):g(v.toDataURL("image/"+m),b+"."+m),[2]):[2]}})})},P}()}},r={};function i(s){if(r[s])return r[s].exports;var o=r[s]={exports:{}};return n[s](o,o.exports,i),o.exports}return i.n=s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return i.d(o,{a:o}),o},i.d=(s,o)=>{for(var a in o)i.o(o,a)&&!i.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:o[a]})},i.o=(s,o)=>Object.prototype.hasOwnProperty.call(s,o),i(676)})().default})}(fo)),fo.exports}var SO=_O();const AO=ts(SO),ou={contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",abi:[{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],type:"function"}],multiplier:1e6};function IO({fromAddress:t,toAddress:e,uint256:n}){return{from:t,to:ou.contractAddress,data:h0({abi:ou.abi,functionName:"transfer",args:[e,n]})}}class DO extends HTMLElement{constructor(){super(),this.initOptions=null,this.API=null,this.sdkConfig=null,this.cryptoTransaction=null,this.getCryptoTransactionIntervalID=null,this.lydianTransaction=null,this.getLydianTransactionIntervalID=null,this.walletConnectService=null,this.containerPaymentSuccess=null,this.containerPaymentFailure=null,this.containerQRCode=null,this.lydianProcessingContainer=null,this.lydianProcessingText=null,this.lydianUsdtPaymentContainer=null,this.containerMoreNetworks=null,this.containerNetworks=null,this.containerNetworkList=null,this.assetImg=null,this.assetTitle=null,this.containerCryptoPayment=null,this.containerAssets=null,this.containerAssetsMore=null,this.btnMoreAssets=null,this.canvasQRCode=null,this.displayTotalAmount=null,this.displayTransactionID=null,this.displayAssetTotal=null,this.displayScanText=null,this.displayExpirationLeft=null,this.btnAppPayment=null,this.btnCryptoPayment=null,this.btnMoreNetworks=null,this.btnCancelCryptoPayment=null,this.lydianBtnCancelCryptoPayment=null,this.lydianBtnCancelUsdtPayment=null,this.lydianBtnCancelWalletConnect=null,this.selectedAsset=null,this.selectedAssetNetworks=null,this.selectedNetwork=null,this.connectWalletButtonsContainer=null,this.containerMoreWallets=null,this.containerWalletList=null,this.btnMoreWallets=null,this.containerWalletManual=null,this.shadow=this.attachShadow({mode:"open"}),this.walletConnectService=new TD({shadow:this.shadow})}async getMerchantConfiguration(e){var n;this.initOptions=e,this.API=new Uu(e.sandbox?x0:_0,this.initOptions.publishableKey),this.render(),await this.getSDKConfig(),this.initializeComponents(),this.setAssetButtons(),this.attachListeners(),this.loadInitialState(),await((n=this.walletConnectService)==null?void 0:n.init())}async updateTransaction(e){if(!this.initOptions)throw new Error("Tether Pay not initialized.");if(!e.amount||!e.currency)throw new Error("Amount and currency are required.");if(!fu(e.currency))throw new Error("Invalid value for currency, valid values are: "+po.join(", "));this.initOptions.transaction=e,this.loadInitialState()}loadInitialState(){var e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I;this.setSelectedAsset(null),this.setSelectedNetwork(null),this.clearInterval(),this.hideQRCode(),this.hidePaymentSuccess(),this.showButtons(),(e=this.btnAppPayment)==null||e.classList.add("hidden"),(n=this.sdkConfig)!=null&&n.appPayEnabled&&((r=this.btnAppPayment)==null||r.classList.remove("hidden")),(i=this.btnCryptoPayment)==null||i.classList.add("hidden"),(s=this.sdkConfig)!=null&&s.cryptoPayEnabled&&((o=this.btnCryptoPayment)==null||o.classList.remove("hidden")),(a=this.lydianUsdtPaymentContainer)==null||a.classList.add("hidden"),(c=this.containerCryptoPayment)==null||c.classList.add("hidden"),(u=this.containerAssetsMore)==null||u.classList.add("hidden"),(l=this.btnMoreAssets)==null||l.classList.remove("hidden"),(h=this.containerNetworks)==null||h.classList.add("hidden"),(d=this.containerMoreNetworks)==null||d.classList.add("hidden"),(y=this.btnMoreNetworks)==null||y.classList.remove("hidden"),(f=this.containerMoreWallets)==null||f.classList.add("hidden"),(g=this.btnMoreWallets)==null||g.classList.remove("hidden"),(I=this.connectWalletButtonsContainer)==null||I.classList.add("hidden")}setSelectedAsset(e){switch(e){case gu:this.selectedAsset=Ou;break;case wu:this.selectedAsset=Du;break;case Su:this.selectedAsset=Au;break;case vu:this.selectedAsset=Iu;break;case W0:this.selectedAsset=iy;break;case G0:this.selectedAsset=sy;break;case Y0:this.selectedAsset=oy;break;case Q0:this.selectedAsset=ay;break;case Z0:this.selectedAsset=cy;break;case J0:this.selectedAsset=uy;break;case ey:this.selectedAsset=ly;break;case ty:this.selectedAsset=hy;break;case ny:this.selectedAsset=dy;break;case bu:this.selectedAsset=$u;break;case mu:this.selectedAsset=Cu;break;case Eu:this.selectedAsset=Pu;break;case _u:this.selectedAsset=Bu;break;case yu:this.selectedAsset=Tu;break;case xu:this.selectedAsset=ku;break;default:this.selectedAsset=null;break}}setSelectedNetwork(e){this.selectedNetwork=e}setSelectedWallet(e){this.selectedWallet=e}showPaymentSuccess(){var e;(e=this.containerPaymentSuccess)==null||e.classList.remove("hidden"),this.hideButtons(),this.hideQRCode()}showPaymentFailure(){var e;(e=this.containerPaymentFailure)==null||e.classList.remove("hidden"),this.hideButtons(),this.hideQRCode()}hidePaymentSuccess(){var e;(e=this.containerPaymentSuccess)==null||e.classList.add("hidden")}showProcessing(e="Processing..."){var n;this.lydianProcessingText&&(this.lydianProcessingText.innerHTML=e),(n=this.lydianProcessingContainer)==null||n.classList.remove("hidden")}hideProcessing(){var e;this.lydianProcessingText&&(this.lydianProcessingText.innerHTML=""),(e=this.lydianProcessingContainer)==null||e.classList.add("hidden")}showButtons(){var e,n,r,i;(e=this.sdkConfig)!=null&&e.appPayEnabled&&((n=this.btnAppPayment)==null||n.classList.remove("hidden")),(r=this.sdkConfig)!=null&&r.cryptoPayEnabled&&((i=this.btnCryptoPayment)==null||i.classList.remove("hidden"))}hideButtons(){var e,n,r,i,s,o,a;(e=this.btnAppPayment)==null||e.classList.add("hidden"),(n=this.btnCryptoPayment)==null||n.classList.add("hidden"),(r=this.lydianUsdtPaymentContainer)==null||r.classList.add("hidden"),(i=this.containerCryptoPayment)==null||i.classList.add("hidden"),(s=this.containerNetworks)==null||s.classList.add("hidden"),(o=this.connectWalletButtonsContainer)==null||o.classList.add("hidden"),(a=this.containerWalletManual)==null||a.classList.add("hidden")}showQRCode(e,n){var i,s,o,a;if(!this.selectedAsset)return;if((i=this.containerQRCode)==null||i.classList.remove("hidden"),this.displayAssetTotal&&(this.displayAssetTotal.innerText=n+" "+this.selectedAsset.code.toUpperCase()),this.displayTransactionID&&(this.displayTransactionID.innerText=(s=this.initOptions)==null?void 0:s.transaction.referenceNumber),this.displayTotalAmount&&(this.displayTotalAmount.innerText=(a=this.initOptions)==null?void 0:a.transaction.amount.toLocaleString("en-US",{style:"currency",currency:(o=this.initOptions)==null?void 0:o.transaction.currency})),this.displayExpirationLeft){const c=this.displayExpirationLeft,u=new Date().getTime()+15*60*1e3,l=setInterval(()=>{const h=new Date().getTime(),d=u-h,y=Math.floor(d%(1e3*60*60)/(1e3*60)),f=Math.floor(d%(1e3*60)/1e3);c.innerHTML=y+":"+f,d<=0&&clearInterval(l)},1e3)}this.displayScanText&&this.selectedWallet.code=="manual"&&(this.displayScanText.innerHTML="Scan the code below using your <br />CAMERA, CRYPTO WALLET, or QR READER");let r="";switch(this.selectedWallet.code){case"manual":r="https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/7065960c-8ebd-4d80-f352-8027ff2bb600/public";break;case"metamask":r="https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/a0ddd685-4a84-4f5c-ab6d-9796994cf500/public";break;case"trustwallet":r="https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/327c5e87-ea96-4b84-aa1f-8f99c2c70f00/public";break}this.canvasQRCode&&new AO({width:238,height:238,type:"canvas",data:e,image:r,dotsOptions:{color:"#000000",type:"extra-rounded"},backgroundOptions:{color:"#ffffff"}}).append(this.canvasQRCode)}hideQRCode(){var e;(e=this.containerQRCode)==null||e.classList.add("hidden"),this.canvasQRCode&&(this.canvasQRCode.innerHTML="")}render(){this.shadow.innerHTML=`<style>${b0}</style>${v0}`}initializeComponents(){var e,n,r,i,s,o,a,c,u,l,h,d,y,f,g,I,$,R,D,_,A,S,F,j,O,M,z,q,C,B,x,w,E;this.lydianUsdtPaymentContainer=(e=this.shadowRoot)==null?void 0:e.getElementById("lydianUsdtPaymentContainer"),this.containerMoreNetworks=(n=this.shadowRoot)==null?void 0:n.getElementById("containerMoreNetworks"),this.containerNetworks=(r=this.shadowRoot)==null?void 0:r.getElementById("containerNetworks"),this.containerNetworkList=(i=this.shadowRoot)==null?void 0:i.getElementById("containerNetworkList"),this.containerPaymentSuccess=(s=this.shadowRoot)==null?void 0:s.getElementById("containerPaymentSuccess"),this.containerPaymentFailure=(o=this.shadowRoot)==null?void 0:o.getElementById("containerPaymentFailure"),this.containerQRCode=(a=this.shadowRoot)==null?void 0:a.getElementById("containerQRCode"),this.lydianProcessingContainer=(c=this.shadowRoot)==null?void 0:c.getElementById("lydianProcessingContainer"),this.lydianProcessingText=(u=this.shadowRoot)==null?void 0:u.getElementById("lydianProcessingText"),this.assetImg=(l=this.shadowRoot)==null?void 0:l.getElementById("assetImg"),this.assetTitle=(h=this.shadowRoot)==null?void 0:h.getElementById("assetTitle"),this.containerCryptoPayment=(d=this.shadowRoot)==null?void 0:d.getElementById("containerCryptoPayment"),this.containerAssets=(y=this.shadowRoot)==null?void 0:y.getElementById("containerAssets"),this.containerAssetsMore=(f=this.shadowRoot)==null?void 0:f.getElementById("containerAssetsMore"),this.canvasQRCode=(g=this.shadowRoot)==null?void 0:g.getElementById("canvasQRCode"),this.displayTotalAmount=(I=this.shadowRoot)==null?void 0:I.getElementById("displayTotalAmount"),this.displayTransactionID=($=this.shadowRoot)==null?void 0:$.getElementById("displayTransactionID"),this.displayAssetTotal=(R=this.shadowRoot)==null?void 0:R.getElementById("displayAssetTotal"),this.displayScanText=(D=this.shadowRoot)==null?void 0:D.getElementById("displayScanText"),this.displayExpirationLeft=(_=this.shadowRoot)==null?void 0:_.getElementById("displayExpirationLeft"),this.btnAppPayment=(A=this.shadowRoot)==null?void 0:A.getElementById("btnAppPayment"),this.btnCryptoPayment=(S=this.shadowRoot)==null?void 0:S.getElementById("btnCryptoPayment"),this.btnMoreNetworks=(F=this.shadowRoot)==null?void 0:F.getElementById("btnMoreNetworks"),this.btnMoreAssets=(j=this.shadowRoot)==null?void 0:j.getElementById("btnMoreAssets"),this.btnMoreWallets=(O=this.shadowRoot)==null?void 0:O.getElementById("btnMoreWallets"),this.btnCancelCryptoPayment=(M=this.shadowRoot)==null?void 0:M.getElementById("btnCancelCryptoPayment"),this.lydianBtnCancelCryptoPayment=(z=this.shadowRoot)==null?void 0:z.getElementById("lydianBtnCancelCryptoPayment"),this.lydianBtnCancelUsdtPayment=(q=this.shadowRoot)==null?void 0:q.getElementById("lydianBtnCancelUsdtPayment"),this.lydianBtnCancelWalletConnect=(C=this.shadowRoot)==null?void 0:C.getElementById("lydianBtnCancelWalletConnect"),this.connectWalletButtonsContainer=(B=this.shadowRoot)==null?void 0:B.getElementById("connectWalletContainer"),this.containerMoreWallets=(x=this.shadowRoot)==null?void 0:x.getElementById("containerMoreWallets"),this.containerWalletList=(w=this.shadowRoot)==null?void 0:w.getElementById("containerWalletList"),this.containerWalletManual=(E=this.shadowRoot)==null?void 0:E.getElementById("containerWalletManual")}attachListeners(){var e,n,r,i,s,o,a;(e=this.btnAppPayment)==null||e.addEventListener("click",c=>{console.log("TODO: NOT IMPLEMENTED")}),(n=this.btnCryptoPayment)==null||n.addEventListener("click",()=>{var c,u;(c=this.btnCryptoPayment)==null||c.classList.toggle("hidden"),(u=this.containerCryptoPayment)==null||u.classList.toggle("hidden")}),(r=this.btnMoreNetworks)==null||r.addEventListener("click",()=>{var c,u;(c=this.containerMoreNetworks)==null||c.classList.toggle("hidden"),(u=this.btnMoreNetworks)==null||u.classList.toggle("hidden")}),(i=this.btnMoreAssets)==null||i.addEventListener("click",()=>{var c,u;(c=this.containerAssetsMore)==null||c.classList.toggle("hidden"),(u=this.btnMoreAssets)==null||u.classList.toggle("hidden")}),(s=this.btnMoreWallets)==null||s.addEventListener("click",()=>{var c,u;(c=this.containerMoreWallets)==null||c.classList.toggle("hidden"),(u=this.btnMoreWallets)==null||u.classList.toggle("hidden")}),(o=this.btnCancelCryptoPayment)==null||o.addEventListener("click",()=>{this.loadInitialState()}),(a=this.lydianBtnCancelCryptoPayment)==null||a.addEventListener("click",()=>{this.loadInitialState()})}async createCryptoTransaction(){var e,n,r,i,s,o;if(!this.selectedAsset||!this.selectedNetwork){(n=(e=this.initOptions)==null?void 0:e.paymentFailedListener)==null||n.call(e,"Asset and network selection required.");return}if(this.initOptions&&this.API){this.clearInterval(),this.hideButtons();try{this.cryptoTransaction=await this.API.createCryptoTransaction({descriptor:this.initOptions.transaction.descriptor,referenceNumber:this.initOptions.transaction.referenceNumber,amount:this.initOptions.transaction.amount,amountCurrency:this.initOptions.transaction.currency,asset:this.selectedAsset.code,network:this.selectedNetwork}),console.log("transaction",this.cryptoTransaction)}catch{(i=(r=this.initOptions)==null?void 0:r.paymentFailedListener)==null||i.call(r,"Unable to create transaction.")}}else(o=(s=this.initOptions)==null?void 0:s.paymentFailedListener)==null||o.call(s,"Lydian not initialized.")}startListeningCryptoTransaction(){this.clearInterval(),this.getCryptoTransactionIntervalID=setInterval(async()=>{var e,n,r,i,s,o,a;if((e=this.cryptoTransaction)!=null&&e.transactionId){const c=await((r=this.API)==null?void 0:r.getCryptoTransaction((n=this.cryptoTransaction)==null?void 0:n.transactionId));if(c){c.status===pu&&(this.showPaymentSuccess(),this.clearInterval(),(s=(i=this.initOptions)==null?void 0:i.paymentSuccessListener)==null||s.call(i));const u=Date.parse(c.expiration),l=Date.now();u<l&&(this.showPaymentFailure(),this.clearInterval(),(a=(o=this.initOptions)==null?void 0:o.paymentFailedListener)==null||a.call(o,"Transaction Timed Out / Failed!"))}}},2e3)}startListeningLydianTransaction(){this.clearInterval(),this.getLydianTransactionIntervalID=setInterval(async()=>{var e,n,r,i,s,o,a;if((e=this.lydianTransaction)!=null&&e.transactionId){const c=await((r=this.API)==null?void 0:r.getClusterTransaction((n=this.lydianTransaction)==null?void 0:n.transactionId));if(c){c.status===pu&&(this.showPaymentSuccess(),this.clearInterval(),(s=(i=this.initOptions)==null?void 0:i.paymentSuccessListener)==null||s.call(i));const u=Date.parse(c.expiration),l=Date.now();u<l&&(this.showPaymentFailure(),this.clearInterval(),(a=(o=this.initOptions)==null?void 0:o.paymentFailedListener)==null||a.call(o,"Transaction Timed Out / Failed!"))}}},2e3)}clearInterval(){this.getCryptoTransactionIntervalID&&(clearInterval(this.getCryptoTransactionIntervalID),this.getCryptoTransactionIntervalID=null),this.getLydianTransactionIntervalID&&(clearInterval(this.getLydianTransactionIntervalID),this.getLydianTransactionIntervalID=null)}setAssetButtons(){var n,r,i,s;if(!this.containerAssets||!this.containerAssetsMore)return;this.containerAssets.innerHTML="",this.containerAssetsMore.innerHTML="";const e=(r=(n=this.sdkConfig)==null?void 0:n.allowedAssets)==null?void 0:r.map((o,a)=>{switch(o.code){case gu:return zt(Ou);case wu:return zt(Du);case Su:return zt(Au);case vu:return zt(Iu);case X0:return zt(ry);case bu:return zt($u);case mu:return zt(Cu);case Eu:return zt(Pu);case _u:return zt(Bu);case yu:return zt(Tu);case xu:return zt(ku)}});e==null||e.filter(o=>o).forEach((o,a)=>{a>=2&&this.containerAssetsMore?this.containerAssetsMore.innerHTML+=o:this.containerAssets&&(this.containerAssets.innerHTML+=o)}),(i=this.sdkConfig)!=null&&i.allowedAssets&&this.sdkConfig.allowedAssets.length<=2&&((s=this.btnMoreAssets)==null||s.classList.add("hidden")),this.attachListenersOnAssets()}attachListenersOnAssets(){var e,n;(n=(e=this.sdkConfig)==null?void 0:e.allowedAssets)==null||n.forEach(r=>{var s;const i=(s=this.shadowRoot)==null?void 0:s.getElementById("btnAsset"+r.code);i==null||i.addEventListener("click",async()=>{var o;this.setSelectedAsset(r.code),(o=this.containerCryptoPayment)==null||o.classList.add("hidden"),r.type=="token"?this.setNetworkButtons():(this.setSelectedNetwork(r.networks[0]),this.showWalletConnectButtons())})})}setNetworkButtons(){var n,r,i,s,o,a;if(!this.containerNetworkList||!this.containerMoreNetworks||!this.assetImg||!this.assetTitle)return;this.containerNetworkList.innerHTML="",this.containerMoreNetworks.innerHTML="",this.assetTitle.innerHTML=(n=this.selectedAsset)==null?void 0:n.title,this.assetImg.src=(r=this.selectedAsset)==null?void 0:r.img;const e=(i=this.sdkConfig)==null?void 0:i.allowedAssets.find(c=>{var u;return c.code===((u=this.selectedAsset)==null?void 0:u.code)});if(e==null){console.log("Unknown asset: ",(s=this.selectedAsset)==null?void 0:s.code);return}console.log("asset",e),e==null||e.networks.forEach((c,u)=>{let l;switch(c){case O0:l=Pe(fy);break;case P0:l=Pe(py);break;case q0:l=Pe(gy);break;case F0:l=Pe(yy);break;case j0:l=Pe(wy);break;case I0:l=Pe(my);break;case S0:l=Pe(by);break;case A0:l=Pe(vy);break;case D0:l=Pe(Ey);break;case $0:l=Pe(xy);break;case k0:l=Pe(_y);break;case N0:l=Pe(Sy);break;case U0:l=Pe(Ay);break;case L0:l=Pe(Iy);break;case H0:l=Pe(Dy);break;case K0:l=Pe(Oy);break;case M0:l=Pe($y);break;case z0:l=Pe(Cy);break;case T0:l=Pe(Py);break;case C0:l=Pe(By);break;case V0:l=Pe(Ty);break;case B0:l=Pe(ky);break;case R0:l=Pe(Ry);break}u>=4&&this.containerMoreNetworks?this.containerMoreNetworks.innerHTML+=l:this.containerNetworkList&&(this.containerNetworkList.innerHTML+=l)}),e!=null&&e.networks&&(e==null?void 0:e.networks.length)<=2&&((o=this.btnMoreNetworks)==null||o.classList.add("hidden")),(a=this.containerNetworks)==null||a.classList.remove("hidden"),this.attachListenerOnNetworks(e.networks)}attachListenerOnNetworks(e){var n;e==null||e.forEach(r=>{var s;const i=(s=this.shadowRoot)==null?void 0:s.getElementById("btnNetwork"+r);i==null||i.addEventListener("click",async()=>{this.setSelectedNetwork(r),this.showWalletConnectButtons()})}),(n=this.lydianBtnCancelUsdtPayment)==null||n.addEventListener("click",async()=>{this.loadInitialState()})}async getSDKConfig(){var e,n,r,i;if(this.API)try{this.sdkConfig=await this.API.getSDKConfig(),this.API.setClusterBaseUri(this.sdkConfig.lydianPayCluster)}catch{(n=(e=this.initOptions)==null?void 0:e.paymentFailedListener)==null||n.call(e,"Unable to load SDK configuration.")}else(i=(r=this.initOptions)==null?void 0:r.paymentFailedListener)==null||i.call(r,"SDK not initialized.")}async showWalletConnectButtons(){var r,i,s,o,a;if(!this.connectWalletButtonsContainer||!this.containerMoreWallets||!this.containerWalletList)return;this.containerWalletList.innerHTML="",this.containerMoreWallets.innerHTML="",(r=this.containerNetworks)==null||r.classList.add("hidden"),this.connectWalletButtonsContainer.classList.remove("hidden");const e={id:"manual",name:"Manual QR Code",img:"https://tetherpay.com/images/95de9fd2-da4f-4415-3ec7-bb1befdbc500/public"};(i=this.sdkConfig)!=null&&i.walletConnectEnabled||(this.setSelectedWallet(e),this.beginWalletConnectTransaction(),(s=this.lydianBtnCancelWalletConnect)==null||s.addEventListener("click",async()=>{this.loadInitialState()})),this.containerWalletManual&&(this.containerWalletManual.innerHTML="",this.containerWalletManual.innerHTML+=f0(e));const n=[{id:"metamask",name:"MetaMask",img:"https://tetherpay.com/images/a0ddd685-4a84-4f5c-ab6d-9796994cf500/public",wcPeerName:"MetaMask Wallet"},{id:"trustwallet",name:"Trust Wallet",img:"https://logowik.com/content/uploads/images/trust-wallet-shield4830.logowik.com.webp",wcPeerName:"Trust Wallet"}];n.forEach((c,u)=>{var h;const l=f0(c,!!((h=this.walletConnectService)!=null&&h.findSession(c)));u>=3&&this.containerMoreWallets?this.containerMoreWallets.innerHTML+=l:this.containerWalletList&&(this.containerWalletList.innerHTML+=l)}),n.length<=3&&((o=this.containerMoreWallets)==null||o.classList.add("hidden")),(a=this.containerWalletList)==null||a.classList.remove("hidden"),this.attachListenerOnWallets([...n,e])}attachListenerOnWallets(e){var n;e.forEach(r=>{var s;const i=(s=this.shadowRoot)==null?void 0:s.getElementById("btnWallet"+r.id);i==null||i.addEventListener("click",async()=>{this.setSelectedWallet(r),this.beginWalletConnectTransaction()})}),(n=this.lydianBtnCancelWalletConnect)==null||n.addEventListener("click",async()=>{this.loadInitialState()})}async beginWalletConnectTransaction(){var e,n,r,i,s,o,a,c,u,l,h,d,y;if(!this.selectedAsset||!this.selectedNetwork){(n=(e=this.initOptions)==null?void 0:e.paymentFailedListener)==null||n.call(e,"Asset and network selection required.");return}if(!this.initOptions||!this.API){(i=(r=this.initOptions)==null?void 0:r.paymentFailedListener)==null||i.call(r,"Lydian not initialized.");return}if(!this.walletConnectService){(o=(s=this.initOptions)==null?void 0:s.paymentFailedListener)==null||o.call(s,"Wallet Connect not initialized.");return}(a=this.connectWalletButtonsContainer)==null||a.classList.add("hidden"),this.showProcessing("Generating QR Code");try{if(this.cryptoTransaction=await this.API.createCryptoTransaction({descriptor:this.initOptions.transaction.descriptor,referenceNumber:this.initOptions.transaction.referenceNumber,amount:this.initOptions.transaction.amount,amountCurrency:this.initOptions.transaction.currency,asset:this.selectedAsset.code,network:this.selectedNetwork}),console.log("transaction",this.cryptoTransaction),this.hideProcessing(),this.selectedWallet.id=="manual")this.showQRCode(this.cryptoTransaction.qrData,this.cryptoTransaction.assetAmount);else{let f=(c=this.walletConnectService)==null?void 0:c.findSession(this.selectedWallet);if(console.log("selected wallet",this.selectedWallet),console.log("matching wallet session",f),!f){const{uri:R,approval:D}=await((u=this.walletConnectService)==null?void 0:u.connectWalletWithQrCode());R&&this.showQRCode(R,this.cryptoTransaction.assetAmount),f=await D(),console.log("Session established:",f),this.walletConnectService.currentSession=f,this.hideQRCode()}const g=this.walletConnectService.getSessionAddress(f,"eip155:1");if(!g)throw new Error("failed to find wallet address from current session");const I=kD(this.cryptoTransaction.qrData);console.log("parsedQrCodeData",I);let $;if(this.selectedAsset.code==="USDT")$=EO({fromAddress:g,toAddress:I.address,uint256:parseInt(I.uint256)});else if(this.selectedAsset.code==="USDC")$=IO({fromAddress:g,toAddress:I.address,uint256:parseFloat(I.uint256)*ou.multiplier});else throw new Error(`unable to encode unkown asset code "${this.selectedAsset.code}"`);try{this.showProcessing(`Waiting for transaction approval from ${f.peer.metadata.name}...`);const R=await this.walletConnectService.sendEthTransaction($,f);this.hideProcessing(),this.showPaymentSuccess(),this.clearInterval(),(h=(l=this.initOptions)==null?void 0:l.paymentSuccessListener)==null||h.call(l)}catch{this.hideProcessing(),this.showPaymentFailure(),this.clearInterval()}}this.startListeningCryptoTransaction(),qy()&&(window.location.href=this.cryptoTransaction.qrData)}catch{this.hideProcessing(),(y=(d=this.initOptions)==null?void 0:d.paymentFailedListener)==null||y.call(d,"Unable to create cryptotransaction.")}}}customElements.get("lydian-checkout")||customElements.define("lydian-checkout",DO);async function OO(t){const e=document.querySelector("lydian-checkout");if(!t.publishableKey||!t.transaction.amount||!t.transaction.currency)throw new Error("SDK initialization requires a baseURI, publishableKey, and transaction");if(!fu(t.transaction.currency))throw new Error("Invalid value for currency, valid values are: "+po.join(", "));await e.getMerchantConfiguration(t)}async function $O(t){await document.querySelector("lydian-checkout").updateTransaction(t)}window.Lydian={init:OO,updateTransaction:$O}})();
