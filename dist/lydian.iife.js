(function(){"use strict";const b0='@import"https://fonts.googleapis.com/css2?family=Antic&family=Antic+Didone&display=swap";*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/*! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com*/*,:after,:before{box-sizing:border-box;border:0 solid #e5e7eb}:after,:before{--tw-content:""}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0}fieldset,legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.m-4{margin:1rem}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.me-1{margin-inline-end:.25rem}.me-4{margin-inline-end:1rem}.ms-2{margin-inline-start:.5rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.inline{display:inline}.flex{display:flex}.table{display:table}.hidden{display:none}.h-12{height:3rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-72{height:18rem}.min-h-\\[200px\\]{min-height:200px}.w-12{width:3rem}.w-64{width:16rem}.w-\\[320px\\]{width:320px}.w-full{width:100%}.max-w-32{max-width:8rem}.shrink-0{flex-shrink:0}.table-fixed{table-layout:fixed}.border-separate{border-collapse:separate}@keyframes spin{to{transform:rotate(1turn)}}.animate-spin{animation:spin 1s linear infinite}.select-text{-webkit-user-select:text;-moz-user-select:text;user-select:text}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse:0;margin-right:calc(.5rem*var(--tw-space-x-reverse));margin-left:calc(.5rem*(1 - var(--tw-space-x-reverse)))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(.5rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem*var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem*(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem*var(--tw-space-y-reverse))}.break-all{word-break:break-all}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.border{border-width:1px}.border-4{border-width:4px}.border-gray-300{--tw-border-opacity:1;border-color:rgb(209 213 219/var(--tw-border-opacity,1))}.border-gray-500{--tw-border-opacity:1;border-color:rgb(107 114 128/var(--tw-border-opacity,1))}.border-transparent{border-color:transparent}.border-t-blue-600{--tw-border-opacity:1;border-top-color:rgb(37 99 235/var(--tw-border-opacity,1))}.bg-gray-50{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity,1))}.bg-red-200{--tw-bg-opacity:1;background-color:rgb(254 202 202/var(--tw-bg-opacity,1))}.bg-white{--tw-bg-opacity:1;background-color:rgb(255 255 255/var(--tw-bg-opacity,1))}.p-1\\.5{padding:.375rem}.p-2{padding:.5rem}.p-6{padding:1.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.ps-1{padding-inline-start:.25rem}.text-center{text-align:center}.text-right{text-align:right}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.leading-5{line-height:1.25rem}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175/var(--tw-text-opacity,1))}.text-gray-500{--tw-text-opacity:1;color:rgb(107 114 128/var(--tw-text-opacity,1))}.text-gray-600{--tw-text-opacity:1;color:rgb(75 85 99/var(--tw-text-opacity,1))}.text-gray-800{--tw-text-opacity:1;color:rgb(31 41 55/var(--tw-text-opacity,1))}.text-gray-900{--tw-text-opacity:1;color:rgb(17 24 39/var(--tw-text-opacity,1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68/var(--tw-text-opacity,1))}.text-red-900{--tw-text-opacity:1;color:rgb(127 29 29/var(--tw-text-opacity,1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255/var(--tw-text-opacity,1))}.underline{text-decoration-line:underline}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color)}.shadow,.shadow-md{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -2px rgba(0,0,0,.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.ring-1{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.ring-gray-200{--tw-ring-opacity:1;--tw-ring-color:rgb(229 231 235/var(--tw-ring-opacity,1))}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.text-lydian-green{color:#044d57}.bg-lydian-green{background:#044d57}.bg-lydian-green:hover{background:#033c46}.bg-lydian-light-green{background:#009393}.bg-lydian-light-green:hover{background:#008282}dialog{border:none;border-radius:12px;padding:1.25rem 1.25rem 1rem;box-shadow:0 10px 30px #0003}dialog::backdrop{background:#00000080}.modal-header{display:flex;align-items:center;justify-content:start;gap:.5rem;margin-bottom:.5rem}.close-btn{border:0;background:transparent;font-size:1.25rem;line-height:1;padding:.5rem;cursor:pointer;border-radius:8px;width:40px;height:40px}.close-btn:hover{background:color-mix(in oklab,Canvas 92%,#000 8%)}.modal-body{line-height:1.5}.hover\\:bg-gray-100:hover{--tw-bg-opacity:1;background-color:rgb(243 244 246/var(--tw-bg-opacity,1))}.hover\\:bg-gray-50:hover{--tw-bg-opacity:1;background-color:rgb(249 250 251/var(--tw-bg-opacity,1))}.hover\\:text-gray-700:hover{--tw-text-opacity:1;color:rgb(55 65 81/var(--tw-text-opacity,1))}.focus\\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000)}.focus\\:ring-indigo-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(99 102 241/var(--tw-ring-opacity,1))}@media (min-width:640px){.sm\\:flex-row{flex-direction:row}.sm\\:text-xl{font-size:1.25rem;line-height:1.75rem}}@media (min-width:768px){.md\\:w-\\[600px\\]{width:600px}}@media (min-width:1024px){.lg\\:w-2\\/3{width:66.666667%}}',v0=`<div class="font-antic">
  <div id="testCanvas"></div>
  <div id="containerPaymentSuccess" class="hidden flex flex-col items-center justify-center min-h-[200px]">
    <p class="text-gray-600 text-lg font-medium">Payment Success!</p>
    <img class="max-w-32 mt-4" src="https://tetherpay.com/images/475982cd-2f7b-4a57-c9b2-13b5014d7100/public"
         alt="Payment Approved!" />
  </div>

  <div id="containerPaymentFailure" class="hidden flex flex-col items-center justify-center">
    <p class="text-red-500 text-lg font-medium">Transaction Timed Out / Failed!</p>
  </div>

  <div id="containerQRCode" class="hidden flex flex-col items-center justify-center">
    <div class="m-4 text-center">
      <span id="displayScanText"></span>
    </div>
    <div class="border p-2 border-gray-500 h-64 w-64 rounded-xl">
      <div id="canvasQRCode"></div>
    </div>

    <div class="m-4 text-center">
      Approval will be shown above when complete
    </div>

    <table class="table-fixed w-full bg-gray-50 p-2 rounded-xl border-separate mt-5">
      <tbody>
      <tr>
        <td>Total</td>
        <td id="displayTotalAmount" class="text-right"></td>
      </tr>
      <tr>
        <td>Transaction ID</td>
        <td id="displayTransactionID" class="text-right"></td>
      </tr>
      <tr>
        <td>Total In Selected Asset</td>
        <td id="displayAssetTotal" class="text-right"></td>
      </tr>
      <tr>
        <td>QR Code Expires In</td>
        <td id="displayExpirationLeft" class="text-right">15:00</td>
      </tr>
      </tbody>
    </table>

    <p id="qrCodeAmount" class="text-lg text-gray-900 sm:text-xl text-center mt-4"></p>
    <button id="lydianBtnCancelCryptoPayment" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>

  </div>

  <div id="lydianProcessingContainer" class="hidden flex flex-col items-center justify-center min-h-[200px]">
    <div class="w-12 h-12 border-4 border-gray-300 border-t-blue-600 rounded-full animate-spin"></div>
    <p id="lydianProcessingText" class="mt-4 text-gray-600 text-lg font-medium text-center"></p>
  </div>

  <button type="button" id="btnAppPayment"
          class="hidden w-full rounded-md border border-transparent bg-lydian-green px-4 py-3 text-base font-medium mb-4 text-white shadow-md">
    Pay with Lydian
  </button>
  <button type="button" id="btnCryptoPayment"
          class="hidden w-full rounded-md border border-transparent bg-lydian-light-green px-4 py-3 text-base font-medium mb-4 text-white shadow-md">
    Pay With Crypto
  </button>

  <div id="containerCryptoPayment" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
    <div class="flex items-center space-x-2">
      <div class="text-lg font-medium">Select An Asset</div>
    </div>

    <div class="space-y-2">
      <div id="containerAssets" class="space-y-2">
      </div>
      <button id="btnMoreAssets" class="text-sm text-gray-500 underline hover:text-gray-700">
        More Assets
      </button>
      <div id="containerAssetsMore" class="space-y-2 hidden">
      </div>
    </div>

    <p class="text-xs text-red-500">
      Please ensure to select the correct network. Sending funds on the wrong
      network will result in a loss of your funds.
    </p>

    <button id="btnCancelCryptoPayment" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>
  </div>

  <div id="containerNetworks" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
    <div class="flex items-center space-x-2">
      <img id="assetImg" src="" class="h-6" />
      <div id="assetTitle" class="text-lg font-medium">USDT (Tether)</div>
    </div>

    <div class="text-sm font-medium">Select A Network</div>

    <div class="space-y-2">
      <div id="containerNetworkList" class="space-y-2">
      </div>
      <button id="btnMoreNetworks" class="text-sm text-gray-500 underline hover:text-gray-700">
        More Networks
      </button>
      <div id="containerMoreNetworks" class="space-y-2 hidden">
      </div>
    </div>

    <p class="text-xs text-red-500">
      Please ensure to select the correct network. Sending funds on the wrong
      network will result in a loss of your funds.
    </p>

    <button id="lydianBtnCancelUsdtPayment" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>
  </div>

  <!-- TODO: clear this container when going back or using loadInitialState -->
  <div id="connectWalletContainer" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
    <div class="flex items-center space-x-2">
      <div class="text-lg font-medium">Connect A Wallet</div>
    </div>

    <div class="space-y-2">
      <div id="containerWalletList" class="space-y-2">
      </div>
      <button id="btnMoreWallets" class="text-sm text-gray-500 underline hover:text-gray-700">
        More Wallets
      </button>
      <div id="containerMoreWallets" class="space-y-2 hidden">
      </div>
    </div>

    <div class="flex items-center justify-center space-x-2">
      <div class="text-lg font-medium text-center text">Or</div>
    </div>

    <div class="space-y-2">
      <div id="containerWalletManual" class="space-y-2"></div>
    </div>

    <p class="text-xs text-red-500">
      Please ensure to select the correct network. Sending funds on the wrong
      network will result in a loss of your funds.
    </p>

    <button id="lydianBtnCancelWalletConnect" class="text-sm text-gray-500 underline hover:text-gray-700">
      Cancel and return
    </button>
  </div>

  <!--  Modal for popup flow -->
  <dialog class="lg:w-2/3 w-full" id="modal" aria-labelledby="modalTitle" aria-modal="true">
    <div class="modal-header">
      <button class="close-btn" id="modalBtnBack" type="button" aria-label="Back">←</button>
      <div class="text-lg font-medium" id="modalTitle">Select an Asset</div>
    </div>
    <div class="modal-body">
      <div id="modalContainerPaymentSuccess" class="hidden flex flex-col items-center justify-center min-h-[200px]">
        <p class="text-gray-600 text-lg font-medium">Payment Success!</p>
        <img class="max-w-32 mt-4" src="https://tetherpay.com/images/475982cd-2f7b-4a57-c9b2-13b5014d7100/public"
             alt="Payment Approved!" />
      </div>

      <div id="modalContainerPaymentFailure" class="hidden flex flex-col items-center justify-center">
        <p class="text-red-500 text-lg font-medium">Transaction Timed Out / Failed!</p>
      </div>

      <div id="modalContainerQRCode">
        <div class="m-4 text-center">
          <span id="modalDisplayScanText"></span>
        </div>
        <div class="flex flex-col sm:flex-row justify-center items-center">
          <div class="border p-2 border-gray-500 h-72 w-64 rounded-xl me-4">
            <div id="modalCanvasQRCode"><img src="./qrcode.png" /></div>
            <div class="text-center mt-2 flex items-center justify-center">
              <svg class="me-1" width="24" height="24" viewBox="0 0 24 24" fill="none"
                   xmlns="http://www.w3.org/2000/svg">
                <g clipPath="url(#clip0_12056_34118)">
                  <path
                    d="M15.87 15.25L12.5 13.25V8.71999C12.5 8.31999 12.18 7.99999 11.78 7.99999H11.72C11.32 7.99999 11 8.31999 11 8.71999V13.44C11 13.79 11.18 14.12 11.49 14.3L15.14 16.49C15.48 16.69 15.92 16.59 16.12 16.25C16.33 15.9 16.22 15.45 15.87 15.25ZM21.18 5.00999L18.1 2.44999C17.68 2.09999 17.05 2.14999 16.69 2.57999C16.34 2.99999 16.4 3.62999 16.82 3.98999L19.89 6.54999C20.31 6.89999 20.94 6.84999 21.3 6.41999C21.66 5.99999 21.6 5.36999 21.18 5.00999ZM4.1 6.54999L7.17 3.98999C7.6 3.62999 7.66 2.99999 7.3 2.57999C6.95 2.14999 6.32 2.09999 5.9 2.44999L2.82 5.00999C2.4 5.36999 2.34 5.99999 2.7 6.41999C3.05 6.84999 3.68 6.89999 4.1 6.54999ZM12 3.99999C7.03 3.99999 3 8.02999 3 13C3 17.97 7.03 22 12 22C16.97 22 21 17.97 21 13C21 8.02999 16.97 3.99999 12 3.99999ZM12 20C8.14 20 5 16.86 5 13C5 9.13999 8.14 5.99999 12 5.99999C15.86 5.99999 19 9.13999 19 13C19 16.86 15.86 20 12 20Z"
                    fill="#212126" />
                </g>
                <defs>
                  <clipPath id="clip0_12056_34118">
                    <rect width="24" height="24" fill="white" />
                  </clipPath>
                </defs>
              </svg>
              Expires In
              <span class="ps-1" id="modalDisplayExpirationLeft">15:00</span>
            </div>
          </div>
          <div>
            <div>
              <p class="mt-4 text-xl font-bold">Amount</p>
              <p class="text-4xl font-bold"><span id="modalDisplayAssetTotal">9.9885 USDt</span>
                <button id="modalButtonCopyAssetTotal"
                        data-copy=""
                        class="ms-2 p-1.5 rounded-md text-gray-400 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        aria-label="Copy">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                       xmlns="http://www.w3.org/2000/svg">
                    <g clipPath="url(#clip0_12056_32426)">
                      <path
                        d="M15 1H4C2.9 1 2 1.9 2 3V16C2 16.55 2.45 17 3 17C3.55 17 4 16.55 4 16V4C4 3.45 4.45 3 5 3H15C15.55 3 16 2.55 16 2C16 1.45 15.55 1 15 1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM18 21H9C8.45 21 8 20.55 8 20V8C8 7.45 8.45 7 9 7H18C18.55 7 19 7.45 19 8V20C19 20.55 18.55 21 18 21Z"
                        fill="#101014" />
                    </g>
                    <defs>
                      <clipPath id="clip0_12056_32426">
                        <rect width="24" height="24" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  <span class="sr-only">Copy amount</span>
                </button>
              </p>
              <p>on <span id="modalDisplayNetwork"></span> Network</p>
            </div>
            <div>
              <p class="mt-4 text-xl font-bold">Address</p>
              <div class="w-[320px] mt-2">
                <div
                  class="flex items-start justify-between gap-2 rounded-xl bg-gray-50 ring-1 ring-gray-200 px-3 py-2">
                  <p id="modalDisplayWalletAddress"
                     class="text-sm text-gray-600 leading-5 break-all select-text"></p>
                  <button
                    id="modalButtonCopyWalletAddress"
                    data-copy=""
                    class="shrink-0 p-1.5 rounded-md text-gray-400 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    aria-label="Copy">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                         xmlns="http://www.w3.org/2000/svg">
                      <g clipPath="url(#clip0_12056_34117)">
                        <path
                          d="M15 1H4C2.9 1 2 1.9 2 3V16C2 16.55 2.45 17 3 17C3.55 17 4 16.55 4 16V4C4 3.45 4.45 3 5 3H15C15.55 3 16 2.55 16 2C16 1.45 15.55 1 15 1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM18 21H9C8.45 21 8 20.55 8 20V8C8 7.45 8.45 7 9 7H18C18.55 7 19 7.45 19 8V20C19 20.55 18.55 21 18 21Z"
                          fill="#8F8F8F" />
                      </g>
                      <defs>
                        <clipPath id="clip0_12056_34117">
                          <rect width="24" height="24" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-4 mx-auto bg-red-200 rounded-xl p-2 md:w-[600px] w-full">
          <div class="flex items-start gap-2">
            <svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10.5 2.23152L18.7952 16.7657H2.20476L10.5 2.23152ZM0.298949 15.6485C-0.549302 17.1344 0.508258 19 2.20476 19H18.7952C20.4917 19 21.5493 17.1344 20.7011 15.6485L12.4058 1.11436C11.5576 -0.371454 9.44244 -0.371454 8.59419 1.11436L0.298949 15.6485ZM9.39837 7.82846V10.0628C9.39837 10.6772 9.89411 11.1799 10.5 11.1799C11.1059 11.1799 11.6016 10.6772 11.6016 10.0628V7.82846C11.6016 7.21402 11.1059 6.7113 10.5 6.7113C9.89411 6.7113 9.39837 7.21402 9.39837 7.82846ZM9.39837 13.4142H11.6016V15.6485H9.39837V13.4142Z"
                fill="#8B162B" />
            </svg>
            <p class="text-red-900">Please double-check these details. Crypto withdrawals are irreversible.</p>
          </div>
        </div>
      </div>

      <div id="modalLydianProcessingContainer" class="hidden flex flex-col items-center justify-center min-h-[200px]">
        <div class="w-12 h-12 border-4 border-gray-300 border-t-blue-600 rounded-full animate-spin"></div>
        <p id="modallydianProcessingText" class="mt-4 text-gray-600 text-lg font-medium text-center"></p>
      </div>

      <div id="modalContainerCryptoPayment"
           class="w-full space-y-4 hidden">
        <div class="flex items-center space-x-2">
          <div class="text-lg font-medium">Select from Popular</div>
        </div>

        <div class="space-y-2">
          <div id="modalContainerAssets" class="space-y-2">
          </div>
        </div>
      </div>

      <div id="modalContainerNetworks" class="w-full bg-white rounded-xl shadow p-6 space-y-4 text-gray-800 hidden">
        <div class="flex items-center space-x-2">
          <img id="modalAssetImg" src="" class="h-6" />
          <div id="modalAssetTitle" class="text-lg font-medium">USDT (Tether)</div>
        </div>

        <div class="text-sm font-medium">Select A Network</div>

        <div class="space-y-2">
          <div id="modalContainerNetworkList" class="space-y-2">
          </div>
          <button id="modalBtnMoreNetworks" class="text-sm text-gray-500 underline hover:text-gray-700">
            More Networks
          </button>
          <div id="modalContainerMoreNetworks" class="space-y-2 hidden">
          </div>
        </div>

        <p class="text-xs text-red-500">
          Please ensure to select the correct network. Sending funds on the wrong
          network will result in a loss of your funds.
        </p>
      </div>
    </div>
  </dialog>
</div>`,po=["USD","TRY"];function fl(t){return po.includes(t)}const E0="cbc90b58aec5c9ab2085a2d691461868",pl=1,x0="https://gateway.sandbox.lydian.com",_0="https://gateway.lydian.com",S0="aptos",A0="arbitrum",I0="avalanche",D0="base",C0="bitcoin",O0="celo",$0="eos",P0="ethereum",T0="hedara",B0="kaia",k0="linea",N0="near",R0="opmainnet",L0="polygon",U0="solana",F0="sonic",M0="sui",z0="tezos",j0="ton",q0="tron",H0="unichain",V0="uniswap",K0="zksync",W0="ARB",G0="BASE",gl="BTC",Q0="CELO",yl="DAI",wl="ETH",Y0="LINEA",Z0="OPMAINNET",J0="POLY",ml="PYUSD",bl="RLUSD",X0="SOL",ey="SONIC",ty="UNICHAIN",vl="USDC",El="USDe",xl="USDP",_l="USDS",Sl="USDT",ny="ZKSYNC",Al={code:"USDT",title:"USDT (Tether)",img:"https://tetherpay.com/images/7065960c-8ebd-4d80-f352-8027ff2bb600/public",type:"token",networks:[]},Il={code:"USDC",title:"USDC",img:"https://tetherpay.com/images/1a664446-0855-4d6d-256e-ad886acba300/public",type:"token",networks:[]},Dl={code:"ETH",title:"Ethereum",img:"https://tetherpay.com/images/327ef8ac-bc72-46ea-2362-878e91c49300/public",type:"coin",networks:[]},iy={code:"SOL",title:"Solana",img:"https://tetherpay.com/images/5850fc57-4451-4f45-b053-3857b1d54e00/public"},Cl={code:"BTC",title:"Bitcoin",img:"https://tetherpay.com/images/7f89f493-190a-41da-2410-a19b46a68900/public",type:"coin",networks:[]},ry={code:"ARB",title:"Arbitrum",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/64d896c2-6ac6-4837-e6bf-e05c53a5f500/public",type:"coin",networks:[]},sy={code:"BASE",title:"Base",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/3fc7c8ef-6863-43e6-967d-de68e14d4600/public",type:"coin",networks:[]},oy={code:"CELO",title:"Celo ",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/7373a7f6-b5dd-4d16-0b98-cbaf9e666300/public",type:"coin",networks:[]},ay={code:"linea",title:"Linea",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/410a3ea8-d59b-4e88-1c1a-ffa77c157600/public",type:"coin",networks:[]},cy={code:"opmainnet",title:"OP Mainnet",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/cd28b090-e932-478e-2a40-7b7d61672d00/public",type:"coin",networks:[]},ly={code:"polygon",title:"Polygon",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/386bebc7-3782-4358-978d-ae2b2d4fbf00/public",type:"coin",networks:[]},uy={code:"sonic",title:"Sonic",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/e9eaf9b0-3093-4239-d20b-a0c5934ec200/public",type:"coin",networks:[]},hy={code:"unichain",title:"Unichain",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/f4c4d2e6-d9a4-4910-febc-ed6de61bd400/public",type:"coin",networks:[]},dy={code:"zksync",title:"ZKsync",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/540fbd94-e1d0-4dda-c6d1-426181f37e00/public",type:"coin",networks:[]},Ol={code:"RLUSD",title:"RLUSD (Ripple USD)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/b71545a6-eab8-4fa2-5888-f26c22ce7f00/public",type:"token",networks:[]},$l={code:"PYUSD",title:"PYUSD (PayPal USD)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/3897aafa-0fd9-4914-ef54-e6312aea9a00/public",type:"token",networks:[]},Pl={code:"USDe",title:"USDe (Ethena USDe)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/76760e01-ce5a-482b-88e0-842f18370d00/public",type:"token",networks:[]},Tl={code:"USDS",title:"USDS (Sky Dollar)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/ee62374d-99a1-46c7-9fc6-eb5907a32600/public",type:"token",networks:[]},Bl={code:"DAI",title:"DAI",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/970875a7-3ae3-4171-4afe-cc1340bf9500/public",type:"token",networks:[]},kl={code:"USDP",title:"USDP (Pax Dollar)",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/970875a7-3ae3-4171-4afe-cc1340bf9500/public",type:"token",networks:[]},fy={code:"bitcoin",name:"Bitcoin",img:"https://tetherpay.com/images/7f89f493-190a-41da-2410-a19b46a68900/public"},py={code:"ethereum",name:"Ethereum",img:"https://tetherpay.com/images/327ef8ac-bc72-46ea-2362-878e91c49300/public"},gy={code:"tron",name:"Tron",img:"https://tetherpay.com/images/b51f79ea-c12b-4c01-246d-592c51214000/public"},yy={code:"solana",name:"Solana",img:"https://tetherpay.com/images/5850fc57-4451-4f45-b053-3857b1d54e00/public"},wy={code:"ton",name:"Ton",img:"https://tetherpay.com/images/a741a20b-6124-4c69-e678-4578b81a5f00/public"},my={code:"avalanche",name:"Avalanche",img:"https://tetherpay.com/images/ebd47494-9bae-4687-7762-19a4184e5400/public"},by={code:"aptos",name:"Aptos",img:"https://tetherpay.com/images/f2b2a145-2c37-4082-5f18-6271081d1500/public"},vy={code:"arbitrum",name:"Arbitrum",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/64d896c2-6ac6-4837-e6bf-e05c53a5f500/public"},Ey={code:"base",name:"Base",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/3fc7c8ef-6863-43e6-967d-de68e14d4600/public"},xy={code:"celo",name:"Celo",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/7373a7f6-b5dd-4d16-0b98-cbaf9e666300/public"},_y={code:"linea",name:"Linea",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/410a3ea8-d59b-4e88-1c1a-ffa77c157600/public"},Sy={code:"opmainnet",name:"OP Mainnet",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/cd28b090-e932-478e-2a40-7b7d61672d00/public"},Ay={code:"polygon",name:"Polygon",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/386bebc7-3782-4358-978d-ae2b2d4fbf00/public"},Iy={code:"sonic",name:"Sonic",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/e9eaf9b0-3093-4239-d20b-a0c5934ec200/public"},Dy={code:"unichain",name:"Unichain",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/f4c4d2e6-d9a4-4910-febc-ed6de61bd400/public"},Cy={code:"zksync",name:"ZKSync",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/540fbd94-e1d0-4dda-c6d1-426181f37e00/public"},Oy={code:"sui",name:"Sui",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/b9ea70f3-4850-49de-ea4b-e1c4b1ae8700/public"},$y={code:"tezos",name:"Tezos",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/77878400-8af3-45c2-d1e9-2f159c206b00/public"},Py={code:"kaia",name:"Kaia",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/ab53d357-f47b-4285-7ef7-dd9a912cf500/public"},Ty={code:"eos",name:"Eos",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/49e27a4b-2bd4-4911-5c24-f1f99cd41700/public"},By={code:"uniswap",name:"Uniswap",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/b88526db-ae1a-4b67-e6f5-7d7e74c8ed00/public"},ky={code:"hedara",name:"Hedara",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/f6195004-ce8e-4a19-9fbc-46394952a200/public"},Ny={code:"near",name:"Near",img:"https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/4f35d901-0541-440a-7e55-2f06c0dd4300/public"};class es{constructor(e,n){if(this.baseUri=e,this.publishableKey=n,this.clusterBaseUri="",!this.baseUri)throw new Error("baseUri is required");if(!this.publishableKey)throw new Error("publishableKey is required")}async request(e,n){const i=`${this.baseUri}${e}`,r={"Content-Type":"application/json","X-Publishable-Key":`${this.publishableKey}`},s=Object.assign({},n,{headers:r}),o=await fetch(i,s);if(o.ok)return await o.json();throw new Error(o.statusText)}async requestCluster(e,n){const i=`${this.clusterBaseUri}${e}`,s=Object.assign({},n,{headers:{"Content-Type":"application/json"}}),o=await fetch(i,s);if(o.ok)return await o.json();throw new Error(o.statusText)}setClusterBaseUri(e){if(this.clusterBaseUri=e,!this.clusterBaseUri)throw new Error("clusterBaseUri is required")}}const Nl="transaction";class Ry extends es{async createCryptoTransaction(e){return await this.request(`/${Nl}`,{method:"POST",body:JSON.stringify(e)})}async getCryptoTransaction(e){return await this.request(`/${Nl}/${e}`)}}function Ly(t,e){e.forEach(n=>{Object.getOwnPropertyNames(n.prototype).forEach(i=>{const r=Object.getOwnPropertyDescriptor(n.prototype,i);r&&Object.defineProperty(t.prototype,i,r)})})}const Uy="config";class Fy extends es{async getSDKConfig(){return await this.request(`/${Uy}`)}}const Rl="transaction";class My extends es{async createClusterTransaction(e){return await this.requestCluster(`/${Rl}`,{method:"POST",body:JSON.stringify(e)})}async getClusterTransaction(e){return await this.requestCluster(`/${Rl}/${e}`)}}class Ll extends es{}Ly(Ll,[Fy,Ry,My]);var Ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ts(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ul(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var Ji={exports:{}},Fl;function zy(){if(Fl)return Ji.exports;Fl=1,Ji.exports=i,Ji.exports.isMobile=i,Ji.exports.default=i;const t=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|redmi|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,e=/CrOS/,n=/android|ipad|playbook|silk/i;function i(r){r||(r={});let s=r.ua;if(!s&&typeof navigator<"u"&&(s=navigator.userAgent),s&&s.headers&&typeof s.headers["user-agent"]=="string"&&(s=s.headers["user-agent"]),typeof s!="string")return!1;let o=t.test(s)&&!e.test(s)||!!r.tablet&&n.test(s);return!o&&r.tablet&&r.featureDetect&&navigator&&navigator.maxTouchPoints>1&&s.indexOf("Macintosh")!==-1&&s.indexOf("Safari")!==-1&&(o=!0),o}return Ji.exports}var jy=zy();const qy=ts(jy);var Wn={},In={},ns={},Gn={},go={},Ml;function Hy(){return Ml||(Ml=1,Object.defineProperty(go,"__esModule",{value:!0})),go}var yo={},zl;function Vy(){return zl||(zl=1,Object.defineProperty(yo,"__esModule",{value:!0})),yo}var wo={},jl;function Ky(){return jl||(jl=1,Object.defineProperty(wo,"__esModule",{value:!0})),wo}var mo={},ql;function Wy(){return ql||(ql=1,Object.defineProperty(mo,"__esModule",{value:!0})),mo}var bo={},Hl;function Gy(){return Hl||(Hl=1,Object.defineProperty(bo,"__esModule",{value:!0})),bo}var is={},Vl;function Qy(){if(Vl)return is;Vl=1,Object.defineProperty(is,"__esModule",{value:!0}),is.classnames=s;const t=o=>Object.entries(o).map(([a,c])=>c&&a),e=o=>!!o,n=(o,a,c)=>c.indexOf(o)===a,i=[];function r(o){return o?typeof o=="string"?[o]:Array.isArray(o)?o.flatMap(r).filter(e):t(o).filter(e):i}function s(o){const a=r(o).filter(n);return a.length>0?a.join(" "):void 0}return is}var Kl;function Yy(){return Kl||(Kl=1,function(t){var e=Gn&&Gn.__createBinding||(Object.create?function(i,r,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(r,s);(!a||("get"in a?!r.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,o,a)}:function(i,r,s,o){o===void 0&&(o=s),i[o]=r[s]}),n=Gn&&Gn.__exportStar||function(i,r){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&e(r,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(Hy(),t),n(Vy(),t),n(Ky(),t),n(Wy(),t),n(Gy(),t),n(Qy(),t)}(Gn)),Gn}var Wl;function Gl(){if(Wl)return ns;Wl=1,Object.defineProperty(ns,"__esModule",{value:!0}),ns.setAttributes=i;const t=Yy();function e(r,s){for(const o of Object.keys(r))o in s&&(s[o]=r[o])}const n=new RegExp("^on\\p{Lu}","u");function i(r,s){for(const o of Object.keys(s)){if(o==="__source"||o==="__self"||o==="tsxTag")continue;const a=s[o];if(o==="class"){const c=(0,t.classnames)(a);c&&r.setAttribute(o,c)}else if(o==="ref")a.current=r;else if(n.test(o)){const c=o.replace(/Capture$/,""),l=o!==c,u=c.toLowerCase().substring(2);r.addEventListener(u,a,l)}else o==="style"&&typeof a!="string"?e(a,r.style):o==="dangerouslySetInnerHTML"?r.innerHTML=a:a===!0?r.setAttribute(o,o):(a||a===0||a==="")&&r.setAttribute(o,a.toString())}}return ns}var Ii={},Ql;function Yl(){if(Ql)return Ii;Ql=1,Object.defineProperty(Ii,"__esModule",{value:!0}),Ii.applyChildren=e,Ii.createDomElement=n,Ii.applyTsxTag=i;function t(r,s){s instanceof Element?r.appendChild(s):typeof s=="string"||typeof s=="number"?r.appendChild(document.createTextNode(s.toString())):console.warn("Unknown type to append: ",s)}function e(r,s){for(const o of s)!o&&o!==0||(Array.isArray(o)?e(r,o):t(r,o))}function n(r,s){const o=s!=null&&s.is?{is:s.is}:void 0;return s!=null&&s.xmlns?document.createElementNS(s.xmlns,r,o):document.createElement(r,o)}function i(r,s){let o=r,a=s;return a&&"tsxTag"in a&&(o=a.tsxTag,!a.is&&r.includes("-")&&(a={...a,is:r})),{finalTag:o,finalAttrs:a}}return Ii}var Zl;function Zy(){if(Zl)return In;Zl=1,Object.defineProperty(In,"__esModule",{value:!0}),In.createRef=In.h=void 0,In.createElement=n;const t=Gl(),e=Yl();function n(r,s,...o){if(typeof r=="function")return r({...s,children:o});const{finalTag:a,finalAttrs:c}=(0,e.applyTsxTag)(r,s),l=(0,e.createDomElement)(a,c);return c&&(0,t.setAttributes)(l,c),(0,e.applyChildren)(l,o),l}In.h=n;const i=()=>({current:null});return In.createRef=i,In}var rs={},Di={},Jl;function Xl(){if(Jl)return Di;Jl=1,Object.defineProperty(Di,"__esModule",{value:!0}),Di.jsx=n,Di.jsxs=n,Di.jsxDEV=n;const t=Gl(),e=Yl();function n(i,r){if(typeof i=="function")return i(r);const{children:s,...o}=r,{finalTag:a,finalAttrs:c}=(0,e.applyTsxTag)(i,o),l=(0,e.createDomElement)(a,c);return(0,t.setAttributes)(l,c),(0,e.applyChildren)(l,[s]),l}return Di}var eu;function Jy(){if(eu)return rs;eu=1,Object.defineProperty(rs,"__esModule",{value:!0}),rs.defineCustomElement=e;const t=Xl();function e(n,i,r){return customElements.define(n,i,r),s=>(0,t.jsx)(n,s)}return rs}var vo={},tu;function Xy(){return tu||(tu=1,Object.defineProperty(vo,"__esModule",{value:!0})),vo}var nu;function e1(){return nu||(nu=1,function(t){var e=Wn&&Wn.__createBinding||(Object.create?function(i,r,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(r,s);(!a||("get"in a?!r.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,o,a)}:function(i,r,s,o){o===void 0&&(o=s),i[o]=r[s]}),n=Wn&&Wn.__exportStar||function(i,r){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&e(r,i,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(Zy(),t),n(Jy(),t),n(Xl(),t),n(Xy(),t)}(Wn)),Wn}var Dt=e1();function zt(t){const e=`btnAsset${t.code}`;return Dt.h("button",{id:e,class:"w-full flex items-center space-x-2 border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50"},Dt.h("img",{src:t.img,alt:t.title,style:"height: 34px; width: 44px;"}),Dt.h("span",null,t.title)).outerHTML}function Pe(t){const e=`btnNetwork${t.code}`;return Dt.h("button",{id:e,class:"w-full flex items-center space-x-2 border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50"},Dt.h("img",{src:t.img,alt:t.name,style:"height: 34px; width: 44px;"}),Dt.h("span",null,t.name)).outerHTML}var ss={exports:{}},iu;function t1(){if(iu)return ss.exports;iu=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(v,A,L){return Function.prototype.apply.call(v,A,L)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(v){return Object.getOwnPropertyNames(v).concat(Object.getOwnPropertySymbols(v))}:n=function(v){return Object.getOwnPropertyNames(v)};function i(x){console&&console.warn&&console.warn(x)}var r=Number.isNaN||function(v){return v!==v};function s(){s.init.call(this)}ss.exports=s,ss.exports.once=O,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(x){if(typeof x!="number"||x<0||r(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");o=x}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(v){if(typeof v!="number"||v<0||r(v))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+v+".");return this._maxListeners=v,this};function c(x){return x._maxListeners===void 0?s.defaultMaxListeners:x._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(v){for(var A=[],L=1;L<arguments.length;L++)A.push(arguments[L]);var M=v==="error",C=this._events;if(C!==void 0)M=M&&C.error===void 0;else if(!M)return!1;if(M){var z;if(A.length>0&&(z=A[0]),z instanceof Error)throw z;var j=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw j.context=z,j}var q=C[v];if(q===void 0)return!1;if(typeof q=="function")e(q,this,A);else for(var P=q.length,T=f(q,P),L=0;L<P;++L)e(T[L],this,A);return!0};function l(x,v,A,L){var M,C,z;if(a(A),C=x._events,C===void 0?(C=x._events=Object.create(null),x._eventsCount=0):(C.newListener!==void 0&&(x.emit("newListener",v,A.listener?A.listener:A),C=x._events),z=C[v]),z===void 0)z=C[v]=A,++x._eventsCount;else if(typeof z=="function"?z=C[v]=L?[A,z]:[z,A]:L?z.unshift(A):z.push(A),M=c(x),M>0&&z.length>M&&!z.warned){z.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(v)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=x,j.type=v,j.count=z.length,i(j)}return x}s.prototype.addListener=function(v,A){return l(this,v,A,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(v,A){return l(this,v,A,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(x,v,A){var L={fired:!1,wrapFn:void 0,target:x,type:v,listener:A},M=u.bind(L);return M.listener=A,L.wrapFn=M,M}s.prototype.once=function(v,A){return a(A),this.on(v,h(this,v,A)),this},s.prototype.prependOnceListener=function(v,A){return a(A),this.prependListener(v,h(this,v,A)),this},s.prototype.removeListener=function(v,A){var L,M,C,z,j;if(a(A),M=this._events,M===void 0)return this;if(L=M[v],L===void 0)return this;if(L===A||L.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete M[v],M.removeListener&&this.emit("removeListener",v,L.listener||A));else if(typeof L!="function"){for(C=-1,z=L.length-1;z>=0;z--)if(L[z]===A||L[z].listener===A){j=L[z].listener,C=z;break}if(C<0)return this;C===0?L.shift():g(L,C),L.length===1&&(M[v]=L[0]),M.removeListener!==void 0&&this.emit("removeListener",v,j||A)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(v){var A,L,M;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[v]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[v]),this;if(arguments.length===0){var C=Object.keys(L),z;for(M=0;M<C.length;++M)z=C[M],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=L[v],typeof A=="function")this.removeListener(v,A);else if(A!==void 0)for(M=A.length-1;M>=0;M--)this.removeListener(v,A[M]);return this};function d(x,v,A){var L=x._events;if(L===void 0)return[];var M=L[v];return M===void 0?[]:typeof M=="function"?A?[M.listener||M]:[M]:A?I(M):f(M,M.length)}s.prototype.listeners=function(v){return d(this,v,!0)},s.prototype.rawListeners=function(v){return d(this,v,!1)},s.listenerCount=function(x,v){return typeof x.listenerCount=="function"?x.listenerCount(v):y.call(x,v)},s.prototype.listenerCount=y;function y(x){var v=this._events;if(v!==void 0){var A=v[x];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function f(x,v){for(var A=new Array(v),L=0;L<v;++L)A[L]=x[L];return A}function g(x,v){for(;v+1<x.length;v++)x[v]=x[v+1];x.pop()}function I(x){for(var v=new Array(x.length),A=0;A<v.length;++A)v[A]=x[A].listener||x[A];return v}function O(x,v){return new Promise(function(A,L){function M(z){x.removeListener(v,C),L(z)}function C(){typeof x.removeListener=="function"&&x.removeListener("error",M),A([].slice.call(arguments))}D(x,v,C,{once:!0}),v!=="error"&&B(x,M,{once:!0})})}function B(x,v,A){typeof x.on=="function"&&D(x,"error",v,A)}function D(x,v,A,L){if(typeof x.on=="function")L.once?x.once(v,A):x.on(v,A);else if(typeof x.addEventListener=="function")x.addEventListener(v,function M(C){L.once&&x.removeEventListener(v,M),A(C)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x)}return ss.exports}var jt=t1();const ru=ts(jt);var Eo={};/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var xo=function(t,e){return xo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r])},xo(t,e)};function n1(t,e){xo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var _o=function(){return _o=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_o.apply(this,arguments)};function i1(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function r1(t,e,n,i){var r=arguments.length,s=r<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s}function s1(t,e){return function(n,i){e(n,i,t)}}function o1(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function a1(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function c1(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function l1(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}function u1(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function So(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function su(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function h1(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(su(arguments[e]));return t}function d1(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,r++)i[r]=s[o];return i}function Xi(t){return this instanceof Xi?(this.v=t,this):new Xi(t)}function f1(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(d){i[d]&&(r[d]=function(y){return new Promise(function(f,g){s.push([d,y,f,g])>1||a(d,y)})})}function a(d,y){try{c(i[d](y))}catch(f){h(s[0][3],f)}}function c(d){d.value instanceof Xi?Promise.resolve(d.value.v).then(l,u):h(s[0][2],d)}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,y){d(y),s.shift(),s.length&&a(s[0][0],s[0][1])}}function p1(t){var e,n;return e={},i("next"),i("throw",function(r){throw r}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(r,s){e[r]=t[r]?function(o){return(n=!n)?{value:Xi(t[r](o)),done:r==="return"}:s?s(o):o}:s}}function g1(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof So=="function"?So(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function y1(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function w1(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function m1(t){return t&&t.__esModule?t:{default:t}}function b1(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function v1(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const os=Ul(Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return _o},__asyncDelegator:p1,__asyncGenerator:f1,__asyncValues:g1,__await:Xi,__awaiter:a1,__classPrivateFieldGet:b1,__classPrivateFieldSet:v1,__createBinding:l1,__decorate:r1,__exportStar:u1,__extends:n1,__generator:c1,__importDefault:m1,__importStar:w1,__makeTemplateObject:y1,__metadata:o1,__param:s1,__read:su,__rest:i1,__spread:h1,__spreadArrays:d1,__values:So},Symbol.toStringTag,{value:"Module"})));var Ao={},er={},ou;function E1(){if(ou)return er;ou=1,Object.defineProperty(er,"__esModule",{value:!0}),er.delay=void 0;function t(e){return new Promise(n=>{setTimeout(()=>{n(!0)},e)})}return er.delay=t,er}var Qn={},Io={},Yn={},au;function x1(){return au||(au=1,Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.ONE_THOUSAND=Yn.ONE_HUNDRED=void 0,Yn.ONE_HUNDRED=100,Yn.ONE_THOUSAND=1e3),Yn}var Do={},cu;function _1(){return cu||(cu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Do)),Do}var lu;function uu(){return lu||(lu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=os;e.__exportStar(x1(),t),e.__exportStar(_1(),t)}(Io)),Io}var hu;function S1(){if(hu)return Qn;hu=1,Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.fromMiliseconds=Qn.toMiliseconds=void 0;const t=uu();function e(i){return i*t.ONE_THOUSAND}Qn.toMiliseconds=e;function n(i){return Math.floor(i/t.ONE_THOUSAND)}return Qn.fromMiliseconds=n,Qn}var du;function A1(){return du||(du=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=os;e.__exportStar(E1(),t),e.__exportStar(S1(),t)}(Ao)),Ao}var Ci={},fu;function I1(){if(fu)return Ci;fu=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const i=this.get(n);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const r=Date.now()-i.started;this.timestamps.set(n,{started:i.started,elapsed:r})}get(n){const i=this.timestamps.get(n);if(typeof i>"u")throw new Error(`No timestamp found for label: ${n}`);return i}elapsed(n){const i=this.get(n);return i.elapsed||Date.now()-i.started}}return Ci.Watch=t,Ci.default=t,Ci}var Co={},tr={},pu;function D1(){if(pu)return tr;pu=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.IWatch=void 0;class t{}return tr.IWatch=t,tr}var gu;function C1(){return gu||(gu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),os.__exportStar(D1(),t)}(Co)),Co}var yu;function O1(){return yu||(yu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=os;e.__exportStar(A1(),t),e.__exportStar(I1(),t),e.__exportStar(C1(),t),e.__exportStar(uu(),t)}(Eo)),Eo}var ee=O1();class Zn{}let $1=class extends Zn{constructor(e){super()}};const wu=ee.FIVE_SECONDS,Jn={pulse:"heartbeat_pulse"};let P1=class g0 extends $1{constructor(e){super(e),this.events=new jt.EventEmitter,this.interval=wu,this.interval=(e==null?void 0:e.interval)||wu}static async init(e){const n=new g0(e);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),ee.toMiliseconds(this.interval))}pulse(){this.events.emit(Jn.pulse)}};const T1=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,B1=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,k1=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function N1(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){R1(t);return}return e}function R1(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function as(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!k1.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(T1.test(t)||B1.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,N1)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function L1(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ze(t,...e){try{return L1(t(...e))}catch(n){return Promise.reject(n)}}function U1(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function F1(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function cs(t){if(U1(t))return String(t);if(F1(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return cs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Oo="base64:";function M1(t){return typeof t=="string"?t:Oo+q1(t)}function z1(t){return typeof t!="string"||!t.startsWith(Oo)?t:j1(t.slice(Oo.length))}function j1(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function q1(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function lt(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function H1(...t){return lt(t.join(":"))}function ls(t){return t=lt(t),t?t+":":""}function V1(t,e){if(e===void 0)return!0;let n=0,i=t.indexOf(":");for(;i>-1;)n++,i=t.indexOf(":",i+1);return n<=e}function K1(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function kC(t){return t}const W1="memory",G1=()=>{const t=new Map;return{name:W1,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,n){t.set(e,n)},setItemRaw(e,n){t.set(e,n)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Q1(t={}){const e={mounts:{"":t.driver||G1()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),r=(l,u)=>{if(e.watching){u=lt(u);for(const h of e.watchListeners)h(l,u)}},s=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await mu(e.mounts[l],r,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const d=new Map,y=f=>{let g=d.get(f.base);return g||(g={driver:f.driver,base:f.base,items:[]},d.set(f.base,g)),g};for(const f of l){const g=typeof f=="string",I=lt(g?f:f.key),O=g?void 0:f.value,B=g||!f.options?u:{...u,...f.options},D=n(I);y(D).items.push({key:I,value:O,relativeKey:D.relativeKey,options:B})}return Promise.all([...d.values()].map(f=>h(f))).then(f=>f.flat())},c={hasItem(l,u={}){l=lt(l);const{relativeKey:h,driver:d}=n(l);return ze(d.hasItem,h,u)},getItem(l,u={}){l=lt(l);const{relativeKey:h,driver:d}=n(l);return ze(d.getItem,h,u).then(y=>as(y))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?ze(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),u).then(d=>d.map(y=>({key:H1(h.base,y.key),value:as(y.value)}))):Promise.all(h.items.map(d=>ze(h.driver.getItem,d.relativeKey,d.options).then(y=>({key:d.key,value:as(y)})))))},getItemRaw(l,u={}){l=lt(l);const{relativeKey:h,driver:d}=n(l);return d.getItemRaw?ze(d.getItemRaw,h,u):ze(d.getItem,h,u).then(y=>z1(y))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=lt(l);const{relativeKey:d,driver:y}=n(l);y.setItem&&(await ze(y.setItem,d,cs(u),h),y.watch||r("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return ze(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:cs(d.value),options:d.options})),u);h.driver.setItem&&await Promise.all(h.items.map(d=>ze(h.driver.setItem,d.relativeKey,cs(d.value),d.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=lt(l);const{relativeKey:d,driver:y}=n(l);if(y.setItemRaw)await ze(y.setItemRaw,d,u,h);else if(y.setItem)await ze(y.setItem,d,M1(u),h);else return;y.watch||r("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=lt(l);const{relativeKey:h,driver:d}=n(l);d.removeItem&&(await ze(d.removeItem,h,u),(u.removeMeta||u.removeMata)&&await ze(d.removeItem,h+"$",u),d.watch||r("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=lt(l);const{relativeKey:h,driver:d}=n(l),y=Object.create(null);if(d.getMeta&&Object.assign(y,await ze(d.getMeta,h,u)),!u.nativeOnly){const f=await ze(d.getItem,h+"$",u).then(g=>as(g));f&&typeof f=="object"&&(typeof f.atime=="string"&&(f.atime=new Date(f.atime)),typeof f.mtime=="string"&&(f.mtime=new Date(f.mtime)),Object.assign(y,f))}return y},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var I;l=ls(l);const h=i(l,!0);let d=[];const y=[];let f=!0;for(const O of h){(I=O.driver.flags)!=null&&I.maxDepth||(f=!1);const B=await ze(O.driver.getKeys,O.relativeBase,u);for(const D of B){const x=O.mountpoint+lt(D);d.some(v=>x.startsWith(v))||y.push(x)}d=[O.mountpoint,...d.filter(D=>!D.startsWith(O.mountpoint))]}const g=u.maxDepth!==void 0&&!f;return y.filter(O=>(!g||V1(O,u.maxDepth))&&K1(O,l))},async clear(l,u={}){l=ls(l),await Promise.all(i(l,!1).map(async h=>{if(h.driver.clear)return ze(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const d=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(d.map(y=>h.driver.removeItem(y,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>bu(l)))},async watch(l){return await s(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=ls(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(mu(u,r,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,d;l=ls(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((d=(h=e.unwatch)[l])==null||d.call(h),delete e.unwatch[l]),u&&await bu(e.mounts[l]),e.mountpoints=e.mountpoints.filter(y=>y!==l),delete e.mounts[l])},getMount(l=""){l=lt(l)+":";const u=n(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=lt(l),i(l,u.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function mu(t,e,n){return t.watch?t.watch((i,r)=>e(i,n+r)):()=>{}}async function bu(t){typeof t.dispose=="function"&&await ze(t.dispose)}function Xn(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function vu(t,e){let n;const i=()=>{if(n)return n;const r=indexedDB.open(t);return r.onupgradeneeded=()=>r.result.createObjectStore(e),n=Xn(r),n.then(s=>{s.onclose=()=>n=void 0},()=>{}),n};return(r,s)=>i().then(o=>s(o.transaction(e,r).objectStore(e)))}let $o;function nr(){return $o||($o=vu("keyval-store","keyval")),$o}function Eu(t,e=nr()){return e("readonly",n=>Xn(n.get(t)))}function Y1(t,e,n=nr()){return n("readwrite",i=>(i.put(e,t),Xn(i.transaction)))}function Z1(t,e=nr()){return e("readwrite",n=>(n.delete(t),Xn(n.transaction)))}function J1(t=nr()){return t("readwrite",e=>(e.clear(),Xn(e.transaction)))}function X1(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Xn(t.transaction)}function ew(t=nr()){return t("readonly",e=>{if(e.getAllKeys)return Xn(e.getAllKeys());const n=[];return X1(e,i=>n.push(i.key)).then(()=>n)})}const tw=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),nw=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(i,r)=>typeof r=="string"&&r.match(/^\d+n$/)?BigInt(r.substring(0,r.length-1)):r)};function Oi(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return nw(t)}catch{return t}}function ei(t){return typeof t=="string"?t:tw(t)||""}const iw="idb-keyval";var rw=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",n=r=>e+r;let i;return t.dbName&&t.storeName&&(i=vu(t.dbName,t.storeName)),{name:iw,options:t,async hasItem(r){return!(typeof await Eu(n(r),i)>"u")},async getItem(r){return await Eu(n(r),i)??null},setItem(r,s){return Y1(n(r),s,i)},removeItem(r){return Z1(n(r),i)},getKeys(){return ew(i)},clear(){return J1(i)}}};const sw="WALLET_CONNECT_V2_INDEXED_DB",ow="keyvaluestorage";let aw=class{constructor(){this.indexedDb=Q1({driver:rw({dbName:sw,storeName:ow})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const n=await this.indexedDb.getItem(e);if(n!==null)return n}async setItem(e,n){await this.indexedDb.setItem(e,ei(n))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},us={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},t.prototype.setItem=function(n,i){this[n]=String(i)},t.prototype.removeItem=function(n){delete this[n]},t.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(i){n[i]=void 0,delete n[i]})},t.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Po<"u"&&Po.localStorage?us.exports=Po.localStorage:typeof window<"u"&&window.localStorage?us.exports=window.localStorage:us.exports=new e})();function cw(t){var e;return[t[0],Oi((e=t[1])!=null?e:"")]}let lw=class{constructor(){this.localStorage=us.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(cw)}async getItem(e){const n=this.localStorage.getItem(e);if(n!==null)return Oi(n)}async setItem(e,n){this.localStorage.setItem(e,ei(n))}async removeItem(e){this.localStorage.removeItem(e)}};const uw="wc_storage_version",xu=1,hw=async(t,e,n)=>{const i=uw,r=await e.getItem(i);if(r&&r>=xu){n(e);return}const s=await t.getKeys();if(!s.length){n(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(i,xu),n(e),dw(t,o)},dw=async(t,e)=>{e.length&&e.forEach(async n=>{await t.removeItem(n)})};let fw=class{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const e=new lw;this.storage=e;try{const n=new aw;hw(e,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,n){return await this.initialize(),this.storage.setItem(e,n)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),e())},20)})}};var To,_u;function pw(){if(_u)return To;_u=1;function t(n){try{return JSON.stringify(n)}catch{return'"[Circular]"'}}To=e;function e(n,i,r){var s=r&&r.stringify||t,o=1;if(typeof n=="object"&&n!==null){var a=i.length+o;if(a===1)return n;var c=new Array(a);c[0]=s(n);for(var l=1;l<a;l++)c[l]=s(i[l]);return c.join(" ")}if(typeof n!="string")return n;var u=i.length;if(u===0)return n;for(var h="",d=1-o,y=-1,f=n&&n.length||0,g=0;g<f;){if(n.charCodeAt(g)===37&&g+1<f){switch(y=y>-1?y:0,n.charCodeAt(g+1)){case 100:case 102:if(d>=u||i[d]==null)break;y<g&&(h+=n.slice(y,g)),h+=Number(i[d]),y=g+2,g++;break;case 105:if(d>=u||i[d]==null)break;y<g&&(h+=n.slice(y,g)),h+=Math.floor(Number(i[d])),y=g+2,g++;break;case 79:case 111:case 106:if(d>=u||i[d]===void 0)break;y<g&&(h+=n.slice(y,g));var I=typeof i[d];if(I==="string"){h+="'"+i[d]+"'",y=g+2,g++;break}if(I==="function"){h+=i[d].name||"<anonymous>",y=g+2,g++;break}h+=s(i[d]),y=g+2,g++;break;case 115:if(d>=u)break;y<g&&(h+=n.slice(y,g)),h+=String(i[d]),y=g+2,g++;break;case 37:y<g&&(h+=n.slice(y,g)),h+="%",y=g+2,g++,d--;break}++d}++g}return y===-1?n:(y<f&&(h+=n.slice(y)),h)}return To}var Bo,Su;function gw(){if(Su)return Bo;Su=1;const t=pw();Bo=r;const e=v().console||{},n={mapHttpRequest:f,mapHttpResponse:f,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:f,res:f,err:d};function i(A,L){return Array.isArray(A)?A.filter(function(C){return C!=="!stdSerializers.err"}):A===!0?Object.keys(L):!1}function r(A){A=A||{},A.browser=A.browser||{};const L=A.browser.transmit;if(L&&typeof L.send!="function")throw Error("pino: transmit option must have a send function");const M=A.browser.write||e;A.browser.write&&(A.browser.asObject=!0);const C=A.serializers||{},z=i(A.browser.serialize,C);let j=A.browser.serialize;Array.isArray(A.browser.serialize)&&A.browser.serialize.indexOf("!stdSerializers.err")>-1&&(j=!1);const q=["error","fatal","warn","info","debug","trace"];typeof M=="function"&&(M.error=M.fatal=M.warn=M.info=M.debug=M.trace=M),A.enabled===!1&&(A.level="silent");const P=A.level||"info",T=Object.create(M);T.log||(T.log=I),Object.defineProperty(T,"levelVal",{get:m}),Object.defineProperty(T,"level",{get:_,set:k});const S={transmit:L,serialize:z,asObject:A.browser.asObject,levels:q,timestamp:y(A)};T.levels=r.levels,T.level=P,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=I,T.serializers=C,T._serialize=z,T._stdErrSerialize=j,T.child=R,L&&(T._logEvent=h());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function _(){return this._level}function k(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,s(S,T,"error","log"),s(S,T,"fatal","error"),s(S,T,"warn","error"),s(S,T,"info","log"),s(S,T,"debug","log"),s(S,T,"trace","log")}function R(U,H){if(!U)throw new Error("missing bindings for child Pino");H=H||{},z&&U.serializers&&(H.serializers=U.serializers);const G=H.serializers;if(z&&G){var Q=Object.assign({},C,G),Z=A.browser.serialize===!0?Object.keys(Q):z;delete U.serializers,c([U],Z,Q,this._stdErrSerialize)}function X(re){this._childLevel=(re._childLevel|0)+1,this.error=l(re,U,"error"),this.fatal=l(re,U,"fatal"),this.warn=l(re,U,"warn"),this.info=l(re,U,"info"),this.debug=l(re,U,"debug"),this.trace=l(re,U,"trace"),Q&&(this.serializers=Q,this._serialize=Z),L&&(this._logEvent=h([].concat(re._logEvent.bindings,U)))}return X.prototype=this,new X(this)}return T}r.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},r.stdSerializers=n,r.stdTimeFunctions=Object.assign({},{nullTime:O,epochTime:B,unixTime:D,isoTime:x});function s(A,L,M,C){const z=Object.getPrototypeOf(L);L[M]=L.levelVal>L.levels.values[M]?I:z[M]?z[M]:e[M]||e[C]||I,o(A,L,M)}function o(A,L,M){!A.transmit&&L[M]===I||(L[M]=function(C){return function(){const j=A.timestamp(),q=new Array(arguments.length),P=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var T=0;T<q.length;T++)q[T]=arguments[T];if(A.serialize&&!A.asObject&&c(q,this._serialize,this.serializers,this._stdErrSerialize),A.asObject?C.call(P,a(this,M,q,j)):C.apply(P,q),A.transmit){const S=A.transmit.level||L.level,m=r.levels.values[S],_=r.levels.values[M];if(_<m)return;u(this,{ts:j,methodLevel:M,methodValue:_,transmitValue:r.levels.values[A.transmit.level||L.level],send:A.transmit.send,val:L.levelVal},q)}}}(L[M]))}function a(A,L,M,C){A._serialize&&c(M,A._serialize,A.serializers,A._stdErrSerialize);const z=M.slice();let j=z[0];const q={};C&&(q.time=C),q.level=r.levels.values[L];let P=(A._childLevel|0)+1;if(P<1&&(P=1),j!==null&&typeof j=="object"){for(;P--&&typeof z[0]=="object";)Object.assign(q,z.shift());j=z.length?t(z.shift(),z):void 0}else typeof j=="string"&&(j=t(z.shift(),z));return j!==void 0&&(q.msg=j),q}function c(A,L,M,C){for(const z in A)if(C&&A[z]instanceof Error)A[z]=r.stdSerializers.err(A[z]);else if(typeof A[z]=="object"&&!Array.isArray(A[z]))for(const j in A[z])L&&L.indexOf(j)>-1&&j in M&&(A[z][j]=M[j](A[z][j]))}function l(A,L,M){return function(){const C=new Array(1+arguments.length);C[0]=L;for(var z=1;z<C.length;z++)C[z]=arguments[z-1];return A[M].apply(this,C)}}function u(A,L,M){const C=L.send,z=L.ts,j=L.methodLevel,q=L.methodValue,P=L.val,T=A._logEvent.bindings;c(M,A._serialize||Object.keys(A.serializers),A.serializers,A._stdErrSerialize===void 0?!0:A._stdErrSerialize),A._logEvent.ts=z,A._logEvent.messages=M.filter(function(S){return T.indexOf(S)===-1}),A._logEvent.level.label=j,A._logEvent.level.value=q,C(j,A._logEvent,P),A._logEvent=h(T)}function h(A){return{ts:0,messages:[],bindings:A||[],level:{label:"",value:0}}}function d(A){const L={type:A.constructor.name,msg:A.message,stack:A.stack};for(const M in A)L[M]===void 0&&(L[M]=A[M]);return L}function y(A){return typeof A.timestamp=="function"?A.timestamp:A.timestamp===!1?O:B}function f(){return{}}function g(A){return A}function I(){}function O(){return!1}function B(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function x(){return new Date(Date.now()).toISOString()}function v(){function A(L){return typeof L<"u"&&L}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return A(self)||A(window)||A(this)||{}}}return Bo}var $i=gw();const hs=ts($i),yw={level:"info"},ir="custom_context",ko=1e3*1024;let ww=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Au=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const n=new ww(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const n=e.value;return e=e.next,{done:!1,value:n}}}}},Iu=class{constructor(e,n=ko){this.level=e??"error",this.levelValue=$i.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new Au(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===$i.levels.values.error?console.error(e):n===$i.levels.values.warn?console.warn(e):n===$i.levels.values.debug?console.debug(e):n===$i.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(ei({timestamp:new Date().toISOString(),log:e}));const n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new Au(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const n=this.getLogArray();return n.push(ei({extraMetadata:e})),new Blob(n,{type:"application/json"})}},mw=class{constructor(e,n=ko){this.baseChunkLogger=new Iu(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const n=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=n,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}},bw=class{constructor(e,n=ko){this.baseChunkLogger=new Iu(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var vw=Object.defineProperty,Ew=Object.defineProperties,xw=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,_w=Object.prototype.hasOwnProperty,Sw=Object.prototype.propertyIsEnumerable,Cu=(t,e,n)=>e in t?vw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ds=(t,e)=>{for(var n in e||(e={}))_w.call(e,n)&&Cu(t,n,e[n]);if(Du)for(var n of Du(e))Sw.call(e,n)&&Cu(t,n,e[n]);return t},fs=(t,e)=>Ew(t,xw(e));function No(t){return fs(ds({},t),{level:(t==null?void 0:t.level)||yw.level})}function Aw(t,e=ir){return t[e]||""}function Iw(t,e,n=ir){return t[n]=e,t}function ut(t,e=ir){let n="";return typeof t.bindings>"u"?n=Aw(t,e):n=t.bindings().context||"",n}function Dw(t,e,n=ir){const i=ut(t,n);return i.trim()?`${i}/${e}`:e}function st(t,e,n=ir){const i=Dw(t,e,n),r=t.child({context:i});return Iw(r,i,n)}function Cw(t){var e,n;const i=new mw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hs(fs(ds({},t.opts),{level:"trace",browser:fs(ds({},(n=t.opts)==null?void 0:n.browser),{write:r=>i.write(r)})})),chunkLoggerController:i}}function Ow(t){var e;const n=new bw((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:hs(fs(ds({},t.opts),{level:"trace"}),n),chunkLoggerController:n}}function $w(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Cw(t):Ow(t)}var Pw=Object.defineProperty,Tw=(t,e,n)=>e in t?Pw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ou=(t,e,n)=>Tw(t,typeof e!="symbol"?e+"":e,n);let Bw=class extends Zn{constructor(e){super(),this.opts=e,Ou(this,"protocol","wc"),Ou(this,"version",2)}};var kw=Object.defineProperty,Nw=(t,e,n)=>e in t?kw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Rw=(t,e,n)=>Nw(t,e+"",n);let Lw=class extends Zn{constructor(e,n){super(),this.core=e,this.logger=n,Rw(this,"records",new Map)}},Uw=class{constructor(e,n){this.logger=e,this.core=n}};class Fw extends Zn{constructor(e,n){super(),this.relayer=e,this.logger=n}}let Mw=class extends Zn{constructor(e){super()}},zw=class{constructor(e,n,i,r){this.core=e,this.logger=n,this.name=i}},jw=class extends Zn{constructor(e,n){super(),this.relayer=e,this.logger=n}},qw=class extends Zn{constructor(e,n){super(),this.core=e,this.logger=n}},Hw=class{constructor(e,n,i){this.core=e,this.logger=n,this.store=i}},Vw=class{constructor(e,n){this.projectId=e,this.logger=n}};class Kw{constructor(e,n,i){this.core=e,this.logger=n,this.telemetryEnabled=i}}var Ww=Object.defineProperty,Gw=(t,e,n)=>e in t?Ww(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$u=(t,e,n)=>Gw(t,typeof e!="symbol"?e+"":e,n);let Qw=class{constructor(e){this.opts=e,$u(this,"protocol","wc"),$u(this,"version",2)}},Yw=class{constructor(e){this.client=e}};function Zw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pu(t,...e){if(!Zw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Tu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Jw(t,e){Pu(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const Pi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ro=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Xw(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Bu(t){return typeof t=="string"&&(t=Xw(t)),Pu(t),t}let em=class{clone(){return this._cloneInto()}};function tm(t){const e=i=>t().update(Bu(i)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function ku(t=32){if(Pi&&typeof Pi.getRandomValues=="function")return Pi.getRandomValues(new Uint8Array(t));if(Pi&&typeof Pi.randomBytes=="function")return Pi.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function nm(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(n>>r&s),a=Number(n&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}let im=class extends em{constructor(e,n,i,r){super(),this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ro(this.buffer)}update(e){Tu(this);const{view:n,buffer:i,blockLen:r}=this;e=Bu(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a===r){const c=Ro(e);for(;r<=s-o;o+=r)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Tu(this),Jw(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:r,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(i,0),o=0);for(let h=o;h<r;h++)n[h]=0;nm(i,r-8,BigInt(this.length*8),s),this.process(i,0);const a=Ro(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:r,finished:s,destroyed:o,pos:a}=this;return e.length=r,e.pos=a,e.finished=s,e.destroyed=o,r%n&&e.buffer.set(i),e}};const ps=BigInt(2**32-1),Lo=BigInt(32);function Nu(t,e=!1){return e?{h:Number(t&ps),l:Number(t>>Lo&ps)}:{h:Number(t>>Lo&ps)|0,l:Number(t&ps)|0}}function rm(t,e=!1){let n=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let r=0;r<t.length;r++){const{h:s,l:o}=Nu(t[r],e);[n[r],i[r]]=[s,o]}return[n,i]}const sm=(t,e)=>BigInt(t>>>0)<<Lo|BigInt(e>>>0),om=(t,e,n)=>t>>>n,am=(t,e,n)=>t<<32-n|e>>>n,cm=(t,e,n)=>t>>>n|e<<32-n,lm=(t,e,n)=>t<<32-n|e>>>n,um=(t,e,n)=>t<<64-n|e>>>n-32,hm=(t,e,n)=>t>>>n-32|e<<64-n,dm=(t,e)=>e,fm=(t,e)=>t,pm=(t,e,n)=>t<<n|e>>>32-n,gm=(t,e,n)=>e<<n|t>>>32-n,ym=(t,e,n)=>e<<n-32|t>>>64-n,wm=(t,e,n)=>t<<n-32|e>>>64-n;function mm(t,e,n,i){const r=(e>>>0)+(i>>>0);return{h:t+n+(r/2**32|0)|0,l:r|0}}const bm=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),vm=(t,e,n,i)=>e+n+i+(t/2**32|0)|0,Em=(t,e,n,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0),xm=(t,e,n,i,r)=>e+n+i+r+(t/2**32|0)|0,_m=(t,e,n,i,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0)+(r>>>0),Sm=(t,e,n,i,r,s)=>e+n+i+r+s+(t/2**32|0)|0,ye={fromBig:Nu,split:rm,toBig:sm,shrSH:om,shrSL:am,rotrSH:cm,rotrSL:lm,rotrBH:um,rotrBL:hm,rotr32H:dm,rotr32L:fm,rotlSH:pm,rotlSL:gm,rotlBH:ym,rotlBL:wm,add:mm,add3L:bm,add3H:vm,add4L:Em,add4H:xm,add5H:Sm,add5L:_m},[Am,Im]=ye.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Dn=new Uint32Array(80),Cn=new Uint32Array(80);let Dm=class extends im{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:i,Bl:r,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:y,Gl:f,Hh:g,Hl:I}=this;return[e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I]}set(e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I){this.Ah=e|0,this.Al=n|0,this.Bh=i|0,this.Bl=r|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=I|0}process(e,n){for(let D=0;D<16;D++,n+=4)Dn[D]=e.getUint32(n),Cn[D]=e.getUint32(n+=4);for(let D=16;D<80;D++){const x=Dn[D-15]|0,v=Cn[D-15]|0,A=ye.rotrSH(x,v,1)^ye.rotrSH(x,v,8)^ye.shrSH(x,v,7),L=ye.rotrSL(x,v,1)^ye.rotrSL(x,v,8)^ye.shrSL(x,v,7),M=Dn[D-2]|0,C=Cn[D-2]|0,z=ye.rotrSH(M,C,19)^ye.rotrBH(M,C,61)^ye.shrSH(M,C,6),j=ye.rotrSL(M,C,19)^ye.rotrBL(M,C,61)^ye.shrSL(M,C,6),q=ye.add4L(L,j,Cn[D-7],Cn[D-16]),P=ye.add4H(q,A,z,Dn[D-7],Dn[D-16]);Dn[D]=P|0,Cn[D]=q|0}let{Ah:i,Al:r,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:y,Fl:f,Gh:g,Gl:I,Hh:O,Hl:B}=this;for(let D=0;D<80;D++){const x=ye.rotrSH(h,d,14)^ye.rotrSH(h,d,18)^ye.rotrBH(h,d,41),v=ye.rotrSL(h,d,14)^ye.rotrSL(h,d,18)^ye.rotrBL(h,d,41),A=h&y^~h&g,L=d&f^~d&I,M=ye.add5L(B,v,L,Im[D],Cn[D]),C=ye.add5H(M,O,x,A,Am[D],Dn[D]),z=M|0,j=ye.rotrSH(i,r,28)^ye.rotrBH(i,r,34)^ye.rotrBH(i,r,39),q=ye.rotrSL(i,r,28)^ye.rotrBL(i,r,34)^ye.rotrBL(i,r,39),P=i&s^i&a^s&a,T=r&o^r&c^o&c;O=g|0,B=I|0,g=y|0,I=f|0,y=h|0,f=d|0,{h,l:d}=ye.add(l|0,u|0,C|0,z|0),l=a|0,u=c|0,a=s|0,c=o|0,s=i|0,o=r|0;const S=ye.add3L(z,q,T);i=ye.add3H(S,C,j,P),r=S|0}({h:i,l:r}=ye.add(this.Ah|0,this.Al|0,i|0,r|0)),{h:s,l:o}=ye.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ye.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ye.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=ye.add(this.Eh|0,this.El|0,h|0,d|0),{h:y,l:f}=ye.add(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:I}=ye.add(this.Gh|0,this.Gl|0,g|0,I|0),{h:O,l:B}=ye.add(this.Hh|0,this.Hl|0,O|0,B|0),this.set(i,r,s,o,a,c,l,u,h,d,y,f,g,I,O,B)}roundClean(){Dn.fill(0),Cn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const Cm=tm(()=>new Dm);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Uo=BigInt(0),Ru=BigInt(1),Om=BigInt(2);function Fo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Mo(t){if(!Fo(t))throw new Error("Uint8Array expected")}function zo(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const $m=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function jo(t){Mo(t);let e="";for(let n=0;n<t.length;n++)e+=$m[t[n]];return e}function Lu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Uo:BigInt("0x"+t)}const cn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Uu(t){if(t>=cn._0&&t<=cn._9)return t-cn._0;if(t>=cn.A&&t<=cn.F)return t-(cn.A-10);if(t>=cn.a&&t<=cn.f)return t-(cn.a-10)}function Fu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let r=0,s=0;r<n;r++,s+=2){const o=Uu(t.charCodeAt(s)),a=Uu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[r]=o*16+a}return i}function Pm(t){return Lu(jo(t))}function gs(t){return Mo(t),Lu(jo(Uint8Array.from(t).reverse()))}function Mu(t,e){return Fu(t.toString(16).padStart(e*2,"0"))}function qo(t,e){return Mu(t,e).reverse()}function ln(t,e,n){let i;if(typeof e=="string")try{i=Fu(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Fo(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=i.length;if(typeof n=="number"&&r!==n)throw new Error(t+" of length "+n+" expected, got "+r);return i}function zu(...t){let e=0;for(let i=0;i<t.length;i++){const r=t[i];Mo(r),e+=r.length}const n=new Uint8Array(e);for(let i=0,r=0;i<t.length;i++){const s=t[i];n.set(s,r),r+=s.length}return n}const Ho=t=>typeof t=="bigint"&&Uo<=t;function Tm(t,e,n){return Ho(t)&&Ho(e)&&Ho(n)&&e<=t&&t<n}function rr(t,e,n,i){if(!Tm(e,n,i))throw new Error("expected valid "+t+": "+n+" <= n < "+i+", got "+e)}function Bm(t){let e;for(e=0;t>Uo;t>>=Ru,e+=1);return e}const km=t=>(Om<<BigInt(t-1))-Ru,Nm={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Fo(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Vo(t,e,n={}){const i=(r,s,o)=>{const a=Nm[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[r];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(r)+" is invalid. Expected "+s+", got "+c)};for(const[r,s]of Object.entries(e))i(r,s,!1);for(const[r,s]of Object.entries(n))i(r,s,!0);return t}function ju(t){const e=new WeakMap;return(n,...i)=>{const r=e.get(n);if(r!==void 0)return r;const s=t(n,...i);return e.set(n,s),s}}const je=BigInt(0),Be=BigInt(1),ti=BigInt(2),Rm=BigInt(3),Ko=BigInt(4),qu=BigInt(5),Hu=BigInt(8);function Le(t,e){const n=t%e;return n>=je?n:e+n}function Lm(t,e,n){if(e<je)throw new Error("invalid exponent, negatives unsupported");if(n<=je)throw new Error("invalid modulus");if(n===Be)return je;let i=Be;for(;e>je;)e&Be&&(i=i*t%n),t=t*t%n,e>>=Be;return i}function Zt(t,e,n){let i=t;for(;e-- >je;)i*=i,i%=n;return i}function Vu(t,e){if(t===je)throw new Error("invert: expected non-zero number");if(e<=je)throw new Error("invert: expected positive modulus, got "+e);let n=Le(t,e),i=e,r=je,s=Be;for(;n!==je;){const o=i/n,a=i%n,c=r-s*o;i=n,n=a,r=s,s=c}if(i!==Be)throw new Error("invert: does not exist");return Le(r,e)}function Um(t){const e=(t-Be)/ti;let n,i,r;for(n=t-Be,i=0;n%ti===je;n/=ti,i++);for(r=ti;r<t&&Lm(r,e,t)!==t-Be;r++)if(r>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+Be)/Ko;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(n+Be)/ti;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,l=o.pow(o.mul(o.ONE,r),n),u=o.pow(a,s),h=o.pow(a,n);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let f=o.sqr(h);d<c&&!o.eql(f,o.ONE);d++)f=o.sqr(f);const y=o.pow(l,Be<<BigInt(c-d-1));l=o.sqr(y),u=o.mul(u,y),h=o.mul(h,l),c=d}return u}}function Fm(t){if(t%Ko===Rm){const e=(t+Be)/Ko;return function(n,i){const r=n.pow(i,e);if(!n.eql(n.sqr(r),i))throw new Error("Cannot find square root");return r}}if(t%Hu===qu){const e=(t-qu)/Hu;return function(n,i){const r=n.mul(i,ti),s=n.pow(r,e),o=n.mul(i,s),a=n.mul(n.mul(o,ti),s),c=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(c),i))throw new Error("Cannot find square root");return c}}return Um(t)}const Mm=(t,e)=>(Le(t,e)&Be)===Be,zm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function jm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=zm.reduce((i,r)=>(i[r]="function",i),e);return Vo(t,n)}function qm(t,e,n){if(n<je)throw new Error("invalid exponent, negatives unsupported");if(n===je)return t.ONE;if(n===Be)return e;let i=t.ONE,r=e;for(;n>je;)n&Be&&(i=t.mul(i,r)),r=t.sqr(r),n>>=Be;return i}function Hm(t,e){const n=new Array(e.length),i=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),r=t.inv(i);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),r),n}function Ku(t,e){const n=e!==void 0?e:t.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function Wu(t,e,n=!1,i={}){if(t<=je)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:r,nByteLength:s}=Ku(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:r,BYTES:s,MASK:km(r),ZERO:je,ONE:Be,create:c=>Le(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return je<=c&&c<t},is0:c=>c===je,isOdd:c=>(c&Be)===Be,neg:c=>Le(-c,t),eql:(c,l)=>c===l,sqr:c=>Le(c*c,t),add:(c,l)=>Le(c+l,t),sub:(c,l)=>Le(c-l,t),mul:(c,l)=>Le(c*l,t),pow:(c,l)=>qm(a,c,l),div:(c,l)=>Le(c*Vu(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Vu(c,t),sqrt:i.sqrt||(c=>(o||(o=Fm(t)),o(a,c))),invertBatch:c=>Hm(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>n?qo(c,s):Mu(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?gs(c):Pm(c)}});return Object.freeze(a)}const Gu=BigInt(0),ys=BigInt(1);function Wo(t,e){const n=e.negate();return t?n:e}function Qu(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Go(t,e){Qu(t,e);const n=Math.ceil(e/t)+1,i=2**(t-1);return{windows:n,windowSize:i}}function Vm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,i)=>{if(!(n instanceof e))throw new Error("invalid point at index "+i)})}function Km(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,i)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+i)})}const Qo=new WeakMap,Yu=new WeakMap;function Yo(t){return Yu.get(t)||1}function Wm(t,e){return{constTimeNegate:Wo,hasPrecomputes(n){return Yo(n)!==1},unsafeLadder(n,i,r=t.ZERO){let s=n;for(;i>Gu;)i&ys&&(r=r.add(s)),s=s.double(),i>>=ys;return r},precomputeWindow(n,i){const{windows:r,windowSize:s}=Go(i,e),o=[];let a=n,c=a;for(let l=0;l<r;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,i,r){const{windows:s,windowSize:o}=Go(n,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**n-1),u=2**n,h=BigInt(n);for(let d=0;d<s;d++){const y=d*o;let f=Number(r&l);r>>=h,f>o&&(f-=u,r+=ys);const g=y,I=y+Math.abs(f)-1,O=d%2!==0,B=f<0;f===0?c=c.add(Wo(O,i[g])):a=a.add(Wo(B,i[I]))}return{p:a,f:c}},wNAFUnsafe(n,i,r,s=t.ZERO){const{windows:o,windowSize:a}=Go(n,e),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){const d=h*a;if(r===Gu)break;let y=Number(r&c);if(r>>=u,y>a&&(y-=l,r+=ys),y===0)continue;let f=i[d+Math.abs(y)-1];y<0&&(f=f.negate()),s=s.add(f)}return s},getPrecomputes(n,i,r){let s=Qo.get(i);return s||(s=this.precomputeWindow(i,n),n!==1&&Qo.set(i,r(s))),s},wNAFCached(n,i,r){const s=Yo(n);return this.wNAF(s,this.getPrecomputes(s,n,r),i)},wNAFCachedUnsafe(n,i,r,s){const o=Yo(n);return o===1?this.unsafeLadder(n,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,r),i,s)},setWindowSize(n,i){Qu(i,e),Yu.set(n,i),Qo.delete(n)}}}function Gm(t,e,n,i){if(Vm(n,t),Km(i,e),n.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const r=t.ZERO,s=Bm(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(r),l=Math.floor((e.BITS-1)/o)*o;let u=r;for(let h=l;h>=0;h-=o){c.fill(r);for(let y=0;y<i.length;y++){const f=i[y],g=Number(f>>BigInt(h)&BigInt(a));c[g]=c[g].add(n[y])}let d=r;for(let y=c.length-1,f=r;y>0;y--)f=f.add(c[y]),d=d.add(f);if(u=u.add(d),h!==0)for(let y=0;y<o;y++)u=u.double()}return u}function Qm(t){return jm(t.Fp),Vo(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Ku(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const qt=BigInt(0),ht=BigInt(1),ws=BigInt(2),Ym=BigInt(8),Zm={zip215:!0};function Jm(t){const e=Qm(t);return Vo(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Xm(t){const e=Jm(t),{Fp:n,n:i,prehash:r,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=ws<<BigInt(a*8)-ht,u=n.create,h=Wu(e.n,e.nBitLength),d=e.uvRatio||((S,m)=>{try{return{isValid:!0,value:n.sqrt(S*n.inv(m))}}catch{return{isValid:!1,value:qt}}}),y=e.adjustScalarBytes||(S=>S),f=e.domain||((S,m,_)=>{if(zo("phflag",_),m.length||_)throw new Error("Contexts/pre-hash are not supported");return S});function g(S,m){rr("coordinate "+S,m,qt,l)}function I(S){if(!(S instanceof D))throw new Error("ExtendedPoint expected")}const O=ju((S,m)=>{const{ex:_,ey:k,ez:R}=S,U=S.is0();m==null&&(m=U?Ym:n.inv(R));const H=u(_*m),G=u(k*m),Q=u(R*m);if(U)return{x:qt,y:ht};if(Q!==ht)throw new Error("invZ was invalid");return{x:H,y:G}}),B=ju(S=>{const{a:m,d:_}=e;if(S.is0())throw new Error("bad point: ZERO");const{ex:k,ey:R,ez:U,et:H}=S,G=u(k*k),Q=u(R*R),Z=u(U*U),X=u(Z*Z),re=u(G*m),ce=u(Z*u(re+Q)),fe=u(X+u(_*u(G*Q)));if(ce!==fe)throw new Error("bad point: equation left != right (1)");const le=u(k*R),ae=u(U*H);if(le!==ae)throw new Error("bad point: equation left != right (2)");return!0});class D{constructor(m,_,k,R){this.ex=m,this.ey=_,this.ez=k,this.et=R,g("x",m),g("y",_),g("z",k),g("t",R),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof D)throw new Error("extended point not allowed");const{x:_,y:k}=m||{};return g("x",_),g("y",k),new D(_,k,ht,u(_*k))}static normalizeZ(m){const _=n.invertBatch(m.map(k=>k.ez));return m.map((k,R)=>k.toAffine(_[R])).map(D.fromAffine)}static msm(m,_){return Gm(D,h,m,_)}_setWindowSize(m){A.setWindowSize(this,m)}assertValidity(){B(this)}equals(m){I(m);const{ex:_,ey:k,ez:R}=this,{ex:U,ey:H,ez:G}=m,Q=u(_*G),Z=u(U*R),X=u(k*G),re=u(H*R);return Q===Z&&X===re}is0(){return this.equals(D.ZERO)}negate(){return new D(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:m}=e,{ex:_,ey:k,ez:R}=this,U=u(_*_),H=u(k*k),G=u(ws*u(R*R)),Q=u(m*U),Z=_+k,X=u(u(Z*Z)-U-H),re=Q+H,ce=re-G,fe=Q-H,le=u(X*ce),ae=u(re*fe),$=u(X*fe),p=u(ce*re);return new D(le,ae,p,$)}add(m){I(m);const{a:_,d:k}=e,{ex:R,ey:U,ez:H,et:G}=this,{ex:Q,ey:Z,ez:X,et:re}=m;if(_===BigInt(-1)){const W=u((U-R)*(Z+Q)),Y=u((U+R)*(Z-Q)),V=u(Y-W);if(V===qt)return this.double();const se=u(H*ws*re),pe=u(G*ws*X),he=pe+se,ne=Y+W,ie=pe-se,be=u(he*V),De=u(ne*ie),ue=u(he*ie),ve=u(V*ne);return new D(be,De,ve,ue)}const ce=u(R*Q),fe=u(U*Z),le=u(G*k*re),ae=u(H*X),$=u((R+U)*(Q+Z)-ce-fe),p=ae-le,w=ae+le,b=u(fe-_*ce),E=u($*p),F=u(w*b),N=u($*b),K=u(p*w);return new D(E,F,K,N)}subtract(m){return this.add(m.negate())}wNAF(m){return A.wNAFCached(this,m,D.normalizeZ)}multiply(m){const _=m;rr("scalar",_,ht,i);const{p:k,f:R}=this.wNAF(_);return D.normalizeZ([k,R])[0]}multiplyUnsafe(m,_=D.ZERO){const k=m;return rr("scalar",k,qt,i),k===qt?v:this.is0()||k===ht?this:A.wNAFCachedUnsafe(this,k,D.normalizeZ,_)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return A.unsafeLadder(this,i).is0()}toAffine(m){return O(this,m)}clearCofactor(){const{h:m}=e;return m===ht?this:this.multiplyUnsafe(m)}static fromHex(m,_=!1){const{d:k,a:R}=e,U=n.BYTES;m=ln("pointHex",m,U),zo("zip215",_);const H=m.slice(),G=m[U-1];H[U-1]=G&-129;const Q=gs(H),Z=_?l:n.ORDER;rr("pointHex.y",Q,qt,Z);const X=u(Q*Q),re=u(X-ht),ce=u(k*X-R);let{isValid:fe,value:le}=d(re,ce);if(!fe)throw new Error("Point.fromHex: invalid y coordinate");const ae=(le&ht)===ht,$=(G&128)!==0;if(!_&&le===qt&&$)throw new Error("Point.fromHex: x=0 and x_0=1");return $!==ae&&(le=u(-le)),D.fromAffine({x:le,y:Q})}static fromPrivateKey(m){return C(m).point}toRawBytes(){const{x:m,y:_}=this.toAffine(),k=qo(_,n.BYTES);return k[k.length-1]|=m&ht?128:0,k}toHex(){return jo(this.toRawBytes())}}D.BASE=new D(e.Gx,e.Gy,ht,u(e.Gx*e.Gy)),D.ZERO=new D(qt,ht,ht,qt);const{BASE:x,ZERO:v}=D,A=Wm(D,a*8);function L(S){return Le(S,i)}function M(S){return L(gs(S))}function C(S){const m=n.BYTES;S=ln("private key",S,m);const _=ln("hashed private key",s(S),2*m),k=y(_.slice(0,m)),R=_.slice(m,2*m),U=M(k),H=x.multiply(U),G=H.toRawBytes();return{head:k,prefix:R,scalar:U,point:H,pointBytes:G}}function z(S){return C(S).pointBytes}function j(S=new Uint8Array,...m){const _=zu(...m);return M(s(f(_,ln("context",S),!!r)))}function q(S,m,_={}){S=ln("message",S),r&&(S=r(S));const{prefix:k,scalar:R,pointBytes:U}=C(m),H=j(_.context,k,S),G=x.multiply(H).toRawBytes(),Q=j(_.context,G,U,S),Z=L(H+Q*R);rr("signature.s",Z,qt,i);const X=zu(G,qo(Z,n.BYTES));return ln("result",X,n.BYTES*2)}const P=Zm;function T(S,m,_,k=P){const{context:R,zip215:U}=k,H=n.BYTES;S=ln("signature",S,2*H),m=ln("message",m),_=ln("publicKey",_,H),U!==void 0&&zo("zip215",U),r&&(m=r(m));const G=gs(S.slice(H,2*H));let Q,Z,X;try{Q=D.fromHex(_,U),Z=D.fromHex(S.slice(0,H),U),X=x.multiplyUnsafe(G)}catch{return!1}if(!U&&Q.isSmallOrder())return!1;const re=j(R,Z.toRawBytes(),Q.toRawBytes(),m);return Z.add(Q.multiplyUnsafe(re)).subtract(X).clearCofactor().equals(D.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:z,sign:q,verify:T,ExtendedPoint:D,utils:{getExtendedPublicKey:C,randomPrivateKey:()=>o(n.BYTES),precompute(S=8,m=D.BASE){return m._setWindowSize(S),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);const Zo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Zu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const eb=BigInt(1),Ju=BigInt(2);BigInt(3);const tb=BigInt(5),nb=BigInt(8);function ib(t){const e=BigInt(10),n=BigInt(20),i=BigInt(40),r=BigInt(80),s=Zo,o=t*t%s*t%s,a=Zt(o,Ju,s)*o%s,c=Zt(a,eb,s)*t%s,l=Zt(c,tb,s)*c%s,u=Zt(l,e,s)*l%s,h=Zt(u,n,s)*u%s,d=Zt(h,i,s)*h%s,y=Zt(d,r,s)*d%s,f=Zt(y,r,s)*d%s,g=Zt(f,e,s)*l%s;return{pow_p_5_8:Zt(g,Ju,s)*t%s,b2:o}}function rb(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function sb(t,e){const n=Zo,i=Le(e*e*e,n),r=Le(i*i*e,n),s=ib(t*r).pow_p_5_8;let o=Le(t*i*s,n);const a=Le(e*o*o,n),c=o,l=Le(o*Zu,n),u=a===t,h=a===Le(-t,n),d=a===Le(-t*Zu,n);return u&&(o=c),(h||d)&&(o=l),Mm(o,n)&&(o=Le(-o,n)),{isValid:u||h,value:o}}const ob=Wu(Zo,void 0,!0),ab={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ob,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:nb,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Cm,randomBytes:ku,adjustScalarBytes:rb,uvRatio:sb},Xu=Xm(ab),cb="EdDSA",lb="JWT",ms=".",bs="base64url",eh="utf8",th="utf8",ub=":",hb="did",db="key",nh="base58btc",fb="z",pb="K36",gb=32;function Jo(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ih(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Jo(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function rh(t,e){e||(e=t.reduce((r,s)=>r+s.length,0));const n=ih(e);let i=0;for(const r of t)n.set(r,i),i+=r.length;return Jo(n)}function yb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var r=0;r<t.length;r++){var s=t.charAt(r),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=r}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,I=0,O=0,B=f.length;O!==B&&f[O]===0;)O++,g++;for(var D=(B-O)*u+1>>>0,x=new Uint8Array(D);O!==B;){for(var v=f[O],A=0,L=D-1;(v!==0||A<I)&&L!==-1;L--,A++)v+=256*x[L]>>>0,x[L]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");I=A,O++}for(var M=D-I;M!==D&&x[M]===0;)M++;for(var C=c.repeat(g);M<D;++M)C+=t.charAt(x[M]);return C}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var I=0,O=0;f[g]===c;)I++,g++;for(var B=(f.length-g)*l+1>>>0,D=new Uint8Array(B);f[g];){var x=n[f.charCodeAt(g)];if(x===255)return;for(var v=0,A=B-1;(x!==0||v<O)&&A!==-1;A--,v++)x+=a*D[A]>>>0,D[A]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");O=v,g++}if(f[g]!==" "){for(var L=B-O;L!==B&&D[L]===0;)L++;for(var M=new Uint8Array(I+(B-L)),C=I;L!==B;)M[C++]=D[L++];return M}}}function y(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var wb=yb,mb=wb;const sh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},bb=t=>new TextEncoder().encode(t),vb=t=>new TextDecoder().decode(t);let Eb=class{constructor(e,n,i){this.name=e,this.prefix=n,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},xb=class{constructor(e,n,i){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return oh(this,e)}},_b=class{constructor(e){this.decoders=e}or(e){return oh(this,e)}decode(e){const n=e[0],i=this.decoders[n];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const oh=(t,e)=>new _b({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let Sb=class{constructor(e,n,i,r){this.name=e,this.prefix=n,this.baseEncode=i,this.baseDecode=r,this.encoder=new Eb(e,n,i),this.decoder=new xb(e,n,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const vs=({name:t,prefix:e,encode:n,decode:i})=>new Sb(t,e,n,i),sr=({prefix:t,name:e,alphabet:n})=>{const{encode:i,decode:r}=mb(n,e);return vs({prefix:t,name:e,encode:i,decode:s=>sh(r(s))})},Ab=(t,e,n,i)=>{const r={};for(let u=0;u<e.length;++u)r[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=r[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ib=(t,e,n)=>{const i=e[e.length-1]==="=",r=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[r&a>>o];if(o&&(s+=e[r&a<<n-o]),i)for(;s.length*n&7;)s+="=";return s},Ge=({name:t,prefix:e,bitsPerChar:n,alphabet:i})=>vs({prefix:e,name:t,encode(r){return Ib(r,i,n)},decode(r){return Ab(r,i,n,t)}}),Db=vs({prefix:"\0",name:"identity",encode:t=>vb(t),decode:t=>bb(t)});var Cb=Object.freeze({__proto__:null,identity:Db});const Ob=Ge({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var $b=Object.freeze({__proto__:null,base2:Ob});const Pb=Ge({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Tb=Object.freeze({__proto__:null,base8:Pb});const Bb=sr({prefix:"9",name:"base10",alphabet:"0123456789"});var kb=Object.freeze({__proto__:null,base10:Bb});const Nb=Ge({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Rb=Ge({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Lb=Object.freeze({__proto__:null,base16:Nb,base16upper:Rb});const Ub=Ge({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Fb=Ge({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Mb=Ge({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),zb=Ge({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),jb=Ge({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qb=Ge({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hb=Ge({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vb=Ge({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Kb=Ge({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Wb=Object.freeze({__proto__:null,base32:Ub,base32upper:Fb,base32pad:Mb,base32padupper:zb,base32hex:jb,base32hexupper:qb,base32hexpad:Hb,base32hexpadupper:Vb,base32z:Kb});const Gb=sr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Qb=sr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Yb=Object.freeze({__proto__:null,base36:Gb,base36upper:Qb});const Zb=sr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jb=sr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xb=Object.freeze({__proto__:null,base58btc:Zb,base58flickr:Jb});const e2=Ge({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),t2=Ge({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),n2=Ge({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),i2=Ge({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var r2=Object.freeze({__proto__:null,base64:e2,base64pad:t2,base64url:n2,base64urlpad:i2});const ah=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),s2=ah.reduce((t,e,n)=>(t[n]=e,t),[]),o2=ah.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function a2(t){return t.reduce((e,n)=>(e+=s2[n],e),"")}function c2(t){const e=[];for(const n of t){const i=o2[n.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(i)}return new Uint8Array(e)}const l2=vs({prefix:"🚀",name:"base256emoji",encode:a2,decode:c2});var u2=Object.freeze({__proto__:null,base256emoji:l2}),h2=lh,ch=128,d2=-128,f2=Math.pow(2,31);function lh(t,e,n){e=e||[],n=n||0;for(var i=n;t>=f2;)e[n++]=t&255|ch,t/=128;for(;t&d2;)e[n++]=t&255|ch,t>>>=7;return e[n]=t|0,lh.bytes=n-i+1,e}var p2=Xo,g2=128,uh=127;function Xo(t,i){var n=0,i=i||0,r=0,s=i,o,a=t.length;do{if(s>=a)throw Xo.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=r<28?(o&uh)<<r:(o&uh)*Math.pow(2,r),r+=7}while(o>=g2);return Xo.bytes=s-i,n}var y2=Math.pow(2,7),w2=Math.pow(2,14),m2=Math.pow(2,21),b2=Math.pow(2,28),v2=Math.pow(2,35),E2=Math.pow(2,42),x2=Math.pow(2,49),_2=Math.pow(2,56),S2=Math.pow(2,63),A2=function(t){return t<y2?1:t<w2?2:t<m2?3:t<b2?4:t<v2?5:t<E2?6:t<x2?7:t<_2?8:t<S2?9:10},I2={encode:h2,decode:p2,encodingLength:A2},hh=I2;const dh=(t,e,n=0)=>(hh.encode(t,e,n),e),fh=t=>hh.encodingLength(t),ea=(t,e)=>{const n=e.byteLength,i=fh(t),r=i+fh(n),s=new Uint8Array(r+n);return dh(t,s,0),dh(n,s,i),s.set(e,r),new D2(t,n,e,s)};let D2=class{constructor(e,n,i,r){this.code=e,this.size=n,this.digest=i,this.bytes=r}};const ph=({name:t,code:e,encode:n})=>new C2(t,e,n);let C2=class{constructor(e,n,i){this.name=e,this.code=n,this.encode=i}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?ea(this.code,n):n.then(i=>ea(this.code,i))}else throw Error("Unknown type, must be binary type")}};const gh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),O2=ph({name:"sha2-256",code:18,encode:gh("SHA-256")}),$2=ph({name:"sha2-512",code:19,encode:gh("SHA-512")});var P2=Object.freeze({__proto__:null,sha256:O2,sha512:$2});const yh=0,T2="identity",wh=sh;var B2=Object.freeze({__proto__:null,identity:{code:yh,name:T2,encode:wh,digest:t=>ea(yh,wh(t))}});new TextEncoder,new TextDecoder;const mh={...Cb,...$b,...Tb,...kb,...Lb,...Wb,...Yb,...Xb,...r2,...u2};({...P2,...B2});function bh(t,e,n,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:i}}}const vh=bh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ta=bh("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=ih(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Eh={utf8:vh,"utf-8":vh,hex:mh.base16,latin1:ta,ascii:ta,binary:ta,...mh};function Es(t,e="utf8"){const n=Eh[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}function Ti(t,e="utf8"){const n=Eh[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Jo(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function xh(t){return Oi(Es(Ti(t,bs),eh))}function xs(t){return Es(Ti(ei(t),eh),bs)}function _h(t){const e=Ti(pb,nh),n=fb+Es(rh([e,t]),nh);return[hb,db,n].join(ub)}function k2(t){return Es(t,bs)}function N2(t){return Ti(t,bs)}function R2(t){return Ti([xs(t.header),xs(t.payload)].join(ms),th)}function L2(t){return[xs(t.header),xs(t.payload),k2(t.signature)].join(ms)}function na(t){const e=t.split(ms),n=xh(e[0]),i=xh(e[1]),r=N2(e[2]),s=Ti(e.slice(0,2).join(ms),th);return{header:n,payload:i,signature:r,data:s}}function Sh(t=ku(gb)){const e=Xu.getPublicKey(t);return{secretKey:rh([t,e]),publicKey:e}}async function U2(t,e,n,i,r=ee.fromMiliseconds(Date.now())){const s={alg:cb,typ:lb},o=_h(i.publicKey),a=r+n,c={iss:o,sub:t,aud:e,iat:r,exp:a},l=R2({header:s,payload:c}),u=Xu.sign(l,i.secretKey.slice(0,32));return L2({header:s,payload:c,signature:u})}var Ah=function(t,e,n){if(n||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},F2=function(){function t(e,n,i){this.name=e,this.version=n,this.os=i,this.type="browser"}return t}(),M2=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),z2=function(){function t(e,n,i,r){this.name=e,this.version=n,this.os=i,this.bot=r,this.type="bot-device"}return t}(),j2=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),q2=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),H2=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,V2=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ih=3,K2=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",H2]],Dh=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function W2(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new q2:typeof navigator<"u"?Q2(navigator.userAgent):Z2()}function G2(t){return t!==""&&K2.reduce(function(e,n){var i=n[0],r=n[1];if(e)return e;var s=r.exec(t);return!!s&&[i,s]},!1)}function Q2(t){var e=G2(t);if(!e)return null;var n=e[0],i=e[1];if(n==="searchbot")return new j2;var r=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);r?r.length<Ih&&(r=Ah(Ah([],r,!0),J2(Ih-r.length),!0)):r=[];var s=r.join("."),o=Y2(t),a=V2.exec(t);return a&&a[1]?new z2(n,s,o,a[1]):new F2(n,s,o)}function Y2(t){for(var e=0,n=Dh.length;e<n;e++){var i=Dh[e],r=i[0],s=i[1],o=s.exec(t);if(o)return r}return null}function Z2(){var t=typeof process<"u"&&process.version;return t?new M2(process.version.slice(1)):null}function J2(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}var Ae={},Ch;function Oh(){if(Ch)return Ae;Ch=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.getLocalStorage=Ae.getLocalStorageOrThrow=Ae.getCrypto=Ae.getCryptoOrThrow=Ae.getLocation=Ae.getLocationOrThrow=Ae.getNavigator=Ae.getNavigatorOrThrow=Ae.getDocument=Ae.getDocumentOrThrow=Ae.getFromWindowOrThrow=Ae.getFromWindow=void 0;function t(d){let y;return typeof window<"u"&&typeof window[d]<"u"&&(y=window[d]),y}Ae.getFromWindow=t;function e(d){const y=t(d);if(!y)throw new Error(`${d} is not defined in Window`);return y}Ae.getFromWindowOrThrow=e;function n(){return e("document")}Ae.getDocumentOrThrow=n;function i(){return t("document")}Ae.getDocument=i;function r(){return e("navigator")}Ae.getNavigatorOrThrow=r;function s(){return t("navigator")}Ae.getNavigator=s;function o(){return e("location")}Ae.getLocationOrThrow=o;function a(){return t("location")}Ae.getLocation=a;function c(){return e("crypto")}Ae.getCryptoOrThrow=c;function l(){return t("crypto")}Ae.getCrypto=l;function u(){return e("localStorage")}Ae.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return Ae.getLocalStorage=h,Ae}var un=Oh(),or={},$h;function X2(){if($h)return or;$h=1,Object.defineProperty(or,"__esModule",{value:!0}),or.getWindowMetadata=void 0;const t=Oh();function e(){let n,i;try{n=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function r(){const y=n.getElementsByTagName("link"),f=[];for(let g=0;g<y.length;g++){const I=y[g],O=I.getAttribute("rel");if(O&&O.toLowerCase().indexOf("icon")>-1){const B=I.getAttribute("href");if(B)if(B.toLowerCase().indexOf("https:")===-1&&B.toLowerCase().indexOf("http:")===-1&&B.indexOf("//")!==0){let D=i.protocol+"//"+i.host;if(B.indexOf("/")===0)D+=B;else{const x=i.pathname.split("/");x.pop();const v=x.join("/");D+=v+"/"+B}f.push(D)}else if(B.indexOf("//")===0){const D=i.protocol+B;f.push(D)}else f.push(B)}}return f}function s(...y){const f=n.getElementsByTagName("meta");for(let g=0;g<f.length;g++){const I=f[g],O=["itemprop","property","name"].map(B=>I.getAttribute(B)).filter(B=>B?y.includes(B):!1);if(O.length&&O){const B=I.getAttribute("content");if(B)return B}}return""}function o(){let y=s("name","og:site_name","og:title","twitter:title");return y||(y=n.title),y}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=i.origin,h=r();return{description:l,url:u,icons:h,name:c}}return or.getWindowMetadata=e,or}var ev=X2();function tv(t,e){const n=t.exec(e);return n==null?void 0:n.groups}const Ph=/^tuple(?<array>(\[(\d*)\])*)$/;function ia(t){let e=t.type;if(Ph.test(t.type)&&"components"in t){e="(";const n=t.components.length;for(let r=0;r<n;r++){const s=t.components[r];e+=ia(s),r<n-1&&(e+=", ")}const i=tv(Ph,t.type);return e+=`)${(i==null?void 0:i.array)??""}`,ia({...t,type:e})}return"indexed"in t&&t.indexed&&(e=`${e} indexed`),t.name?`${e} ${t.name}`:e}function ar(t){let e="";const n=t.length;for(let i=0;i<n;i++){const r=t[i];e+=ia(r),i!==n-1&&(e+=", ")}return e}function nv(t){var e;return t.type==="function"?`function ${t.name}(${ar(t.inputs)})${t.stateMutability&&t.stateMutability!=="nonpayable"?` ${t.stateMutability}`:""}${(e=t.outputs)!=null&&e.length?` returns (${ar(t.outputs)})`:""}`:t.type==="event"?`event ${t.name}(${ar(t.inputs)})`:t.type==="error"?`error ${t.name}(${ar(t.inputs)})`:t.type==="constructor"?`constructor(${ar(t.inputs)})${t.stateMutability==="payable"?" payable":""}`:t.type==="fallback"?`fallback() external${t.stateMutability==="payable"?" payable":""}`:"receive() external payable"}function cr(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function ra(t){return cr(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const Th="2.31.0";let lr={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${Th}`},_s=class dl extends Error{constructor(e,n={}){var a;const i=(()=>{var c;return n.cause instanceof dl?n.cause.details:(c=n.cause)!=null&&c.message?n.cause.message:n.details})(),r=n.cause instanceof dl&&n.cause.docsPath||n.docsPath,s=(a=lr.getDocsUrl)==null?void 0:a.call(lr,{...n,docsPath:r}),o=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...i?[`Details: ${i}`]:[],...lr.version?[`Version: ${lr.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=r,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=Th}walk(e){return Bh(this,e)}};function Bh(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Bh(t.cause,e):e?null:t}let kh=class extends _s{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}};function Bi(t,{dir:e,size:n=32}={}){return typeof t=="string"?iv(t,{dir:e,size:n}):rv(t,{dir:e,size:n})}function iv(t,{dir:e,size:n=32}={}){if(n===null)return t;const i=t.replace("0x","");if(i.length>n*2)throw new kh({size:Math.ceil(i.length/2),targetSize:n,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function rv(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new kh({size:t.length,targetSize:n,type:"bytes"});const i=new Uint8Array(n);for(let r=0;r<n;r++){const s=e==="right";i[s?r:n-r-1]=t[s?r:t.length-r-1]}return i}let sv=class extends _s{constructor({max:e,min:n,signed:i,size:r,value:s}){super(`Number "${s}" is not in safe ${r?`${r*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}},ov=class extends _s{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}};function ki(t,{size:e}){if(ra(t)>e)throw new ov({givenSize:ra(t),maxSize:e})}function sa(t,e={}){const{signed:n}=e;e.size&&ki(t,{size:e.size});const i=BigInt(t);if(!n)return i;const r=(t.length-2)/2,s=(1n<<BigInt(r)*8n-1n)-1n;return i<=s?i:i-BigInt(`0x${"f".padStart(r*2,"f")}`)-1n}function av(t,e={}){return Number(sa(t,e))}const cv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function oa(t,e={}){return typeof t=="number"||typeof t=="bigint"?Rh(t,e):typeof t=="string"?hv(t,e):typeof t=="boolean"?lv(t,e):Nh(t,e)}function lv(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(ki(n,{size:e.size}),Bi(n,{size:e.size})):n}function Nh(t,e={}){let n="";for(let r=0;r<t.length;r++)n+=cv[t[r]];const i=`0x${n}`;return typeof e.size=="number"?(ki(i,{size:e.size}),Bi(i,{dir:"right",size:e.size})):i}function Rh(t,e={}){const{signed:n,size:i}=e,r=BigInt(t);let s;i?n?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&r>s||r<o){const c=typeof t=="bigint"?"n":"";throw new sv({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:n,size:i,value:`${t}${c}`})}const a=`0x${(n&&r<0?(1n<<BigInt(i*8))+BigInt(r):r).toString(16)}`;return i?Bi(a,{size:i}):a}const uv=new TextEncoder;function hv(t,e={}){const n=uv.encode(t);return Nh(n,e)}const dv=new TextEncoder;function fv(t,e={}){return typeof t=="number"||typeof t=="bigint"?gv(t,e):typeof t=="boolean"?pv(t,e):cr(t)?Uh(t,e):Fh(t,e)}function pv(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(ki(n,{size:e.size}),Bi(n,{size:e.size})):n}const hn={zero:48,nine:57,A:65,F:70,a:97,f:102};function Lh(t){if(t>=hn.zero&&t<=hn.nine)return t-hn.zero;if(t>=hn.A&&t<=hn.F)return t-(hn.A-10);if(t>=hn.a&&t<=hn.f)return t-(hn.a-10)}function Uh(t,e={}){let n=t;e.size&&(ki(n,{size:e.size}),n=Bi(n,{dir:"right",size:e.size}));let i=n.slice(2);i.length%2&&(i=`0${i}`);const r=i.length/2,s=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const c=Lh(i.charCodeAt(a++)),l=Lh(i.charCodeAt(a++));if(c===void 0||l===void 0)throw new _s(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);s[o]=c*16+l}return s}function gv(t,e){const n=Rh(t,e);return Uh(n)}function Fh(t,e={}){const n=dv.encode(t);return typeof e.size=="number"?(ki(n,{size:e.size}),Bi(n,{dir:"right",size:e.size})):n}const Ss=BigInt(2**32-1),Mh=BigInt(32);function yv(t,e=!1){return e?{h:Number(t&Ss),l:Number(t>>Mh&Ss)}:{h:Number(t>>Mh&Ss)|0,l:Number(t&Ss)|0}}function wv(t,e=!1){const n=t.length;let i=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=yv(t[s],e);[i[s],r[s]]=[o,a]}return[i,r]}const mv=(t,e,n)=>t<<n|e>>>32-n,bv=(t,e,n)=>e<<n|t>>>32-n,vv=(t,e,n)=>e<<n-32|t>>>64-n,Ev=(t,e,n)=>t<<n-32|e>>>64-n,Ni=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xv(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ur(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ni(t,...e){if(!xv(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function _v(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ur(t.outputLen),ur(t.blockLen)}function Ri(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zh(t,e){ni(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Sv(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Li(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function aa(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Jt(t,e){return t<<32-e|t>>>e}const Av=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Iv(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Dv(t){for(let e=0;e<t.length;e++)t[e]=Iv(t[e]);return t}const jh=Av?t=>t:Dv;function Cv(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function As(t){return typeof t=="string"&&(t=Cv(t)),ni(t),t}function Ov(...t){let e=0;for(let i=0;i<t.length;i++){const r=t[i];ni(r),e+=r.length}const n=new Uint8Array(e);for(let i=0,r=0;i<t.length;i++){const s=t[i];n.set(s,r),r+=s.length}return n}class ca{}function qh(t){const e=i=>t().update(As(i)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function $v(t=32){if(Ni&&typeof Ni.getRandomValues=="function")return Ni.getRandomValues(new Uint8Array(t));if(Ni&&typeof Ni.randomBytes=="function")return Uint8Array.from(Ni.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Pv=BigInt(0),hr=BigInt(1),Tv=BigInt(2),Bv=BigInt(7),kv=BigInt(256),Nv=BigInt(113),Hh=[],Vh=[],Kh=[];for(let t=0,e=hr,n=1,i=0;t<24;t++){[n,i]=[i,(2*n+3*i)%5],Hh.push(2*(5*i+n)),Vh.push((t+1)*(t+2)/2%64);let r=Pv;for(let s=0;s<7;s++)e=(e<<hr^(e>>Bv)*Nv)%kv,e&Tv&&(r^=hr<<(hr<<BigInt(s))-hr);Kh.push(r)}const Wh=wv(Kh,!0),Rv=Wh[0],Lv=Wh[1],Gh=(t,e,n)=>n>32?vv(t,e,n):mv(t,e,n),Qh=(t,e,n)=>n>32?Ev(t,e,n):bv(t,e,n);function Uv(t,e=24){const n=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],h=Gh(l,u,1)^n[a],d=Qh(l,u,1)^n[a+1];for(let y=0;y<50;y+=10)t[o+y]^=h,t[o+y+1]^=d}let r=t[2],s=t[3];for(let o=0;o<24;o++){const a=Vh[o],c=Gh(r,s,a),l=Qh(r,s,a),u=Hh[o];r=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=Rv[i],t[1]^=Lv[i]}Li(n)}class la extends ca{constructor(e,n,i,r=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=i,this.enableXOF=r,this.rounds=s,ur(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Sv(this.state)}clone(){return this._cloneInto()}keccak(){jh(this.state32),Uv(this.state32,this.rounds),jh(this.state32),this.posOut=0,this.pos=0}update(e){Ri(this),e=As(e),ni(e);const{blockLen:n,state:i}=this,r=e.length;for(let s=0;s<r;){const o=Math.min(n-this.pos,r-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:i,blockLen:r}=this;e[i]^=n,(n&128)!==0&&i===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Ri(this,!1),ni(e),this.finish();const n=this.state,{blockLen:i}=this;for(let r=0,s=e.length;r<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-r);e.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ur(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(zh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Li(this.state)}_cloneInto(e){const{blockLen:n,suffix:i,outputLen:r,rounds:s,enableXOF:o}=this;return e||(e=new la(n,i,r,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Fv=(t,e,n)=>qh(()=>new la(e,t,n)),Yh=Fv(1,136,256/8);function Zh(t,e){const n=e||"hex",i=Yh(cr(t,{strict:!1})?fv(t):t);return n==="bytes"?i:oa(i)}let Mv=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}};const ua=new Mv(8192);function zv(t,e){if(ua.has(`${t}.${e}`))return ua.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),i=Zh(Fh(n),"bytes"),r=n.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(i[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const s=`0x${r.join("")}`;return ua.set(`${t}.${e}`,s),s}function jv(t){const e=Zh(`0x${t.substring(4)}`).substring(26);return zv(`0x${e}`)}async function qv({hash:t,signature:e}){const n=cr(t)?t:oa(t),{secp256k1:i}=await Promise.resolve().then(()=>IE);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:d}=e,y=Number(d??h),f=Jh(y);return new i.Signature(sa(l),sa(u)).addRecoveryBit(f)}const o=cr(e)?e:oa(e);if(ra(o)!==65)throw new Error("invalid signature length");const a=av(`0x${o.slice(130)}`),c=Jh(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(n.substring(2)).toHex(!1)}`}function Jh(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function Hv({hash:t,signature:e}){return jv(await qv({hash:t,signature:e}))}function Vv(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(n>>r&s),a=Number(n&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function Kv(t,e,n){return t&e^~t&n}function Wv(t,e,n){return t&e^t&n^e&n}class Gv extends ca{constructor(e,n,i,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=r,this.buffer=new Uint8Array(e),this.view=aa(this.buffer)}update(e){Ri(this),e=As(e),ni(e);const{view:n,buffer:i,blockLen:r}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a===r){const c=aa(e);for(;r<=s-o;o+=r)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ri(this),zh(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:r,isLE:s}=this;let{pos:o}=this;n[o++]=128,Li(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(i,0),o=0);for(let h=o;h<r;h++)n[h]=0;Vv(i,r-8,BigInt(this.length*8),s),this.process(i,0);const a=aa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:r,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=r,e.pos=a,r%n&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const On=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$n=new Uint32Array(64);class Yv extends Gv{constructor(e=32){super(64,e,8,!1),this.A=On[0]|0,this.B=On[1]|0,this.C=On[2]|0,this.D=On[3]|0,this.E=On[4]|0,this.F=On[5]|0,this.G=On[6]|0,this.H=On[7]|0}get(){const{A:e,B:n,C:i,D:r,E:s,F:o,G:a,H:c}=this;return[e,n,i,r,s,o,a,c]}set(e,n,i,r,s,o,a,c){this.A=e|0,this.B=n|0,this.C=i|0,this.D=r|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)$n[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=$n[h-15],y=$n[h-2],f=Jt(d,7)^Jt(d,18)^d>>>3,g=Jt(y,17)^Jt(y,19)^y>>>10;$n[h]=g+$n[h-7]+f+$n[h-16]|0}let{A:i,B:r,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=Jt(a,6)^Jt(a,11)^Jt(a,25),y=u+d+Kv(a,c,l)+Qv[h]+$n[h]|0,g=(Jt(i,2)^Jt(i,13)^Jt(i,22))+Wv(i,r,s)|0;u=l,l=c,c=a,a=o+y|0,o=s,s=r,r=i,i=y+g|0}i=i+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,r,s,o,a,c,l,u)}roundClean(){Li($n)}destroy(){this.set(0,0,0,0,0,0,0,0),Li(this.buffer)}}const Zv=qh(()=>new Yv);class Xh extends ca{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,_v(e);const i=As(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(i.length>r?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Li(s)}update(e){return Ri(this),this.iHash.update(e),this}digestInto(e){Ri(this),ni(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:i,finished:r,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ed=(t,e,n)=>new Xh(t,e).update(n).digest();ed.create=(t,e)=>new Xh(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ha=BigInt(0),da=BigInt(1);function dr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function fa(t){if(!dr(t))throw new Error("Uint8Array expected")}function fr(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Is(t){const e=t.toString(16);return e.length&1?"0"+e:e}function td(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ha:BigInt("0x"+t)}const nd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Jv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function pr(t){if(fa(t),nd)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=Jv[t[n]];return e}const dn={_0:48,_9:57,A:65,F:70,a:97,f:102};function id(t){if(t>=dn._0&&t<=dn._9)return t-dn._0;if(t>=dn.A&&t<=dn.F)return t-(dn.A-10);if(t>=dn.a&&t<=dn.f)return t-(dn.a-10)}function Ds(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(nd)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let r=0,s=0;r<n;r++,s+=2){const o=id(t.charCodeAt(s)),a=id(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[r]=o*16+a}return i}function ii(t){return td(pr(t))}function rd(t){return fa(t),td(pr(Uint8Array.from(t).reverse()))}function gr(t,e){return Ds(t.toString(16).padStart(e*2,"0"))}function sd(t,e){return gr(t,e).reverse()}function Ct(t,e,n){let i;if(typeof e=="string")try{i=Ds(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(dr(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=i.length;if(typeof n=="number"&&r!==n)throw new Error(t+" of length "+n+" expected, got "+r);return i}function Cs(...t){let e=0;for(let i=0;i<t.length;i++){const r=t[i];fa(r),e+=r.length}const n=new Uint8Array(e);for(let i=0,r=0;i<t.length;i++){const s=t[i];n.set(s,r),r+=s.length}return n}const pa=t=>typeof t=="bigint"&&ha<=t;function ga(t,e,n){return pa(t)&&pa(e)&&pa(n)&&e<=t&&t<n}function Ui(t,e,n,i){if(!ga(e,n,i))throw new Error("expected valid "+t+": "+n+" <= n < "+i+", got "+e)}function Xv(t){let e;for(e=0;t>ha;t>>=da,e+=1);return e}const Os=t=>(da<<BigInt(t))-da,ya=t=>new Uint8Array(t),od=t=>Uint8Array.from(t);function eE(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let i=ya(t),r=ya(t),s=0;const o=()=>{i.fill(1),r.fill(0),s=0},a=(...h)=>n(r,i,...h),c=(h=ya(0))=>{r=a(od([0]),h),i=a(),h.length!==0&&(r=a(od([1]),h),i=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const d=[];for(;h<e;){i=a();const y=i.slice();d.push(y),h+=i.length}return Cs(...d)};return(h,d)=>{o(),c(h);let y;for(;!(y=d(l()));)c();return o(),y}}const tE={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||dr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function $s(t,e,n={}){const i=(r,s,o)=>{const a=tE[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[r];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(r)+" is invalid. Expected "+s+", got "+c)};for(const[r,s]of Object.entries(e))i(r,s,!1);for(const[r,s]of Object.entries(n))i(r,s,!0);return t}function ad(t){const e=new WeakMap;return(n,...i)=>{const r=e.get(n);if(r!==void 0)return r;const s=t(n,...i);return e.set(n,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dt=BigInt(0),ot=BigInt(1),ri=BigInt(2),nE=BigInt(3),cd=BigInt(4),ld=BigInt(5),ud=BigInt(8);function ft(t,e){const n=t%e;return n>=dt?n:e+n}function Ot(t,e,n){let i=t;for(;e-- >dt;)i*=i,i%=n;return i}function wa(t,e){if(t===dt)throw new Error("invert: expected non-zero number");if(e<=dt)throw new Error("invert: expected positive modulus, got "+e);let n=ft(t,e),i=e,r=dt,s=ot;for(;n!==dt;){const a=i/n,c=i%n,l=r-s*a;i=n,n=c,r=s,s=l}if(i!==ot)throw new Error("invert: does not exist");return ft(r,e)}function hd(t,e){const n=(t.ORDER+ot)/cd,i=t.pow(e,n);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function iE(t,e){const n=(t.ORDER-ld)/ud,i=t.mul(e,ri),r=t.pow(i,n),s=t.mul(e,r),o=t.mul(t.mul(s,ri),r),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function rE(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-ot,n=0;for(;e%ri===dt;)e/=ri,n++;let i=ri;const r=ma(t);for(;fd(r,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return hd;let s=r.pow(i,e);const o=(e+ot)/ri;return function(c,l){if(c.is0(l))return l;if(fd(c,l)!==1)throw new Error("Cannot find square root");let u=n,h=c.mul(c.ONE,s),d=c.pow(l,e),y=c.pow(l,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let f=1,g=c.sqr(d);for(;!c.eql(g,c.ONE);)if(f++,g=c.sqr(g),f===u)throw new Error("Cannot find square root");const I=ot<<BigInt(u-f-1),O=c.pow(h,I);u=f,h=c.sqr(O),d=c.mul(d,h),y=c.mul(y,O)}return y}}function sE(t){return t%cd===nE?hd:t%ud===ld?iE:rE(t)}const oE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function aE(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=oE.reduce((i,r)=>(i[r]="function",i),e);return $s(t,n)}function cE(t,e,n){if(n<dt)throw new Error("invalid exponent, negatives unsupported");if(n===dt)return t.ONE;if(n===ot)return e;let i=t.ONE,r=e;for(;n>dt;)n&ot&&(i=t.mul(i,r)),r=t.sqr(r),n>>=ot;return i}function dd(t,e,n=!1){const i=new Array(e.length).fill(n?t.ZERO:void 0),r=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(r);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function fd(t,e){const n=(t.ORDER-ot)/ri,i=t.pow(e,n),r=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!r&&!s&&!o)throw new Error("invalid Legendre symbol result");return r?1:s?0:-1}function pd(t,e){e!==void 0&&ur(e);const n=e!==void 0?e:t.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function ma(t,e,n=!1,i={}){if(t<=dt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:r,nByteLength:s}=pd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:r,BYTES:s,MASK:Os(r),ZERO:dt,ONE:ot,create:c=>ft(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return dt<=c&&c<t},is0:c=>c===dt,isOdd:c=>(c&ot)===ot,neg:c=>ft(-c,t),eql:(c,l)=>c===l,sqr:c=>ft(c*c,t),add:(c,l)=>ft(c+l,t),sub:(c,l)=>ft(c-l,t),mul:(c,l)=>ft(c*l,t),pow:(c,l)=>cE(a,c,l),div:(c,l)=>ft(c*wa(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>wa(c,t),sqrt:i.sqrt||(c=>(o||(o=sE(t)),o(a,c))),toBytes:c=>n?sd(c,s):gr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?rd(c):ii(c)},invertBatch:c=>dd(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function gd(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function yd(t){const e=gd(t);return e+Math.ceil(e/2)}function lE(t,e,n=!1){const i=t.length,r=gd(e),s=yd(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=n?rd(t):ii(t),a=ft(o,e-ot)+ot;return n?sd(a,r):gr(a,r)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wd=BigInt(0),ba=BigInt(1);function va(t,e){const n=e.negate();return t?n:e}function md(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ea(t,e){md(t,e);const n=Math.ceil(e/t)+1,i=2**(t-1),r=2**t,s=Os(t),o=BigInt(t);return{windows:n,windowSize:i,mask:s,maxNumber:r,shiftBy:o}}function bd(t,e,n){const{windowSize:i,mask:r,maxNumber:s,shiftBy:o}=n;let a=Number(t&r),c=t>>o;a>i&&(a-=s,c+=ba);const l=e*i,u=l+Math.abs(a)-1,h=a===0,d=a<0,y=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:y,offsetF:l}}function uE(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,i)=>{if(!(n instanceof e))throw new Error("invalid point at index "+i)})}function hE(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,i)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+i)})}const xa=new WeakMap,vd=new WeakMap;function _a(t){return vd.get(t)||1}function dE(t,e){return{constTimeNegate:va,hasPrecomputes(n){return _a(n)!==1},unsafeLadder(n,i,r=t.ZERO){let s=n;for(;i>wd;)i&ba&&(r=r.add(s)),s=s.double(),i>>=ba;return r},precomputeWindow(n,i){const{windows:r,windowSize:s}=Ea(i,e),o=[];let a=n,c=a;for(let l=0;l<r;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,i,r){let s=t.ZERO,o=t.BASE;const a=Ea(n,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:d,isNegF:y,offsetF:f}=bd(r,c,a);r=l,h?o=o.add(va(y,i[f])):s=s.add(va(d,i[u]))}return{p:s,f:o}},wNAFUnsafe(n,i,r,s=t.ZERO){const o=Ea(n,e);for(let a=0;a<o.windows&&r!==wd;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=bd(r,a,o);if(r=c,!u){const d=i[l];s=s.add(h?d.negate():d)}}return s},getPrecomputes(n,i,r){let s=xa.get(i);return s||(s=this.precomputeWindow(i,n),n!==1&&xa.set(i,r(s))),s},wNAFCached(n,i,r){const s=_a(n);return this.wNAF(s,this.getPrecomputes(s,n,r),i)},wNAFCachedUnsafe(n,i,r,s){const o=_a(n);return o===1?this.unsafeLadder(n,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,r),i,s)},setWindowSize(n,i){md(i,e),vd.set(n,i),xa.delete(n)}}}function fE(t,e,n,i){uE(n,t),hE(i,e);const r=n.length,s=i.length;if(r!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Xv(BigInt(r));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Os(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let y=h;y>=0;y-=c){u.fill(o);for(let g=0;g<s;g++){const I=i[g],O=Number(I>>BigInt(y)&l);u[O]=u[O].add(n[g])}let f=o;for(let g=u.length-1,I=o;g>0;g--)I=I.add(u[g]),f=f.add(I);if(d=d.add(f),y!==0)for(let g=0;g<c;g++)d=d.double()}return d}function Ed(t){return aE(t.Fp),$s(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...pd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xd(t){t.lowS!==void 0&&fr("lowS",t.lowS),t.prehash!==void 0&&fr("prehash",t.prehash)}function pE(t){const e=Ed(t);$s(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:i,a:r}=e;if(n){if(!i.eql(r,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class gE extends Error{constructor(e=""){super(e)}}const fn={Err:gE,_tlv:{encode:(t,e)=>{const{Err:n}=fn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const i=e.length/2,r=Is(i);if(r.length/2&128)throw new n("tlv.encode: long form length too big");const s=i>127?Is(r.length/2|128):"";return Is(t)+s+r+e},decode(t,e){const{Err:n}=fn;let i=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new n("tlv.decode: wrong tlv");const r=e[i++],s=!!(r&128);let o=0;if(!s)o=r;else{const c=r&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=fn;if(t<pn)throw new e("integer: negative integers are not allowed");let n=Is(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=fn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ii(t)}},toSig(t){const{Err:e,_int:n,_tlv:i}=fn,r=Ct("signature",t),{v:s,l:o}=i.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(t){const{_tlv:e,_int:n}=fn,i=e.encode(2,n.encode(t.r)),r=e.encode(2,n.encode(t.s)),s=i+r;return e.encode(48,s)}};function Sa(t,e){return pr(gr(t,e))}const pn=BigInt(0),qe=BigInt(1);BigInt(2);const Aa=BigInt(3),yE=BigInt(4);function wE(t){const e=pE(t),{Fp:n}=e,i=ma(e.n,e.nBitLength),r=e.toBytes||((D,x,v)=>{const A=x.toAffine();return Cs(Uint8Array.from([4]),n.toBytes(A.x),n.toBytes(A.y))}),s=e.fromBytes||(D=>{const x=D.subarray(1),v=n.fromBytes(x.subarray(0,n.BYTES)),A=n.fromBytes(x.subarray(n.BYTES,2*n.BYTES));return{x:v,y:A}});function o(D){const{a:x,b:v}=e,A=n.sqr(D),L=n.mul(A,D);return n.add(n.add(L,n.mul(D,x)),v)}function a(D,x){const v=n.sqr(x),A=o(D);return n.eql(v,A)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=n.mul(n.pow(e.a,Aa),yE),l=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(c,l)))throw new Error("bad curve params: a or b");function u(D){return ga(D,qe,e.n)}function h(D){const{allowedPrivateKeyLengths:x,nByteLength:v,wrapPrivateKey:A,n:L}=e;if(x&&typeof D!="bigint"){if(dr(D)&&(D=pr(D)),typeof D!="string"||!x.includes(D.length))throw new Error("invalid private key");D=D.padStart(v*2,"0")}let M;try{M=typeof D=="bigint"?D:ii(Ct("private key",D,v))}catch{throw new Error("invalid private key, expected hex or "+v+" bytes, got "+typeof D)}return A&&(M=ft(M,L)),Ui("private key",M,qe,L),M}function d(D){if(!(D instanceof g))throw new Error("ProjectivePoint expected")}const y=ad((D,x)=>{const{px:v,py:A,pz:L}=D;if(n.eql(L,n.ONE))return{x:v,y:A};const M=D.is0();x==null&&(x=M?n.ONE:n.inv(L));const C=n.mul(v,x),z=n.mul(A,x),j=n.mul(L,x);if(M)return{x:n.ZERO,y:n.ZERO};if(!n.eql(j,n.ONE))throw new Error("invZ was invalid");return{x:C,y:z}}),f=ad(D=>{if(D.is0()){if(e.allowInfinityPoint&&!n.is0(D.py))return;throw new Error("bad point: ZERO")}const{x,y:v}=D.toAffine();if(!n.isValid(x)||!n.isValid(v))throw new Error("bad point: x or y not FE");if(!a(x,v))throw new Error("bad point: equation left != right");if(!D.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(x,v,A){if(x==null||!n.isValid(x))throw new Error("x required");if(v==null||!n.isValid(v)||n.is0(v))throw new Error("y required");if(A==null||!n.isValid(A))throw new Error("z required");this.px=x,this.py=v,this.pz=A,Object.freeze(this)}static fromAffine(x){const{x:v,y:A}=x||{};if(!x||!n.isValid(v)||!n.isValid(A))throw new Error("invalid affine point");if(x instanceof g)throw new Error("projective point not allowed");const L=M=>n.eql(M,n.ZERO);return L(v)&&L(A)?g.ZERO:new g(v,A,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const v=dd(n,x.map(A=>A.pz));return x.map((A,L)=>A.toAffine(v[L])).map(g.fromAffine)}static fromHex(x){const v=g.fromAffine(s(Ct("pointHex",x)));return v.assertValidity(),v}static fromPrivateKey(x){return g.BASE.multiply(h(x))}static msm(x,v){return fE(g,i,x,v)}_setWindowSize(x){B.setWindowSize(this,x)}assertValidity(){f(this)}hasEvenY(){const{y:x}=this.toAffine();if(n.isOdd)return!n.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){d(x);const{px:v,py:A,pz:L}=this,{px:M,py:C,pz:z}=x,j=n.eql(n.mul(v,z),n.mul(M,L)),q=n.eql(n.mul(A,z),n.mul(C,L));return j&&q}negate(){return new g(this.px,n.neg(this.py),this.pz)}double(){const{a:x,b:v}=e,A=n.mul(v,Aa),{px:L,py:M,pz:C}=this;let z=n.ZERO,j=n.ZERO,q=n.ZERO,P=n.mul(L,L),T=n.mul(M,M),S=n.mul(C,C),m=n.mul(L,M);return m=n.add(m,m),q=n.mul(L,C),q=n.add(q,q),z=n.mul(x,q),j=n.mul(A,S),j=n.add(z,j),z=n.sub(T,j),j=n.add(T,j),j=n.mul(z,j),z=n.mul(m,z),q=n.mul(A,q),S=n.mul(x,S),m=n.sub(P,S),m=n.mul(x,m),m=n.add(m,q),q=n.add(P,P),P=n.add(q,P),P=n.add(P,S),P=n.mul(P,m),j=n.add(j,P),S=n.mul(M,C),S=n.add(S,S),P=n.mul(S,m),z=n.sub(z,P),q=n.mul(S,T),q=n.add(q,q),q=n.add(q,q),new g(z,j,q)}add(x){d(x);const{px:v,py:A,pz:L}=this,{px:M,py:C,pz:z}=x;let j=n.ZERO,q=n.ZERO,P=n.ZERO;const T=e.a,S=n.mul(e.b,Aa);let m=n.mul(v,M),_=n.mul(A,C),k=n.mul(L,z),R=n.add(v,A),U=n.add(M,C);R=n.mul(R,U),U=n.add(m,_),R=n.sub(R,U),U=n.add(v,L);let H=n.add(M,z);return U=n.mul(U,H),H=n.add(m,k),U=n.sub(U,H),H=n.add(A,L),j=n.add(C,z),H=n.mul(H,j),j=n.add(_,k),H=n.sub(H,j),P=n.mul(T,U),j=n.mul(S,k),P=n.add(j,P),j=n.sub(_,P),P=n.add(_,P),q=n.mul(j,P),_=n.add(m,m),_=n.add(_,m),k=n.mul(T,k),U=n.mul(S,U),_=n.add(_,k),k=n.sub(m,k),k=n.mul(T,k),U=n.add(U,k),m=n.mul(_,U),q=n.add(q,m),m=n.mul(H,U),j=n.mul(R,j),j=n.sub(j,m),m=n.mul(R,_),P=n.mul(H,P),P=n.add(P,m),new g(j,q,P)}subtract(x){return this.add(x.negate())}is0(){return this.equals(g.ZERO)}wNAF(x){return B.wNAFCached(this,x,g.normalizeZ)}multiplyUnsafe(x){const{endo:v,n:A}=e;Ui("scalar",x,pn,A);const L=g.ZERO;if(x===pn)return L;if(this.is0()||x===qe)return this;if(!v||B.hasPrecomputes(this))return B.wNAFCachedUnsafe(this,x,g.normalizeZ);let{k1neg:M,k1:C,k2neg:z,k2:j}=v.splitScalar(x),q=L,P=L,T=this;for(;C>pn||j>pn;)C&qe&&(q=q.add(T)),j&qe&&(P=P.add(T)),T=T.double(),C>>=qe,j>>=qe;return M&&(q=q.negate()),z&&(P=P.negate()),P=new g(n.mul(P.px,v.beta),P.py,P.pz),q.add(P)}multiply(x){const{endo:v,n:A}=e;Ui("scalar",x,qe,A);let L,M;if(v){const{k1neg:C,k1:z,k2neg:j,k2:q}=v.splitScalar(x);let{p:P,f:T}=this.wNAF(z),{p:S,f:m}=this.wNAF(q);P=B.constTimeNegate(C,P),S=B.constTimeNegate(j,S),S=new g(n.mul(S.px,v.beta),S.py,S.pz),L=P.add(S),M=T.add(m)}else{const{p:C,f:z}=this.wNAF(x);L=C,M=z}return g.normalizeZ([L,M])[0]}multiplyAndAddUnsafe(x,v,A){const L=g.BASE,M=(z,j)=>j===pn||j===qe||!z.equals(L)?z.multiplyUnsafe(j):z.multiply(j),C=M(this,v).add(M(x,A));return C.is0()?void 0:C}toAffine(x){return y(this,x)}isTorsionFree(){const{h:x,isTorsionFree:v}=e;if(x===qe)return!0;if(v)return v(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:v}=e;return x===qe?this:v?v(g,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return fr("isCompressed",x),this.assertValidity(),r(g,this,x)}toHex(x=!0){return fr("isCompressed",x),pr(this.toRawBytes(x))}}g.BASE=new g(e.Gx,e.Gy,n.ONE),g.ZERO=new g(n.ZERO,n.ONE,n.ZERO);const{endo:I,nBitLength:O}=e,B=dE(g,I?Math.ceil(O/2):O);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function mE(t){const e=Ed(t);return $s(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function bE(t){const e=mE(t),{Fp:n,n:i,nByteLength:r,nBitLength:s}=e,o=n.BYTES+1,a=2*n.BYTES+1;function c(S){return ft(S,i)}function l(S){return wa(S,i)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:y}=wE({...e,toBytes(S,m,_){const k=m.toAffine(),R=n.toBytes(k.x),U=Cs;return fr("isCompressed",_),_?U(Uint8Array.from([m.hasEvenY()?2:3]),R):U(Uint8Array.from([4]),R,n.toBytes(k.y))},fromBytes(S){const m=S.length,_=S[0],k=S.subarray(1);if(m===o&&(_===2||_===3)){const R=ii(k);if(!ga(R,qe,n.ORDER))throw new Error("Point is not on curve");const U=d(R);let H;try{H=n.sqrt(U)}catch(Z){const X=Z instanceof Error?": "+Z.message:"";throw new Error("Point is not on curve"+X)}const G=(H&qe)===qe;return(_&1)===1!==G&&(H=n.neg(H)),{x:R,y:H}}else if(m===a&&_===4){const R=n.fromBytes(k.subarray(0,n.BYTES)),U=n.fromBytes(k.subarray(n.BYTES,2*n.BYTES));return{x:R,y:U}}else{const R=o,U=a;throw new Error("invalid Point, expected length of "+R+", or uncompressed "+U+", got "+m)}}});function f(S){const m=i>>qe;return S>m}function g(S){return f(S)?c(-S):S}const I=(S,m,_)=>ii(S.slice(m,_));class O{constructor(m,_,k){Ui("r",m,qe,i),Ui("s",_,qe,i),this.r=m,this.s=_,k!=null&&(this.recovery=k),Object.freeze(this)}static fromCompact(m){const _=r;return m=Ct("compactSignature",m,_*2),new O(I(m,0,_),I(m,_,2*_))}static fromDER(m){const{r:_,s:k}=fn.toSig(Ct("DER",m));return new O(_,k)}assertValidity(){}addRecoveryBit(m){return new O(this.r,this.s,m)}recoverPublicKey(m){const{r:_,s:k,recovery:R}=this,U=L(Ct("msgHash",m));if(R==null||![0,1,2,3].includes(R))throw new Error("recovery id invalid");const H=R===2||R===3?_+e.n:_;if(H>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const G=(R&1)===0?"02":"03",Q=u.fromHex(G+Sa(H,n.BYTES)),Z=l(H),X=c(-U*Z),re=c(k*Z),ce=u.BASE.multiplyAndAddUnsafe(Q,X,re);if(!ce)throw new Error("point at infinify");return ce.assertValidity(),ce}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new O(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ds(this.toDERHex())}toDERHex(){return fn.hexFromSig(this)}toCompactRawBytes(){return Ds(this.toCompactHex())}toCompactHex(){const m=r;return Sa(this.r,m)+Sa(this.s,m)}}const B={isValidPrivateKey(S){try{return h(S),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const S=yd(e.n);return lE(e.randomBytes(S),e.n)},precompute(S=8,m=u.BASE){return m._setWindowSize(S),m.multiply(BigInt(3)),m}};function D(S,m=!0){return u.fromPrivateKey(S).toRawBytes(m)}function x(S){if(typeof S=="bigint")return!1;if(S instanceof u)return!0;const _=Ct("key",S).length,k=n.BYTES,R=k+1,U=2*k+1;if(!(e.allowedPrivateKeyLengths||r===R))return _===R||_===U}function v(S,m,_=!0){if(x(S)===!0)throw new Error("first arg must be private key");if(x(m)===!1)throw new Error("second arg must be public key");return u.fromHex(m).multiply(h(S)).toRawBytes(_)}const A=e.bits2int||function(S){if(S.length>8192)throw new Error("input is too large");const m=ii(S),_=S.length*8-s;return _>0?m>>BigInt(_):m},L=e.bits2int_modN||function(S){return c(A(S))},M=Os(s);function C(S){return Ui("num < 2^"+s,S,pn,M),gr(S,r)}function z(S,m,_=j){if(["recovered","canonical"].some(le=>le in _))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:R}=e;let{lowS:U,prehash:H,extraEntropy:G}=_;U==null&&(U=!0),S=Ct("msgHash",S),xd(_),H&&(S=Ct("prehashed msgHash",k(S)));const Q=L(S),Z=h(m),X=[C(Z),C(Q)];if(G!=null&&G!==!1){const le=G===!0?R(n.BYTES):G;X.push(Ct("extraEntropy",le))}const re=Cs(...X),ce=Q;function fe(le){const ae=A(le);if(!y(ae))return;const $=l(ae),p=u.BASE.multiply(ae).toAffine(),w=c(p.x);if(w===pn)return;const b=c($*c(ce+w*Z));if(b===pn)return;let E=(p.x===w?0:2)|Number(p.y&qe),F=b;return U&&f(b)&&(F=g(b),E^=1),new O(w,F,E)}return{seed:re,k2sig:fe}}const j={lowS:e.lowS,prehash:!1},q={lowS:e.lowS,prehash:!1};function P(S,m,_=j){const{seed:k,k2sig:R}=z(S,m,_),U=e;return eE(U.hash.outputLen,U.nByteLength,U.hmac)(k,R)}u.BASE._setWindowSize(8);function T(S,m,_,k=q){var E;const R=S;m=Ct("msgHash",m),_=Ct("publicKey",_);const{lowS:U,prehash:H,format:G}=k;if(xd(k),"strict"in k)throw new Error("options.strict was renamed to lowS");if(G!==void 0&&G!=="compact"&&G!=="der")throw new Error("format must be compact or der");const Q=typeof R=="string"||dr(R),Z=!Q&&!G&&typeof R=="object"&&R!==null&&typeof R.r=="bigint"&&typeof R.s=="bigint";if(!Q&&!Z)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let X,re;try{if(Z&&(X=new O(R.r,R.s)),Q){try{G!=="compact"&&(X=O.fromDER(R))}catch(F){if(!(F instanceof fn.Err))throw F}!X&&G!=="der"&&(X=O.fromCompact(R))}re=u.fromHex(_)}catch{return!1}if(!X||U&&X.hasHighS())return!1;H&&(m=e.hash(m));const{r:ce,s:fe}=X,le=L(m),ae=l(fe),$=c(le*ae),p=c(ce*ae),w=(E=u.BASE.multiplyAndAddUnsafe(re,$,p))==null?void 0:E.toAffine();return w?c(w.x)===ce:!1}return{CURVE:e,getPublicKey:D,getSharedSecret:v,sign:P,verify:T,ProjectivePoint:u,Signature:O,utils:B}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vE(t){return{hash:t,hmac:(e,...n)=>ed(t,e,Ov(...n)),randomBytes:$v}}function EE(t,e){const n=i=>bE({...t,...vE(i)});return{...n(e),create:n}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _d=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Sd=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),xE=BigInt(0),_E=BigInt(1),Ia=BigInt(2),Ad=(t,e)=>(t+e/Ia)/e;function SE(t){const e=_d,n=BigInt(3),i=BigInt(6),r=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=Ot(u,n,e)*u%e,d=Ot(h,n,e)*u%e,y=Ot(d,Ia,e)*l%e,f=Ot(y,r,e)*y%e,g=Ot(f,s,e)*f%e,I=Ot(g,a,e)*g%e,O=Ot(I,c,e)*I%e,B=Ot(O,a,e)*g%e,D=Ot(B,n,e)*u%e,x=Ot(D,o,e)*f%e,v=Ot(x,i,e)*l%e,A=Ot(v,Ia,e);if(!Da.eql(Da.sqr(A),t))throw new Error("Cannot find square root");return A}const Da=ma(_d,void 0,void 0,{sqrt:SE}),AE=EE({a:xE,b:BigInt(7),Fp:Da,n:Sd,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Sd,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-_E*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),r=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Ad(s*t,e),c=Ad(-i*t,e);let l=ft(t-a*n-c*r,e),u=ft(-a*i-c*s,e);const h=l>o,d=u>o;if(h&&(l=e-l),d&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},Zv),IE=Object.freeze(Object.defineProperty({__proto__:null,secp256k1:AE},Symbol.toStringTag,{value:"Module"}));function DE(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const n=t.length,i=t.charAt(0),r=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0;const y=l.length;for(;d!==y&&l[d]===0;)d++,u++;const f=(y-d)*s+1>>>0,g=new Uint8Array(f);for(;d!==y;){let B=l[d],D=0;for(let x=f-1;(B!==0||D<h)&&x!==-1;x--,D++)B+=256*g[x]>>>0,g[x]=B%n>>>0,B=B/n>>>0;if(B!==0)throw new Error("Non-zero carry");h=D,d++}let I=f-h;for(;I!==f&&g[I]===0;)I++;let O=i.repeat(u);for(;I<f;++I)O+=t.charAt(g[I]);return O}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===i;)h++,u++;const y=(l.length-u)*r+1>>>0,f=new Uint8Array(y);for(;u<l.length;){const B=l.charCodeAt(u);if(B>255)return;let D=e[B];if(D===255)return;let x=0;for(let v=y-1;(D!==0||x<d)&&v!==-1;v--,x++)D+=n*f[v]>>>0,f[v]=D%256>>>0,D=D/256>>>0;if(D!==0)throw new Error("Non-zero carry");d=x,u++}let g=y-d;for(;g!==y&&f[g]===0;)g++;const I=new Uint8Array(h+(y-g));let O=h;for(;g!==y;)I[O++]=f[g++];return I}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var CE="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const yr=DE(CE);function OE(t){const e=t.length;let n=0,i=0;for(;i<e;){let r=t.charCodeAt(i++);if((r&4294967168)===0){n++;continue}else if((r&4294965248)===0)n+=2;else{if(r>=55296&&r<=56319&&i<e){const s=t.charCodeAt(i);(s&64512)===56320&&(++i,r=((r&1023)<<10)+(s&1023)+65536)}(r&4294901760)===0?n+=3:n+=4}}return n}function $E(t,e,n){const i=t.length;let r=n,s=0;for(;s<i;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[r++]=o;continue}else if((o&4294965248)===0)e[r++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[r++]=o>>12&15|224,e[r++]=o>>6&63|128):(e[r++]=o>>18&7|240,e[r++]=o>>12&63|128,e[r++]=o>>6&63|128)}e[r++]=o&63|128}}const PE=new TextEncoder,TE=50;function BE(t,e,n){PE.encodeInto(t,e.subarray(n))}function kE(t,e,n){t.length>TE?BE(t,e,n):$E(t,e,n)}const NE=4096;function Id(t,e,n){let i=e;const r=i+n,s=[];let o="";for(;i<r;){const a=t[i++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[i++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,l=t[i++]&63;s.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[i++]&63,l=t[i++]&63,u=t[i++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=NE&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const RE=new TextDecoder,LE=200;function UE(t,e,n){const i=t.subarray(e,e+n);return RE.decode(i)}function FE(t,e,n){return n>LE?UE(t,e,n):Id(t,e,n)}class Ps{constructor(e,n){this.type=e,this.data=n}}class xt extends Error{constructor(e){super(e);const n=Object.create(xt.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:xt.name})}}const wr=4294967295;function ME(t,e,n){const i=n/4294967296,r=n;t.setUint32(e,i),t.setUint32(e+4,r)}function Dd(t,e,n){const i=Math.floor(n/4294967296),r=n;t.setUint32(e,i),t.setUint32(e+4,r)}function Cd(t,e){const n=t.getInt32(e),i=t.getUint32(e+4);return n*4294967296+i}function zE(t,e){const n=t.getUint32(e),i=t.getUint32(e+4);return n*4294967296+i}const jE=-1,qE=4294967296-1,HE=17179869184-1;function VE({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=HE)if(e===0&&t<=qE){const n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t),n}else{const n=t/4294967296,i=t&4294967295,r=new Uint8Array(8),s=new DataView(r.buffer);return s.setUint32(0,e<<2|n&3),s.setUint32(4,i),r}else{const n=new Uint8Array(12),i=new DataView(n.buffer);return i.setUint32(0,e),Dd(i,4,t),n}}function KE(t){const e=t.getTime(),n=Math.floor(e/1e3),i=(e-n*1e3)*1e6,r=Math.floor(i/1e9);return{sec:n+r,nsec:i-r*1e9}}function WE(t){if(t instanceof Date){const e=KE(t);return VE(e)}else return null}function GE(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const n=e.getUint32(0),i=e.getUint32(4),r=(n&3)*4294967296+i,s=n>>>2;return{sec:r,nsec:s}}case 12:{const n=Cd(e,4),i=e.getUint32(0);return{sec:n,nsec:i}}default:throw new xt(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function QE(t){const e=GE(t);return new Date(e.sec*1e3+e.nsec/1e6)}const YE={type:jE,encode:WE,decode:QE};class Ts{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(YE)}register({type:e,encode:n,decode:i}){if(e>=0)this.encoders[e]=n,this.decoders[e]=i;else{const r=-1-e;this.builtInEncoders[r]=n,this.builtInDecoders[r]=i}}tryToEncode(e,n){for(let i=0;i<this.builtInEncoders.length;i++){const r=this.builtInEncoders[i];if(r!=null){const s=r(e,n);if(s!=null){const o=-1-i;return new Ps(o,s)}}}for(let i=0;i<this.encoders.length;i++){const r=this.encoders[i];if(r!=null){const s=r(e,n);if(s!=null){const o=i;return new Ps(o,s)}}}return e instanceof Ps?e:null}decode(e,n,i){const r=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return r?r(e,n,i):new Ps(n,e)}}Ts.defaultCodec=new Ts;function ZE(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Ca(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):ZE(t)?new Uint8Array(t):Uint8Array.from(t)}const JE=100,XE=2048;let ex=class y0{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Ts.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??JE,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??XE,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new y0({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,n){if(n>this.maxDepth)throw new Error(`Too deep objects in depth ${n}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)}ensureBufferSizeToWrite(e){const n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)}resizeBuffer(e){const n=new ArrayBuffer(e),i=new Uint8Array(n),r=new DataView(n);i.set(this.bytes),this.view=r,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=OE(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),kE(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,n){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error(`Too large binary: ${n}`);const i=Ca(e);this.writeU8a(i)}encodeArray(e,n){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const r of e)this.doEncode(r,n+1)}countWithoutUndefined(e,n){let i=0;for(const r of n)e[r]!==void 0&&i++;return i}encodeMap(e,n){const i=Object.keys(e);this.sortKeys&&i.sort();const r=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else if(r<4294967296)this.writeU8(223),this.writeU32(r);else throw new Error(`Too large map object: ${r}`);for(const s of i){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,n+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),r=i.length;if(r>=4294967296)throw new Error(`Too large extension object: ${r}`);this.writeU8(201),this.writeU32(r),this.writeI8(e.type),this.writeU8a(i);return}const n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error(`Too large extension object: ${n}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),ME(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Dd(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function tx(t,e){return new ex(e).encodeSharedRef(t)}function Oa(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const nx=16,ix=16;class rx{constructor(e=nx,n=ix){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=n,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,n,i){const r=this.caches[i-1];e:for(const s of r){const o=s.bytes;for(let a=0;a<i;a++)if(o[a]!==e[n+a])continue e;return s.str}return null}store(e,n){const i=this.caches[e.length-1],r={bytes:e,str:n};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=r:i.push(r)}decode(e,n,i){const r=this.find(e,n,i);if(r!=null)return this.hit++,r;this.miss++;const s=Id(e,n,i),o=Uint8Array.prototype.slice.call(e,n,n+i);return this.store(o,s),s}}const $a="array",mr="map_key",Od="map_value",sx=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new xt("The type of key must be string or number but "+typeof t)};class ox{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const n=this.getUninitializedStateFromPool();n.type=$a,n.position=0,n.size=e,n.array=new Array(e)}pushMapState(e){const n=this.getUninitializedStateFromPool();n.type=mr,n.readCount=0,n.size=e,n.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===$a){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===mr||e.type===Od){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const br=-1,Pa=new DataView(new ArrayBuffer(0)),ax=new Uint8Array(Pa.buffer);try{Pa.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const $d=new RangeError("Insufficient data"),cx=new rx;let lx=class w0{constructor(e){this.totalPos=0,this.pos=0,this.view=Pa,this.bytes=ax,this.headByte=br,this.stack=new ox,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Ts.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??wr,this.maxBinLength=(e==null?void 0:e.maxBinLength)??wr,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??wr,this.maxMapLength=(e==null?void 0:e.maxMapLength)??wr,this.maxExtLength=(e==null?void 0:e.maxExtLength)??wr,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:cx,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??sx}clone(){return new w0({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=br,this.stack.reset()}setBuffer(e){const n=Ca(e);this.bytes=n,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===br&&!this.hasRemaining(1))this.setBuffer(e);else{const n=this.bytes.subarray(this.pos),i=Ca(e),r=new Uint8Array(n.length+i.length);r.set(n),r.set(i,n.length),this.setBuffer(r)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:n,pos:i}=this;return new RangeError(`Extra ${n.byteLength-i} of ${n.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let n=!1,i;for await(const a of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),n=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:r,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Oa(r)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,n){if(this.entered){yield*this.clone().decodeMultiAsync(e,n);return}try{this.entered=!0;let i=n,r=-1;for await(const s of e){if(n&&r===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(r=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--r!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let n;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){const r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e<160){const r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else{const r=e-160;n=this.decodeString(r,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){const r=this.lookU8();n=this.decodeString(r,1)}else if(e===218){const r=this.lookU16();n=this.decodeString(r,2)}else if(e===219){const r=this.lookU32();n=this.decodeString(r,4)}else if(e===220){const r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===221){const r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else n=[]}else if(e===222){const r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===223){const r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else n={}}else if(e===196){const r=this.lookU8();n=this.decodeBinary(r,1)}else if(e===197){const r=this.lookU16();n=this.decodeBinary(r,2)}else if(e===198){const r=this.lookU32();n=this.decodeBinary(r,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){const r=this.lookU8();n=this.decodeExtension(r,1)}else if(e===200){const r=this.lookU16();n=this.decodeExtension(r,2)}else if(e===201){const r=this.lookU32();n=this.decodeExtension(r,4)}else throw new xt(`Unrecognized type byte: ${Oa(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const r=i.top();if(r.type===$a)if(r.array[r.position]=n,r.position++,r.position===r.size)n=r.array,i.release(r);else continue e;else if(r.type===mr){if(n==="__proto__")throw new xt("The key __proto__ is not allowed");r.key=this.mapKeyConverter(n),r.type=Od;continue e}else if(r.map[r.key]=n,r.readCount++,r.readCount===r.size)n=r.map,i.release(r);else{r.key=null,r.type=mr;continue e}}return n}}readHeadByte(){return this.headByte===br&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=br}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new xt(`Unrecognized array type byte: ${Oa(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new xt(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new xt(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,n){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,n):this.decodeBinary(e,n)}decodeUtf8String(e,n){var s;if(e>this.maxStrLength)throw new xt(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+n+e)throw $d;const i=this.pos+n;let r;return this.stateIsMapKey()&&((s=this.keyDecoder)!=null&&s.canBeCached(e))?r=this.keyDecoder.decode(this.bytes,i,e):r=FE(this.bytes,i,e),this.pos+=n+e,r}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===mr:!1}decodeBinary(e,n){if(e>this.maxBinLength)throw new xt(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+n))throw $d;const i=this.pos+n,r=this.bytes.subarray(i,i+e);return this.pos+=n+e,r}decodeExtension(e,n){if(e>this.maxExtLength)throw new xt(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+n),r=this.decodeBinary(e,n+1);return this.extensionCodec.decode(r,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=zE(this.view,this.pos);return this.pos+=8,e}readI64(){const e=Cd(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function ux(t,e){return new lx(e).decode(t)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hx(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Pd(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function Bs(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Ta(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Ba(t){if(!Array.isArray(t))throw new Error("array expected")}function ks(t,e){if(!Pd(!0,e))throw new Error(`${t}: array of strings expected`)}function dx(t,e){if(!Pd(!1,e))throw new Error(`${t}: array of numbers expected`)}function fx(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),i=t.map(s=>s.encode).reduceRight(n,e),r=t.map(s=>s.decode).reduce(n,e);return{encode:i,decode:r}}function px(t){const e=typeof t=="string"?t.split(""):t,n=e.length;ks("alphabet",e);const i=new Map(e.map((r,s)=>[r,s]));return{encode:r=>(Ba(r),r.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:r=>(Ba(r),r.map(s=>{Bs("alphabet.decode",s);const o=i.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function gx(t=""){return Bs("join",t),{encode:e=>(ks("join.decode",e),e.join(t)),decode:e=>(Bs("join.decode",e),e.split(t))}}function yx(t,e="="){return Ta(t),Bs("padding",e),{encode(n){for(ks("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){ks("padding.decode",n);let i=n.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&n[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,i)}}}const Td=(t,e)=>e===0?t:Td(e,t%e),Ns=(t,e)=>t+(e-Td(t,e)),ka=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Bd(t,e,n,i){if(Ba(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ns(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Ns(e,n)}`);let r=0,s=0;const o=ka[e],a=ka[n]-1,c=[];for(const l of t){if(Ta(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(r=r<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((r>>s-n&a)>>>0);const u=ka[s];if(u===void 0)throw new Error("invalid carry");r&=u-1}if(r=r<<n-s&a,!i&&s>=e)throw new Error("Excess padding");if(!i&&r>0)throw new Error(`Non-zero padding: ${r}`);return i&&s>0&&c.push(r>>>0),c}function wx(t,e=!1){if(Ta(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Ns(8,t)>32||Ns(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!hx(n))throw new Error("radix2.encode input should be Uint8Array");return Bd(Array.from(n),8,t,!e)},decode:n=>(dx("radix2.decode",n),Uint8Array.from(Bd(n,t,8,e)))}}const mx=fx(wx(5),px("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),yx(5),gx(""));function Na(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function kd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Na(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function vr(t,e){e||(e=t.reduce((r,s)=>r+s.length,0));const n=kd(e);let i=0;for(const r of t)n.set(r,i),i+=r.length;return Na(n)}function bx(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var r=0;r<t.length;r++){var s=t.charAt(r),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=r}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,I=0,O=0,B=f.length;O!==B&&f[O]===0;)O++,g++;for(var D=(B-O)*u+1>>>0,x=new Uint8Array(D);O!==B;){for(var v=f[O],A=0,L=D-1;(v!==0||A<I)&&L!==-1;L--,A++)v+=256*x[L]>>>0,x[L]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");I=A,O++}for(var M=D-I;M!==D&&x[M]===0;)M++;for(var C=c.repeat(g);M<D;++M)C+=t.charAt(x[M]);return C}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var I=0,O=0;f[g]===c;)I++,g++;for(var B=(f.length-g)*l+1>>>0,D=new Uint8Array(B);f[g];){var x=n[f.charCodeAt(g)];if(x===255)return;for(var v=0,A=B-1;(x!==0||v<O)&&A!==-1;A--,v++)x+=a*D[A]>>>0,D[A]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");O=v,g++}if(f[g]!==" "){for(var L=B-O;L!==B&&D[L]===0;)L++;for(var M=new Uint8Array(I+(B-L)),C=I;L!==B;)M[C++]=D[L++];return M}}}function y(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var vx=bx,Ex=vx;const xx=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},_x=t=>new TextEncoder().encode(t),Sx=t=>new TextDecoder().decode(t);class Ax{constructor(e,n,i){this.name=e,this.prefix=n,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ix{constructor(e,n,i){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Nd(this,e)}}class Dx{constructor(e){this.decoders=e}or(e){return Nd(this,e)}decode(e){const n=e[0],i=this.decoders[n];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Nd=(t,e)=>new Dx({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Cx{constructor(e,n,i,r){this.name=e,this.prefix=n,this.baseEncode=i,this.baseDecode=r,this.encoder=new Ax(e,n,i),this.decoder=new Ix(e,n,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Rs=({name:t,prefix:e,encode:n,decode:i})=>new Cx(t,e,n,i),Er=({prefix:t,name:e,alphabet:n})=>{const{encode:i,decode:r}=Ex(n,e);return Rs({prefix:t,name:e,encode:i,decode:s=>xx(r(s))})},Ox=(t,e,n,i)=>{const r={};for(let u=0;u<e.length;++u)r[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=r[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},$x=(t,e,n)=>{const i=e[e.length-1]==="=",r=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[r&a>>o];if(o&&(s+=e[r&a<<n-o]),i)for(;s.length*n&7;)s+="=";return s},Qe=({name:t,prefix:e,bitsPerChar:n,alphabet:i})=>Rs({prefix:e,name:t,encode(r){return $x(r,i,n)},decode(r){return Ox(r,i,n,t)}}),Px=Rs({prefix:"\0",name:"identity",encode:t=>Sx(t),decode:t=>_x(t)}),Tx=Object.freeze(Object.defineProperty({__proto__:null,identity:Px},Symbol.toStringTag,{value:"Module"})),Bx=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),kx=Object.freeze(Object.defineProperty({__proto__:null,base2:Bx},Symbol.toStringTag,{value:"Module"})),Nx=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Rx=Object.freeze(Object.defineProperty({__proto__:null,base8:Nx},Symbol.toStringTag,{value:"Module"})),Lx=Er({prefix:"9",name:"base10",alphabet:"0123456789"}),Ux=Object.freeze(Object.defineProperty({__proto__:null,base10:Lx},Symbol.toStringTag,{value:"Module"})),Fx=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Mx=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),zx=Object.freeze(Object.defineProperty({__proto__:null,base16:Fx,base16upper:Mx},Symbol.toStringTag,{value:"Module"})),jx=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qx=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Hx=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Vx=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Kx=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Wx=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Gx=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Qx=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Yx=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Zx=Object.freeze(Object.defineProperty({__proto__:null,base32:jx,base32hex:Kx,base32hexpad:Gx,base32hexpadupper:Qx,base32hexupper:Wx,base32pad:Hx,base32padupper:Vx,base32upper:qx,base32z:Yx},Symbol.toStringTag,{value:"Module"})),Jx=Er({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Xx=Er({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),e3=Object.freeze(Object.defineProperty({__proto__:null,base36:Jx,base36upper:Xx},Symbol.toStringTag,{value:"Module"})),t3=Er({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),n3=Er({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),i3=Object.freeze(Object.defineProperty({__proto__:null,base58btc:t3,base58flickr:n3},Symbol.toStringTag,{value:"Module"})),r3=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),s3=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),o3=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),a3=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),c3=Object.freeze(Object.defineProperty({__proto__:null,base64:r3,base64pad:s3,base64url:o3,base64urlpad:a3},Symbol.toStringTag,{value:"Module"})),Rd=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),l3=Rd.reduce((t,e,n)=>(t[n]=e,t),[]),u3=Rd.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function h3(t){return t.reduce((e,n)=>(e+=l3[n],e),"")}function d3(t){const e=[];for(const n of t){const i=u3[n.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(i)}return new Uint8Array(e)}const f3=Rs({prefix:"🚀",name:"base256emoji",encode:h3,decode:d3}),p3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:f3},Symbol.toStringTag,{value:"Module"}));new TextEncoder,new TextDecoder;const Ld={...Tx,...kx,...Rx,...Ux,...zx,...Zx,...e3,...i3,...c3,...p3};function Ud(t,e,n,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:i}}}const Fd=Ud("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ra=Ud("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=kd(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Md={utf8:Fd,"utf-8":Fd,hex:Ld.base16,latin1:Ra,ascii:Ra,binary:Ra,...Ld};function $t(t,e="utf8"){const n=Md[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Na(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function pt(t,e="utf8"){const n=Md[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}const g3={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var La,zd;function jd(){if(zd)return La;zd=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function n(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function r(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=i(a[u]).toUpperCase(),l+=" ",l+=i(a[u+1]).toUpperCase();else if(c===64)l+=i(a[u+1]).toUpperCase(),l+=i(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function s(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let d=0;d<a;d++)u[d]=d%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let d=0;d<c;d++){const y=o(u),f=new Date().getTime(),g=f-l;l=f,console.log("Hashed in "+g+"ms: "+y.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return La={normalizeInput:e,toHex:n,debugPrint:r,testSpeed:s},La}var Ua,qd;function y3(){if(qd)return Ua;qd=1;const t=jd();function e(O,B,D){const x=O[B]+O[D];let v=O[B+1]+O[D+1];x>=4294967296&&v++,O[B]=x,O[B+1]=v}function n(O,B,D,x){let v=O[B]+D;D<0&&(v+=4294967296);let A=O[B+1]+x;v>=4294967296&&A++,O[B]=v,O[B+1]=A}function i(O,B){return O[B]^O[B+1]<<8^O[B+2]<<16^O[B+3]<<24}function r(O,B,D,x,v,A){const L=l[v],M=l[v+1],C=l[A],z=l[A+1];e(c,O,B),n(c,O,L,M);let j=c[x]^c[O],q=c[x+1]^c[O+1];c[x]=q,c[x+1]=j,e(c,D,x),j=c[B]^c[D],q=c[B+1]^c[D+1],c[B]=j>>>24^q<<8,c[B+1]=q>>>24^j<<8,e(c,O,B),n(c,O,C,z),j=c[x]^c[O],q=c[x+1]^c[O+1],c[x]=j>>>16^q<<16,c[x+1]=q>>>16^j<<16,e(c,D,x),j=c[B]^c[D],q=c[B+1]^c[D+1],c[B]=q>>>31^j<<1,c[B+1]=j>>>31^q<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(O){return O*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(O,B){let D=0;for(D=0;D<16;D++)c[D]=O.h[D],c[D+16]=s[D];for(c[24]=c[24]^O.t,c[25]=c[25]^O.t/4294967296,B&&(c[28]=~c[28],c[29]=~c[29]),D=0;D<32;D++)l[D]=i(O.b,4*D);for(D=0;D<12;D++)r(0,8,16,24,a[D*16+0],a[D*16+1]),r(2,10,18,26,a[D*16+2],a[D*16+3]),r(4,12,20,28,a[D*16+4],a[D*16+5]),r(6,14,22,30,a[D*16+6],a[D*16+7]),r(0,10,20,30,a[D*16+8],a[D*16+9]),r(2,12,22,24,a[D*16+10],a[D*16+11]),r(4,14,16,26,a[D*16+12],a[D*16+13]),r(6,8,18,28,a[D*16+14],a[D*16+15]);for(D=0;D<16;D++)O.h[D]=O.h[D]^c[D]^c[D+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function d(O,B,D,x){if(O===0||O>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(B&&B.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(D&&D.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(x&&x.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const v={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:O};h.fill(0),h[0]=O,B&&(h[1]=B.length),h[2]=1,h[3]=1,D&&h.set(D,32),x&&h.set(x,48);for(let A=0;A<16;A++)v.h[A]=s[A]^i(h,A*4);return B&&(y(v,B),v.c=128),v}function y(O,B){for(let D=0;D<B.length;D++)O.c===128&&(O.t+=O.c,u(O,!1),O.c=0),O.b[O.c++]=B[D]}function f(O){for(O.t+=O.c;O.c<128;)O.b[O.c++]=0;u(O,!0);const B=new Uint8Array(O.outlen);for(let D=0;D<O.outlen;D++)B[D]=O.h[D>>2]>>8*(D&3);return B}function g(O,B,D,x,v){D=D||64,O=t.normalizeInput(O),x&&(x=t.normalizeInput(x)),v&&(v=t.normalizeInput(v));const A=d(D,B,x,v);return y(A,O),f(A)}function I(O,B,D,x,v){const A=g(O,B,D,x,v);return t.toHex(A)}return Ua={blake2b:g,blake2bHex:I,blake2bInit:d,blake2bUpdate:y,blake2bFinal:f},Ua}var Fa,Hd;function w3(){if(Hd)return Fa;Hd=1;const t=jd();function e(f,g){return f[g]^f[g+1]<<8^f[g+2]<<16^f[g+3]<<24}function n(f,g,I,O,B,D){o[f]=o[f]+o[g]+B,o[O]=i(o[O]^o[f],16),o[I]=o[I]+o[O],o[g]=i(o[g]^o[I],12),o[f]=o[f]+o[g]+D,o[O]=i(o[O]^o[f],8),o[I]=o[I]+o[O],o[g]=i(o[g]^o[I],7)}function i(f,g){return f>>>g^f<<32-g}const r=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(f,g){let I=0;for(I=0;I<8;I++)o[I]=f.h[I],o[I+8]=r[I];for(o[12]^=f.t,o[13]^=f.t/4294967296,g&&(o[14]=~o[14]),I=0;I<16;I++)a[I]=e(f.b,4*I);for(I=0;I<10;I++)n(0,4,8,12,a[s[I*16+0]],a[s[I*16+1]]),n(1,5,9,13,a[s[I*16+2]],a[s[I*16+3]]),n(2,6,10,14,a[s[I*16+4]],a[s[I*16+5]]),n(3,7,11,15,a[s[I*16+6]],a[s[I*16+7]]),n(0,5,10,15,a[s[I*16+8]],a[s[I*16+9]]),n(1,6,11,12,a[s[I*16+10]],a[s[I*16+11]]),n(2,7,8,13,a[s[I*16+12]],a[s[I*16+13]]),n(3,4,9,14,a[s[I*16+14]],a[s[I*16+15]]);for(I=0;I<8;I++)f.h[I]^=o[I]^o[I+8]}function l(f,g){if(!(f>0&&f<=32))throw new Error("Incorrect output length, should be in [1, 32]");const I=g?g.length:0;if(g&&!(I>0&&I<=32))throw new Error("Incorrect key length, should be in [1, 32]");const O={h:new Uint32Array(r),b:new Uint8Array(64),c:0,t:0,outlen:f};return O.h[0]^=16842752^I<<8^f,I>0&&(u(O,g),O.c=64),O}function u(f,g){for(let I=0;I<g.length;I++)f.c===64&&(f.t+=f.c,c(f,!1),f.c=0),f.b[f.c++]=g[I]}function h(f){for(f.t+=f.c;f.c<64;)f.b[f.c++]=0;c(f,!0);const g=new Uint8Array(f.outlen);for(let I=0;I<f.outlen;I++)g[I]=f.h[I>>2]>>8*(I&3)&255;return g}function d(f,g,I){I=I||32,f=t.normalizeInput(f);const O=l(I,g);return u(O,f),h(O)}function y(f,g,I){const O=d(f,g,I);return t.toHex(O)}return Fa={blake2s:d,blake2sHex:y,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},Fa}var Ma,Vd;function m3(){if(Vd)return Ma;Vd=1;const t=y3(),e=w3();return Ma={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Ma}var b3=m3();const v3=":";function Ls(t){const[e,n]=t.split(v3);return{namespace:e,reference:n}}function Kd(t,e){return t.includes(":")?[t]:e.chains||[]}var E3=Object.defineProperty,x3=Object.defineProperties,_3=Object.getOwnPropertyDescriptors,Wd=Object.getOwnPropertySymbols,S3=Object.prototype.hasOwnProperty,A3=Object.prototype.propertyIsEnumerable,Gd=(t,e,n)=>e in t?E3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Qd=(t,e)=>{for(var n in e||(e={}))S3.call(e,n)&&Gd(t,n,e[n]);if(Wd)for(var n of Wd(e))A3.call(e,n)&&Gd(t,n,e[n]);return t},I3=(t,e)=>x3(t,_3(e));const D3="ReactNative",_t={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},C3="js";function Us(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Pn(){return!un.getDocument()&&!!un.getNavigator()&&navigator.product===D3}function O3(){return Pn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function $3(){return Pn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Fi(){return!Us()&&!!un.getNavigator()&&!!un.getDocument()}function xr(){return Pn()?_t.reactNative:Us()?_t.node:Fi()?_t.browser:_t.unknown}function Yd(){var t;try{return Pn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function P3(t,e){const n=new URLSearchParams(t);for(const i of Object.keys(e).sort())if(e.hasOwnProperty(i)){const r=e[i];r!==void 0&&n.set(i,r)}return n.toString()}function T3(t){var e,n;const i=Zd();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(r=>r!=="")),I3(Qd(Qd({},i),t),{url:(t==null?void 0:t.url)||i.url,name:(t==null?void 0:t.name)||i.name,description:(t==null?void 0:t.description)||i.description,icons:(n=t==null?void 0:t.icons)!=null&&n.length&&t.icons.length>0?t.icons:i.icons})}catch(r){return console.warn("Error populating app metadata",r),t||i}}function Zd(){return ev.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function B3(){if(xr()===_t.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:i}=global.Platform;return[n,i].join("-")}const t=W2();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function k3(){var t;const e=xr();return e===_t.browser?[e,((t=un.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Jd(t,e,n){const i=B3(),r=k3();return[[t,e].join("-"),[C3,n].join("-"),i,r].join("/")}function N3({protocol:t,version:e,relayUrl:n,sdkVersion:i,auth:r,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=n.split("?"),u=Jd(t,e,i),h={auth:r,ua:u,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},d=P3(l[1]||"",h);return l[0]+"?"+d}function si(t,e){return t.filter(n=>e.includes(n)).length===t.length}function za(t){return Object.fromEntries(t.entries())}function ja(t){return new Map(Object.entries(t))}function oi(t=ee.FIVE_MINUTES,e){const n=ee.toMiliseconds(t||ee.FIVE_MINUTES);let i,r,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&r&&(clearTimeout(s),r(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},n),i=a,r=c})}}function Tn(t,e,n){return new Promise(async(i,r)=>{const s=setTimeout(()=>r(new Error(n)),e);try{const o=await t;i(o)}catch(o){r(o)}clearTimeout(s)})}function Xd(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function R3(t){return Xd("topic",t)}function L3(t){return Xd("id",t)}function ef(t){const[e,n]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")i.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))i.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return i}function Ue(t,e){return ee.fromMiliseconds(Date.now()+ee.toMiliseconds(t))}function Bn(t){return Date.now()>=ee.toMiliseconds(t)}function _e(t,e){return`${t}${e?`:${e}`:""}`}function ai(t=[],e=[]){return[...new Set([...t,...e])]}async function U3({id:t,topic:e,wcDeepLink:n}){var i;try{if(!n)return;const r=typeof n=="string"?JSON.parse(n):n,s=r==null?void 0:r.href;if(typeof s!="string")return;const o=F3(s,t,e),a=xr();if(a===_t.browser){if(!((i=un.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}M3(o)}else a===_t.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(r){console.error(r)}}function F3(t,e,n){const i=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let r=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";r=`${r}${s}${H3(i,!0)}`}else r=`${r}/wc?${i}`;return r}function M3(t){let e="_self";q3()?e="_top":(j3()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function z3(t,e){let n="";try{if(Fi()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(i){console.error(i)}return n}function tf(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),i=n.indexOf(e);return n[i+2]}function nf(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function qa(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function j3(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function q3(){try{return window.self!==window.top}catch{return!1}}function H3(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function rf(t){return Buffer.from(t,"base64").toString("utf-8")}function V3(t){return new Promise(e=>setTimeout(e,t))}const Fs=BigInt(2**32-1),sf=BigInt(32);function of(t,e=!1){return e?{h:Number(t&Fs),l:Number(t>>sf&Fs)}:{h:Number(t>>sf&Fs)|0,l:Number(t&Fs)|0}}function af(t,e=!1){const n=t.length;let i=new Uint32Array(n),r=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=of(t[s],e);[i[s],r[s]]=[o,a]}return[i,r]}const cf=(t,e,n)=>t>>>n,lf=(t,e,n)=>t<<32-n|e>>>n,kn=(t,e,n)=>t>>>n|e<<32-n,Nn=(t,e,n)=>t<<32-n|e>>>n,_r=(t,e,n)=>t<<64-n|e>>>n-32,Sr=(t,e,n)=>t>>>n-32|e<<64-n,K3=(t,e)=>e,W3=(t,e)=>t,G3=(t,e,n)=>t<<n|e>>>32-n,Q3=(t,e,n)=>e<<n|t>>>32-n,Y3=(t,e,n)=>e<<n-32|t>>>64-n,Z3=(t,e,n)=>t<<n-32|e>>>64-n;function Ht(t,e,n,i){const r=(e>>>0)+(i>>>0);return{h:t+n+(r/2**32|0)|0,l:r|0}}const Ha=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),Va=(t,e,n,i)=>e+n+i+(t/2**32|0)|0,J3=(t,e,n,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0),X3=(t,e,n,i,r)=>e+n+i+r+(t/2**32|0)|0,e4=(t,e,n,i,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(i>>>0)+(r>>>0),t4=(t,e,n,i,r,s)=>e+n+i+r+s+(t/2**32|0)|0,Mi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ka(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function gn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Pt(t,...e){if(!Ka(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Wa(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");gn(t.outputLen),gn(t.blockLen)}function Rn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ga(t,e){Pt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Ar(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Tt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Qa(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Xt(t,e){return t<<32-e|t>>>e}const uf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function hf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const yn=uf?t=>t:t=>hf(t);function n4(t){for(let e=0;e<t.length;e++)t[e]=hf(t[e]);return t}const Ln=uf?t=>t:n4,df=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",i4=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ir(t){if(Pt(t),df)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=i4[t[n]];return e}const wn={_0:48,_9:57,A:65,F:70,a:97,f:102};function ff(t){if(t>=wn._0&&t<=wn._9)return t-wn._0;if(t>=wn.A&&t<=wn.F)return t-(wn.A-10);if(t>=wn.a&&t<=wn.f)return t-(wn.a-10)}function Ya(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(df)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(n);for(let r=0,s=0;r<n;r++,s+=2){const o=ff(t.charCodeAt(s)),a=ff(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[r]=o*16+a}return i}function r4(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Vt(t){return typeof t=="string"&&(t=r4(t)),Pt(t),t}function ci(...t){let e=0;for(let i=0;i<t.length;i++){const r=t[i];Pt(r),e+=r.length}const n=new Uint8Array(e);for(let i=0,r=0;i<t.length;i++){const s=t[i];n.set(s,r),r+=s.length}return n}let Ms=class{};function Dr(t){const e=i=>t().update(Vt(i)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function s4(t){const e=(i,r)=>t(r).update(Vt(i)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=i=>t(i),e}function zi(t=32){if(Mi&&typeof Mi.getRandomValues=="function")return Mi.getRandomValues(new Uint8Array(t));if(Mi&&typeof Mi.randomBytes=="function")return Uint8Array.from(Mi.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const o4=BigInt(0),Cr=BigInt(1),a4=BigInt(2),c4=BigInt(7),l4=BigInt(256),u4=BigInt(113),pf=[],gf=[],yf=[];for(let t=0,e=Cr,n=1,i=0;t<24;t++){[n,i]=[i,(2*n+3*i)%5],pf.push(2*(5*i+n)),gf.push((t+1)*(t+2)/2%64);let r=o4;for(let s=0;s<7;s++)e=(e<<Cr^(e>>c4)*u4)%l4,e&a4&&(r^=Cr<<(Cr<<BigInt(s))-Cr);yf.push(r)}const wf=af(yf,!0),h4=wf[0],d4=wf[1],mf=(t,e,n)=>n>32?Y3(t,e,n):G3(t,e,n),bf=(t,e,n)=>n>32?Z3(t,e,n):Q3(t,e,n);function f4(t,e=24){const n=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],h=mf(l,u,1)^n[a],d=bf(l,u,1)^n[a+1];for(let y=0;y<50;y+=10)t[o+y]^=h,t[o+y+1]^=d}let r=t[2],s=t[3];for(let o=0;o<24;o++){const a=gf[o],c=mf(r,s,a),l=bf(r,s,a),u=pf[o];r=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=h4[i],t[1]^=d4[i]}Tt(n)}let p4=class m0 extends Ms{constructor(e,n,i,r=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=i,this.enableXOF=r,this.rounds=s,gn(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Ar(this.state)}clone(){return this._cloneInto()}keccak(){Ln(this.state32),f4(this.state32,this.rounds),Ln(this.state32),this.posOut=0,this.pos=0}update(e){Rn(this),e=Vt(e),Pt(e);const{blockLen:n,state:i}=this,r=e.length;for(let s=0;s<r;){const o=Math.min(n-this.pos,r-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:i,blockLen:r}=this;e[i]^=n,(n&128)!==0&&i===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Rn(this,!1),Pt(e),this.finish();const n=this.state,{blockLen:i}=this;for(let r=0,s=e.length;r<s;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,s-r);e.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return gn(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ga(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Tt(this.state)}_cloneInto(e){const{blockLen:n,suffix:i,outputLen:r,rounds:s,enableXOF:o}=this;return e||(e=new m0(n,i,r,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}};const g4=(t,e,n)=>Dr(()=>new p4(e,t,n)),y4=g4(1,136,256/8);function w4(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(n>>r&s),a=Number(n&s),c=i?4:0,l=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+l,a,i)}function m4(t,e,n){return t&e^~t&n}function b4(t,e,n){return t&e^t&n^e&n}let vf=class extends Ms{constructor(e,n,i,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=i,this.isLE=r,this.buffer=new Uint8Array(e),this.view=Qa(this.buffer)}update(e){Rn(this),e=Vt(e),Pt(e);const{view:n,buffer:i,blockLen:r}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a===r){const c=Qa(e);for(;r<=s-o;o+=r)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rn(this),Ga(e,this),this.finished=!0;const{buffer:n,view:i,blockLen:r,isLE:s}=this;let{pos:o}=this;n[o++]=128,Tt(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(i,0),o=0);for(let h=o;h<r;h++)n[h]=0;w4(i,r-8,BigInt(this.length*8),s),this.process(i,0);const a=Qa(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:i,length:r,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=r,e.pos=a,r%n&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const Un=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),tt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),nt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),v4=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Fn=new Uint32Array(64);let E4=class extends vf{constructor(e=32){super(64,e,8,!1),this.A=Un[0]|0,this.B=Un[1]|0,this.C=Un[2]|0,this.D=Un[3]|0,this.E=Un[4]|0,this.F=Un[5]|0,this.G=Un[6]|0,this.H=Un[7]|0}get(){const{A:e,B:n,C:i,D:r,E:s,F:o,G:a,H:c}=this;return[e,n,i,r,s,o,a,c]}set(e,n,i,r,s,o,a,c){this.A=e|0,this.B=n|0,this.C=i|0,this.D=r|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)Fn[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const d=Fn[h-15],y=Fn[h-2],f=Xt(d,7)^Xt(d,18)^d>>>3,g=Xt(y,17)^Xt(y,19)^y>>>10;Fn[h]=g+Fn[h-7]+f+Fn[h-16]|0}let{A:i,B:r,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=Xt(a,6)^Xt(a,11)^Xt(a,25),y=u+d+m4(a,c,l)+v4[h]+Fn[h]|0,f=(Xt(i,2)^Xt(i,13)^Xt(i,22))+b4(i,r,s)|0;u=l,l=c,c=a,a=o+y|0,o=s,s=r,r=i,i=y+f|0}i=i+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(i,r,s,o,a,c,l,u)}roundClean(){Tt(Fn)}destroy(){this.set(0,0,0,0,0,0,0,0),Tt(this.buffer)}};const Ef=af(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),x4=Ef[0],_4=Ef[1],Mn=new Uint32Array(80),zn=new Uint32Array(80);let Za=class extends vf{constructor(e=64){super(128,e,16,!1),this.Ah=nt[0]|0,this.Al=nt[1]|0,this.Bh=nt[2]|0,this.Bl=nt[3]|0,this.Ch=nt[4]|0,this.Cl=nt[5]|0,this.Dh=nt[6]|0,this.Dl=nt[7]|0,this.Eh=nt[8]|0,this.El=nt[9]|0,this.Fh=nt[10]|0,this.Fl=nt[11]|0,this.Gh=nt[12]|0,this.Gl=nt[13]|0,this.Hh=nt[14]|0,this.Hl=nt[15]|0}get(){const{Ah:e,Al:n,Bh:i,Bl:r,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:y,Gl:f,Hh:g,Hl:I}=this;return[e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I]}set(e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I){this.Ah=e|0,this.Al=n|0,this.Bh=i|0,this.Bl=r|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=y|0,this.Gl=f|0,this.Hh=g|0,this.Hl=I|0}process(e,n){for(let D=0;D<16;D++,n+=4)Mn[D]=e.getUint32(n),zn[D]=e.getUint32(n+=4);for(let D=16;D<80;D++){const x=Mn[D-15]|0,v=zn[D-15]|0,A=kn(x,v,1)^kn(x,v,8)^cf(x,v,7),L=Nn(x,v,1)^Nn(x,v,8)^lf(x,v,7),M=Mn[D-2]|0,C=zn[D-2]|0,z=kn(M,C,19)^_r(M,C,61)^cf(M,C,6),j=Nn(M,C,19)^Sr(M,C,61)^lf(M,C,6),q=J3(L,j,zn[D-7],zn[D-16]),P=X3(q,A,z,Mn[D-7],Mn[D-16]);Mn[D]=P|0,zn[D]=q|0}let{Ah:i,Al:r,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:y,Fl:f,Gh:g,Gl:I,Hh:O,Hl:B}=this;for(let D=0;D<80;D++){const x=kn(h,d,14)^kn(h,d,18)^_r(h,d,41),v=Nn(h,d,14)^Nn(h,d,18)^Sr(h,d,41),A=h&y^~h&g,L=d&f^~d&I,M=e4(B,v,L,_4[D],zn[D]),C=t4(M,O,x,A,x4[D],Mn[D]),z=M|0,j=kn(i,r,28)^_r(i,r,34)^_r(i,r,39),q=Nn(i,r,28)^Sr(i,r,34)^Sr(i,r,39),P=i&s^i&a^s&a,T=r&o^r&c^o&c;O=g|0,B=I|0,g=y|0,I=f|0,y=h|0,f=d|0,{h,l:d}=Ht(l|0,u|0,C|0,z|0),l=a|0,u=c|0,a=s|0,c=o|0,s=i|0,o=r|0;const S=Ha(z,q,T);i=Va(S,C,j,P),r=S|0}({h:i,l:r}=Ht(this.Ah|0,this.Al|0,i|0,r|0)),{h:s,l:o}=Ht(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ht(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ht(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=Ht(this.Eh|0,this.El|0,h|0,d|0),{h:y,l:f}=Ht(this.Fh|0,this.Fl|0,y|0,f|0),{h:g,l:I}=Ht(this.Gh|0,this.Gl|0,g|0,I|0),{h:O,l:B}=Ht(this.Hh|0,this.Hl|0,O|0,B|0),this.set(i,r,s,o,a,c,l,u,h,d,y,f,g,I,O,B)}roundClean(){Tt(Mn,zn)}destroy(){Tt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},S4=class extends Za{constructor(){super(48),this.Ah=tt[0]|0,this.Al=tt[1]|0,this.Bh=tt[2]|0,this.Bl=tt[3]|0,this.Ch=tt[4]|0,this.Cl=tt[5]|0,this.Dh=tt[6]|0,this.Dl=tt[7]|0,this.Eh=tt[8]|0,this.El=tt[9]|0,this.Fh=tt[10]|0,this.Fl=tt[11]|0,this.Gh=tt[12]|0,this.Gl=tt[13]|0,this.Hh=tt[14]|0,this.Hl=tt[15]|0}};const it=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);let A4=class extends Za{constructor(){super(32),this.Ah=it[0]|0,this.Al=it[1]|0,this.Bh=it[2]|0,this.Bl=it[3]|0,this.Ch=it[4]|0,this.Cl=it[5]|0,this.Dh=it[6]|0,this.Dl=it[7]|0,this.Eh=it[8]|0,this.El=it[9]|0,this.Fh=it[10]|0,this.Fl=it[11]|0,this.Gh=it[12]|0,this.Gl=it[13]|0,this.Hh=it[14]|0,this.Hl=it[15]|0}};const zs=Dr(()=>new E4),I4=Dr(()=>new Za),D4=Dr(()=>new S4),C4=Dr(()=>new A4),O4=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Fe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),oe=new Uint32Array(32);function jn(t,e,n,i,r,s){const o=r[s],a=r[s+1];let c=oe[2*t],l=oe[2*t+1],u=oe[2*e],h=oe[2*e+1],d=oe[2*n],y=oe[2*n+1],f=oe[2*i],g=oe[2*i+1],I=Ha(c,u,o);l=Va(I,l,h,a),c=I|0,{Dh:g,Dl:f}={Dh:g^l,Dl:f^c},{Dh:g,Dl:f}={Dh:K3(g,f),Dl:W3(g)},{h:y,l:d}=Ht(y,d,g,f),{Bh:h,Bl:u}={Bh:h^y,Bl:u^d},{Bh:h,Bl:u}={Bh:kn(h,u,24),Bl:Nn(h,u,24)},oe[2*t]=c,oe[2*t+1]=l,oe[2*e]=u,oe[2*e+1]=h,oe[2*n]=d,oe[2*n+1]=y,oe[2*i]=f,oe[2*i+1]=g}function qn(t,e,n,i,r,s){const o=r[s],a=r[s+1];let c=oe[2*t],l=oe[2*t+1],u=oe[2*e],h=oe[2*e+1],d=oe[2*n],y=oe[2*n+1],f=oe[2*i],g=oe[2*i+1],I=Ha(c,u,o);l=Va(I,l,h,a),c=I|0,{Dh:g,Dl:f}={Dh:g^l,Dl:f^c},{Dh:g,Dl:f}={Dh:kn(g,f,16),Dl:Nn(g,f,16)},{h:y,l:d}=Ht(y,d,g,f),{Bh:h,Bl:u}={Bh:h^y,Bl:u^d},{Bh:h,Bl:u}={Bh:_r(h,u,63),Bl:Sr(h,u,63)},oe[2*t]=c,oe[2*t+1]=l,oe[2*e]=u,oe[2*e+1]=h,oe[2*n]=d,oe[2*n+1]=y,oe[2*i]=f,oe[2*i+1]=g}function $4(t,e={},n,i,r){if(gn(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==r)throw new Error("personalization must be undefined or "+r)}class P4 extends Ms{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,gn(e),gn(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=Ar(this.buffer)}update(e){Rn(this),e=Vt(e),Pt(e);const{blockLen:n,buffer:i,buffer32:r}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(Ln(r),this.compress(r,0,!1),Ln(r),this.pos=0);const l=Math.min(n-this.pos,s-c),u=o+c;if(l===n&&!(u%4)&&c+l<s){const h=new Uint32Array(a,u,Math.floor((s-c)/4));Ln(h);for(let d=0;c+n<s;d+=r.length,c+=n)this.length+=n,this.compress(h,d,!1);Ln(h);continue}i.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Rn(this),Ga(e,this);const{pos:n,buffer32:i}=this;this.finished=!0,Tt(this.buffer.subarray(n)),Ln(i),this.compress(i,0,!0),Ln(i);const r=Ar(e);this.get().forEach((s,o)=>r[o]=yn(s))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}_cloneInto(e){const{buffer:n,length:i,finished:r,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=r,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class T4 extends P4{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=Fe[0]|0,this.v0h=Fe[1]|0,this.v1l=Fe[2]|0,this.v1h=Fe[3]|0,this.v2l=Fe[4]|0,this.v2h=Fe[5]|0,this.v3l=Fe[6]|0,this.v3h=Fe[7]|0,this.v4l=Fe[8]|0,this.v4h=Fe[9]|0,this.v5l=Fe[10]|0,this.v5h=Fe[11]|0,this.v6l=Fe[12]|0,this.v6h=Fe[13]|0,this.v7l=Fe[14]|0,this.v7h=Fe[15]|0,$4(n,e,64,16,16);let{key:i,personalization:r,salt:s}=e,o=0;if(i!==void 0&&(i=Vt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Vt(s);const a=Ar(s);this.v4l^=yn(a[0]),this.v4h^=yn(a[1]),this.v5l^=yn(a[2]),this.v5h^=yn(a[3])}if(r!==void 0){r=Vt(r);const a=Ar(r);this.v6l^=yn(a[0]),this.v6h^=yn(a[1]),this.v7l^=yn(a[2]),this.v7h^=yn(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:i,v1h:r,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:d,v6l:y,v6h:f,v7l:g,v7h:I}=this;return[e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I]}set(e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I){this.v0l=e|0,this.v0h=n|0,this.v1l=i|0,this.v1h=r|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=d|0,this.v6l=y|0,this.v6h=f|0,this.v7l=g|0,this.v7h=I|0}compress(e,n,i){this.get().forEach((c,l)=>oe[l]=c),oe.set(Fe,16);let{h:r,l:s}=of(BigInt(this.length));oe[24]=Fe[8]^s,oe[25]=Fe[9]^r,i&&(oe[28]=~oe[28],oe[29]=~oe[29]);let o=0;const a=O4;for(let c=0;c<12;c++)jn(0,4,8,12,e,n+2*a[o++]),qn(0,4,8,12,e,n+2*a[o++]),jn(1,5,9,13,e,n+2*a[o++]),qn(1,5,9,13,e,n+2*a[o++]),jn(2,6,10,14,e,n+2*a[o++]),qn(2,6,10,14,e,n+2*a[o++]),jn(3,7,11,15,e,n+2*a[o++]),qn(3,7,11,15,e,n+2*a[o++]),jn(0,5,10,15,e,n+2*a[o++]),qn(0,5,10,15,e,n+2*a[o++]),jn(1,6,11,12,e,n+2*a[o++]),qn(1,6,11,12,e,n+2*a[o++]),jn(2,7,8,13,e,n+2*a[o++]),qn(2,7,8,13,e,n+2*a[o++]),jn(3,4,9,14,e,n+2*a[o++]),qn(3,4,9,14,e,n+2*a[o++]);this.v0l^=oe[0]^oe[16],this.v0h^=oe[1]^oe[17],this.v1l^=oe[2]^oe[18],this.v1h^=oe[3]^oe[19],this.v2l^=oe[4]^oe[20],this.v2h^=oe[5]^oe[21],this.v3l^=oe[6]^oe[22],this.v3h^=oe[7]^oe[23],this.v4l^=oe[8]^oe[24],this.v4h^=oe[9]^oe[25],this.v5l^=oe[10]^oe[26],this.v5h^=oe[11]^oe[27],this.v6l^=oe[12]^oe[28],this.v6h^=oe[13]^oe[29],this.v7l^=oe[14]^oe[30],this.v7h^=oe[15]^oe[31],Tt(oe)}destroy(){this.destroyed=!0,Tt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const B4=s4(t=>new T4(t)),k4="https://rpc.walletconnect.org/v1";function xf(t){const e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(y4(n)).toString("hex")}async function N4(t,e,n,i,r,s){switch(n.t){case"eip191":return await R4(t,e,n.s);case"eip1271":return await L4(t,e,n.s,i,r,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}async function R4(t,e,n){return(await Hv({hash:xf(e),signature:n})).toLowerCase()===t.toLowerCase()}async function L4(t,e,n,i,r,s){const o=Ls(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=n.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:xf(e)).substring(2),d=a+h+c+u+l,y=await fetch(`${s||k4}/?chainId=${i}&projectId=${r}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:U4(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:f}=await y.json();return f?f.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function U4(){return Date.now()+Math.floor(Math.random()*1e3)}function F4(t){const e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);const i=n[0];if(i===0)throw new Error("No signatures found");const r=1+i*64;if(n.length<r)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return yr.encode(s)}function M4(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),i=new Uint8Array(n.length+e.length);i.set(n),i.set(e,n.length);const r=B4(i,{dkLen:32});return yr.encode(r)}function _f(t){const e=new Uint8Array(zs(z4(t)));return yr.encode(e)}function z4(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Sf(t){const e=Buffer.from(t,"base64"),n=ux(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const i=tx(n),r=Buffer.from("TX"),s=Buffer.concat([r,Buffer.from(i)]),o=C4(s);return mx.encode(o).replace(/=+$/,"")}function Ja(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function j4(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),i=Buffer.from(t.signature.signature,"base64"),r=[];r.push(Buffer.from([10])),r.push(Ja(e.length)),r.push(e),r.push(Buffer.from([18])),r.push(Ja(n.length)),r.push(n),r.push(Buffer.from([26])),r.push(Ja(i.length)),r.push(i);const s=Buffer.concat(r),o=zs(s);return Buffer.from(o).toString("hex").toUpperCase()}var q4=Object.defineProperty,H4=Object.defineProperties,V4=Object.getOwnPropertyDescriptors,Af=Object.getOwnPropertySymbols,K4=Object.prototype.hasOwnProperty,W4=Object.prototype.propertyIsEnumerable,If=(t,e,n)=>e in t?q4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,G4=(t,e)=>{for(var n in e||(e={}))K4.call(e,n)&&If(t,n,e[n]);if(Af)for(var n of Af(e))W4.call(e,n)&&If(t,n,e[n]);return t},Q4=(t,e)=>H4(t,V4(e));const Y4="did:pkh:",Xa=t=>t==null?void 0:t.split(":"),Z4=t=>{const e=t&&Xa(t);if(e)return t.includes(Y4)?e[3]:e[1]},ec=t=>{const e=t&&Xa(t);if(e)return e[2]+":"+e[3]},js=t=>{const e=t&&Xa(t);if(e)return e.pop()};async function Df(t){const{cacao:e,projectId:n}=t,{s:i,p:r}=e,s=Cf(r,r.iss),o=js(r.iss);return await N4(o,s,i,ec(r.iss),n)}const Cf=(t,e)=>{const n=`${t.domain} wants you to sign in with your Ethereum account:`,i=js(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=t.statement||void 0;const s=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${Z4(e)}`,c=`Nonce: ${t.nonce}`,l=`Issued At: ${t.iat}`,u=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,d=t.requestId?`Request ID: ${t.requestId}`:void 0,y=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,f=qs(t.resources);if(f){const g=Or(f);r=o8(r,g)}return[n,i,"",r,"",s,o,a,c,l,u,h,d,y].filter(g=>g!=null).join(`
`)};function J4(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function X4(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function li(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{const i=t.att[n];if(Array.isArray(i))throw new Error(`Resource must be an object: ${n}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(i).forEach(r=>{const s=i[r];if(!Array.isArray(s))throw new Error(`Ability limits ${r} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${r} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${r}) must be an array of objects, found: ${o}`)})})})}function e8(t,e,n,i={}){return n==null||n.sort((r,s)=>r.localeCompare(s)),{att:{[t]:t8(e,n,i)}}}function t8(t,e,n={}){e=e==null?void 0:e.sort((r,s)=>r.localeCompare(s));const i=e.map(r=>({[`${t}/${r}`]:[n]}));return Object.assign({},...i)}function Of(t){return li(t),`urn:recap:${J4(t).replace(/=/g,"")}`}function Or(t){const e=X4(t.replace("urn:recap:",""));return li(e),e}function n8(t,e,n){const i=e8(t,e,n);return Of(i)}function i8(t){return t&&t.includes("urn:recap:")}function r8(t,e){const n=Or(t),i=Or(e),r=s8(n,i);return Of(r)}function s8(t,e){li(t),li(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((r,s)=>r.localeCompare(s)),i={att:{}};return n.forEach(r=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[r])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[r])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;i.att[r]=Q4(G4({},i.att[r]),{[a]:((c=t.att[r])==null?void 0:c[a])||((l=e.att[r])==null?void 0:l[a])})})}),i}function o8(t="",e){li(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const i=[];let r=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(r++,`(${r}) '${h}': '${l[h].join("', '")}' for '${a}'.`));i.push(u.join(", ").replace(".,","."))});const s=i.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function $f(t){var e;const n=Or(t);li(n);const i=(e=n.att)==null?void 0:e.eip155;return i?Object.keys(i).map(r=>r.split("/")[1]):[]}function Pf(t){const e=Or(t);li(e);const n=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(r=>{var s;(s=r==null?void 0:r[0])!=null&&s.chains&&n.push(r[0].chains)})}),[...new Set(n.flat())]}function qs(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return i8(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Tf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function tc(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function nc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function gt(t,...e){if(!Tf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Bf(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function a8(t,e){gt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Hn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ji(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function c8(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const l8=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function u8(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ic(t){if(typeof t=="string")t=u8(t);else if(Tf(t))t=rc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function h8(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function d8(t,e){if(t.length!==e.length)return!1;let n=0;for(let i=0;i<t.length;i++)n|=t[i]^e[i];return n===0}const f8=(t,e)=>{function n(i,...r){if(gt(i),!l8)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=r[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?gt(l):gt(l,t.nonceLength)}const s=t.tagLength;s&&r[1]!==void 0&&gt(r[1]);const o=e(i,...r),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");gt(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,gt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(gt(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(n,t),n};function kf(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!g8(e))throw new Error("invalid output, must be aligned");return e}function Nf(t,e,n,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(n>>r&s),a=Number(n&s);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function p8(t,e,n){tc(n);const i=new Uint8Array(16),r=c8(i);return Nf(r,0,BigInt(e),n),Nf(r,8,BigInt(t),n),i}function g8(t){return t.byteOffset%4===0}function rc(t){return Uint8Array.from(t)}const Rf=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),y8=Rf("expand 16-byte k"),w8=Rf("expand 32-byte k"),m8=Hn(y8),b8=Hn(w8);function Ee(t,e){return t<<e|t>>>32-e}function sc(t){return t.byteOffset%4===0}const Hs=64,v8=16,Lf=2**32-1,Uf=new Uint32Array;function E8(t,e,n,i,r,s,o,a){const c=r.length,l=new Uint8Array(Hs),u=Hn(l),h=sc(r)&&sc(s),d=h?Hn(r):Uf,y=h?Hn(s):Uf;for(let f=0;f<c;o++){if(t(e,n,i,u,o,a),o>=Lf)throw new Error("arx: counter overflow");const g=Math.min(Hs,c-f);if(h&&g===Hs){const I=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let O=0,B;O<v8;O++)B=I+O,y[B]=d[B]^u[O];f+=Hs;continue}for(let I=0,O;I<g;I++)O=f+I,s[O]=r[O]^l[I];f+=g}}function x8(t,e){const{allowShortKeys:n,extendNonceFn:i,counterLength:r,counterRight:s,rounds:o}=h8({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return nc(r),nc(o),tc(s),tc(n),(a,c,l,u,h=0)=>{gt(a),gt(c),gt(l);const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),gt(u),nc(h),h<0||h>=Lf)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const y=[];let f=a.length,g,I;if(f===32)y.push(g=rc(a)),I=b8;else if(f===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),I=m8,y.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);sc(c)||y.push(c=rc(c));const O=Hn(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(I,O,Hn(c.subarray(0,16)),O),c=c.subarray(16)}const B=16-r;if(B!==c.length)throw new Error(`arx: nonce must be ${B} or 16 bytes`);if(B!==12){const x=new Uint8Array(12);x.set(c,s?0:12-c.length),c=x,y.push(c)}const D=Hn(c);return E8(t,I,O,D,l,u,h,o),ji(...y),u}}const Ye=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class _8{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ic(e),gt(e,32);const n=Ye(e,0),i=Ye(e,2),r=Ye(e,4),s=Ye(e,6),o=Ye(e,8),a=Ye(e,10),c=Ye(e,12),l=Ye(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|i<<3)&8191,this.r[2]=(i>>>10|r<<6)&7939,this.r[3]=(r>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Ye(e,16+2*u)}process(e,n,i=!1){const r=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],y=o[6],f=o[7],g=o[8],I=o[9],O=Ye(e,n+0),B=Ye(e,n+2),D=Ye(e,n+4),x=Ye(e,n+6),v=Ye(e,n+8),A=Ye(e,n+10),L=Ye(e,n+12),M=Ye(e,n+14);let C=s[0]+(O&8191),z=s[1]+((O>>>13|B<<3)&8191),j=s[2]+((B>>>10|D<<6)&8191),q=s[3]+((D>>>7|x<<9)&8191),P=s[4]+((x>>>4|v<<12)&8191),T=s[5]+(v>>>1&8191),S=s[6]+((v>>>14|A<<2)&8191),m=s[7]+((A>>>11|L<<5)&8191),_=s[8]+((L>>>8|M<<8)&8191),k=s[9]+(M>>>5|r),R=0,U=R+C*a+z*(5*I)+j*(5*g)+q*(5*f)+P*(5*y);R=U>>>13,U&=8191,U+=T*(5*d)+S*(5*h)+m*(5*u)+_*(5*l)+k*(5*c),R+=U>>>13,U&=8191;let H=R+C*c+z*a+j*(5*I)+q*(5*g)+P*(5*f);R=H>>>13,H&=8191,H+=T*(5*y)+S*(5*d)+m*(5*h)+_*(5*u)+k*(5*l),R+=H>>>13,H&=8191;let G=R+C*l+z*c+j*a+q*(5*I)+P*(5*g);R=G>>>13,G&=8191,G+=T*(5*f)+S*(5*y)+m*(5*d)+_*(5*h)+k*(5*u),R+=G>>>13,G&=8191;let Q=R+C*u+z*l+j*c+q*a+P*(5*I);R=Q>>>13,Q&=8191,Q+=T*(5*g)+S*(5*f)+m*(5*y)+_*(5*d)+k*(5*h),R+=Q>>>13,Q&=8191;let Z=R+C*h+z*u+j*l+q*c+P*a;R=Z>>>13,Z&=8191,Z+=T*(5*I)+S*(5*g)+m*(5*f)+_*(5*y)+k*(5*d),R+=Z>>>13,Z&=8191;let X=R+C*d+z*h+j*u+q*l+P*c;R=X>>>13,X&=8191,X+=T*a+S*(5*I)+m*(5*g)+_*(5*f)+k*(5*y),R+=X>>>13,X&=8191;let re=R+C*y+z*d+j*h+q*u+P*l;R=re>>>13,re&=8191,re+=T*c+S*a+m*(5*I)+_*(5*g)+k*(5*f),R+=re>>>13,re&=8191;let ce=R+C*f+z*y+j*d+q*h+P*u;R=ce>>>13,ce&=8191,ce+=T*l+S*c+m*a+_*(5*I)+k*(5*g),R+=ce>>>13,ce&=8191;let fe=R+C*g+z*f+j*y+q*d+P*h;R=fe>>>13,fe&=8191,fe+=T*u+S*l+m*c+_*a+k*(5*I),R+=fe>>>13,fe&=8191;let le=R+C*I+z*g+j*f+q*y+P*d;R=le>>>13,le&=8191,le+=T*h+S*u+m*l+_*c+k*a,R+=le>>>13,le&=8191,R=(R<<2)+R|0,R=R+U|0,U=R&8191,R=R>>>13,H+=R,s[0]=U,s[1]=H,s[2]=G,s[3]=Q,s[4]=Z,s[5]=X,s[6]=re,s[7]=ce,s[8]=fe,s[9]=le}finalize(){const{h:e,pad:n}=this,i=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=r,r=e[a]>>>13,e[a]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,i[0]=e[0]+5,r=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+r,r=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(r^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;ji(i)}update(e){Bf(this),e=ic(e),gt(e);const{buffer:n,blockLen:i}=this,r=e.length;for(let s=0;s<r;){const o=Math.min(i-this.pos,r-s);if(o===i){for(;i<=r-s;s+=i)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){ji(this.h,this.r,this.buffer,this.pad)}digestInto(e){Bf(this),a8(e,this),this.finished=!0;const{buffer:n,h:i}=this;let{pos:r}=this;if(r){for(n[r++]=1;r<16;r++)n[r]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const i=e.slice(0,n);return this.destroy(),i}}function S8(t){const e=(i,r)=>t(r).update(ic(i)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=i=>t(i),e}const A8=S8(t=>new _8(t));function I8(t,e,n,i,r,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],y=e[3],f=e[4],g=e[5],I=e[6],O=e[7],B=r,D=n[0],x=n[1],v=n[2],A=o,L=a,M=c,C=l,z=u,j=h,q=d,P=y,T=f,S=g,m=I,_=O,k=B,R=D,U=x,H=v;for(let Q=0;Q<s;Q+=2)A=A+z|0,k=Ee(k^A,16),T=T+k|0,z=Ee(z^T,12),A=A+z|0,k=Ee(k^A,8),T=T+k|0,z=Ee(z^T,7),L=L+j|0,R=Ee(R^L,16),S=S+R|0,j=Ee(j^S,12),L=L+j|0,R=Ee(R^L,8),S=S+R|0,j=Ee(j^S,7),M=M+q|0,U=Ee(U^M,16),m=m+U|0,q=Ee(q^m,12),M=M+q|0,U=Ee(U^M,8),m=m+U|0,q=Ee(q^m,7),C=C+P|0,H=Ee(H^C,16),_=_+H|0,P=Ee(P^_,12),C=C+P|0,H=Ee(H^C,8),_=_+H|0,P=Ee(P^_,7),A=A+j|0,H=Ee(H^A,16),m=m+H|0,j=Ee(j^m,12),A=A+j|0,H=Ee(H^A,8),m=m+H|0,j=Ee(j^m,7),L=L+q|0,k=Ee(k^L,16),_=_+k|0,q=Ee(q^_,12),L=L+q|0,k=Ee(k^L,8),_=_+k|0,q=Ee(q^_,7),M=M+P|0,R=Ee(R^M,16),T=T+R|0,P=Ee(P^T,12),M=M+P|0,R=Ee(R^M,8),T=T+R|0,P=Ee(P^T,7),C=C+z|0,U=Ee(U^C,16),S=S+U|0,z=Ee(z^S,12),C=C+z|0,U=Ee(U^C,8),S=S+U|0,z=Ee(z^S,7);let G=0;i[G++]=o+A|0,i[G++]=a+L|0,i[G++]=c+M|0,i[G++]=l+C|0,i[G++]=u+z|0,i[G++]=h+j|0,i[G++]=d+q|0,i[G++]=y+P|0,i[G++]=f+T|0,i[G++]=g+S|0,i[G++]=I+m|0,i[G++]=O+_|0,i[G++]=B+k|0,i[G++]=D+R|0,i[G++]=x+U|0,i[G++]=v+H|0}const D8=x8(I8,{counterRight:!1,counterLength:4,allowShortKeys:!1}),C8=new Uint8Array(16),Ff=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(C8.subarray(n))},O8=new Uint8Array(32);function Mf(t,e,n,i,r){const s=t(e,n,O8),o=A8.create(s);r&&Ff(o,r),Ff(o,i);const a=p8(i.length,r?r.length:0,!0);o.update(a);const c=o.digest();return ji(s,a),c}const $8=t=>(e,n,i)=>({encrypt(r,s){const o=r.length;s=kf(o+16,s,!1),s.set(r);const a=s.subarray(0,-16);t(e,n,a,a,1);const c=Mf(t,e,n,a,i);return s.set(c,o),ji(c),s},decrypt(r,s){s=kf(r.length-16,s,!1);const o=r.subarray(0,-16),a=r.subarray(-16),c=Mf(t,e,n,o,i);if(!d8(a,c))throw new Error("invalid tag");return s.set(r.subarray(0,-16)),t(e,n,s,s,1),ji(c),s}}),zf=f8({blockSize:64,nonceLength:12,tagLength:16},$8(D8));let jf=class extends Ms{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Wa(e);const i=Vt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(i.length>r?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Tt(s)}update(e){return Rn(this),this.iHash.update(e),this}digestInto(e){Rn(this),Pt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:i,finished:r,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Vs=(t,e,n)=>new jf(t,e).update(n).digest();Vs.create=(t,e)=>new jf(t,e);function P8(t,e,n){return Wa(t),n===void 0&&(n=new Uint8Array(t.outputLen)),Vs(t,Vt(n),Vt(e))}const oc=Uint8Array.from([0]),qf=Uint8Array.of();function T8(t,e,n,i=32){Wa(t),gn(i);const r=t.outputLen;if(i>255*r)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r);n===void 0&&(n=qf);const o=new Uint8Array(s*r),a=Vs.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)oc[0]=u+1,c.update(u===0?qf:l).update(n).update(oc).digestInto(l),o.set(l,r*u),a._cloneInto(c);return a.destroy(),c.destroy(),Tt(l,oc),o.slice(0,i)}const B8=(t,e,n,i,r)=>T8(t,P8(t,e,n),i,r),Ks=zs,ac=BigInt(0),cc=BigInt(1);function Ws(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Gs(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Hf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ac:BigInt("0x"+t)}function Qs(t){return Hf(Ir(t))}function Ys(t){return Pt(t),Hf(Ir(Uint8Array.from(t).reverse()))}function lc(t,e){return Ya(t.toString(16).padStart(e*2,"0"))}function uc(t,e){return lc(t,e).reverse()}function yt(t,e,n){let i;if(typeof e=="string")try{i=Ya(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ka(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const r=i.length;if(typeof n=="number"&&r!==n)throw new Error(t+" of length "+n+" expected, got "+r);return i}const hc=t=>typeof t=="bigint"&&ac<=t;function k8(t,e,n){return hc(t)&&hc(e)&&hc(n)&&e<=t&&t<n}function dc(t,e,n,i){if(!k8(e,n,i))throw new Error("expected valid "+t+": "+n+" <= n < "+i+", got "+e)}function N8(t){let e;for(e=0;t>ac;t>>=cc,e+=1);return e}const Zs=t=>(cc<<BigInt(t))-cc;function R8(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const i=d=>new Uint8Array(d),r=d=>Uint8Array.of(d);let s=i(t),o=i(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},l=(...d)=>n(o,s,...d),u=(d=i(0))=>{o=l(r(0),d),s=l(),d.length!==0&&(o=l(r(1),d),s=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const y=[];for(;d<e;){s=l();const f=s.slice();y.push(f),d+=s.length}return ci(...y)};return(d,y)=>{c(),u(d);let f;for(;!(f=y(h()));)u();return c(),f}}function Js(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(r,s,o){const a=t[r];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${r}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([r,s])=>i(r,s,!1)),Object.entries(n).forEach(([r,s])=>i(r,s,!0))}function Vf(t){const e=new WeakMap;return(n,...i)=>{const r=e.get(n);if(r!==void 0)return r;const s=t(n,...i);return e.set(n,s),s}}const wt=BigInt(0),at=BigInt(1),ui=BigInt(2),L8=BigInt(3),Kf=BigInt(4),Wf=BigInt(5),Gf=BigInt(8);function Bt(t,e){const n=t%e;return n>=wt?n:e+n}function Kt(t,e,n){let i=t;for(;e-- >wt;)i*=i,i%=n;return i}function Qf(t,e){if(t===wt)throw new Error("invert: expected non-zero number");if(e<=wt)throw new Error("invert: expected positive modulus, got "+e);let n=Bt(t,e),i=e,r=wt,s=at;for(;n!==wt;){const o=i/n,a=i%n,c=r-s*o;i=n,n=a,r=s,s=c}if(i!==at)throw new Error("invert: does not exist");return Bt(r,e)}function Yf(t,e){const n=(t.ORDER+at)/Kf,i=t.pow(e,n);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function U8(t,e){const n=(t.ORDER-Wf)/Gf,i=t.mul(e,ui),r=t.pow(i,n),s=t.mul(e,r),o=t.mul(t.mul(s,ui),r),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function F8(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-at,n=0;for(;e%ui===wt;)e/=ui,n++;let i=ui;const r=qi(t);for(;Jf(r,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Yf;let s=r.pow(i,e);const o=(e+at)/ui;return function(a,c){if(a.is0(c))return c;if(Jf(a,c)!==1)throw new Error("Cannot find square root");let l=n,u=a.mul(a.ONE,s),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let y=1,f=a.sqr(h);for(;!a.eql(f,a.ONE);)if(y++,f=a.sqr(f),y===l)throw new Error("Cannot find square root");const g=at<<BigInt(l-y-1),I=a.pow(u,g);l=y,u=a.sqr(I),h=a.mul(h,u),d=a.mul(d,I)}return d}}function M8(t){return t%Kf===L8?Yf:t%Gf===Wf?U8:F8(t)}const z8=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function j8(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=z8.reduce((i,r)=>(i[r]="function",i),e);return Js(t,n),t}function q8(t,e,n){if(n<wt)throw new Error("invalid exponent, negatives unsupported");if(n===wt)return t.ONE;if(n===at)return e;let i=t.ONE,r=e;for(;n>wt;)n&at&&(i=t.mul(i,r)),r=t.sqr(r),n>>=at;return i}function Zf(t,e,n=!1){const i=new Array(e.length).fill(n?t.ZERO:void 0),r=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),s=t.inv(r);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),s),i}function Jf(t,e){const n=(t.ORDER-at)/ui,i=t.pow(e,n),r=t.eql(i,t.ONE),s=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!r&&!s&&!o)throw new Error("invalid Legendre symbol result");return r?1:s?0:-1}function H8(t,e){e!==void 0&&gn(e);const n=e!==void 0?e:t.toString(2).length,i=Math.ceil(n/8);return{nBitLength:n,nByteLength:i}}function qi(t,e,n=!1,i={}){if(t<=wt)throw new Error("invalid field: expected ORDER > 0, got "+t);let r,s;if(typeof e=="object"&&e!=null){if(i.sqrt||n)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(r=u.BITS),u.sqrt&&(s=u.sqrt),typeof u.isLE=="boolean"&&(n=u.isLE)}else typeof e=="number"&&(r=e),i.sqrt&&(s=i.sqrt);const{nBitLength:o,nByteLength:a}=H8(t,r);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const l=Object.freeze({ORDER:t,isLE:n,BITS:o,BYTES:a,MASK:Zs(o),ZERO:wt,ONE:at,create:u=>Bt(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return wt<=u&&u<t},is0:u=>u===wt,isValidNot0:u=>!l.is0(u)&&l.isValid(u),isOdd:u=>(u&at)===at,neg:u=>Bt(-u,t),eql:(u,h)=>u===h,sqr:u=>Bt(u*u,t),add:(u,h)=>Bt(u+h,t),sub:(u,h)=>Bt(u-h,t),mul:(u,h)=>Bt(u*h,t),pow:(u,h)=>q8(l,u,h),div:(u,h)=>Bt(u*Qf(h,t),t),sqrN:u=>u*u,addN:(u,h)=>u+h,subN:(u,h)=>u-h,mulN:(u,h)=>u*h,inv:u=>Qf(u,t),sqrt:s||(u=>(c||(c=M8(t)),c(l,u))),toBytes:u=>n?uc(u,a):lc(u,a),fromBytes:u=>{if(u.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);return n?Ys(u):Qs(u)},invertBatch:u=>Zf(l,u),cmov:(u,h,d)=>d?h:u});return Object.freeze(l)}function Xf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ep(t){const e=Xf(t);return e+Math.ceil(e/2)}function V8(t,e,n=!1){const i=t.length,r=Xf(e),s=ep(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=n?Ys(t):Qs(t),a=Bt(o,e-at)+at;return n?uc(a,r):lc(a,r)}const Hi=BigInt(0),hi=BigInt(1);function $r(t,e){const n=e.negate();return t?n:e}function K8(t,e,n){const i=s=>s.pz,r=Zf(t.Fp,n.map(i));return n.map((s,o)=>s.toAffine(r[o])).map(t.fromAffine)}function tp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function fc(t,e){tp(t,e);const n=Math.ceil(e/t)+1,i=2**(t-1),r=2**t,s=Zs(t),o=BigInt(t);return{windows:n,windowSize:i,mask:s,maxNumber:r,shiftBy:o}}function np(t,e,n){const{windowSize:i,mask:r,maxNumber:s,shiftBy:o}=n;let a=Number(t&r),c=t>>o;a>i&&(a-=s,c+=hi);const l=e*i,u=l+Math.abs(a)-1,h=a===0,d=a<0,y=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:y,offsetF:l}}function W8(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,i)=>{if(!(n instanceof e))throw new Error("invalid point at index "+i)})}function G8(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,i)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+i)})}const pc=new WeakMap,ip=new WeakMap;function gc(t){return ip.get(t)||1}function rp(t){if(t!==Hi)throw new Error("invalid wNAF")}function Q8(t,e){return{constTimeNegate:$r,hasPrecomputes(n){return gc(n)!==1},unsafeLadder(n,i,r=t.ZERO){let s=n;for(;i>Hi;)i&hi&&(r=r.add(s)),s=s.double(),i>>=hi;return r},precomputeWindow(n,i){const{windows:r,windowSize:s}=fc(i,e),o=[];let a=n,c=a;for(let l=0;l<r;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,i,r){let s=t.ZERO,o=t.BASE;const a=fc(n,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:d,isNegF:y,offsetF:f}=np(r,c,a);r=l,h?o=o.add($r(y,i[f])):s=s.add($r(d,i[u]))}return rp(r),{p:s,f:o}},wNAFUnsafe(n,i,r,s=t.ZERO){const o=fc(n,e);for(let a=0;a<o.windows&&r!==Hi;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=np(r,a,o);if(r=c,!u){const d=i[l];s=s.add(h?d.negate():d)}}return rp(r),s},getPrecomputes(n,i,r){let s=pc.get(i);return s||(s=this.precomputeWindow(i,n),n!==1&&(typeof r=="function"&&(s=r(s)),pc.set(i,s))),s},wNAFCached(n,i,r){const s=gc(n);return this.wNAF(s,this.getPrecomputes(s,n,r),i)},wNAFCachedUnsafe(n,i,r,s){const o=gc(n);return o===1?this.unsafeLadder(n,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,r),i,s)},setWindowSize(n,i){tp(i,e),ip.set(n,i),pc.delete(n)}}}function Y8(t,e,n,i){let r=e,s=t.ZERO,o=t.ZERO;for(;n>Hi||i>Hi;)n&hi&&(s=s.add(r)),i&hi&&(o=o.add(r)),r=r.double(),n>>=hi,i>>=hi;return{p1:s,p2:o}}function Z8(t,e,n,i){W8(n,t),G8(i,e);const r=n.length,s=i.length;if(r!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=N8(BigInt(r));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Zs(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let d=o;for(let y=h;y>=0;y-=c){u.fill(o);for(let g=0;g<s;g++){const I=i[g],O=Number(I>>BigInt(y)&l);u[O]=u[O].add(n[g])}let f=o;for(let g=u.length-1,I=o;g>0;g--)I=I.add(u[g]),f=f.add(I);if(d=d.add(f),y!==0)for(let g=0;g<c;g++)d=d.double()}return d}function sp(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return j8(e),e}else return qi(t)}function J8(t,e,n={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const o of["p","n","h"]){const a=e[o];if(!(typeof a=="bigint"&&a>Hi))throw new Error(`CURVE.${o} must be positive bigint`)}const i=sp(e.p,n.Fp),r=sp(e.n,n.Fn),s=["Gx","Gy","a","b"];for(const o of s)if(!i.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:i,Fn:r}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const Pr=BigInt(0),Vi=BigInt(1),Xs=BigInt(2);function X8(t){return Js(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function e5(t){const e=X8(t),{P:n,type:i,adjustScalarBytes:r,powPminus2:s,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||zi,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),y=a?Xs**BigInt(254):Xs**BigInt(447),f=a?BigInt(8)*Xs**BigInt(251)-Vi:BigInt(4)*Xs**BigInt(445)-Vi,g=y+f+Vi,I=C=>Bt(C,n),O=B(h);function B(C){return uc(I(C),u)}function D(C){const z=yt("u coordinate",C,u);return a&&(z[31]&=127),I(Ys(z))}function x(C){return Ys(r(yt("scalar",C,u)))}function v(C,z){const j=M(D(z),x(C));if(j===Pr)throw new Error("invalid private or public key received");return B(j)}function A(C){return v(C,O)}function L(C,z,j){const q=I(C*(z-j));return z=I(z-q),j=I(j+q),{x_2:z,x_3:j}}function M(C,z){dc("u",C,Pr,n),dc("scalar",z,y,g);const j=z,q=C;let P=Vi,T=Pr,S=C,m=Vi,_=Pr;for(let R=BigInt(l-1);R>=Pr;R--){const U=j>>R&Vi;_^=U,{x_2:P,x_3:S}=L(_,P,S),{x_2:T,x_3:m}=L(_,T,m),_=U;const H=P+T,G=I(H*H),Q=P-T,Z=I(Q*Q),X=G-Z,re=S+m,ce=S-m,fe=I(ce*H),le=I(re*Q),ae=fe+le,$=fe-le;S=I(ae*ae),m=I(q*I($*$)),P=I(G*Z),T=I(X*(G+I(d*X)))}({x_2:P,x_3:S}=L(_,P,S)),{x_2:T,x_3:m}=L(_,T,m);const k=s(T);return I(P*k)}return{scalarMult:v,scalarMultBase:A,getSharedSecret:(C,z)=>v(C,z),getPublicKey:C=>A(C),utils:{randomPrivateKey:()=>c(u)},GuBytes:O.slice()}}BigInt(0);const t5=BigInt(1),op=BigInt(2),n5=BigInt(3),i5=BigInt(5);BigInt(8);const ap={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function r5(t){const e=BigInt(10),n=BigInt(20),i=BigInt(40),r=BigInt(80),s=ap.p,o=t*t%s*t%s,a=Kt(o,op,s)*o%s,c=Kt(a,t5,s)*t%s,l=Kt(c,i5,s)*c%s,u=Kt(l,e,s)*l%s,h=Kt(u,n,s)*u%s,d=Kt(h,i,s)*h%s,y=Kt(d,r,s)*d%s,f=Kt(y,r,s)*d%s,g=Kt(f,e,s)*l%s;return{pow_p_5_8:Kt(g,op,s)*t%s,b2:o}}function s5(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const yc=(()=>{const t=ap.p;return e5({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:i}=r5(e);return Bt(Kt(n,n5,t)*i,t)},adjustScalarBytes:s5})})();function cp(t){t.lowS!==void 0&&Ws("lowS",t.lowS),t.prehash!==void 0&&Ws("prehash",t.prehash)}class o5 extends Error{constructor(e=""){super(e)}}const mn={Err:o5,_tlv:{encode:(t,e)=>{const{Err:n}=mn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const i=e.length/2,r=Gs(i);if(r.length/2&128)throw new n("tlv.encode: long form length too big");const s=i>127?Gs(r.length/2|128):"";return Gs(t)+s+r+e},decode(t,e){const{Err:n}=mn;let i=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new n("tlv.decode: wrong tlv");const r=e[i++],s=!!(r&128);let o=0;if(!s)o=r;else{const c=r&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const l=e.subarray(i,i+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(i+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=mn;if(t<Tr)throw new e("integer: negative integers are not allowed");let n=Gs(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=mn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Qs(t)}},toSig(t){const{Err:e,_int:n,_tlv:i}=mn,r=yt("signature",t),{v:s,l:o}=i.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,s),{v:l,l:u}=i.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(t){const{_tlv:e,_int:n}=mn,i=e.encode(2,n.encode(t.r)),r=e.encode(2,n.encode(t.s)),s=i+r;return e.encode(48,s)}},Tr=BigInt(0),Br=BigInt(1),a5=BigInt(2),eo=BigInt(3),c5=BigInt(4);function l5(t,e,n){function i(r){const s=t.sqr(r),o=t.mul(s,r);return t.add(t.add(o,t.mul(r,e)),n)}return i}function lp(t,e,n){const{BYTES:i}=t;function r(s){let o;if(typeof s=="bigint")o=s;else{let a=yt("private key",s);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(i);c.set(a,c.length-a.length),a=c}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${i}, got ${typeof s}`)}}if(n&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return r}function u5(t,e={}){const{Fp:n,Fn:i}=J8("weierstrass",t,e),{h:r,n:s}=t;Js(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!n.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(M,C,z){const{x:j,y:q}=C.toAffine(),P=n.toBytes(j);if(Ws("isCompressed",z),z){a();const T=!n.isOdd(q);return ci(up(T),P)}else return ci(Uint8Array.of(4),P,n.toBytes(q))}function l(M){Pt(M);const C=n.BYTES,z=C+1,j=2*C+1,q=M.length,P=M[0],T=M.subarray(1);if(q===z&&(P===2||P===3)){const S=n.fromBytes(T);if(!n.isValid(S))throw new Error("bad point: is not on curve, wrong x");const m=d(S);let _;try{_=n.sqrt(m)}catch(R){const U=R instanceof Error?": "+R.message:"";throw new Error("bad point: is not on curve, sqrt error"+U)}a();const k=n.isOdd(_);return(P&1)===1!==k&&(_=n.neg(_)),{x:S,y:_}}else if(q===j&&P===4){const S=n.fromBytes(T.subarray(C*0,C*1)),m=n.fromBytes(T.subarray(C*1,C*2));if(!y(S,m))throw new Error("bad point: is not on curve");return{x:S,y:m}}else throw new Error(`bad point: got length ${q}, expected compressed=${z} or uncompressed=${j}`)}const u=e.toBytes||c,h=e.fromBytes||l,d=l5(n,t.a,t.b);function y(M,C){const z=n.sqr(C),j=d(M);return n.eql(z,j)}if(!y(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const f=n.mul(n.pow(t.a,eo),c5),g=n.mul(n.sqr(t.b),BigInt(27));if(n.is0(n.add(f,g)))throw new Error("bad curve params: a or b");function I(M,C,z=!1){if(!n.isValid(C)||z&&n.is0(C))throw new Error(`bad point coordinate ${M}`);return C}function O(M){if(!(M instanceof v))throw new Error("ProjectivePoint expected")}const B=Vf((M,C)=>{const{px:z,py:j,pz:q}=M;if(n.eql(q,n.ONE))return{x:z,y:j};const P=M.is0();C==null&&(C=P?n.ONE:n.inv(q));const T=n.mul(z,C),S=n.mul(j,C),m=n.mul(q,C);if(P)return{x:n.ZERO,y:n.ZERO};if(!n.eql(m,n.ONE))throw new Error("invZ was invalid");return{x:T,y:S}}),D=Vf(M=>{if(M.is0()){if(e.allowInfinityPoint&&!n.is0(M.py))return;throw new Error("bad point: ZERO")}const{x:C,y:z}=M.toAffine();if(!n.isValid(C)||!n.isValid(z))throw new Error("bad point: x or y not field elements");if(!y(C,z))throw new Error("bad point: equation left != right");if(!M.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function x(M,C,z,j,q){return z=new v(n.mul(z.px,M),z.py,z.pz),C=$r(j,C),z=$r(q,z),C.add(z)}class v{constructor(C,z,j){this.px=I("x",C),this.py=I("y",z,!0),this.pz=I("z",j),Object.freeze(this)}static fromAffine(C){const{x:z,y:j}=C||{};if(!C||!n.isValid(z)||!n.isValid(j))throw new Error("invalid affine point");if(C instanceof v)throw new Error("projective point not allowed");return n.is0(z)&&n.is0(j)?v.ZERO:new v(z,j,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(C){return K8(v,"pz",C)}static fromBytes(C){return Pt(C),v.fromHex(C)}static fromHex(C){const z=v.fromAffine(h(yt("pointHex",C)));return z.assertValidity(),z}static fromPrivateKey(C){const z=lp(i,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return v.BASE.multiply(z(C))}static msm(C,z){return Z8(v,i,C,z)}precompute(C=8,z=!0){return L.setWindowSize(this,C),z||this.multiply(eo),this}_setWindowSize(C){this.precompute(C)}assertValidity(){D(this)}hasEvenY(){const{y:C}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(C)}equals(C){O(C);const{px:z,py:j,pz:q}=this,{px:P,py:T,pz:S}=C,m=n.eql(n.mul(z,S),n.mul(P,q)),_=n.eql(n.mul(j,S),n.mul(T,q));return m&&_}negate(){return new v(this.px,n.neg(this.py),this.pz)}double(){const{a:C,b:z}=t,j=n.mul(z,eo),{px:q,py:P,pz:T}=this;let S=n.ZERO,m=n.ZERO,_=n.ZERO,k=n.mul(q,q),R=n.mul(P,P),U=n.mul(T,T),H=n.mul(q,P);return H=n.add(H,H),_=n.mul(q,T),_=n.add(_,_),S=n.mul(C,_),m=n.mul(j,U),m=n.add(S,m),S=n.sub(R,m),m=n.add(R,m),m=n.mul(S,m),S=n.mul(H,S),_=n.mul(j,_),U=n.mul(C,U),H=n.sub(k,U),H=n.mul(C,H),H=n.add(H,_),_=n.add(k,k),k=n.add(_,k),k=n.add(k,U),k=n.mul(k,H),m=n.add(m,k),U=n.mul(P,T),U=n.add(U,U),k=n.mul(U,H),S=n.sub(S,k),_=n.mul(U,R),_=n.add(_,_),_=n.add(_,_),new v(S,m,_)}add(C){O(C);const{px:z,py:j,pz:q}=this,{px:P,py:T,pz:S}=C;let m=n.ZERO,_=n.ZERO,k=n.ZERO;const R=t.a,U=n.mul(t.b,eo);let H=n.mul(z,P),G=n.mul(j,T),Q=n.mul(q,S),Z=n.add(z,j),X=n.add(P,T);Z=n.mul(Z,X),X=n.add(H,G),Z=n.sub(Z,X),X=n.add(z,q);let re=n.add(P,S);return X=n.mul(X,re),re=n.add(H,Q),X=n.sub(X,re),re=n.add(j,q),m=n.add(T,S),re=n.mul(re,m),m=n.add(G,Q),re=n.sub(re,m),k=n.mul(R,X),m=n.mul(U,Q),k=n.add(m,k),m=n.sub(G,k),k=n.add(G,k),_=n.mul(m,k),G=n.add(H,H),G=n.add(G,H),Q=n.mul(R,Q),X=n.mul(U,X),G=n.add(G,Q),Q=n.sub(H,Q),Q=n.mul(R,Q),X=n.add(X,Q),H=n.mul(G,X),_=n.add(_,H),H=n.mul(re,X),m=n.mul(Z,m),m=n.sub(m,H),H=n.mul(Z,G),k=n.mul(re,k),k=n.add(k,H),new v(m,_,k)}subtract(C){return this.add(C.negate())}is0(){return this.equals(v.ZERO)}multiply(C){const{endo:z}=e;if(!i.isValidNot0(C))throw new Error("invalid scalar: out of range");let j,q;const P=T=>L.wNAFCached(this,T,v.normalizeZ);if(z){const{k1neg:T,k1:S,k2neg:m,k2:_}=z.splitScalar(C),{p:k,f:R}=P(S),{p:U,f:H}=P(_);q=R.add(H),j=x(z.beta,k,U,T,m)}else{const{p:T,f:S}=P(C);j=T,q=S}return v.normalizeZ([j,q])[0]}multiplyUnsafe(C){const{endo:z}=e,j=this;if(!i.isValid(C))throw new Error("invalid scalar: out of range");if(C===Tr||j.is0())return v.ZERO;if(C===Br)return j;if(L.hasPrecomputes(this))return this.multiply(C);if(z){const{k1neg:q,k1:P,k2neg:T,k2:S}=z.splitScalar(C),{p1:m,p2:_}=Y8(v,j,P,S);return x(z.beta,m,_,q,T)}else return L.wNAFCachedUnsafe(j,C)}multiplyAndAddUnsafe(C,z,j){const q=this.multiplyUnsafe(z).add(C.multiplyUnsafe(j));return q.is0()?void 0:q}toAffine(C){return B(this,C)}isTorsionFree(){const{isTorsionFree:C}=e;return r===Br?!0:C?C(v,this):L.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){const{clearCofactor:C}=e;return r===Br?this:C?C(v,this):this.multiplyUnsafe(r)}toBytes(C=!0){return Ws("isCompressed",C),this.assertValidity(),u(v,this,C)}toRawBytes(C=!0){return this.toBytes(C)}toHex(C=!0){return Ir(this.toBytes(C))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}v.BASE=new v(t.Gx,t.Gy,n.ONE),v.ZERO=new v(n.ZERO,n.ONE,n.ZERO),v.Fp=n,v.Fn=i;const A=i.BITS,L=Q8(v,e.endo?Math.ceil(A/2):A);return v}function up(t){return Uint8Array.of(t?2:3)}function h5(t,e,n={}){Js(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=e.randomBytes||zi,r=e.hmac||((j,...q)=>Vs(e.hash,j,ci(...q))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o;function l(j){const q=a>>Br;return j>q}function u(j){return l(j)?o.neg(j):j}function h(j,q){if(!o.isValidNot0(q))throw new Error(`invalid signature ${j}: out of range 1..CURVE.n`)}class d{constructor(q,P,T){h("r",q),h("s",P),this.r=q,this.s=P,T!=null&&(this.recovery=T),Object.freeze(this)}static fromCompact(q){const P=o.BYTES,T=yt("compactSignature",q,P*2);return new d(o.fromBytes(T.subarray(0,P)),o.fromBytes(T.subarray(P,P*2)))}static fromDER(q){const{r:P,s:T}=mn.toSig(yt("DER",q));return new d(P,T)}assertValidity(){}addRecoveryBit(q){return new d(this.r,this.s,q)}recoverPublicKey(q){const P=s.ORDER,{r:T,s:S,recovery:m}=this;if(m==null||![0,1,2,3].includes(m))throw new Error("recovery id invalid");if(a*a5<P&&m>1)throw new Error("recovery id is ambiguous for h>1 curve");const _=m===2||m===3?T+a:T;if(!s.isValid(_))throw new Error("recovery id 2 or 3 invalid");const k=s.toBytes(_),R=t.fromHex(ci(up((m&1)===0),k)),U=o.inv(_),H=D(yt("msgHash",q)),G=o.create(-H*U),Q=o.create(S*U),Z=t.BASE.multiplyUnsafe(G).add(R.multiplyUnsafe(Q));if(Z.is0())throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o.neg(this.s),this.recovery):this}toBytes(q){if(q==="compact")return ci(o.toBytes(this.r),o.toBytes(this.s));if(q==="der")return Ya(mn.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ir(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ir(this.toBytes("compact"))}}const y=lp(o,n.allowedPrivateKeyLengths,n.wrapPrivateKey),f={isValidPrivateKey(j){try{return y(j),!0}catch{return!1}},normPrivateKeyToScalar:y,randomPrivateKey:()=>{const j=a;return V8(i(ep(j)),j)},precompute(j=8,q=t.BASE){return q.precompute(j,!1)}};function g(j,q=!0){return t.fromPrivateKey(j).toBytes(q)}function I(j){if(typeof j=="bigint")return!1;if(j instanceof t)return!0;const q=yt("key",j).length,P=s.BYTES,T=P+1,S=2*P+1;if(!(n.allowedPrivateKeyLengths||o.BYTES===T))return q===T||q===S}function O(j,q,P=!0){if(I(j)===!0)throw new Error("first arg must be private key");if(I(q)===!1)throw new Error("second arg must be public key");return t.fromHex(q).multiply(y(j)).toBytes(P)}const B=e.bits2int||function(j){if(j.length>8192)throw new Error("input is too large");const q=Qs(j),P=j.length*8-c;return P>0?q>>BigInt(P):q},D=e.bits2int_modN||function(j){return o.create(B(j))},x=Zs(c);function v(j){return dc("num < 2^"+c,j,Tr,x),o.toBytes(j)}function A(j,q,P=L){if(["recovered","canonical"].some(Z=>Z in P))throw new Error("sign() legacy options not supported");const{hash:T}=e;let{lowS:S,prehash:m,extraEntropy:_}=P;S==null&&(S=!0),j=yt("msgHash",j),cp(P),m&&(j=yt("prehashed msgHash",T(j)));const k=D(j),R=y(q),U=[v(R),v(k)];if(_!=null&&_!==!1){const Z=_===!0?i(s.BYTES):_;U.push(yt("extraEntropy",Z))}const H=ci(...U),G=k;function Q(Z){const X=B(Z);if(!o.isValidNot0(X))return;const re=o.inv(X),ce=t.BASE.multiply(X).toAffine(),fe=o.create(ce.x);if(fe===Tr)return;const le=o.create(re*o.create(G+fe*R));if(le===Tr)return;let ae=(ce.x===fe?0:2)|Number(ce.y&Br),$=le;return S&&l(le)&&($=u(le),ae^=1),new d(fe,$,ae)}return{seed:H,k2sig:Q}}const L={lowS:e.lowS,prehash:!1},M={lowS:e.lowS,prehash:!1};function C(j,q,P=L){const{seed:T,k2sig:S}=A(j,q,P);return R8(e.hash.outputLen,o.BYTES,r)(T,S)}t.BASE.precompute(8);function z(j,q,P,T=M){const S=j;q=yt("msgHash",q),P=yt("publicKey",P),cp(T);const{lowS:m,prehash:_,format:k}=T;if("strict"in T)throw new Error("options.strict was renamed to lowS");if(k!==void 0&&!["compact","der","js"].includes(k))throw new Error('format must be "compact", "der" or "js"');const R=typeof S=="string"||Ka(S),U=!R&&!k&&typeof S=="object"&&S!==null&&typeof S.r=="bigint"&&typeof S.s=="bigint";if(!R&&!U)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let H,G;try{if(U)if(k===void 0||k==="js")H=new d(S.r,S.s);else throw new Error("invalid format");if(R){try{k!=="compact"&&(H=d.fromDER(S))}catch(ae){if(!(ae instanceof mn.Err))throw ae}!H&&k!=="der"&&(H=d.fromCompact(S))}G=t.fromHex(P)}catch{return!1}if(!H||m&&H.hasHighS())return!1;_&&(q=e.hash(q));const{r:Q,s:Z}=H,X=D(q),re=o.inv(Z),ce=o.create(X*re),fe=o.create(Q*re),le=t.BASE.multiplyUnsafe(ce).add(G.multiplyUnsafe(fe));return le.is0()?!1:o.create(le.x)===Q}return Object.freeze({getPublicKey:g,getSharedSecret:O,sign:C,verify:z,utils:f,Point:t,Signature:d})}function d5(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp,i=qi(e.n,t.nBitLength),r={Fp:n,Fn:i,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:r}}function f5(t){const{CURVE:e,curveOpts:n}=d5(t),i={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,ecdsaOpts:i}}function p5(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function g5(t){const{CURVE:e,curveOpts:n,ecdsaOpts:i}=f5(t),r=u5(e,n),s=h5(r,i,n);return p5(t,s)}function wc(t,e){const n=i=>g5({...t,hash:i});return{...n(e),create:n}}const hp={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},dp={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},fp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},y5=qi(hp.p),w5=qi(dp.p),m5=qi(fp.p),b5=wc({...hp,Fp:y5,lowS:!1},zs);wc({...dp,Fp:w5,lowS:!1},D4),wc({...fp,Fp:m5,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},I4);const v5=b5,pp="base10",ct="base16",Wt="base64pad",Vn="base64url",kr="utf8",gp=0,bn=1,Nr=2,E5=0,yp=1,Rr=12,mc=32;function x5(){const t=yc.utils.randomPrivateKey(),e=yc.getPublicKey(t);return{privateKey:pt(t,ct),publicKey:pt(e,ct)}}function bc(){const t=zi(mc);return pt(t,ct)}function _5(t,e){const n=yc.getSharedSecret($t(t,ct),$t(e,ct)),i=B8(Ks,n,void 0,void 0,mc);return pt(i,ct)}function to(t){const e=Ks($t(t,ct));return pt(e,ct)}function en(t){const e=Ks($t(t,kr));return pt(e,ct)}function wp(t){return $t(`${t}`,pp)}function di(t){return Number(pt(t,pp))}function mp(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function bp(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function S5(t){const e=wp(typeof t.type<"u"?t.type:gp);if(di(e)===bn&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?$t(t.senderPublicKey,ct):void 0,i=typeof t.iv<"u"?$t(t.iv,ct):zi(Rr),r=$t(t.symKey,ct),s=zf(r,i).encrypt($t(t.message,kr)),o=vp({type:e,sealed:s,iv:i,senderPublicKey:n});return t.encoding===Vn?mp(o):o}function A5(t){const e=$t(t.symKey,ct),{sealed:n,iv:i}=Lr({encoded:t.encoded,encoding:t.encoding}),r=zf(e,i).decrypt(n);if(r===null)throw new Error("Failed to decrypt");return pt(r,kr)}function I5(t,e){const n=wp(Nr),i=zi(Rr),r=$t(t,kr),s=vp({type:n,sealed:r,iv:i});return e===Vn?mp(s):s}function D5(t,e){const{sealed:n}=Lr({encoded:t,encoding:e});return pt(n,kr)}function vp(t){if(di(t.type)===Nr)return pt(vr([t.type,t.sealed]),Wt);if(di(t.type)===bn){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return pt(vr([t.type,t.senderPublicKey,t.iv,t.sealed]),Wt)}return pt(vr([t.type,t.iv,t.sealed]),Wt)}function Lr(t){const e=(t.encoding||Wt)===Vn?bp(t.encoded):t.encoded,n=$t(e,Wt),i=n.slice(E5,yp),r=yp;if(di(i)===bn){const c=r+mc,l=c+Rr,u=n.slice(r,c),h=n.slice(c,l),d=n.slice(l);return{type:i,sealed:d,iv:h,senderPublicKey:u}}if(di(i)===Nr){const c=n.slice(r),l=zi(Rr);return{type:i,sealed:c,iv:l}}const s=r+Rr,o=n.slice(r,s),a=n.slice(s);return{type:i,sealed:a,iv:o}}function C5(t,e){const n=Lr({encoded:t,encoding:e==null?void 0:e.encoding});return Ep({type:di(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?pt(n.senderPublicKey,ct):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ep(t){const e=(t==null?void 0:t.type)||gp;if(e===bn){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function xp(t){return t.type===bn&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function _p(t){return t.type===Nr}function O5(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return vr([new Uint8Array([4]),e,n])}function $5(t,e){const[n,i,r]=t.split("."),s=Buffer.from(bp(r),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${i}`,l=Ks(c),u=O5(e);if(!v5.verify(vr([o,a]),l,u))throw new Error("Invalid signature");return na(t).payload}const P5="irn";function no(t){return(t==null?void 0:t.relay)||{protocol:P5}}function Ur(t){const e=g3[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function T5(t,e="-"){const n={},i="relay"+e;return Object.keys(t).forEach(r=>{if(r.startsWith(i)){const s=r.replace(i,""),o=t[r];n[s]=o}}),n}function Sp(t){if(!t.includes("wc:")){const l=rf(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),r=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a={};o.forEach((l,u)=>{a[u]=l});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:B5(r[0]),version:parseInt(r[1],10),symKey:a.symKey,relay:T5(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function B5(t){return t.startsWith("//")?t.substring(2):t}function k5(t,e="-"){const n="relay",i={};return Object.keys(t).forEach(r=>{const s=r,o=n+e+s;t[s]&&(i[o]=t[s])}),i}function Ap(t){const e=new URLSearchParams,n=k5(t.relay);Object.keys(n).sort().forEach(r=>{e.set(r,n[r])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const i=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${i}`}function io(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var N5=Object.defineProperty,R5=Object.defineProperties,L5=Object.getOwnPropertyDescriptors,Ip=Object.getOwnPropertySymbols,U5=Object.prototype.hasOwnProperty,F5=Object.prototype.propertyIsEnumerable,Dp=(t,e,n)=>e in t?N5(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M5=(t,e)=>{for(var n in e||(e={}))U5.call(e,n)&&Dp(t,n,e[n]);if(Ip)for(var n of Ip(e))F5.call(e,n)&&Dp(t,n,e[n]);return t},z5=(t,e)=>R5(t,L5(e));function Ki(t){const e=[];return t.forEach(n=>{const[i,r]=n.split(":");e.push(`${i}:${r}`)}),e}function j5(t){const e=[];return Object.values(t).forEach(n=>{e.push(...Ki(n.accounts))}),e}function q5(t,e){const n=[];return Object.values(t).forEach(i=>{Ki(i.accounts).includes(e)&&n.push(...i.methods)}),n}function H5(t,e){const n=[];return Object.values(t).forEach(i=>{Ki(i.accounts).includes(e)&&n.push(...i.events)}),n}function Cp(t){return t.includes(":")}function V5(t){return Cp(t)?t.split(":")[0]:t}function Op(t){var e,n,i;const r={};if(!Fr(t))return r;for(const[s,o]of Object.entries(t)){const a=Cp(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=V5(s);r[u]=z5(M5({},r[u]),{chains:ai(a,(e=r[u])==null?void 0:e.chains),methods:ai(c,(n=r[u])==null?void 0:n.methods),events:ai(l,(i=r[u])==null?void 0:i.events)})}return r}function K5(t){const e={};return t==null||t.forEach(n=>{var i;const[r,s]=n.split(":");e[r]||(e[r]={accounts:[],chains:[],events:[],methods:[]}),e[r].accounts.push(n),(i=e[r].chains)==null||i.push(`${r}:${s}`)}),e}function $p(t,e){e=e.map(i=>i.replace("did:pkh:",""));const n=K5(e);for(const[i,r]of Object.entries(n))r.methods?r.methods=ai(r.methods,t):r.methods=t,r.events=["chainChanged","accountsChanged"];return n}function W5(t,e){var n,i,r,s,o,a;const c=Op(t),l=Op(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const d of h)u[d]={chains:ai((n=c[d])==null?void 0:n.chains,(i=l[d])==null?void 0:i.chains),methods:ai((r=c[d])==null?void 0:r.methods,(s=l[d])==null?void 0:s.methods),events:ai((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}const G5={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Q5={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function te(t,e){const{message:n,code:i}=Q5[t];return{message:e?`${n} ${e}`:n,code:i}}function Te(t,e){const{message:n,code:i}=G5[t];return{message:e?`${n} ${e}`:n,code:i}}function Wi(t,e){return!!Array.isArray(t)}function Fr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ze(t){return typeof t>"u"}function ke(t,e){return e&&Ze(t)?!0:typeof t=="string"&&!!t.trim().length}function vc(t,e){return e&&Ze(t)?!0:typeof t=="number"&&!isNaN(t)}function Y5(t,e){const{requiredNamespaces:n}=e,i=Object.keys(t.namespaces),r=Object.keys(n);let s=!0;return si(r,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Ki(a),h=n[o];(!si(Kd(o,h),u)||!si(h.methods,c)||!si(h.events,l))&&(s=!1)}),s):!1}function ro(t){return ke(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Z5(t){if(ke(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const n=e[0]+":"+e[1];return!!e[2]&&ro(n)}}return!1}function J5(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(ke(t,!1)){if(e(t))return!0;const n=rf(t);return e(n)}}catch{}return!1}function X5(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function e6(t){return t==null?void 0:t.topic}function t6(t,e){let n=null;return ke(t==null?void 0:t.publicKey,!1)||(n=te("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function Pp(t){let e=!0;return Wi(t)?t.length&&(e=t.every(n=>ke(n,!1))):e=!1,e}function n6(t,e,n){let i=null;return Wi(e)&&e.length?e.forEach(r=>{i||ro(r)||(i=Te("UNSUPPORTED_CHAINS",`${n}, chain ${r} should be a string and conform to "namespace:chainId" format`))}):ro(t)||(i=Te("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function i6(t,e,n){let i=null;return Object.entries(t).forEach(([r,s])=>{if(i)return;const o=n6(r,Kd(r,s),`${e} ${n}`);o&&(i=o)}),i}function r6(t,e){let n=null;return Wi(t)?t.forEach(i=>{n||Z5(i)||(n=Te("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):n=Te("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function s6(t,e){let n=null;return Object.values(t).forEach(i=>{if(n)return;const r=r6(i==null?void 0:i.accounts,`${e} namespace`);r&&(n=r)}),n}function o6(t,e){let n=null;return Pp(t==null?void 0:t.methods)?Pp(t==null?void 0:t.events)||(n=Te("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=Te("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function Tp(t,e){let n=null;return Object.values(t).forEach(i=>{if(n)return;const r=o6(i,`${e}, namespace`);r&&(n=r)}),n}function a6(t,e,n){let i=null;if(t&&Fr(t)){const r=Tp(t,e);r&&(i=r);const s=i6(t,e,n);s&&(i=s)}else i=te("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return i}function Ec(t,e){let n=null;if(t&&Fr(t)){const i=Tp(t,e);i&&(n=i);const r=s6(t,e);r&&(n=r)}else n=te("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function Bp(t){return ke(t.protocol,!0)}function c6(t,e){let n=!1;return t?t&&Wi(t)&&t.length&&t.forEach(i=>{n=Bp(i)}):n=!0,n}function l6(t){return typeof t=="number"}function mt(t){return typeof t<"u"&&typeof t!==null}function u6(t){return!(!t||typeof t!="object"||!t.code||!vc(t.code,!1)||!t.message||!ke(t.message,!1))}function h6(t){return!(Ze(t)||!ke(t.method,!1))}function d6(t){return!(Ze(t)||Ze(t.result)&&Ze(t.error)||!vc(t.id,!1)||!ke(t.jsonrpc,!1))}function f6(t){return!(Ze(t)||!ke(t.name,!1))}function kp(t,e){return!(!ro(e)||!j5(t).includes(e))}function p6(t,e,n){return ke(n,!1)?q5(t,e).includes(n):!1}function g6(t,e,n){return ke(n,!1)?H5(t,e).includes(n):!1}function Np(t,e,n){let i=null;const r=y6(t),s=w6(e),o=Object.keys(r),a=Object.keys(s),c=Rp(Object.keys(t)),l=Rp(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(i=te("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),si(o,a)||(i=te("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const d=Ki(e[h].accounts);d.includes(h)||(i=te("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{i||(si(r[h].methods,s[h].methods)?si(r[h].events,s[h].events)||(i=te("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${h}`)):i=te("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function y6(t){const e={};return Object.keys(t).forEach(n=>{var i;n.includes(":")?e[n]=t[n]:(i=t[n].chains)==null||i.forEach(r=>{e[r]={methods:t[n].methods,events:t[n].events}})}),e}function Rp(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function w6(t){const e={};return Object.keys(t).forEach(n=>{if(n.includes(":"))e[n]=t[n];else{const i=Ki(t[n].accounts);i==null||i.forEach(r=>{e[r]={accounts:t[n].accounts.filter(s=>s.includes(`${r}:`)),methods:t[n].methods,events:t[n].events}})}}),e}function m6(t,e){return vc(t,!1)&&t<=e.max&&t>=e.min}function Lp(){const t=xr();return new Promise(e=>{switch(t){case _t.browser:e(b6());break;case _t.reactNative:e(v6());break;case _t.node:e(E6());break;default:e(!0)}})}function b6(){return Fi()&&(navigator==null?void 0:navigator.onLine)}async function v6(){if(Pn()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function E6(){return!0}function x6(t){switch(xr()){case _t.browser:_6(t);break;case _t.reactNative:S6(t);break}}function _6(t){!Pn()&&Fi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function S6(t){Pn()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function A6(){var t;return Fi()&&un.getDocument()?((t=un.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const xc={};class Mr{static get(e){return xc[e]}static set(e,n){xc[e]=n}static delete(e){delete xc[e]}}function I6(t){const e=yr.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function D6({publicKey:t,signature:e,payload:n}){var i;const r=_c(n.method),s=128|parseInt(((i=n.version)==null?void 0:i.toString())||"4"),o=$6(n.address),a=n.era==="00"?new Uint8Array([0]):_c(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(n.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${O6(n.tip)}`),h=T6(u),d=new Uint8Array([0,...t,o,...e,...a,...l,...h,...r]),y=P6(d.length+1);return new Uint8Array([...y,s,...d])}function C6(t){const e=_c(t),n=b3.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function _c(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function O6(t){return t.startsWith("0x")?t.slice(2):t}function $6(t){const e=yr.decode(t)[0];return e===42?0:e===60?2:1}function P6(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function T6(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function B6(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=I6(t.transaction.address),i=D6({publicKey:n,signature:e,payload:t.transaction}),r=Buffer.from(i).toString("hex");return C6(r)}const k6="PARSE_ERROR",N6="INVALID_REQUEST",R6="METHOD_NOT_FOUND",L6="INVALID_PARAMS",Up="INTERNAL_ERROR",Sc="SERVER_ERROR",U6=[-32700,-32600,-32601,-32602,-32603],zr={[k6]:{code:-32700,message:"Parse error"},[N6]:{code:-32600,message:"Invalid Request"},[R6]:{code:-32601,message:"Method not found"},[L6]:{code:-32602,message:"Invalid params"},[Up]:{code:-32603,message:"Internal error"},[Sc]:{code:-32e3,message:"Server error"}},Fp=Sc;function F6(t){return U6.includes(t)}function Mp(t){return Object.keys(zr).includes(t)?zr[t]:zr[Fp]}function M6(t){const e=Object.values(zr).find(n=>n.code===t);return e||zr[Fp]}function z6(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var Ac={};/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */var Ic=function(t,e){return Ic=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)i.hasOwnProperty(r)&&(n[r]=i[r])},Ic(t,e)};function j6(t,e){Ic(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Dc=function(){return Dc=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Dc.apply(this,arguments)};function q6(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function H6(t,e,n,i){var r=arguments.length,s=r<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,n):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s}function V6(t,e){return function(n,i){e(n,i,t)}}function K6(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function W6(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(i.next(u))}catch(h){o(h)}}function c(u){try{l(i.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):r(u.value).then(a,c)}l((i=i.apply(t,e||[])).next())})}function G6(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(s=l[0]&2?r.return:l[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,l[1])).done)return s;switch(r=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,r=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],r=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Q6(t,e,n,i){i===void 0&&(i=n),t[i]=e[n]}function Y6(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Cc(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zp(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function Z6(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(zp(arguments[e]));return t}function J6(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,r++)i[r]=s[o];return i}function jr(t){return this instanceof jr?(this.v=t,this):new jr(t)}function X6(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(d){i[d]&&(r[d]=function(y){return new Promise(function(f,g){s.push([d,y,f,g])>1||a(d,y)})})}function a(d,y){try{c(i[d](y))}catch(f){h(s[0][3],f)}}function c(d){d.value instanceof jr?Promise.resolve(d.value.v).then(l,u):h(s[0][2],d)}function l(d){a("next",d)}function u(d){a("throw",d)}function h(d,y){d(y),s.shift(),s.length&&a(s[0][0],s[0][1])}}function e_(t){var e,n;return e={},i("next"),i("throw",function(r){throw r}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(r,s){e[r]=t[r]?function(o){return(n=!n)?{value:jr(t[r](o)),done:r==="return"}:s?s(o):o}:s}}function t_(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Cc=="function"?Cc(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),r(a,c,o.done,o.value)})}}function r(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function n_(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function i_(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r_(t){return t&&t.__esModule?t:{default:t}}function s_(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function o_(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const a_=Ul(Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Dc},__asyncDelegator:e_,__asyncGenerator:X6,__asyncValues:t_,__await:jr,__awaiter:W6,__classPrivateFieldGet:s_,__classPrivateFieldSet:o_,__createBinding:Q6,__decorate:H6,__exportStar:Y6,__extends:j6,__generator:G6,__importDefault:r_,__importStar:i_,__makeTemplateObject:n_,__metadata:K6,__param:V6,__read:zp,__rest:q6,__spread:Z6,__spreadArrays:J6,__values:Cc},Symbol.toStringTag,{value:"Module"})));var vn={},jp;function c_(){if(jp)return vn;jp=1,Object.defineProperty(vn,"__esModule",{value:!0}),vn.isBrowserCryptoAvailable=vn.getSubtleCrypto=vn.getBrowerCrypto=void 0;function t(){return(Ai==null?void 0:Ai.crypto)||(Ai==null?void 0:Ai.msCrypto)||{}}vn.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}vn.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return vn.isBrowserCryptoAvailable=n,vn}var En={},qp;function l_(){if(qp)return En;qp=1,Object.defineProperty(En,"__esModule",{value:!0}),En.isBrowser=En.isNode=En.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}En.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}En.isNode=e;function n(){return!t()&&!e()}return En.isBrowser=n,En}var Hp;function u_(){return Hp||(Hp=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=a_;e.__exportStar(c_(),t),e.__exportStar(l_(),t)}(Ac)),Ac}var h_=u_();function tn(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function fi(t=6){return BigInt(tn(t))}function pi(t,e,n){return{id:n||tn(),jsonrpc:"2.0",method:t,params:e}}function Oc(t,e){return{id:t,jsonrpc:"2.0",result:e}}function $c(t,e,n){return{id:t,jsonrpc:"2.0",error:d_(e)}}function d_(t,e){return typeof t>"u"?Mp(Up):(typeof t=="string"&&(t=Object.assign(Object.assign({},Mp(Sc)),{message:t})),F6(t.code)&&(t=M6(t.code)),t)}class f_{}class p_ extends f_{constructor(){super()}}class g_ extends p_{constructor(e){super()}}const y_="^wss?:";function w_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function m_(t,e){const n=w_(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function Vp(t){return m_(t,y_)}function b_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Kp(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Pc(t){return Kp(t)&&"method"in t}function so(t){return Kp(t)&&(nn(t)||kt(t))}function nn(t){return"result"in t}function kt(t){return"error"in t}class v_ extends g_{constructor(e){super(e),this.events=new jt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(pi(e.method,e.params||[],e.id||fi().toString()),n)}async requestStrict(e,n){return new Promise(async(i,r)=>{if(!this.connection.connected)try{await this.open()}catch(s){r(s)}this.events.on(`${e.id}`,s=>{kt(s)?r(s.error):i(s.result)});try{await this.connection.send(e,n)}catch(s){r(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),so(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const E_=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),x_=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Wp=t=>t.split("?")[0],Gp=10,__=E_();let S_=class{constructor(e){if(this.url=e,this.events=new jt.EventEmitter,this.registering=!1,!Vp(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ei(e))}catch(n){this.onError(e.id,n)}}register(e=this.url){if(!Vp(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((i,r)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),r(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return r(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((n,i)=>{const r=h_.isReactNative()?void 0:{rejectUnauthorized:!b_(e)},s=new __(e,[],r);x_()?s.onerror=o=>{const a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(e){e.onmessage=n=>this.onPayload(n),e.onclose=n=>this.onClose(n),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?Oi(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const i=this.parseError(n),r=i.message||i.toString(),s=$c(e,r);this.events.emit("payload",s)}parseError(e,n=this.url){return z6(e,Wp(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Gp&&this.events.setMaxListeners(Gp)}emitError(e){const n=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Wp(this.url)}`));return this.events.emit("register_error",n),n}};const Qp="wc",Yp=2,Tc="core",rn=`${Qp}@2:${Tc}:`,A_={logger:"error"},I_={database:":memory:"},D_="crypto",Zp="client_ed25519_seed",C_=ee.ONE_DAY,O_="keychain",$_="0.3",P_="messages",T_="0.3",Jp=ee.SIX_HOURS,B_="publisher",Xp="irn",k_="error",eg="wss://relay.walletconnect.org",N_="relayer",He={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},R_="_subscription",Nt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},L_=.1,Bc="2.21.3",Oe={link_mode:"link_mode",relay:"relay"},oo={inbound:"inbound",outbound:"outbound"},U_="0.3",F_="WALLETCONNECT_CLIENT_ID",tg="WALLETCONNECT_LINK_MODE_APPS",St={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},M_="subscription",z_="0.3",j_="pairing",q_="0.3",qr={wc_pairingDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ee.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:0},res:{ttl:ee.ONE_DAY,prompt:!1,tag:0}}},gi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Gt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},H_="history",V_="0.3",K_="expirer",Rt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},W_="0.3",G_="verify-api",Q_="https://verify.walletconnect.com",ng="https://verify.walletconnect.org",Hr=ng,Y_=`${Hr}/v3`,Z_=[Q_,ng],J_="echo",X_="https://echo.walletconnect.com",sn={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},xn={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Qt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},yi={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},wi={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Vr={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},eS=.1,tS="event-client",nS=86400,iS="https://pulse.walletconnect.org/batch";function rS(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),i=0;i<n.length;i++)n[i]=255;for(var r=0;r<t.length;r++){var s=t.charAt(r),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=r}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,I=0,O=0,B=f.length;O!==B&&f[O]===0;)O++,g++;for(var D=(B-O)*u+1>>>0,x=new Uint8Array(D);O!==B;){for(var v=f[O],A=0,L=D-1;(v!==0||A<I)&&L!==-1;L--,A++)v+=256*x[L]>>>0,x[L]=v%a>>>0,v=v/a>>>0;if(v!==0)throw new Error("Non-zero carry");I=A,O++}for(var M=D-I;M!==D&&x[M]===0;)M++;for(var C=c.repeat(g);M<D;++M)C+=t.charAt(x[M]);return C}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var I=0,O=0;f[g]===c;)I++,g++;for(var B=(f.length-g)*l+1>>>0,D=new Uint8Array(B);f[g];){var x=n[f.charCodeAt(g)];if(x===255)return;for(var v=0,A=B-1;(x!==0||v<O)&&A!==-1;A--,v++)x+=a*D[A]>>>0,D[A]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");O=v,g++}if(f[g]!==" "){for(var L=B-O;L!==B&&D[L]===0;)L++;for(var M=new Uint8Array(I+(B-L)),C=I;L!==B;)M[C++]=D[L++];return M}}}function y(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:y}}var sS=rS,oS=sS;const ig=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},aS=t=>new TextEncoder().encode(t),cS=t=>new TextDecoder().decode(t);class lS{constructor(e,n,i){this.name=e,this.prefix=n,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class uS{constructor(e,n,i){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return rg(this,e)}}class hS{constructor(e){this.decoders=e}or(e){return rg(this,e)}decode(e){const n=e[0],i=this.decoders[n];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const rg=(t,e)=>new hS({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class dS{constructor(e,n,i,r){this.name=e,this.prefix=n,this.baseEncode=i,this.baseDecode=r,this.encoder=new lS(e,n,i),this.decoder=new uS(e,n,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ao=({name:t,prefix:e,encode:n,decode:i})=>new dS(t,e,n,i),Kr=({prefix:t,name:e,alphabet:n})=>{const{encode:i,decode:r}=oS(n,e);return ao({prefix:t,name:e,encode:i,decode:s=>ig(r(s))})},fS=(t,e,n,i)=>{const r={};for(let u=0;u<e.length;++u)r[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=r[t[u]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},pS=(t,e,n)=>{const i=e[e.length-1]==="=",r=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[r&a>>o];if(o&&(s+=e[r&a<<n-o]),i)for(;s.length*n&7;)s+="=";return s},Je=({name:t,prefix:e,bitsPerChar:n,alphabet:i})=>ao({prefix:e,name:t,encode(r){return pS(r,i,n)},decode(r){return fS(r,i,n,t)}}),gS=ao({prefix:"\0",name:"identity",encode:t=>cS(t),decode:t=>aS(t)});var yS=Object.freeze({__proto__:null,identity:gS});const wS=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var mS=Object.freeze({__proto__:null,base2:wS});const bS=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var vS=Object.freeze({__proto__:null,base8:bS});const ES=Kr({prefix:"9",name:"base10",alphabet:"0123456789"});var xS=Object.freeze({__proto__:null,base10:ES});const _S=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),SS=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var AS=Object.freeze({__proto__:null,base16:_S,base16upper:SS});const IS=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),DS=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),CS=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),OS=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$S=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),PS=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),TS=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),BS=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kS=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var NS=Object.freeze({__proto__:null,base32:IS,base32upper:DS,base32pad:CS,base32padupper:OS,base32hex:$S,base32hexupper:PS,base32hexpad:TS,base32hexpadupper:BS,base32z:kS});const RS=Kr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),LS=Kr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var US=Object.freeze({__proto__:null,base36:RS,base36upper:LS});const FS=Kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),MS=Kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var zS=Object.freeze({__proto__:null,base58btc:FS,base58flickr:MS});const jS=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qS=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),HS=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),VS=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var KS=Object.freeze({__proto__:null,base64:jS,base64pad:qS,base64url:HS,base64urlpad:VS});const sg=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),WS=sg.reduce((t,e,n)=>(t[n]=e,t),[]),GS=sg.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function QS(t){return t.reduce((e,n)=>(e+=WS[n],e),"")}function YS(t){const e=[];for(const n of t){const i=GS[n.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(i)}return new Uint8Array(e)}const ZS=ao({prefix:"🚀",name:"base256emoji",encode:QS,decode:YS});var JS=Object.freeze({__proto__:null,base256emoji:ZS}),XS=ag,og=128,eA=-128,tA=Math.pow(2,31);function ag(t,e,n){e=e||[],n=n||0;for(var i=n;t>=tA;)e[n++]=t&255|og,t/=128;for(;t&eA;)e[n++]=t&255|og,t>>>=7;return e[n]=t|0,ag.bytes=n-i+1,e}var nA=kc,iA=128,cg=127;function kc(t,i){var n=0,i=i||0,r=0,s=i,o,a=t.length;do{if(s>=a)throw kc.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=r<28?(o&cg)<<r:(o&cg)*Math.pow(2,r),r+=7}while(o>=iA);return kc.bytes=s-i,n}var rA=Math.pow(2,7),sA=Math.pow(2,14),oA=Math.pow(2,21),aA=Math.pow(2,28),cA=Math.pow(2,35),lA=Math.pow(2,42),uA=Math.pow(2,49),hA=Math.pow(2,56),dA=Math.pow(2,63),fA=function(t){return t<rA?1:t<sA?2:t<oA?3:t<aA?4:t<cA?5:t<lA?6:t<uA?7:t<hA?8:t<dA?9:10},pA={encode:XS,decode:nA,encodingLength:fA},lg=pA;const ug=(t,e,n=0)=>(lg.encode(t,e,n),e),hg=t=>lg.encodingLength(t),Nc=(t,e)=>{const n=e.byteLength,i=hg(t),r=i+hg(n),s=new Uint8Array(r+n);return ug(t,s,0),ug(n,s,i),s.set(e,r),new gA(t,n,e,s)};class gA{constructor(e,n,i,r){this.code=e,this.size=n,this.digest=i,this.bytes=r}}const dg=({name:t,code:e,encode:n})=>new yA(t,e,n);class yA{constructor(e,n,i){this.name=e,this.code=n,this.encode=i}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Nc(this.code,n):n.then(i=>Nc(this.code,i))}else throw Error("Unknown type, must be binary type")}}const fg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),wA=dg({name:"sha2-256",code:18,encode:fg("SHA-256")}),mA=dg({name:"sha2-512",code:19,encode:fg("SHA-512")});var bA=Object.freeze({__proto__:null,sha256:wA,sha512:mA});const pg=0,vA="identity",gg=ig;var EA=Object.freeze({__proto__:null,identity:{code:pg,name:vA,encode:gg,digest:t=>Nc(pg,gg(t))}});new TextEncoder,new TextDecoder;const yg={...yS,...mS,...vS,...xS,...AS,...NS,...US,...zS,...KS,...JS};({...bA,...EA});function wg(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function xA(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?wg(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function mg(t,e,n,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:i}}}const bg=mg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Rc=mg("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=xA(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),_A={utf8:bg,"utf-8":bg,hex:yg.base16,latin1:Rc,ascii:Rc,binary:Rc,...yg};function SA(t,e="utf8"){const n=_A[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wg(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var AA=Object.defineProperty,IA=(t,e,n)=>e in t?AA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,on=(t,e,n)=>IA(t,typeof e!="symbol"?e+"":e,n);class DA{constructor(e,n){this.core=e,this.logger=n,on(this,"keychain",new Map),on(this,"name",O_),on(this,"version",$_),on(this,"initialized",!1),on(this,"storagePrefix",rn),on(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),on(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),on(this,"set",async(i,r)=>{this.isInitialized(),this.keychain.set(i,r),await this.persist()}),on(this,"get",i=>{this.isInitialized();const r=this.keychain.get(i);if(typeof r>"u"){const{message:s}=te("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}),on(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=st(n,this.name)}get context(){return ut(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,za(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ja(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var CA=Object.defineProperty,OA=(t,e,n)=>e in t?CA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xe=(t,e,n)=>OA(t,typeof e!="symbol"?e+"":e,n);class $A{constructor(e,n,i){this.core=e,this.logger=n,Xe(this,"name",D_),Xe(this,"keychain"),Xe(this,"randomSessionIdentifier",bc()),Xe(this,"initialized",!1),Xe(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),Xe(this,"hasKeys",r=>(this.isInitialized(),this.keychain.has(r))),Xe(this,"getClientId",async()=>{this.isInitialized();const r=await this.getClientSeed(),s=Sh(r);return _h(s.publicKey)}),Xe(this,"generateKeyPair",()=>{this.isInitialized();const r=x5();return this.setPrivateKey(r.publicKey,r.privateKey)}),Xe(this,"signJWT",async r=>{this.isInitialized();const s=await this.getClientSeed(),o=Sh(s),a=this.randomSessionIdentifier;return await U2(a,r,C_,o)}),Xe(this,"generateSharedKey",(r,s,o)=>{this.isInitialized();const a=this.getPrivateKey(r),c=_5(a,s);return this.setSymKey(c,o)}),Xe(this,"setSymKey",async(r,s)=>{this.isInitialized();const o=s||to(r);return await this.keychain.set(o,r),o}),Xe(this,"deleteKeyPair",async r=>{this.isInitialized(),await this.keychain.del(r)}),Xe(this,"deleteSymKey",async r=>{this.isInitialized(),await this.keychain.del(r)}),Xe(this,"encode",async(r,s,o)=>{this.isInitialized();const a=Ep(o),c=ei(s);if(_p(a))return I5(c,o==null?void 0:o.encoding);if(xp(a)){const d=a.senderPublicKey,y=a.receiverPublicKey;r=await this.generateSharedKey(d,y)}const l=this.getSymKey(r),{type:u,senderPublicKey:h}=a;return S5({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),Xe(this,"decode",async(r,s,o)=>{this.isInitialized();const a=C5(s,o);if(_p(a)){const c=D5(s,o==null?void 0:o.encoding);return Oi(c)}if(xp(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;r=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(r),l=A5({symKey:c,encoded:s,encoding:o==null?void 0:o.encoding});return Oi(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${r}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),Xe(this,"getPayloadType",(r,s=Wt)=>{const o=Lr({encoded:r,encoding:s});return di(o.type)}),Xe(this,"getPayloadSenderPublicKey",(r,s=Wt)=>{const o=Lr({encoded:r,encoding:s});return o.senderPublicKey?pt(o.senderPublicKey,ct):void 0}),this.core=e,this.logger=st(n,this.name),this.keychain=i||new DA(this.core,this.logger)}get context(){return ut(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Zp)}catch{e=bc(),await this.keychain.set(Zp,e)}return SA(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var PA=Object.defineProperty,TA=Object.defineProperties,BA=Object.getOwnPropertyDescriptors,vg=Object.getOwnPropertySymbols,kA=Object.prototype.hasOwnProperty,NA=Object.prototype.propertyIsEnumerable,Lc=(t,e,n)=>e in t?PA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,RA=(t,e)=>{for(var n in e||(e={}))kA.call(e,n)&&Lc(t,n,e[n]);if(vg)for(var n of vg(e))NA.call(e,n)&&Lc(t,n,e[n]);return t},LA=(t,e)=>TA(t,BA(e)),At=(t,e,n)=>Lc(t,typeof e!="symbol"?e+"":e,n);class UA extends Uw{constructor(e,n){super(e,n),this.logger=e,this.core=n,At(this,"messages",new Map),At(this,"messagesWithoutClientAck",new Map),At(this,"name",P_),At(this,"version",T_),At(this,"initialized",!1),At(this,"storagePrefix",rn),At(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const r=await this.getRelayerMessagesWithoutClientAck();typeof r<"u"&&(this.messagesWithoutClientAck=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),At(this,"set",async(i,r,s)=>{this.isInitialized();const o=en(r);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=r,this.messages.set(i,a),s===oo.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,LA(RA({},c),{[o]:r}))}return await this.persist(),o}),At(this,"get",i=>{this.isInitialized();let r=this.messages.get(i);return typeof r>"u"&&(r={}),r}),At(this,"getWithoutAck",i=>{this.isInitialized();const r={};for(const s of i){const o=this.messagesWithoutClientAck.get(s)||{};r[s]=Object.values(o)}return r}),At(this,"has",(i,r)=>{this.isInitialized();const s=this.get(i),o=en(r);return typeof s[o]<"u"}),At(this,"ack",async(i,r)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;const o=en(r);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),At(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=st(e,this.name),this.core=n}get context(){return ut(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,za(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,za(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ja(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ja(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var FA=Object.defineProperty,MA=Object.defineProperties,zA=Object.getOwnPropertyDescriptors,Eg=Object.getOwnPropertySymbols,jA=Object.prototype.hasOwnProperty,qA=Object.prototype.propertyIsEnumerable,Uc=(t,e,n)=>e in t?FA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,co=(t,e)=>{for(var n in e||(e={}))jA.call(e,n)&&Uc(t,n,e[n]);if(Eg)for(var n of Eg(e))qA.call(e,n)&&Uc(t,n,e[n]);return t},Fc=(t,e)=>MA(t,zA(e)),Yt=(t,e,n)=>Uc(t,typeof e!="symbol"?e+"":e,n);class HA extends Fw{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Yt(this,"events",new jt.EventEmitter),Yt(this,"name",B_),Yt(this,"queue",new Map),Yt(this,"publishTimeout",ee.toMiliseconds(ee.ONE_MINUTE)),Yt(this,"initialPublishTimeout",ee.toMiliseconds(ee.ONE_SECOND*15)),Yt(this,"needsTransportRestart",!1),Yt(this,"publish",async(i,r,s)=>{var o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:r,opts:s}});const a=(s==null?void 0:s.ttl)||Jp,c=no(s),l=(s==null?void 0:s.prompt)||!1,u=(s==null?void 0:s.tag)||0,h=(s==null?void 0:s.id)||fi().toString(),d={topic:i,message:r,opts:{ttl:a,relay:c,prompt:l,tag:u,id:h,attestation:s==null?void 0:s.attestation,tvf:s==null?void 0:s.tvf}},y=`Failed to publish payload, please try again. id:${h} tag:${u}`;try{const f=new Promise(async g=>{const I=({id:B})=>{d.opts.id===B&&(this.removeRequestFromQueue(B),this.relayer.events.removeListener(He.publish,I),g(d))};this.relayer.events.on(He.publish,I);const O=Tn(new Promise((B,D)=>{this.rpcPublish({topic:i,message:r,ttl:a,prompt:l,tag:u,id:h,attestation:s==null?void 0:s.attestation,tvf:s==null?void 0:s.tvf}).then(B).catch(x=>{this.logger.warn(x,x==null?void 0:x.message),D(x)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${h} tag:${u}`);try{await O,this.events.removeListener(He.publish,I)}catch(B){this.queue.set(h,Fc(co({},d),{attempt:1})),this.logger.warn(B,B==null?void 0:B.message)}});this.logger.trace({type:"method",method:"publish",params:{id:h,topic:i,message:r,opts:s}}),await Tn(f,this.publishTimeout,y)}catch(f){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(f),(o=s==null?void 0:s.internal)!=null&&o.throwOnFailedPublish)throw f}finally{this.queue.delete(h)}}),Yt(this,"on",(i,r)=>{this.events.on(i,r)}),Yt(this,"once",(i,r)=>{this.events.once(i,r)}),Yt(this,"off",(i,r)=>{this.events.off(i,r)}),Yt(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),this.relayer=e,this.logger=st(n,this.name),this.registerEventListeners()}get context(){return ut(this.logger)}async rpcPublish(e){var n,i,r,s;const{topic:o,message:a,ttl:c=Jp,prompt:l,tag:u,id:h,attestation:d,tvf:y}=e,f={method:Ur(no().protocol).publish,params:co({topic:o,message:a,ttl:c,prompt:l,tag:u,attestation:d},y),id:h};Ze((n=f.params)==null?void 0:n.prompt)&&((i=f.params)==null||delete i.prompt),Ze((r=f.params)==null?void 0:r.tag)&&((s=f.params)==null||delete s.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:f});const g=await this.relayer.request(f);return this.relayer.events.emit(He.publish,e),this.logger.debug("Successfully Published Payload"),g}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{const i=e.attempt+1;this.queue.set(n,Fc(co({},e),{attempt:i}));const{topic:r,message:s,opts:o,attestation:a}=e;this.logger.warn({},`Publisher: queue->publishing: ${e.opts.id}, tag: ${e.opts.tag}, attempt: ${i}`),await this.rpcPublish(Fc(co({},e),{topic:r,message:s,ttl:o.ttl,prompt:o.prompt,tag:o.tag,id:o.id,attestation:a,tvf:o.tvf})),this.logger.warn({},`Publisher: queue->published: ${e.opts.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Jn.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(He.connection_stalled);return}this.checkQueue()}),this.relayer.on(He.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var VA=Object.defineProperty,KA=(t,e,n)=>e in t?VA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Gi=(t,e,n)=>KA(t,typeof e!="symbol"?e+"":e,n);class WA{constructor(){Gi(this,"map",new Map),Gi(this,"set",(e,n)=>{const i=this.get(e);this.exists(e,n)||this.map.set(e,[...i,n])}),Gi(this,"get",e=>this.map.get(e)||[]),Gi(this,"exists",(e,n)=>this.get(e).includes(n)),Gi(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,n))return;const r=i.filter(s=>s!==n);if(!r.length){this.map.delete(e);return}this.map.set(e,r)}),Gi(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var GA=Object.defineProperty,QA=Object.defineProperties,YA=Object.getOwnPropertyDescriptors,xg=Object.getOwnPropertySymbols,ZA=Object.prototype.hasOwnProperty,JA=Object.prototype.propertyIsEnumerable,Mc=(t,e,n)=>e in t?GA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wr=(t,e)=>{for(var n in e||(e={}))ZA.call(e,n)&&Mc(t,n,e[n]);if(xg)for(var n of xg(e))JA.call(e,n)&&Mc(t,n,e[n]);return t},zc=(t,e)=>QA(t,YA(e)),Ie=(t,e,n)=>Mc(t,typeof e!="symbol"?e+"":e,n);class XA extends jw{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,Ie(this,"subscriptions",new Map),Ie(this,"topicMap",new WA),Ie(this,"events",new jt.EventEmitter),Ie(this,"name",M_),Ie(this,"version",z_),Ie(this,"pending",new Map),Ie(this,"cached",[]),Ie(this,"initialized",!1),Ie(this,"storagePrefix",rn),Ie(this,"subscribeTimeout",ee.toMiliseconds(ee.ONE_MINUTE)),Ie(this,"initialSubscribeTimeout",ee.toMiliseconds(ee.ONE_SECOND*15)),Ie(this,"clientId"),Ie(this,"batchSubscribeTopicsLimit",500),Ie(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ie(this,"subscribe",async(i,r)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:r}});try{const s=no(r),o={topic:i,relay:s,transportType:r==null?void 0:r.transportType};this.pending.set(i,o);const a=await this.rpcSubscribe(i,s,r);return typeof a=="string"&&(this.onSubscribe(a,o),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:r}})),a}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}}),Ie(this,"unsubscribe",async(i,r)=>{this.isInitialized(),typeof(r==null?void 0:r.id)<"u"?await this.unsubscribeById(i,r.id,r):await this.unsubscribeByTopic(i,r)}),Ie(this,"isSubscribed",i=>new Promise(r=>{r(this.topicMap.topics.includes(i))})),Ie(this,"isKnownTopic",i=>new Promise(r=>{r(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),Ie(this,"on",(i,r)=>{this.events.on(i,r)}),Ie(this,"once",(i,r)=>{this.events.once(i,r)}),Ie(this,"off",(i,r)=>{this.events.off(i,r)}),Ie(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),Ie(this,"start",async()=>{await this.onConnect()}),Ie(this,"stop",async()=>{await this.onDisconnect()}),Ie(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ie(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}),Ie(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Jn.pulse,async()=>{await this.checkPending()}),this.events.on(St.created,async i=>{const r=St.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(St.deleted,async i=>{const r=St.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}),this.relayer=e,this.logger=st(n,this.name),this.clientId=""}get context(){return ut(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let i=!1;try{i=this.getSubscription(e).topic===n}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){const i=this.topicMap.get(e);await Promise.all(i.map(async r=>await this.unsubscribeById(e,r,n)))}async unsubscribeById(e,n,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:i}});try{const r=no(i);await this.restartToComplete({topic:e,id:n,relay:r}),await this.rpcUnsubscribe(e,n,r);const s=Te("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:i}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,n,i){var r;(!i||(i==null?void 0:i.transportType)===Oe.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});const s={method:Ur(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});const o=(r=i==null?void 0:i.internal)==null?void 0:r.throwOnFailedPublish;try{const a=await this.getSubscriptionId(e);if((i==null?void 0:i.transportType)===Oe.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(s).catch(u=>this.logger.warn(u))},ee.toMiliseconds(ee.ONE_SECOND)),a;const c=new Promise(async u=>{const h=d=>{d.topic===e&&(this.events.removeListener(St.created,h),u(d.id))};this.events.on(St.created,h);try{const d=await Tn(new Promise((y,f)=>{this.relayer.request(s).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),f(g)}).then(y)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(St.created,h),u(d)}catch{}}),l=await Tn(c,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&o)throw new Error(`Subscribing to ${e} failed, please try again`);return l?a:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(He.connection_stalled),o)throw a}return null}async rpcBatchSubscribe(e){if(!e.length)return;const n=e[0].relay,i={method:Ur(n.protocol).batchSubscribe,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Tn(new Promise(r=>{this.relayer.request(i).catch(s=>this.logger.warn(s)).then(r)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(He.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const n=e[0].relay,i={method:Ur(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let r;try{r=await await Tn(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(He.connection_stalled)}return r}rpcUnsubscribe(e,n,i){const r={method:Ur(i.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.request(r)}onSubscribe(e,n){this.setSubscription(e,zc(Wr({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,Wr({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,i){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,Wr({},n)),this.topicMap.set(n.topic,e),this.events.emit(St.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const n=this.subscriptions.get(e);if(!n){const{message:i}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(St.deleted,zc(Wr({},i),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(St.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<n;i++){const r=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(r)}}this.events.emit(St.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>zc(Wr({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await V3(ee.toMiliseconds(ee.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return en(e+await this.getClientId())}}var eI=Object.defineProperty,_g=Object.getOwnPropertySymbols,tI=Object.prototype.hasOwnProperty,nI=Object.prototype.propertyIsEnumerable,jc=(t,e,n)=>e in t?eI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sg=(t,e)=>{for(var n in e||(e={}))tI.call(e,n)&&jc(t,n,e[n]);if(_g)for(var n of _g(e))nI.call(e,n)&&jc(t,n,e[n]);return t},xe=(t,e,n)=>jc(t,typeof e!="symbol"?e+"":e,n);class iI extends Mw{constructor(e){super(e),xe(this,"protocol","wc"),xe(this,"version",2),xe(this,"core"),xe(this,"logger"),xe(this,"events",new jt.EventEmitter),xe(this,"provider"),xe(this,"messages"),xe(this,"subscriber"),xe(this,"publisher"),xe(this,"name",N_),xe(this,"transportExplicitlyClosed",!1),xe(this,"initialized",!1),xe(this,"connectionAttemptInProgress",!1),xe(this,"relayUrl"),xe(this,"projectId"),xe(this,"packageName"),xe(this,"bundleId"),xe(this,"hasExperiencedNetworkDisruption",!1),xe(this,"pingTimeout"),xe(this,"heartBeatTimeout",ee.toMiliseconds(ee.THIRTY_SECONDS+ee.FIVE_SECONDS)),xe(this,"reconnectTimeout"),xe(this,"connectPromise"),xe(this,"reconnectInProgress",!1),xe(this,"requestsInFlight",[]),xe(this,"connectTimeout",ee.toMiliseconds(ee.ONE_SECOND*15)),xe(this,"request",async n=>{var i,r;this.logger.debug("Publishing Request Payload");const s=n.id||fi().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:n.method,topic:(i=n.params)==null?void 0:i.topic},"relayer.request - publishing...");const o=`${s}:${((r=n.params)==null?void 0:r.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),xe(this,"resetPingTimeout",()=>{Us()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,i,r,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(r=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null?void 0:r.terminate)==null||s.call(r)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),xe(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),xe(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(He.connect)}),xe(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),xe(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(He.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),xe(this,"registerProviderListeners",()=>{this.provider.on(Nt.payload,this.onPayloadHandler),this.provider.on(Nt.connect,this.onConnectHandler),this.provider.on(Nt.disconnect,this.onDisconnectHandler),this.provider.on(Nt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?st(e.logger,this.name):hs(No({level:e.logger||k_})),this.messages=new UA(this.logger,e.core),this.subscriber=new XA(this,this.logger),this.publisher=new HA(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||eg,this.projectId=e.projectId,O3()?this.packageName=Yd():$3()&&(this.bundleId=Yd()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return ut(this.logger)}get connected(){var e,n,i;return((i=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,n,i;return((i=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,i){this.isInitialized(),await this.publisher.publish(e,n,i),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:Oe.relay},oo.outbound)}async subscribe(e,n){var i,r,s;this.isInitialized(),(!(n!=null&&n.transportType)||(n==null?void 0:n.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(r=n==null?void 0:n.internal)==null?void 0:r.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(St.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(St.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,Sg({internal:{throwOnFailedPublish:o}},n)).catch(d=>{o&&h(d)})||a,u()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Tn(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.warn("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,i)=>{await this.connect(e).then(n).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Lp())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=e.sort((i,r)=>i.publishedAt-r.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const i of n)try{await this.onMessageEvent(i)}catch(r){this.logger.warn(r,"Error while processing batch message event: "+(r==null?void 0:r.message))}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){const{topic:i}=e;if(!n.sessionExists){const r=Ue(ee.FIVE_MINUTES),s={topic:i,expiry:r,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit(He.message,e),await this.recordMessageEvent(e,oo.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(i,r)=>{const s=()=>{r(new Error("Connection interrupted while trying to connect"))};this.provider.once(Nt.disconnect,s),await Tn(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{r(o)}).finally(()=>{this.provider.off(Nt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{r(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(Nt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(Nt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const r=i;this.logger.warn({},r.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(i=>setTimeout(i,ee.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,i,r,s;if(Us())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(r=(i=this.provider)==null?void 0:i.connection)==null?void 0:r.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new v_(new S_(N3({sdkVersion:Bc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){const{topic:i,message:r}=e;await this.messages.set(i,r,n)}async shouldIgnoreMessageEvent(e){const{topic:n,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const r=this.messages.has(n,i);return r&&this.logger.warn(`Ignoring duplicate message: ${i}`),r}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Pc(e)){if(!e.method.endsWith(R_))return;const n=e.params,{topic:i,message:r,publishedAt:s,attestation:o}=n.data,a={topic:i,message:r,publishedAt:s,transportType:Oe.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Sg({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else so(e)&&this.events.emit(He.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,oo.inbound),this.events.emit(He.message,e))}async acknowledgePayload(e){const n=Oc(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(Nt.payload,this.onPayloadHandler),this.provider.off(Nt.connect,this.onConnectHandler),this.provider.off(Nt.disconnect,this.onDisconnectHandler),this.provider.off(Nt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Lp();x6(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Jn.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&A6())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n==null?void 0:n.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(He.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},ee.toMiliseconds(L_)))))}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function rI(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Ag(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Ig(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const sI="[object RegExp]",oI="[object String]",aI="[object Number]",cI="[object Boolean]",Dg="[object Arguments]",lI="[object Symbol]",uI="[object Date]",hI="[object Map]",dI="[object Set]",fI="[object Array]",pI="[object Function]",gI="[object ArrayBuffer]",qc="[object Object]",yI="[object Error]",wI="[object DataView]",mI="[object Uint8Array]",bI="[object Uint8ClampedArray]",vI="[object Uint16Array]",EI="[object Uint32Array]",xI="[object BigUint64Array]",_I="[object Int8Array]",SI="[object Int16Array]",AI="[object Int32Array]",II="[object BigInt64Array]",DI="[object Float32Array]",CI="[object Float64Array]";function OI(){}function Cg(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function $I(t,e,n){return Gr(t,e,void 0,void 0,void 0,void 0,n)}function Gr(t,e,n,i,r,s,o){const a=o(t,e,n,i,r,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Qr(t,e,s,o)}return Qr(t,e,s,o)}function Qr(t,e,n,i){if(Object.is(t,e))return!0;let r=Ig(t),s=Ig(e);if(r===Dg&&(r=qc),s===Dg&&(s=qc),r!==s)return!1;switch(r){case oI:return t.toString()===e.toString();case aI:{const c=t.valueOf(),l=e.valueOf();return rI(c,l)}case cI:case uI:case lI:return Object.is(t.valueOf(),e.valueOf());case sI:return t.source===e.source&&t.flags===e.flags;case pI:return t===e}n=n??new Map;const o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(r){case hI:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Gr(l,e.get(c),c,t,e,n,i))return!1;return!0}case dI:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],d=l.findIndex(y=>Gr(h,y,void 0,t,e,n,i));if(d===-1)return!1;l.splice(d,1)}return!0}case fI:case mI:case bI:case vI:case EI:case xI:case _I:case SI:case AI:case II:case DI:case CI:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Gr(t[c],e[c],c,t,e,n,i))return!1;return!0}case gI:return t.byteLength!==e.byteLength?!1:Qr(new Uint8Array(t),new Uint8Array(e),n,i);case wI:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Qr(new Uint8Array(t),new Uint8Array(e),n,i);case yI:return t.name===e.name&&t.message===e.message;case qc:{if(!(Qr(t.constructor,e.constructor,n,i)||Cg(t)&&Cg(e)))return!1;const c=[...Object.keys(t),...Ag(t)],l=[...Object.keys(e),...Ag(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;const y=e[h];if(!Gr(d,y,h,t,e,n,i))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function PI(t,e){return $I(t,e,OI)}var TI=Object.defineProperty,Og=Object.getOwnPropertySymbols,BI=Object.prototype.hasOwnProperty,kI=Object.prototype.propertyIsEnumerable,Hc=(t,e,n)=>e in t?TI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$g=(t,e)=>{for(var n in e||(e={}))BI.call(e,n)&&Hc(t,n,e[n]);if(Og)for(var n of Og(e))kI.call(e,n)&&Hc(t,n,e[n]);return t},bt=(t,e,n)=>Hc(t,typeof e!="symbol"?e+"":e,n);class mi extends zw{constructor(e,n,i,r=rn,s=void 0){super(e,n,i,r),this.core=e,this.logger=n,this.name=i,bt(this,"map",new Map),bt(this,"version",U_),bt(this,"cached",[]),bt(this,"initialized",!1),bt(this,"getKey"),bt(this,"storagePrefix",rn),bt(this,"recentlyDeleted",[]),bt(this,"recentlyDeletedLimit",200),bt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ze(o)?this.map.set(this.getKey(o),o):X5(o)?this.map.set(o.id,o):e6(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),bt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),bt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),bt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>PI(a[c],o[c]))):this.values)),bt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=$g($g({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),bt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=st(n,this.name),this.storagePrefix=r,this.getKey=s}get context(){return ut(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){const{message:r}=te("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}const{message:i}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var NI=Object.defineProperty,RI=(t,e,n)=>e in t?NI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,we=(t,e,n)=>RI(t,typeof e!="symbol"?e+"":e,n);class LI{constructor(e,n){this.core=e,this.logger=n,we(this,"name",j_),we(this,"version",q_),we(this,"events",new ru),we(this,"pairings"),we(this,"initialized",!1),we(this,"storagePrefix",rn),we(this,"ignoredPayloadTypes",[bn]),we(this,"registeredMethods",[]),we(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),we(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),we(this,"create",async i=>{this.isInitialized();const r=bc(),s=await this.core.crypto.setSymKey(r),o=Ue(ee.FIVE_MINUTES),a={protocol:Xp},c={topic:s,expiry:o,relay:a,active:!1,methods:i==null?void 0:i.methods},l=Ap({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:r,relay:a,expiryTimestamp:o,methods:i==null?void 0:i.methods});return this.events.emit(gi.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i==null?void 0:i.transportType}),{topic:s,uri:l}}),we(this,"pair",async i=>{this.isInitialized();const r=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[sn.pairing_started]}});this.isValidPair(i,r);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=Sp(i.uri);r.props.properties.topic=s,r.addTrace(sn.pairing_uri_validation_success),r.addTrace(sn.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),r.addTrace(sn.existing_pairing),u.active)throw r.setError(xn.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);r.addTrace(sn.pairing_not_expired)}const h=c||Ue(ee.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(s,h),await this.pairings.set(s,d),r.addTrace(sn.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(gi.create,d),r.addTrace(sn.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),r.addTrace(sn.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError(xn.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(y){throw r.setError(xn.subscribe_pairing_topic_failure),y}return r.addTrace(sn.subscribe_pairing_topic_success),d}),we(this,"activate",async({topic:i})=>{this.isInitialized();const r=Ue(ee.FIVE_MINUTES);this.core.expirer.set(i,r),await this.pairings.update(i,{active:!0,expiry:r})}),we(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:r}=i;if(this.pairings.keys.includes(r)){const s=await this.sendRequest(r,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=oi();this.events.once(_e("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),we(this,"updateExpiry",async({topic:i,expiry:r})=>{this.isInitialized(),await this.pairings.update(i,{expiry:r})}),we(this,"updateMetadata",async({topic:i,metadata:r})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:r})}),we(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),we(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:r}=i;this.pairings.keys.includes(r)&&(await this.sendRequest(r,"wc_pairingDelete",Te("USER_DISCONNECTED")),await this.deletePairing(r))}),we(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:r,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(r);return Ap({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),we(this,"sendRequest",async(i,r,s)=>{const o=pi(r,s),a=await this.core.crypto.encode(i,o),c=qr[r].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),we(this,"sendResult",async(i,r,s)=>{const o=Oc(i,s),a=await this.core.crypto.encode(r,o),c=(await this.core.history.get(r,i)).request.method,l=qr[c].res;await this.core.relayer.publish(r,a,l),await this.core.history.resolve(o)}),we(this,"sendError",async(i,r,s)=>{const o=$c(i,s),a=await this.core.crypto.encode(r,o),c=(await this.core.history.get(r,i)).request.method,l=qr[c]?qr[c].res:qr.unregistered_method.res;await this.core.relayer.publish(r,a,l),await this.core.history.resolve(o)}),we(this,"deletePairing",async(i,r)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Te("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),r?Promise.resolve():this.core.expirer.del(i)])}),we(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(r=>Bn(r.expiry));await Promise.all(i.map(r=>this.deletePairing(r.topic)))}),we(this,"onRelayEventRequest",async i=>{const{topic:r,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(r,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(r,s);default:return await this.onUnknownRpcMethodRequest(r,s)}}),we(this,"onRelayEventResponse",async i=>{const{topic:r,payload:s}=i,o=(await this.core.history.get(r,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(r,s);default:return this.onUnknownRpcMethodResponse(o)}}),we(this,"onPairingPingRequest",async(i,r)=>{const{id:s}=r;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(gi.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),we(this,"onPairingPingResponse",(i,r)=>{const{id:s}=r;setTimeout(()=>{nn(r)?this.events.emit(_e("pairing_ping",s),{}):kt(r)&&this.events.emit(_e("pairing_ping",s),{error:r.error})},500)}),we(this,"onPairingDeleteRequest",async(i,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(gi.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),we(this,"onUnknownRpcMethodRequest",async(i,r)=>{const{id:s,method:o}=r;try{if(this.registeredMethods.includes(o))return;const a=Te("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),we(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(Te("WC_METHOD_UNSUPPORTED",i))}),we(this,"isValidPair",(i,r)=>{var s;if(!mt(i)){const{message:a}=te("MISSING_OR_INVALID",`pair() params: ${i}`);throw r.setError(xn.malformed_pairing_uri),new Error(a)}if(!J5(i.uri)){const{message:a}=te("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw r.setError(xn.malformed_pairing_uri),new Error(a)}const o=Sp(i==null?void 0:i.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:a}=te("MISSING_OR_INVALID","pair() uri#relay-protocol");throw r.setError(xn.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=te("MISSING_OR_INVALID","pair() uri#symKey");throw r.setError(xn.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&ee.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){r.setError(xn.pairing_expired);const{message:a}=te("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),we(this,"isValidPing",async i=>{if(!mt(i)){const{message:s}=te("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:r}=i;await this.isValidPairingTopic(r)}),we(this,"isValidDisconnect",async i=>{if(!mt(i)){const{message:s}=te("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:r}=i;await this.isValidPairingTopic(r)}),we(this,"isValidPairingTopic",async i=>{if(!ke(i,!1)){const{message:r}=te("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.pairings.keys.includes(i)){const{message:r}=te("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(Bn(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:r}=te("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}),this.core=e,this.logger=st(n,this.name),this.pairings=new mi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ut(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(He.message,async e=>{const{topic:n,message:i,transportType:r}=e;if(this.pairings.keys.includes(n)&&r!==Oe.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const s=await this.core.crypto.decode(n,i);Pc(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):so(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Rt.expired,async e=>{const{topic:n}=ef(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(gi.expire,{topic:n}))})}}var UI=Object.defineProperty,FI=(t,e,n)=>e in t?UI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,et=(t,e,n)=>FI(t,typeof e!="symbol"?e+"":e,n);class MI extends Lw{constructor(e,n){super(e,n),this.core=e,this.logger=n,et(this,"records",new Map),et(this,"events",new jt.EventEmitter),et(this,"name",H_),et(this,"version",V_),et(this,"cached",[]),et(this,"initialized",!1),et(this,"storagePrefix",rn),et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),et(this,"set",(i,r,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:r,chainId:s}),this.records.has(r.id))return;const o={id:r.id,topic:i,request:{method:r.method,params:r.params||null},chainId:s,expiry:Ue(ee.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Gt.created,o)}),et(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const r=await this.getRecord(i.id);typeof r.response>"u"&&(r.response=kt(i)?{error:i.error}:{result:i.result},this.records.set(r.id,r),this.persist(),this.events.emit(Gt.updated,r))}),et(this,"get",async(i,r)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:r}),await this.getRecord(r))),et(this,"delete",(i,r)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:r}),this.values.forEach(s=>{if(s.topic===i){if(typeof r<"u"&&s.id!==r)return;this.records.delete(s.id),this.events.emit(Gt.deleted,s)}}),this.persist()}),et(this,"exists",async(i,r)=>(this.isInitialized(),this.records.has(r)?(await this.getRecord(r)).topic===i:!1)),et(this,"on",(i,r)=>{this.events.on(i,r)}),et(this,"once",(i,r)=>{this.events.once(i,r)}),et(this,"off",(i,r)=>{this.events.off(i,r)}),et(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),this.logger=st(n,this.name)}get context(){return ut(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const i={topic:n.topic,request:pi(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const n=this.records.get(e);if(!n){const{message:i}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Gt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Gt.created,e=>{const n=Gt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Gt.updated,e=>{const n=Gt.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(Gt.deleted,e=>{const n=Gt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(Jn.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{ee.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(Gt.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var zI=Object.defineProperty,jI=(t,e,n)=>e in t?zI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,rt=(t,e,n)=>jI(t,typeof e!="symbol"?e+"":e,n);class qI extends qw{constructor(e,n){super(e,n),this.core=e,this.logger=n,rt(this,"expirations",new Map),rt(this,"events",new jt.EventEmitter),rt(this,"name",K_),rt(this,"version",W_),rt(this,"cached",[]),rt(this,"initialized",!1),rt(this,"storagePrefix",rn),rt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),rt(this,"has",i=>{try{const r=this.formatTarget(i);return typeof this.getExpiration(r)<"u"}catch{return!1}}),rt(this,"set",(i,r)=>{this.isInitialized();const s=this.formatTarget(i),o={target:s,expiry:r};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Rt.created,{target:s,expiration:o})}),rt(this,"get",i=>{this.isInitialized();const r=this.formatTarget(i);return this.getExpiration(r)}),rt(this,"del",i=>{if(this.isInitialized(),this.has(i)){const r=this.formatTarget(i),s=this.getExpiration(r);this.expirations.delete(r),this.events.emit(Rt.deleted,{target:r,expiration:s})}}),rt(this,"on",(i,r)=>{this.events.on(i,r)}),rt(this,"once",(i,r)=>{this.events.once(i,r)}),rt(this,"off",(i,r)=>{this.events.off(i,r)}),rt(this,"removeListener",(i,r)=>{this.events.removeListener(i,r)}),this.logger=st(n,this.name)}get context(){return ut(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return R3(e);if(typeof e=="number")return L3(e);const{message:n}=te("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Rt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:n}=te("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const n=this.expirations.get(e);if(!n){const{message:i}=te("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return n}checkExpiry(e,n){const{expiry:i}=n;ee.toMiliseconds(i)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(Rt.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(Jn.pulse,()=>this.checkExpirations()),this.events.on(Rt.created,e=>{const n=Rt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Rt.expired,e=>{const n=Rt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(Rt.deleted,e=>{const n=Rt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}}var HI=Object.defineProperty,VI=(t,e,n)=>e in t?HI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ne=(t,e,n)=>VI(t,typeof e!="symbol"?e+"":e,n);class KI extends Hw{constructor(e,n,i){super(e,n,i),this.core=e,this.logger=n,this.store=i,Ne(this,"name",G_),Ne(this,"abortController"),Ne(this,"isDevEnv"),Ne(this,"verifyUrlV3",Y_),Ne(this,"storagePrefix",rn),Ne(this,"version",Yp),Ne(this,"publicKey"),Ne(this,"fetchPromise"),Ne(this,"init",async()=>{var r;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&ee.toMiliseconds((r=this.publicKey)==null?void 0:r.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ne(this,"register",async r=>{if(!Fi()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=r,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const l=un.getDocument(),u=this.startAbortTimer(ee.ONE_SECOND*5),h=await new Promise((d,y)=>{const f=()=>{window.removeEventListener("message",I),l.body.removeChild(g),y("attestation aborted")};this.abortController.signal.addEventListener("abort",f);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",f,{signal:this.abortController.signal});const I=O=>{if(O.data&&typeof O.data=="string")try{const B=JSON.parse(O.data);if(B.type==="verify_attestation"){if(na(B.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",f),window.removeEventListener("message",I),d(B.attestation===null?"":B.attestation)}}catch(B){this.logger.warn(B)}};l.body.appendChild(g),window.addEventListener("message",I,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),Ne(this,"resolve",async r=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=r;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(na(s).payload.id!==a)return;const l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(r==null?void 0:r.verifyUrl);return this.fetchAttestation(o,c)}),Ne(this,"fetchAttestation",async(r,s)=>{this.logger.debug(`resolving attestation: ${r} from url: ${s}`);const o=this.startAbortTimer(ee.ONE_SECOND*5),a=await fetch(`${s}/attestation/${r}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ne(this,"getVerifyUrl",r=>{let s=r||Hr;return Z_.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Hr}`),s=Hr),s}),Ne(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const r=this.startAbortTimer(ee.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(r),await s.json()}catch(r){this.logger.warn(r)}}),Ne(this,"persistPublicKey",async r=>{this.logger.debug("persisting public key to local storage",r),await this.store.setItem(this.storeKey,r),this.publicKey=r}),Ne(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ne(this,"isValidJwtAttestation",async r=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(r,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(r,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ne(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ne(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const r=await this.fetchPromise;return this.fetchPromise=void 0,r}),Ne(this,"validateAttestation",(r,s)=>{const o=$5(r,s.publicKey),a={hasExpired:ee.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=st(n,this.name),this.abortController=new AbortController,this.isDevEnv=qa(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ut(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ee.toMiliseconds(e))}}var WI=Object.defineProperty,GI=(t,e,n)=>e in t?WI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Pg=(t,e,n)=>GI(t,typeof e!="symbol"?e+"":e,n);class QI extends Vw{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,Pg(this,"context",J_),Pg(this,"registerDeviceToken",async i=>{const{clientId:r,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${X_}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:r,type:o,token:s,always_raw:a})})}),this.logger=st(n,this.context)}}var YI=Object.defineProperty,Tg=Object.getOwnPropertySymbols,ZI=Object.prototype.hasOwnProperty,JI=Object.prototype.propertyIsEnumerable,Vc=(t,e,n)=>e in t?YI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yr=(t,e)=>{for(var n in e||(e={}))ZI.call(e,n)&&Vc(t,n,e[n]);if(Tg)for(var n of Tg(e))JI.call(e,n)&&Vc(t,n,e[n]);return t},Ve=(t,e,n)=>Vc(t,typeof e!="symbol"?e+"":e,n);class XI extends Kw{constructor(e,n,i=!0){super(e,n,i),this.core=e,this.logger=n,Ve(this,"context",tS),Ve(this,"storagePrefix",rn),Ve(this,"storageVersion",eS),Ve(this,"events",new Map),Ve(this,"shouldPersist",!1),Ve(this,"init",async()=>{if(!qa())try{const r={eventId:nf(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Jd(this.core.relayer.protocol,this.core.relayer.version,Bc)}}};await this.sendEvent([r])}catch(r){this.logger.warn(r)}}),Ve(this,"createEvent",r=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=r,l=nf(),u=this.core.projectId||"",h=Date.now(),d=Yr({eventId:l,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),Ve(this,"getEvent",r=>{const{eventId:s,topic:o}=r;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Yr(Yr({},a),this.setMethods(a.eventId))}),Ve(this,"deleteEvent",r=>{const{eventId:s}=r;this.events.delete(s),this.shouldPersist=!0}),Ve(this,"setEventListeners",()=>{this.core.heartbeat.on(Jn.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(r=>{ee.fromMiliseconds(Date.now())-ee.fromMiliseconds(r.timestamp)>nS&&(this.events.delete(r.eventId),this.shouldPersist=!0)})})}),Ve(this,"setMethods",r=>({addTrace:s=>this.addTrace(r,s),setError:s=>this.setError(r,s)})),Ve(this,"addTrace",(r,s)=>{const o=this.events.get(r);o&&(o.props.properties.trace.push(s),this.events.set(r,o),this.shouldPersist=!0)}),Ve(this,"setError",(r,s)=>{const o=this.events.get(r);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(r,o),this.shouldPersist=!0)}),Ve(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ve(this,"restore",async()=>{try{const r=await this.core.storage.getItem(this.storageKey)||[];if(!r.length)return;r.forEach(s=>{this.events.set(s.eventId,Yr(Yr({},s),this.setMethods(s.eventId)))})}catch(r){this.logger.warn(r)}}),Ve(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const r=[];for(const[s,o]of this.events)o.props.type&&r.push(o);if(r.length!==0)try{if((await this.sendEvent(r)).ok)for(const s of r)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ve(this,"sendEvent",async r=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${iS}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Bc}${s}`,{method:"POST",body:JSON.stringify(r)})}),Ve(this,"getAppDomain",()=>Zd().url),this.logger=st(n,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var eD=Object.defineProperty,Bg=Object.getOwnPropertySymbols,tD=Object.prototype.hasOwnProperty,nD=Object.prototype.propertyIsEnumerable,Kc=(t,e,n)=>e in t?eD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,kg=(t,e)=>{for(var n in e||(e={}))tD.call(e,n)&&Kc(t,n,e[n]);if(Bg)for(var n of Bg(e))nD.call(e,n)&&Kc(t,n,e[n]);return t},Ce=(t,e,n)=>Kc(t,typeof e!="symbol"?e+"":e,n);class Wc extends Bw{constructor(e){var n;super(e),Ce(this,"protocol",Qp),Ce(this,"version",Yp),Ce(this,"name",Tc),Ce(this,"relayUrl"),Ce(this,"projectId"),Ce(this,"customStoragePrefix"),Ce(this,"events",new jt.EventEmitter),Ce(this,"logger"),Ce(this,"heartbeat"),Ce(this,"relayer"),Ce(this,"crypto"),Ce(this,"storage"),Ce(this,"history"),Ce(this,"expirer"),Ce(this,"pairing"),Ce(this,"verify"),Ce(this,"echoClient"),Ce(this,"linkModeSupportedApps"),Ce(this,"eventClient"),Ce(this,"initialized",!1),Ce(this,"logChunkController"),Ce(this,"on",(a,c)=>this.events.on(a,c)),Ce(this,"once",(a,c)=>this.events.once(a,c)),Ce(this,"off",(a,c)=>this.events.off(a,c)),Ce(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Ce(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Oe.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||eg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=No({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:A_.logger,name:Tc}),{logger:s,chunkLoggerController:o}=$w({opts:r,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=st(s,this.name),this.heartbeat=new P1,this.crypto=new $A(this,this.logger,e==null?void 0:e.keychain),this.history=new MI(this,this.logger),this.expirer=new qI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new fw(kg(kg({},I_),e==null?void 0:e.storageOptions)),this.relayer=new iI({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new LI(this,this.logger),this.verify=new KI(this,this.logger,this.storage),this.echoClient=new QI(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new XI(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const n=new Wc(e);await n.initialize();const i=await n.crypto.getClientId();return await n.storage.setItem(F_,i),n}get context(){return ut(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(tg,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(tg)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${e}`,i=`${n}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const iD=Wc,Ng="wc",Rg=2,Lg="client",Gc=`${Ng}@${Rg}:${Lg}:`,Qc={name:Lg,logger:"error"},Ug="WALLETCONNECT_DEEPLINK_CHOICE",rD="proposal",Fg="Proposal expired",sD="session",Qi=ee.SEVEN_DAYS,oD="engine",Ke={wc_sessionPropose:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ee.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ee.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ee.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ee.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ee.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ee.FIVE_MINUTES,prompt:!1,tag:1119}}},Yc={min:ee.FIVE_MINUTES,max:ee.SEVEN_DAYS},an={idle:"IDLE",active:"ACTIVE"},aD={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},cD="request",lD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],uD="wc",hD="auth",dD="authKeys",fD="pairingTopics",pD="requests",lo=`${uD}@${1.5}:${hD}:`,uo=`${lo}:PUB_KEY`;var gD=Object.defineProperty,yD=Object.defineProperties,wD=Object.getOwnPropertyDescriptors,Mg=Object.getOwnPropertySymbols,mD=Object.prototype.hasOwnProperty,bD=Object.prototype.propertyIsEnumerable,Zc=(t,e,n)=>e in t?gD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$e=(t,e)=>{for(var n in e||(e={}))mD.call(e,n)&&Zc(t,n,e[n]);if(Mg)for(var n of Mg(e))bD.call(e,n)&&Zc(t,n,e[n]);return t},vt=(t,e)=>yD(t,wD(e)),J=(t,e,n)=>Zc(t,typeof e!="symbol"?e+"":e,n);class vD extends Yw{constructor(e){super(e),J(this,"name",oD),J(this,"events",new ru),J(this,"initialized",!1),J(this,"requestQueue",{state:an.idle,queue:[]}),J(this,"sessionRequestQueue",{state:an.idle,queue:[]}),J(this,"requestQueueDelay",ee.ONE_SECOND),J(this,"expectedPairingMethodMap",new Map),J(this,"recentlyDeletedMap",new Map),J(this,"recentlyDeletedLimit",200),J(this,"relayMessageCache",[]),J(this,"pendingSessions",new Map),J(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ke)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ee.toMiliseconds(this.requestQueueDelay)))}),J(this,"connect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=vt($e({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=W5(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:r,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=i;let u=r,h,d=!1;try{if(u){const A=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=A.active}}catch(A){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),A}if(!u||!d){const{topic:A,uri:L}=await this.client.core.pairing.create();u=A,h=L}if(!u){const{message:A}=te("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(A)}const y=await this.client.core.crypto.generateKeyPair(),f=Ke.wc_sessionPropose.req.ttl||ee.FIVE_MINUTES,g=Ue(f),I=vt($e($e({requiredNamespaces:s,optionalNamespaces:o,relays:l??[{protocol:Xp}],proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:tn()}),O=_e("session_connect",I.id),{reject:B,resolve:D,done:x}=oi(f,Fg),v=({id:A})=>{A===I.id&&(this.client.events.off("proposal_expire",v),this.pendingSessions.delete(I.id),this.events.emit(O,{error:{message:Fg,code:0}}))};return this.client.events.on("proposal_expire",v),this.events.once(O,({error:A,session:L})=>{this.client.events.off("proposal_expire",v),A?B(A):L&&D(L)}),await this.sendRequest({topic:u,method:"wc_sessionPropose",params:I,throwOnFailedPublish:!0,clientRpcId:I.id}),await this.setProposal(I.id,I),{uri:h,approval:x}}),J(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(i){throw this.client.logger.error("pair() failed"),i}}),J(this,"approve",async n=>{var i,r,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=n==null?void 0:n.id)==null?void 0:i.toString(),trace:[Qt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(C){throw o.setError(yi.no_internet_connection),C}try{await this.isValidProposalId(n==null?void 0:n.id)}catch(C){throw this.client.logger.error(`approve() -> proposal.get(${n==null?void 0:n.id}) failed`),o.setError(yi.proposal_not_found),C}try{await this.isValidApprove(n)}catch(C){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(yi.session_approve_namespace_validation_failure),C}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=n,y=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:f,proposer:g,requiredNamespaces:I,optionalNamespaces:O}=y;let B=(r=this.client.core.eventClient)==null?void 0:r.getEvent({topic:f});B||(B=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:Qt.session_approve_started,properties:{topic:f,trace:[Qt.session_approve_started,Qt.session_namespaces_validation_success]}}));const D=await this.client.core.crypto.generateKeyPair(),x=g.publicKey,v=await this.client.core.crypto.generateSharedKey(D,x),A=$e($e($e({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:D,metadata:this.client.metadata},expiry:Ue(Qi)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),L=Oe.relay;B.addTrace(Qt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(v,{transportType:L})}catch(C){throw B.setError(yi.subscribe_session_topic_failure),C}B.addTrace(Qt.subscribe_session_topic_success);const M=vt($e({},A),{topic:v,requiredNamespaces:I,optionalNamespaces:O,pairingTopic:f,acknowledged:!1,self:A.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:D,transportType:Oe.relay});await this.client.session.set(v,M),B.addTrace(Qt.store_session);try{B.addTrace(Qt.publishing_session_settle),await this.sendRequest({topic:v,method:"wc_sessionSettle",params:A,throwOnFailedPublish:!0}).catch(C=>{throw B==null||B.setError(yi.session_settle_publish_failure),C}),B.addTrace(Qt.session_settle_publish_success),B.addTrace(Qt.publishing_session_approve),await this.sendResult({id:a,topic:f,result:{relay:{protocol:c??"irn"},responderPublicKey:D},throwOnFailedPublish:!0}).catch(C=>{throw B==null||B.setError(yi.session_approve_publish_failure),C}),B.addTrace(Qt.session_approve_publish_success)}catch(C){throw this.client.logger.error(C),this.client.session.delete(v,Te("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(v),C}return this.client.core.eventClient.deleteEvent({eventId:B.eventId}),await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:f}),await this.setExpiry(v,Ue(Qi)),{topic:v,acknowledged:()=>Promise.resolve(this.client.session.get(v))}}),J(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:r}=n;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&await this.sendError({id:i,topic:s,error:r,rpcOpts:Ke.wc_sessionPropose.reject}),await this.deleteProposal(i)}),J(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:r}=n,{done:s,resolve:o,reject:a}=oi(),c=tn(),l=fi().toString(),u=this.client.session.get(i).namespaces;return this.events.once(_e("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:r}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:u}),a(h)}),{acknowledged:s}}),J(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=n,r=tn(),{done:s,resolve:o,reject:a}=oi();return this.events.once(_e("session_extend",r),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,Ue(Qi)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),J(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(I){throw this.client.logger.error("request() -> isValidRequest() failed"),I}const{chainId:i,request:r,topic:s,expiry:o=Ke.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);(a==null?void 0:a.transportType)===Oe.relay&&await this.confirmOnlineStateOrThrow();const c=tn(),l=fi().toString(),{done:u,resolve:h,reject:d}=oi(o,"Request expired. Please try again.");this.events.once(_e("session_request",c),({error:I,result:O})=>{I?d(I):h(O)});const y="wc_sessionRequest",f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:y,params:{request:vt($e({},r),{expiryTimestamp:Ue(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:f}).catch(I=>d(I)),this.client.events.emit("session_request_sent",{topic:s,request:r,chainId:i,id:c}),await u();const g={request:vt($e({},r),{expiryTimestamp:Ue(o)}),chainId:i};return await Promise.all([new Promise(async I=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:y,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(O=>d(O)),this.client.events.emit("session_request_sent",{topic:s,request:r,chainId:i,id:c}),I()}),new Promise(async I=>{var O;if(!((O=a.sessionConfig)!=null&&O.disableDeepLink)){const B=await z3(this.client.core.storage,Ug);await U3({id:c,topic:s,wcDeepLink:B})}I()}),u()]).then(I=>I[2])}),J(this,"respond",async n=>{this.isInitialized(),await this.isValidRespond(n);const{topic:i,response:r}=n,{id:s}=r,o=this.client.session.get(i);o.transportType===Oe.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);nn(r)?await this.sendResult({id:s,topic:i,result:r.result,throwOnFailedPublish:!0,appLink:a}):kt(r)&&await this.sendError({id:s,topic:i,error:r.error,appLink:a}),this.cleanupAfterResponse(n)}),J(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(r){throw this.client.logger.error("ping() -> isValidPing() failed"),r}const{topic:i}=n;if(this.client.session.keys.includes(i)){const r=tn(),s=fi().toString(),{done:o,resolve:a,reject:c}=oi();this.events.once(_e("session_ping",r),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:r,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),J(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);const{topic:i,event:r,chainId:s}=n,o=fi().toString(),a=tn();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:r,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),J(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);const{topic:i}=n;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:Te("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:r}=te("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(r)}}),J(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(i=>Y5(i,n)))),J(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),J(this,"authenticate",async(n,i)=>{var r;this.isInitialized(),this.isValidAuthenticate(n);const s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((r=this.client.metadata.redirect)==null?void 0:r.linkMode),o=s?Oe.link_mode:Oe.relay;o===Oe.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:y,nbf:f,methods:g=[],expiry:I}=n,O=[...n.resources||[]],{topic:B,uri:D}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:B,uri:D}});const x=await this.client.core.crypto.generateKeyPair(),v=to(x);if(await Promise.all([this.client.auth.authKeys.set(uo,{responseTopic:v,publicKey:x}),this.client.auth.pairingTopics.set(v,{topic:v,pairingTopic:B})]),await this.client.core.relayer.subscribe(v,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${B}`),g.length>0){const{namespace:R}=Ls(a[0]);let U=n8(R,"request",g);qs(O)&&(U=r8(U,O.pop())),O.push(U)}const A=I&&I>Ke.wc_sessionAuthenticate.req.ttl?I:Ke.wc_sessionAuthenticate.req.ttl,L={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:y,nbf:f,resources:O},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Ue(A)},M={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},C={requiredNamespaces:{},optionalNamespaces:M,relays:[{protocol:"irn"}],pairingTopic:B,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Ue(Ke.wc_sessionPropose.req.ttl),id:tn()},{done:z,resolve:j,reject:q}=oi(A,"Request expired"),P=tn(),T=_e("session_connect",C.id),S=_e("session_request",P),m=async({error:R,session:U})=>{this.events.off(S,_),R?q(R):U&&j({session:U})},_=async R=>{var U,H,G;if(await this.deletePendingAuthRequest(P,{message:"fulfilled",code:0}),R.error){const le=Te("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return R.error.code===le.code?void 0:(this.events.off(T,m),q(R.error.message))}await this.deleteProposal(C.id),this.events.off(T,m);const{cacaos:Q,responder:Z}=R.result,X=[],re=[];for(const le of Q){await Df({cacao:le,projectId:this.client.core.projectId})||(this.client.logger.error(le,"Signature verification failed"),q(Te("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ae}=le,$=qs(ae.resources),p=[ec(ae.iss)],w=js(ae.iss);if($){const b=$f($),E=Pf($);X.push(...b),p.push(...E)}for(const b of p)re.push(`${b}:${w}`)}const ce=await this.client.core.crypto.generateSharedKey(x,Z.publicKey);let fe;X.length>0&&(fe={topic:ce,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:Z,controller:Z.publicKey,expiry:Ue(Qi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:B,namespaces:$p([...new Set(X)],[...new Set(re)]),transportType:o},await this.client.core.relayer.subscribe(ce,{transportType:o}),await this.client.session.set(ce,fe),B&&await this.client.core.pairing.updateMetadata({topic:B,metadata:Z.metadata}),fe=this.client.session.get(ce)),(U=this.client.metadata.redirect)!=null&&U.linkMode&&(H=Z.metadata.redirect)!=null&&H.linkMode&&(G=Z.metadata.redirect)!=null&&G.universal&&i&&(this.client.core.addLinkModeSupportedApp(Z.metadata.redirect.universal),this.client.session.update(ce,{transportType:Oe.link_mode})),j({auths:Q,session:fe})};this.events.once(T,m),this.events.once(S,_);let k;try{if(s){const R=pi("wc_sessionAuthenticate",L,P);this.client.core.history.set(B,R);const U=await this.client.core.crypto.encode("",R,{type:Nr,encoding:Vn});k=io(i,B,U)}else await Promise.all([this.sendRequest({topic:B,method:"wc_sessionAuthenticate",params:L,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:P}),this.sendRequest({topic:B,method:"wc_sessionPropose",params:C,expiry:Ke.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:C.id})])}catch(R){throw this.events.off(T,m),this.events.off(S,_),R}return await this.setProposal(C.id,C),await this.setAuthRequest(P,{request:vt($e({},L),{verifyContext:{}}),pairingTopic:B,transportType:o}),{uri:k??D,response:z}}),J(this,"approveSessionAuthenticate",async n=>{const{id:i,auths:r}=n,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[wi.authenticated_session_approve_started]}});try{this.isInitialized()}catch(I){throw s.setError(Vr.no_internet_connection),I}const o=this.getPendingAuthRequest(i);if(!o)throw s.setError(Vr.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||Oe.relay;a===Oe.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=to(c),h={type:bn,receiverPublicKey:c,senderPublicKey:l},d=[],y=[];for(const I of r){if(!await Df({cacao:I,projectId:this.client.core.projectId})){s.setError(Vr.invalid_cacao);const v=Te("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:u,error:v,encodeOpts:h}),new Error(v.message)}s.addTrace(wi.cacaos_verified);const{p:O}=I,B=qs(O.resources),D=[ec(O.iss)],x=js(O.iss);if(B){const v=$f(B),A=Pf(B);d.push(...v),D.push(...A)}for(const v of D)y.push(`${v}:${x}`)}const f=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(wi.create_authenticated_session_topic);let g;if((d==null?void 0:d.length)>0){g={topic:f,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ue(Qi),authentication:r,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:$p([...new Set(d)],[...new Set(y)]),transportType:a},s.addTrace(wi.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(f,{transportType:a})}catch(I){throw s.setError(Vr.subscribe_authenticated_session_topic_failure),I}s.addTrace(wi.subscribe_authenticated_session_topic_success),await this.client.session.set(f,g),s.addTrace(wi.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(wi.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:i,result:{cacaos:r,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(I){throw s.setError(Vr.authenticated_session_approve_publish_failure),I}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),J(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();const{id:i,reason:r}=n,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===Oe.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=to(o),l={type:bn,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:r,encodeOpts:l,rpcOpts:Ke.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),J(this,"formatAuthMessage",n=>{this.isInitialized();const{request:i,iss:r}=n;return Cf(i,r)}),J(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),J(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{const i=this.client.core.pairing.pairings.get(n.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(r.length===0)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),J(this,"deleteSession",async n=>{var i;const{topic:r,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,Te("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Ug).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===r&&this.deletePendingSessionRequest(l.id,Te("USER_DISCONNECTED"))}),r===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=an.idle),o&&this.client.events.emit("session_delete",{id:a,topic:r})}),J(this,"deleteProposal",async(n,i)=>{if(i)try{const r=this.client.proposal.get(n),s=this.client.core.eventClient.getEvent({topic:r.pairingTopic});s==null||s.setError(yi.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,Te("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),J(this,"deletePendingSessionRequest",async(n,i,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,i),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),r&&(this.sessionRequestQueue.state=an.idle,this.client.events.emit("session_request_expire",{id:n}))}),J(this,"deletePendingAuthRequest",async(n,i,r=!1)=>{await Promise.all([this.client.auth.requests.delete(n,i),r?Promise.resolve():this.client.core.expirer.del(n)])}),J(this,"setExpiry",async(n,i)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,i),await this.client.session.update(n,{expiry:i}))}),J(this,"setProposal",async(n,i)=>{this.client.core.expirer.set(n,Ue(Ke.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,i)}),J(this,"setAuthRequest",async(n,i)=>{const{request:r,pairingTopic:s,transportType:o=Oe.relay}=i;this.client.core.expirer.set(n,r.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:n,pairingTopic:s,verifyContext:r.verifyContext,transportType:o})}),J(this,"setPendingSessionRequest",async n=>{const{id:i,topic:r,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||Ue(Ke.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:r,params:s,verifyContext:o})}),J(this,"sendRequest",async n=>{const{topic:i,method:r,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h}=n,d=pi(r,s,c);let y;const f=!!u;try{const O=f?Vn:Wt;y=await this.client.core.crypto.encode(i,d,{encoding:O})}catch(O){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),O}let g;if(lD.includes(r)){const O=en(JSON.stringify(d)),B=en(y);g=await this.client.core.verify.register({id:B,decryptedId:O})}const I=Ke[r].req;if(I.attestation=g,o&&(I.ttl=o),a&&(I.id=a),this.client.core.history.set(i,d),f){const O=io(u,i,y);await global.Linking.openURL(O,this.client.name)}else{const O=Ke[r].req;o&&(O.ttl=o),a&&(O.id=a),O.tvf=vt($e({},h),{correlationId:d.id}),l?(O.internal=vt($e({},O.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,y,O)):this.client.core.relayer.publish(i,y,O).catch(B=>this.client.logger.error(B))}return d.id}),J(this,"sendResult",async n=>{const{id:i,topic:r,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,l=Oc(i,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const f=h?Vn:Wt;u=await this.client.core.crypto.encode(r,l,vt($e({},a||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${r} failed`),f}let d,y;try{d=await this.client.core.history.get(r,i);const f=d.request;try{y=this.getTVFParams(i,f.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(f){throw this.client.logger.error(`sendResult() -> history.get(${r}, ${i}) failed`),f}if(h){const f=io(c,r,u);await global.Linking.openURL(f,this.client.name)}else{const f=d.request.method,g=Ke[f].res;g.tvf=vt($e({},y),{correlationId:i}),o?(g.internal=vt($e({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,u,g)):this.client.core.relayer.publish(r,u,g).catch(I=>this.client.logger.error(I))}await this.client.core.history.resolve(l)}),J(this,"sendError",async n=>{const{id:i,topic:r,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,l=$c(i,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const y=h?Vn:Wt;u=await this.client.core.crypto.encode(r,l,vt($e({},o||{}),{encoding:y}))}catch(y){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${r} failed`),y}let d;try{d=await this.client.core.history.get(r,i)}catch(y){throw this.client.logger.error(`sendError() -> history.get(${r}, ${i}) failed`),y}if(h){const y=io(c,r,u);await global.Linking.openURL(y,this.client.name)}else{const y=d.request.method,f=a||Ke[y].res;this.client.core.relayer.publish(r,u,f)}await this.client.core.history.resolve(l)}),J(this,"cleanup",async()=>{const n=[],i=[];this.client.session.getAll().forEach(r=>{let s=!1;Bn(r.expiry)&&(s=!0),this.client.core.crypto.keychain.has(r.topic)||(s=!0),s&&n.push(r.topic)}),this.client.proposal.getAll().forEach(r=>{Bn(r.expiryTimestamp)&&i.push(r.id)}),await Promise.all([...n.map(r=>this.deleteSession({topic:r})),...i.map(r=>this.deleteProposal(r))])}),J(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),J(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),J(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===an.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=an.active;const n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=an.idle}),J(this,"processRequest",async n=>{const{topic:i,payload:r,attestation:s,transportType:o,encryptedId:a}=n,c=r.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:r,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,r);case"wc_sessionPing":return await this.onSessionPingRequest(i,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:r,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:r,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),J(this,"onRelayEventResponse",async n=>{const{topic:i,payload:r,transportType:s}=n,o=(await this.client.core.history.get(i,r.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,r,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,r);case"wc_sessionExtend":return this.onSessionExtendResponse(i,r);case"wc_sessionPing":return this.onSessionPingResponse(i,r);case"wc_sessionRequest":return this.onSessionRequestResponse(i,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,r);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),J(this,"onRelayEventUnknownPayload",n=>{const{topic:i}=n,{message:r}=te("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(r)}),J(this,"shouldIgnorePairingRequest",n=>{const{topic:i,requestMethod:r}=n,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(r)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),J(this,"onSessionProposeRequest",async n=>{const{topic:i,payload:r,attestation:s,encryptedId:o}=n,{params:a,id:c}=r;try{const l=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(xn.proposal_listener_not_found)),this.isValidConnect($e({},r.params));const u=a.expiryTimestamp||Ue(Ke.wc_sessionPropose.req.ttl),h=$e({id:c,pairingTopic:i,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const d=await this.getVerifyContext({attestationId:s,hash:en(JSON.stringify(r)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(sn.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){await this.sendError({id:c,topic:i,error:l,rpcOpts:Ke.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),J(this,"onSessionProposeResponse",async(n,i,r)=>{const{id:s}=i;if(nn(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:n,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:n})}else if(kt(i)){await this.deleteProposal(s);const o=_e("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),J(this,"onSessionSettleRequest",async(n,i)=>{const{id:r,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d}=i.params,y=[...this.pendingSessions.values()].find(I=>I.sessionTopic===n);if(!y)return this.client.logger.error(`Pending session not found for topic ${n}`);const f=this.client.proposal.get(y.proposalId),g=vt($e($e($e({topic:n,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:y.pairingTopic,requiredNamespaces:f.requiredNamespaces,optionalNamespaces:f.optionalNamespaces,controller:a.publicKey,self:{publicKey:y.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:Oe.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:y.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(_e("session_connect",y.proposalId),{session:g}),this.pendingSessions.delete(y.proposalId),this.deleteProposal(y.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:n,result:!0})}catch(o){await this.sendError({id:r,topic:n,error:o}),this.client.logger.error(o)}}),J(this,"onSessionSettleResponse",async(n,i)=>{const{id:r}=i;nn(i)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(_e("session_approve",r),{})):kt(i)&&(await this.client.session.delete(n,Te("USER_DISCONNECTED")),this.events.emit(_e("session_approve",r),{error:i.error}))}),J(this,"onSessionUpdateRequest",async(n,i)=>{const{params:r,id:s}=i;try{const o=`${n}_session_update`,a=Mr.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:Te("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate($e({topic:n},r));try{Mr.set(o,s),await this.client.session.update(n,{namespaces:r.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw Mr.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:r})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),J(this,"isRequestOutOfSync",(n,i)=>i.toString().slice(0,-3)<n.toString().slice(0,-3)),J(this,"onSessionUpdateResponse",(n,i)=>{const{id:r}=i,s=_e("session_update",r);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);nn(i)?this.events.emit(_e("session_update",r),{}):kt(i)&&this.events.emit(_e("session_update",r),{error:i.error})}),J(this,"onSessionExtendRequest",async(n,i)=>{const{id:r}=i;try{this.isValidExtend({topic:n}),await this.setExpiry(n,Ue(Qi)),await this.sendResult({id:r,topic:n,result:!0}),this.client.events.emit("session_extend",{id:r,topic:n})}catch(s){await this.sendError({id:r,topic:n,error:s}),this.client.logger.error(s)}}),J(this,"onSessionExtendResponse",(n,i)=>{const{id:r}=i,s=_e("session_extend",r);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);nn(i)?this.events.emit(_e("session_extend",r),{}):kt(i)&&this.events.emit(_e("session_extend",r),{error:i.error})}),J(this,"onSessionPingRequest",async(n,i)=>{const{id:r}=i;try{this.isValidPing({topic:n}),await this.sendResult({id:r,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:n})}catch(s){await this.sendError({id:r,topic:n,error:s}),this.client.logger.error(s)}}),J(this,"onSessionPingResponse",(n,i)=>{const{id:r}=i,s=_e("session_ping",r);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);nn(i)?this.events.emit(_e("session_ping",r),{}):kt(i)&&this.events.emit(_e("session_ping",r),{error:i.error})},500)}),J(this,"onSessionDeleteRequest",async(n,i)=>{const{id:r}=i;try{this.isValidDisconnect({topic:n,reason:i.params}),Promise.all([new Promise(s=>{this.client.core.relayer.once(He.publish,async()=>{s(await this.deleteSession({topic:n,id:r}))})}),this.sendResult({id:r,topic:n,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:n,error:Te("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),J(this,"onSessionRequest",async n=>{var i,r,s;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=n,{id:h,params:d}=a;try{await this.isValidRequest($e({topic:o},d));const y=this.client.session.get(o),f=await this.getVerifyContext({attestationId:c,hash:en(JSON.stringify(pi("wc_sessionRequest",d,h))),encryptedId:l,metadata:y.peer.metadata,transportType:u}),g={id:h,topic:o,params:d,verifyContext:f};await this.setPendingSessionRequest(g),u===Oe.link_mode&&(i=y.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((r=y.peer.metadata.redirect)==null?void 0:r.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(y){await this.sendError({id:h,topic:o,error:y}),this.client.logger.error(y)}}),J(this,"onSessionRequestResponse",(n,i)=>{const{id:r}=i,s=_e("session_request",r);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);nn(i)?this.events.emit(_e("session_request",r),{result:i.result}):kt(i)&&this.events.emit(_e("session_request",r),{error:i.error})}),J(this,"onSessionEventRequest",async(n,i)=>{const{id:r,params:s}=i;try{const o=`${n}_session_event_${s.event.name}`,a=Mr.get(o);if(a&&this.isRequestOutOfSync(a,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidEmit($e({topic:n},s)),this.client.events.emit("session_event",{id:r,topic:n,params:s}),Mr.set(o,r)}catch(o){await this.sendError({id:r,topic:n,error:o}),this.client.logger.error(o)}}),J(this,"onSessionAuthenticateResponse",(n,i)=>{const{id:r}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:i}),nn(i)?this.events.emit(_e("session_request",r),{result:i.result}):kt(i)&&this.events.emit(_e("session_request",r),{error:i.error})}),J(this,"onSessionAuthenticateRequest",async n=>{var i;const{topic:r,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{const{requester:l,authPayload:u,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:en(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),y={requester:l,pairingTopic:r,id:s.id,authPayload:u,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:y,pairingTopic:r,transportType:c}),c===Oe.link_mode&&(i=l.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:s.params,id:s.id,verifyContext:d})}catch(l){this.client.logger.error(l);const u=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),y={type:bn,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:s.id,topic:r,error:l,encodeOpts:y,rpcOpts:Ke.wc_sessionAuthenticate.autoReject,appLink:d})}}),J(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),J(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=an.idle,this.processSessionRequestQueue()},ee.toMiliseconds(this.requestQueueDelay))}),J(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:i})=>{const r=this.client.core.history.pending;r.length>0&&r.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{const o=s.request.id,a=_e("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(_e("session_request",s.request.id),{error:i})})}),J(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===an.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=an.active,this.emitSessionRequest(n)}catch(i){this.client.logger.error(i)}}),J(this,"emitSessionRequest",n=>{this.client.events.emit("session_request",n)}),J(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;const i=this.client.proposal.getAll().find(r=>r.pairingTopic===n.topic);i&&this.onSessionProposeRequest({topic:n.topic,payload:pi("wc_sessionPropose",vt($e({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),J(this,"isValidConnect",async n=>{if(!mt(n)){const{message:l}=te("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:r,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if(Ze(i)||await this.isValidPairingTopic(i),!c6(c)){const{message:l}=te("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!Ze(r)&&Fr(r)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(r,"requiredNamespaces")}if(!Ze(s)&&Fr(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),Ze(o)||this.validateSessionProps(o,"sessionProperties"),!Ze(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(r||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u)))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),J(this,"validateNamespaces",(n,i)=>{const r=a6(n,"connect()",i);if(r)throw new Error(r.message)}),J(this,"isValidApprove",async n=>{if(!mt(n))throw new Error(te("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:i,namespaces:r,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=Ec(r,"approve()");if(l)throw new Error(l.message);const u=Np(c.requiredNamespaces,r,"approve()");if(u)throw new Error(u.message);if(!ke(s,!0)){const{message:h}=te("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(Ze(o)||this.validateSessionProps(o,"sessionProperties"),!Ze(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(r));if(!Object.keys(a).every(d=>h.has(d)))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),J(this,"isValidReject",async n=>{if(!mt(n)){const{message:s}=te("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}const{id:i,reason:r}=n;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!u6(r)){const{message:s}=te("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw new Error(s)}}),J(this,"isValidSessionSettleRequest",n=>{if(!mt(n)){const{message:l}=te("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(l)}const{relay:i,controller:r,namespaces:s,expiry:o}=n;if(!Bp(i)){const{message:l}=te("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=t6(r,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Ec(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Bn(o)){const{message:l}=te("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),J(this,"isValidUpdate",async n=>{if(!mt(n)){const{message:c}=te("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}const{topic:i,namespaces:r}=n;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),o=Ec(r,"update()");if(o)throw new Error(o.message);const a=Np(s.requiredNamespaces,r,"update()");if(a)throw new Error(a.message)}),J(this,"isValidExtend",async n=>{if(!mt(n)){const{message:r}=te("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(r)}const{topic:i}=n;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),J(this,"isValidRequest",async n=>{if(!mt(n)){const{message:c}=te("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}const{topic:i,request:r,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!kp(a,s)){const{message:c}=te("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!h6(r)){const{message:c}=te("MISSING_OR_INVALID",`request() ${JSON.stringify(r)}`);throw new Error(c)}if(!p6(a,s,r.method)){const{message:c}=te("MISSING_OR_INVALID",`request() method: ${r.method}`);throw new Error(c)}if(o&&!m6(o,Yc)){const{message:c}=te("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Yc.min} and ${Yc.max}`);throw new Error(c)}}),J(this,"isValidRespond",async n=>{var i;if(!mt(n)){const{message:o}=te("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(o)}const{topic:r,response:s}=n;try{await this.isValidSessionTopic(r)}catch(o){throw(i=n==null?void 0:n.response)!=null&&i.id&&this.cleanupAfterResponse(n),o}if(!d6(s)){const{message:o}=te("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),J(this,"isValidPing",async n=>{if(!mt(n)){const{message:r}=te("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(r)}const{topic:i}=n;await this.isValidSessionOrPairingTopic(i)}),J(this,"isValidEmit",async n=>{if(!mt(n)){const{message:a}=te("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}const{topic:i,event:r,chainId:s}=n;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!kp(o,s)){const{message:a}=te("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!f6(r)){const{message:a}=te("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}if(!g6(o,s,r.name)){const{message:a}=te("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(r)}`);throw new Error(a)}}),J(this,"isValidDisconnect",async n=>{if(!mt(n)){const{message:r}=te("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(r)}const{topic:i}=n;await this.isValidSessionOrPairingTopic(i)}),J(this,"isValidAuthenticate",n=>{const{chains:i,uri:r,domain:s,nonce:o}=n;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!ke(r,!1))throw new Error("uri is required parameter");if(!ke(s,!1))throw new Error("domain is required parameter");if(!ke(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Ls(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Ls(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),J(this,"getVerifyContext",async n=>{const{attestationId:i,hash:r,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||Hr,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Oe.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:i,hash:r,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),J(this,"validateSessionProps",(n,i)=>{Object.values(n).forEach((r,s)=>{if(r==null){const{message:o}=te("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${r} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),J(this,"getPendingAuthRequest",n=>{const i=this.client.auth.requests.get(n);return typeof i=="object"?i:void 0}),J(this,"addToRecentlyDeleted",(n,i)=>{if(this.recentlyDeletedMap.set(n,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let r=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(r++>=s)break;this.recentlyDeletedMap.delete(o)}}}),J(this,"checkRecentlyDeleted",n=>{const i=this.recentlyDeletedMap.get(n);if(i){const{message:r}=te("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${n}`);throw new Error(r)}}),J(this,"isLinkModeEnabled",(n,i)=>{var r,s,o,a,c,l,u,h,d;return!n||i!==Oe.link_mode?!1:((s=(r=this.client.metadata)==null?void 0:r.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=n==null?void 0:n.redirect)==null?void 0:u.universal)!==void 0&&((h=n==null?void 0:n.redirect)==null?void 0:h.universal)!==""&&((d=n==null?void 0:n.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),J(this,"getAppLinkIfEnabled",(n,i)=>{var r;return this.isLinkModeEnabled(n,i)?(r=n==null?void 0:n.redirect)==null?void 0:r.universal:void 0}),J(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;const i=tf(n,"topic")||"",r=decodeURIComponent(tf(n,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:Oe.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:r,sessionExists:s})}),J(this,"registerLinkModeListeners",async()=>{var n;if(qa()||Pn()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){const i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const r=await i.getInitialURL();r&&setTimeout(()=>{this.handleLinkModeMessage({url:r})},50)}}}),J(this,"getTVFParams",(n,i,r)=>{var s,o,a;if(!((s=i.request)!=null&&s.method))return{};const c={correlationId:n,rpcMethods:[i.request.method],chainId:i.chainId};try{const l=this.extractTxHashesFromResult(i.request,r);c.txHashes=l,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),J(this,"isValidContractData",n=>{var i;if(!n)return!1;try{const r=(n==null?void 0:n.data)||((i=n==null?void 0:n[0])==null?void 0:i.data);if(!r.startsWith("0x"))return!1;const s=r.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),J(this,"extractTxHashesFromResult",(n,i)=>{var r;try{if(!i)return[];const s=n.method,o=aD[s];if(s==="sui_signTransaction")return[M4(i.transactionBytes)];if(s==="near_signTransaction")return[_f(i)];if(s==="near_signTransactions")return i.map(c=>_f(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(r=i.tx_json)==null?void 0:r.hash];if(s==="polkadot_signTransaction")return[B6({transaction:n.params.transactionPayload,signature:i.signature})];if(s==="algo_signTxn")return Wi(i)?i.map(c=>Sf(c)):[Sf(i)];if(s==="cosmos_signDirect")return[j4(i)];if(typeof i=="string")return[i];const a=i[o.key];if(Wi(a))return s==="solana_signAllTransactions"?a.map(c=>F4(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,r]of Object.entries(n))for(const s of r)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=te("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(He.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:n,message:i,attestation:r,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(uo)?this.client.auth.authKeys.get(uo):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(n,i,{receiverPublicKey:o,encoding:s===Oe.link_mode?Vn:Wt});Pc(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:r,transportType:s,encryptedId:en(i)})):so(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(n,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Rt.expired,async e=>{const{topic:n,id:i}=ef(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,te("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,te("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(gi.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(gi.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ke(e,!1)){const{message:n}=te("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:n}=te("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(Bn(this.client.core.pairing.pairings.get(e).expiry)){const{message:n}=te("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!ke(e,!1)){const{message:n}=te("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:n}=te("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(Bn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:n}=te("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){const{message:n}=te("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ke(e,!1)){const{message:n}=te("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{const{message:n}=te("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!l6(e)){const{message:n}=te("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){const{message:n}=te("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(Bn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:n}=te("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}}class ED extends mi{constructor(e,n){super(e,n,rD,Gc),this.core=e,this.logger=n}}class xD extends mi{constructor(e,n){super(e,n,sD,Gc),this.core=e,this.logger=n}}class _D extends mi{constructor(e,n){super(e,n,cD,Gc,i=>i.id),this.core=e,this.logger=n}}class SD extends mi{constructor(e,n){super(e,n,dD,lo,()=>uo),this.core=e,this.logger=n}}class AD extends mi{constructor(e,n){super(e,n,fD,lo),this.core=e,this.logger=n}}class ID extends mi{constructor(e,n){super(e,n,pD,lo,i=>i.id),this.core=e,this.logger=n}}var DD=Object.defineProperty,CD=(t,e,n)=>e in t?DD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Jc=(t,e,n)=>CD(t,typeof e!="symbol"?e+"":e,n);class OD{constructor(e,n){this.core=e,this.logger=n,Jc(this,"authKeys"),Jc(this,"pairingTopics"),Jc(this,"requests"),this.authKeys=new SD(this.core,this.logger),this.pairingTopics=new AD(this.core,this.logger),this.requests=new ID(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var $D=Object.defineProperty,PD=(t,e,n)=>e in t?$D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,me=(t,e,n)=>PD(t,typeof e!="symbol"?e+"":e,n);class Xc extends Qw{constructor(e){super(e),me(this,"protocol",Ng),me(this,"version",Rg),me(this,"name",Qc.name),me(this,"metadata"),me(this,"core"),me(this,"logger"),me(this,"events",new jt.EventEmitter),me(this,"engine"),me(this,"session"),me(this,"proposal"),me(this,"pendingRequest"),me(this,"auth"),me(this,"signConfig"),me(this,"on",(i,r)=>this.events.on(i,r)),me(this,"once",(i,r)=>this.events.once(i,r)),me(this,"off",(i,r)=>this.events.off(i,r)),me(this,"removeListener",(i,r)=>this.events.removeListener(i,r)),me(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),me(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"update",async i=>{try{return await this.engine.update(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"request",async i=>{try{return await this.engine.request(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"find",i=>{try{return this.engine.find(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),me(this,"authenticate",async(i,r)=>{try{return await this.engine.authenticate(i,r)}catch(s){throw this.logger.error(s.message),s}}),me(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(r){throw this.logger.error(r.message),r}}),this.name=(e==null?void 0:e.name)||Qc.name,this.metadata=T3(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const n=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:hs(No({level:(e==null?void 0:e.logger)||Qc.logger}));this.core=(e==null?void 0:e.core)||new iD(e),this.logger=st(n,this.name),this.session=new xD(this.core,this.logger),this.proposal=new ED(this.core,this.logger),this.pendingRequest=new _D(this.core,this.logger),this.engine=new vD(this),this.auth=new OD(this.core,this.logger)}static async init(e){const n=new Xc(e);return await n.initialize(),n}get context(){return ut(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success"),setTimeout(()=>{this.engine.processRelayMessageCache()},ee.toMiliseconds(ee.ONE_SECOND))}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const TD=Xc;class BD{constructor({shadow:e}){this.shadow=e}get currentSession(){return this.session}set currentSession(e){this.session=e}restoreLastSession(){if(!this.client)throw new Error("wallet connect client not initialized");console.log("all sessions",this.client.session.getAll());const e=this.client.session.getAll().pop();return console.log("lastSession",e),e}findSession(e){if(!this.client)throw new Error("wallet connect client not initialized");return console.log("walletConnect findSession, all sessions:",this.client.session.getAll()),this.client.session.getAll().find(n=>n.peer.metadata.name===e.wcPeerName)}async init(){this.client=await TD.init({projectId:E0}),this.session=this.restoreLastSession(),this.client.on("session_event",e=>{console.log("session event",e)}),this.client.on("session_update",({topic:e,params:n})=>{var o;const{namespaces:i}=n,s={...(o=this.client)==null?void 0:o.session.get(e),namespaces:i};console.log("session updated:",s)}),this.client.on("session_delete",e=>{console.log("session deleted:",e)})}async connectWalletWithQrCode(){if(!this.client)throw new Error("wallet connect client not initialized");const{uri:e,approval:n}=await this.client.connect({requiredNamespaces:{eip155:{methods:["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData"],chains:["eip155:1"],events:["chainChanged","accountsChanged"]}}});return console.log("Connect with URI:",e),{uri:e,approval:n}}async sendEthTransaction(e,n){if(!this.client)throw new Error("wallet connect client not initialized");if(n=n||this.session,!n)throw new Error("wallet connect session not initialized");console.log("sending eth_sendTransaction request");const i=await this.client.request({chainId:"eip155:1",topic:n.topic,request:{method:"eth_sendTransaction",params:[e]}});return console.log("result:",i),i}getSessionAddress(e,n){var i;return(i=e.namespaces.eip155.accounts.find(r=>r.startsWith(n)))==null?void 0:i.split(":").pop()}}function kD(t){var e;return(e=t.split("?").pop())==null?void 0:e.split("&").reduce((n,i)=>{const[r,s]=i.split("=");return n[r]=s,n},{})}function ND(t){return t.length===0?t:t.charAt(0).toUpperCase()+t.slice(1)}function el(t,{includeName:e=!1}={}){if(t.type!=="function"&&t.type!=="event"&&t.type!=="error")throw new qD(t.type);return`${t.name}(${zg(t.inputs,{includeName:e})})`}function zg(t,{includeName:e=!1}={}){return t?t.map(n=>RD(n,{includeName:e})).join(e?", ":","):""}function RD(t,{includeName:e}){return t.type.startsWith("tuple")?`(${zg(t.components,{includeName:e})})${t.type.slice(5)}`:t.type+(e&&t.name?` ${t.name}`:"")}function Zr(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Lt(t){return Zr(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const jg="2.31.3";let Jr={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${jg}`};class Me extends Error{constructor(e,n={}){var a;const i=(()=>{var c;return n.cause instanceof Me?n.cause.details:(c=n.cause)!=null&&c.message?n.cause.message:n.details})(),r=n.cause instanceof Me&&n.cause.docsPath||n.docsPath,s=(a=Jr.getDocsUrl)==null?void 0:a.call(Jr,{...n,docsPath:r}),o=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...i?[`Details: ${i}`]:[],...Jr.version?[`Version: ${Jr.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=i,this.docsPath=r,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=jg}walk(e){return qg(this,e)}}function qg(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?qg(t.cause,e):e?null:t}class LD extends Me{constructor({expectedLength:e,givenLength:n,type:i}){super([`ABI encoding array length mismatch for type ${i}.`,`Expected length: ${e}`,`Given length: ${n}`].join(`
`),{name:"AbiEncodingArrayLengthMismatchError"})}}class UD extends Me{constructor({expectedSize:e,value:n}){super(`Size of bytes "${n}" (bytes${Lt(n)}) does not match expected size (bytes${e}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class FD extends Me{constructor({expectedLength:e,givenLength:n}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${e}`,`Given length (values): ${n}`].join(`
`),{name:"AbiEncodingLengthMismatchError"})}}class Hg extends Me{constructor(e,{docsPath:n}={}){super([`Function ${e?`"${e}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join(`
`),{docsPath:n,name:"AbiFunctionNotFoundError"})}}class MD extends Me{constructor(e,n){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${e.type}\` in \`${el(e.abiItem)}\`, and`,`\`${n.type}\` in \`${el(n.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class zD extends Me{constructor(e,{docsPath:n}){super([`Type "${e}" is not a valid encoding type.`,"Please provide a valid ABI type."].join(`
`),{docsPath:n,name:"InvalidAbiEncodingType"})}}class jD extends Me{constructor(e){super([`Value "${e}" is not a valid array.`].join(`
`),{name:"InvalidArrayError"})}}class qD extends Me{constructor(e){super([`"${e}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join(`
`),{name:"InvalidDefinitionTypeError"})}}class Vg extends Me{constructor({offset:e,position:n,size:i}){super(`Slice ${n==="start"?"starting":"ending"} at offset "${e}" is out-of-bounds (size: ${i}).`,{name:"SliceOffsetOutOfBoundsError"})}}class Kg extends Me{constructor({size:e,targetSize:n,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}}function Yi(t,{dir:e,size:n=32}={}){return typeof t=="string"?Kn(t,{dir:e,size:n}):HD(t,{dir:e,size:n})}function Kn(t,{dir:e,size:n=32}={}){if(n===null)return t;const i=t.replace("0x","");if(i.length>n*2)throw new Kg({size:Math.ceil(i.length/2),targetSize:n,type:"hex"});return`0x${i[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function HD(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new Kg({size:t.length,targetSize:n,type:"bytes"});const i=new Uint8Array(n);for(let r=0;r<n;r++){const s=e==="right";i[s?r:n-r-1]=t[s?r:t.length-r-1]}return i}class Wg extends Me{constructor({max:e,min:n,signed:i,size:r,value:s}){super(`Number "${s}" is not in safe ${r?`${r*8}-bit ${i?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}}class VD extends Me{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Xr(t,{size:e}){if(Lt(t)>e)throw new VD({givenSize:Lt(t),maxSize:e})}const KD=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function WD(t,e={}){return typeof t=="number"||typeof t=="bigint"?bi(t,e):typeof t=="string"?Yg(t,e):typeof t=="boolean"?Gg(t,e):Qg(t,e)}function Gg(t,e={}){const n=`0x${Number(t)}`;return typeof e.size=="number"?(Xr(n,{size:e.size}),Yi(n,{size:e.size})):n}function Qg(t,e={}){let n="";for(let r=0;r<t.length;r++)n+=KD[t[r]];const i=`0x${n}`;return typeof e.size=="number"?(Xr(i,{size:e.size}),Yi(i,{dir:"right",size:e.size})):i}function bi(t,e={}){const{signed:n,size:i}=e,r=BigInt(t);let s;i?n?s=(1n<<BigInt(i)*8n-1n)-1n:s=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&r>s||r<o){const c=typeof t=="bigint"?"n":"";throw new Wg({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:n,size:i,value:`${t}${c}`})}const a=`0x${(n&&r<0?(1n<<BigInt(i*8))+BigInt(r):r).toString(16)}`;return i?Yi(a,{size:i}):a}const GD=new TextEncoder;function Yg(t,e={}){const n=GD.encode(t);return Qg(n,e)}const QD=new TextEncoder;function Zg(t,e={}){return typeof t=="number"||typeof t=="bigint"?ZD(t,e):typeof t=="boolean"?YD(t,e):Zr(t)?Xg(t,e):e0(t,e)}function YD(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(Xr(n,{size:e.size}),Yi(n,{size:e.size})):n}const _n={zero:48,nine:57,A:65,F:70,a:97,f:102};function Jg(t){if(t>=_n.zero&&t<=_n.nine)return t-_n.zero;if(t>=_n.A&&t<=_n.F)return t-(_n.A-10);if(t>=_n.a&&t<=_n.f)return t-(_n.a-10)}function Xg(t,e={}){let n=t;e.size&&(Xr(n,{size:e.size}),n=Yi(n,{dir:"right",size:e.size}));let i=n.slice(2);i.length%2&&(i=`0${i}`);const r=i.length/2,s=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const c=Jg(i.charCodeAt(a++)),l=Jg(i.charCodeAt(a++));if(c===void 0||l===void 0)throw new Me(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);s[o]=c*16+l}return s}function ZD(t,e){const n=bi(t,e);return Xg(n)}function e0(t,e={}){const n=QD.encode(t);return typeof e.size=="number"?(Xr(n,{size:e.size}),Yi(n,{dir:"right",size:e.size})):n}function t0(t,e){const n=e||"hex",i=Yh(Zr(t,{strict:!1})?Zg(t):t);return n==="bytes"?i:WD(i)}const JD=t=>t0(Zg(t));function XD(t){return JD(t)}function eC(t){let e=!0,n="",i=0,r="",s=!1;for(let o=0;o<t.length;o++){const a=t[o];if(["(",")",","].includes(a)&&(e=!0),a==="("&&i++,a===")"&&i--,!!e){if(i===0){if(a===" "&&["event","function",""].includes(r))r="";else if(r+=a,a===")"){s=!0;break}continue}if(a===" "){t[o-1]!==","&&n!==","&&n!==",("&&(n="",e=!1);continue}r+=a,n+=a}}if(!s)throw new Me("Unable to normalize signature.");return r}const tC=t=>{const e=typeof t=="string"?t:nv(t);return eC(e)};function n0(t){return XD(tC(t))}const nC=n0;class iC extends Me{constructor({address:e}){super(`Address "${e}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class i0 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const tl=new i0(8192);function rC(t,e){if(tl.has(`${t}.${e}`))return tl.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),i=t0(e0(n),"bytes"),r=n.split("");for(let o=0;o<40;o+=2)i[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(i[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const s=`0x${r.join("")}`;return tl.set(`${t}.${e}`,s),s}const sC=/^0x[a-fA-F0-9]{40}$/,nl=new i0(8192);function ho(t,e){const{strict:n=!0}=e??{},i=`${t}.${n}`;if(nl.has(i))return nl.get(i);const r=sC.test(t)?t.toLowerCase()===t?!0:n?rC(t)===t:!0:!1;return nl.set(i,r),r}function Zi(t){return typeof t[0]=="string"?r0(t):oC(t)}function oC(t){let e=0;for(const r of t)e+=r.length;const n=new Uint8Array(e);let i=0;for(const r of t)n.set(r,i),i+=r.length;return n}function r0(t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function s0(t,e,n,{strict:i}={}){return Zr(t,{strict:!1})?cC(t,e,n,{strict:i}):aC(t,e,n,{strict:i})}function o0(t,e){if(typeof e=="number"&&e>0&&e>Lt(t)-1)throw new Vg({offset:e,position:"start",size:Lt(t)})}function a0(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Lt(t)!==n-e)throw new Vg({offset:n,position:"end",size:Lt(t)})}function aC(t,e,n,{strict:i}={}){o0(t,e);const r=t.slice(e,n);return i&&a0(r,e,n),r}function cC(t,e,n,{strict:i}={}){o0(t,e);const r=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return i&&a0(r,e,n),r}const lC=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function uC(t,e){if(t.length!==e.length)throw new FD({expectedLength:t.length,givenLength:e.length});const n=hC({params:t,values:e}),i=rl(n);return i.length===0?"0x":i}function hC({params:t,values:e}){const n=[];for(let i=0;i<t.length;i++)n.push(il({param:t[i],value:e[i]}));return n}function il({param:t,value:e}){const n=bC(t.type);if(n){const[i,r]=n;return fC(e,{length:i,param:{...t,type:r}})}if(t.type==="tuple")return mC(e,{param:t});if(t.type==="address")return dC(e);if(t.type==="bool")return gC(e);if(t.type.startsWith("uint")||t.type.startsWith("int")){const i=t.type.startsWith("int"),[,,r="256"]=lC.exec(t.type)??[];return yC(e,{signed:i,size:Number(r)})}if(t.type.startsWith("bytes"))return pC(e,{param:t});if(t.type==="string")return wC(e);throw new zD(t.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function rl(t){let e=0;for(let s=0;s<t.length;s++){const{dynamic:o,encoded:a}=t[s];o?e+=32:e+=Lt(a)}const n=[],i=[];let r=0;for(let s=0;s<t.length;s++){const{dynamic:o,encoded:a}=t[s];o?(n.push(bi(e+r,{size:32})),i.push(a),r+=Lt(a)):n.push(a)}return Zi([...n,...i])}function dC(t){if(!ho(t))throw new iC({address:t});return{dynamic:!1,encoded:Kn(t.toLowerCase())}}function fC(t,{length:e,param:n}){const i=e===null;if(!Array.isArray(t))throw new jD(t);if(!i&&t.length!==e)throw new LD({expectedLength:e,givenLength:t.length,type:`${n.type}[${e}]`});let r=!1;const s=[];for(let o=0;o<t.length;o++){const a=il({param:n,value:t[o]});a.dynamic&&(r=!0),s.push(a)}if(i||r){const o=rl(s);if(i){const a=bi(s.length,{size:32});return{dynamic:!0,encoded:s.length>0?Zi([a,o]):a}}if(r)return{dynamic:!0,encoded:o}}return{dynamic:!1,encoded:Zi(s.map(({encoded:o})=>o))}}function pC(t,{param:e}){const[,n]=e.type.split("bytes"),i=Lt(t);if(!n){let r=t;return i%32!==0&&(r=Kn(r,{dir:"right",size:Math.ceil((t.length-2)/2/32)*32})),{dynamic:!0,encoded:Zi([Kn(bi(i,{size:32})),r])}}if(i!==Number.parseInt(n))throw new UD({expectedSize:Number.parseInt(n),value:t});return{dynamic:!1,encoded:Kn(t,{dir:"right"})}}function gC(t){if(typeof t!="boolean")throw new Me(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:Kn(Gg(t))}}function yC(t,{signed:e,size:n=256}){if(typeof n=="number"){const i=2n**(BigInt(n)-(e?1n:0n))-1n,r=e?-i-1n:0n;if(t>i||t<r)throw new Wg({max:i.toString(),min:r.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:bi(t,{size:32,signed:e})}}function wC(t){const e=Yg(t),n=Math.ceil(Lt(e)/32),i=[];for(let r=0;r<n;r++)i.push(Kn(s0(e,r*32,(r+1)*32),{dir:"right"}));return{dynamic:!0,encoded:Zi([Kn(bi(Lt(e),{size:32})),...i])}}function mC(t,{param:e}){let n=!1;const i=[];for(let r=0;r<e.components.length;r++){const s=e.components[r],o=Array.isArray(t)?r:s.name,a=il({param:s,value:t[o]});i.push(a),a.dynamic&&(n=!0)}return{dynamic:n,encoded:n?rl(i):Zi(i.map(({encoded:r})=>r))}}function bC(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}const c0=t=>s0(n0(t),0,4);function vC(t){const{abi:e,args:n=[],name:i}=t,r=Zr(i,{strict:!1}),s=e.filter(a=>r?a.type==="function"?c0(a)===i:a.type==="event"?nC(a)===i:!1:"name"in a&&a.name===i);if(s.length===0)return;if(s.length===1)return s[0];let o;for(const a of s){if(!("inputs"in a))continue;if(!n||n.length===0){if(!a.inputs||a.inputs.length===0)return a;continue}if(!a.inputs||a.inputs.length===0||a.inputs.length!==n.length)continue;if(n.every((l,u)=>{const h="inputs"in a&&a.inputs[u];return h?sl(l,h):!1})){if(o&&"inputs"in o&&o.inputs){const l=l0(a.inputs,o.inputs,n);if(l)throw new MD({abiItem:a,type:l[0]},{abiItem:o,type:l[1]})}o=a}}return o||s[0]}function sl(t,e){const n=typeof t,i=e.type;switch(i){case"address":return ho(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return i==="tuple"&&"components"in e?Object.values(e.components).every((r,s)=>sl(Object.values(t)[s],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(i)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(i)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(i)?Array.isArray(t)&&t.every(r=>sl(r,{...e,type:i.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function l0(t,e,n){for(const i in t){const r=t[i],s=e[i];if(r.type==="tuple"&&s.type==="tuple"&&"components"in r&&"components"in s)return l0(r.components,s.components,n[i]);const o=[r.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?ho(n[i],{strict:!1}):o.includes("address")&&o.includes("bytes")?ho(n[i],{strict:!1}):!1)return o}}const u0="/docs/contract/encodeFunctionData";function EC(t){const{abi:e,args:n,functionName:i}=t;let r=e[0];if(i){const s=vC({abi:e,args:n,name:i});if(!s)throw new Hg(i,{docsPath:u0});r=s}if(r.type!=="function")throw new Hg(void 0,{docsPath:u0});return{abi:[r],functionName:c0(el(r))}}function h0(t){const{args:e}=t,{abi:n,functionName:i}=(()=>{var a;return t.abi.length===1&&((a=t.functionName)!=null&&a.startsWith("0x"))?t:EC(t)})(),r=n[0],s=i,o="inputs"in r&&r.inputs?uC(r.inputs,e??[]):void 0;return r0([s,o??"0x"])}const d0={contractAddress:"0xdAC17F958D2ee523a2206206994597C13D831ec7",abi:[{inputs:[{internalType:"address",name:"recipient",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]};function xC({fromAddress:t,toAddress:e,uint256:n}){return{from:t,to:d0.contractAddress,data:h0({abi:d0.abi,functionName:"transfer",args:[e,n]})}}function f0(t,e){const n=`btnWallet${t.id}`;return Dt.h("button",{id:n,class:"w-full flex items-center space-x-2 border border-gray-300 rounded-lg px-4 py-2 hover:bg-gray-50"},Dt.h("div",{style:{width:"44",paddingRight:"5px"}},Dt.h("img",{src:t.img,alt:t.name,style:"height: 34px; width: 44px;"})),Dt.h("div",{class:"flex w-full",style:"justify-content: space-between;"},Dt.h("span",null,t.name),Dt.h("span",{class:"text-lydian-green"},e?"Linked":""))).outerHTML}var fo={exports:{}},_C=fo.exports,p0;function SC(){return p0||(p0=1,function(t,e){(function(n,i){t.exports=i()})(_C,function(){return(()=>{var n={192:(s,o)=>{var a,c,l=function(){var u=function(P,T){var S=P,m=I[T],_=null,k=0,R=null,U=[],H={},G=function($,p){_=function(w){for(var b=new Array(w),E=0;E<w;E+=1){b[E]=new Array(w);for(var F=0;F<w;F+=1)b[E][F]=null}return b}(k=4*S+17),Q(0,0),Q(k-7,0),Q(0,k-7),X(),Z(),ce($,p),S>=7&&re($),R==null&&(R=le(S,m,U)),fe(R,p)},Q=function($,p){for(var w=-1;w<=7;w+=1)if(!($+w<=-1||k<=$+w))for(var b=-1;b<=7;b+=1)p+b<=-1||k<=p+b||(_[$+w][p+b]=0<=w&&w<=6&&(b==0||b==6)||0<=b&&b<=6&&(w==0||w==6)||2<=w&&w<=4&&2<=b&&b<=4)},Z=function(){for(var $=8;$<k-8;$+=1)_[$][6]==null&&(_[$][6]=$%2==0);for(var p=8;p<k-8;p+=1)_[6][p]==null&&(_[6][p]=p%2==0)},X=function(){for(var $=O.getPatternPosition(S),p=0;p<$.length;p+=1)for(var w=0;w<$.length;w+=1){var b=$[p],E=$[w];if(_[b][E]==null)for(var F=-2;F<=2;F+=1)for(var N=-2;N<=2;N+=1)_[b+F][E+N]=F==-2||F==2||N==-2||N==2||F==0&&N==0}},re=function($){for(var p=O.getBCHTypeNumber(S),w=0;w<18;w+=1){var b=!$&&(p>>w&1)==1;_[Math.floor(w/3)][w%3+k-8-3]=b}for(w=0;w<18;w+=1)b=!$&&(p>>w&1)==1,_[w%3+k-8-3][Math.floor(w/3)]=b},ce=function($,p){for(var w=m<<3|p,b=O.getBCHTypeInfo(w),E=0;E<15;E+=1){var F=!$&&(b>>E&1)==1;E<6?_[E][8]=F:E<8?_[E+1][8]=F:_[k-15+E][8]=F}for(E=0;E<15;E+=1)F=!$&&(b>>E&1)==1,E<8?_[8][k-E-1]=F:E<9?_[8][15-E-1+1]=F:_[8][15-E-1]=F;_[k-8][8]=!$},fe=function($,p){for(var w=-1,b=k-1,E=7,F=0,N=O.getMaskFunction(p),K=k-1;K>0;K-=2)for(K==6&&(K-=1);;){for(var W=0;W<2;W+=1)if(_[b][K-W]==null){var Y=!1;F<$.length&&(Y=($[F]>>>E&1)==1),N(b,K-W)&&(Y=!Y),_[b][K-W]=Y,(E-=1)==-1&&(F+=1,E=7)}if((b+=w)<0||k<=b){b-=w,w=-w;break}}},le=function($,p,w){for(var b=x.getRSBlocks($,p),E=v(),F=0;F<w.length;F+=1){var N=w[F];E.put(N.getMode(),4),E.put(N.getLength(),O.getLengthInBits(N.getMode(),$)),N.write(E)}var K=0;for(F=0;F<b.length;F+=1)K+=b[F].dataCount;if(E.getLengthInBits()>8*K)throw"code length overflow. ("+E.getLengthInBits()+">"+8*K+")";for(E.getLengthInBits()+4<=8*K&&E.put(0,4);E.getLengthInBits()%8!=0;)E.putBit(!1);for(;!(E.getLengthInBits()>=8*K||(E.put(236,8),E.getLengthInBits()>=8*K));)E.put(17,8);return function(W,Y){for(var V=0,se=0,pe=0,he=new Array(Y.length),ne=new Array(Y.length),ie=0;ie<Y.length;ie+=1){var be=Y[ie].dataCount,De=Y[ie].totalCount-be;se=Math.max(se,be),pe=Math.max(pe,De),he[ie]=new Array(be);for(var ue=0;ue<he[ie].length;ue+=1)he[ie][ue]=255&W.getBuffer()[ue+V];V+=be;var ve=O.getErrorCorrectPolynomial(De),de=D(he[ie],ve.getLength()-1).mod(ve);for(ne[ie]=new Array(ve.getLength()-1),ue=0;ue<ne[ie].length;ue+=1){var ge=ue+de.getLength()-ne[ie].length;ne[ie][ue]=ge>=0?de.getAt(ge):0}}var Re=0;for(ue=0;ue<Y.length;ue+=1)Re+=Y[ue].totalCount;var Ut=new Array(Re),Se=0;for(ue=0;ue<se;ue+=1)for(ie=0;ie<Y.length;ie+=1)ue<he[ie].length&&(Ut[Se]=he[ie][ue],Se+=1);for(ue=0;ue<pe;ue+=1)for(ie=0;ie<Y.length;ie+=1)ue<ne[ie].length&&(Ut[Se]=ne[ie][ue],Se+=1);return Ut}(E,b)};H.addData=function($,p){var w=null;switch(p=p||"Byte"){case"Numeric":w=A($);break;case"Alphanumeric":w=L($);break;case"Byte":w=M($);break;case"Kanji":w=C($);break;default:throw"mode:"+p}U.push(w),R=null},H.isDark=function($,p){if($<0||k<=$||p<0||k<=p)throw $+","+p;return _[$][p]},H.getModuleCount=function(){return k},H.make=function(){if(S<1){for(var $=1;$<40;$++){for(var p=x.getRSBlocks($,m),w=v(),b=0;b<U.length;b++){var E=U[b];w.put(E.getMode(),4),w.put(E.getLength(),O.getLengthInBits(E.getMode(),$)),E.write(w)}var F=0;for(b=0;b<p.length;b++)F+=p[b].dataCount;if(w.getLengthInBits()<=8*F)break}S=$}G(!1,function(){for(var N=0,K=0,W=0;W<8;W+=1){G(!0,W);var Y=O.getLostPoint(H);(W==0||N>Y)&&(N=Y,K=W)}return K}())},H.createTableTag=function($,p){$=$||2;var w="";w+='<table style="',w+=" border-width: 0px; border-style: none;",w+=" border-collapse: collapse;",w+=" padding: 0px; margin: "+(p=p===void 0?4*$:p)+"px;",w+='">',w+="<tbody>";for(var b=0;b<H.getModuleCount();b+=1){w+="<tr>";for(var E=0;E<H.getModuleCount();E+=1)w+='<td style="',w+=" border-width: 0px; border-style: none;",w+=" border-collapse: collapse;",w+=" padding: 0px; margin: 0px;",w+=" width: "+$+"px;",w+=" height: "+$+"px;",w+=" background-color: ",w+=H.isDark(b,E)?"#000000":"#ffffff",w+=";",w+='"/>';w+="</tr>"}return(w+="</tbody>")+"</table>"},H.createSvgTag=function($,p,w,b){var E={};typeof arguments[0]=="object"&&($=(E=arguments[0]).cellSize,p=E.margin,w=E.alt,b=E.title),$=$||2,p=p===void 0?4*$:p,(w=typeof w=="string"?{text:w}:w||{}).text=w.text||null,w.id=w.text?w.id||"qrcode-description":null,(b=typeof b=="string"?{text:b}:b||{}).text=b.text||null,b.id=b.text?b.id||"qrcode-title":null;var F,N,K,W,Y=H.getModuleCount()*$+2*p,V="";for(W="l"+$+",0 0,"+$+" -"+$+",0 0,-"+$+"z ",V+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',V+=E.scalable?"":' width="'+Y+'px" height="'+Y+'px"',V+=' viewBox="0 0 '+Y+" "+Y+'" ',V+=' preserveAspectRatio="xMinYMin meet"',V+=b.text||w.text?' role="img" aria-labelledby="'+ae([b.id,w.id].join(" ").trim())+'"':"",V+=">",V+=b.text?'<title id="'+ae(b.id)+'">'+ae(b.text)+"</title>":"",V+=w.text?'<description id="'+ae(w.id)+'">'+ae(w.text)+"</description>":"",V+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',V+='<path d="',N=0;N<H.getModuleCount();N+=1)for(K=N*$+p,F=0;F<H.getModuleCount();F+=1)H.isDark(N,F)&&(V+="M"+(F*$+p)+","+K+W);return(V+='" stroke="transparent" fill="black"/>')+"</svg>"},H.createDataURL=function($,p){$=$||2,p=p===void 0?4*$:p;var w=H.getModuleCount()*$+2*p,b=p,E=w-p;return q(w,w,function(F,N){if(b<=F&&F<E&&b<=N&&N<E){var K=Math.floor((F-b)/$),W=Math.floor((N-b)/$);return H.isDark(W,K)?0:1}return 1})},H.createImgTag=function($,p,w){$=$||2,p=p===void 0?4*$:p;var b=H.getModuleCount()*$+2*p,E="";return E+="<img",E+=' src="',E+=H.createDataURL($,p),E+='"',E+=' width="',E+=b,E+='"',E+=' height="',E+=b,E+='"',w&&(E+=' alt="',E+=ae(w),E+='"'),E+"/>"};var ae=function($){for(var p="",w=0;w<$.length;w+=1){var b=$.charAt(w);switch(b){case"<":p+="&lt;";break;case">":p+="&gt;";break;case"&":p+="&amp;";break;case'"':p+="&quot;";break;default:p+=b}}return p};return H.createASCII=function($,p){if(($=$||1)<2)return function(he){he=he===void 0?2:he;var ne,ie,be,De,ue,ve=1*H.getModuleCount()+2*he,de=he,ge=ve-he,Re={"██":"█","█ ":"▀"," █":"▄","  ":" "},Ut={"██":"▀","█ ":"▀"," █":" ","  ":" "},Se="";for(ne=0;ne<ve;ne+=2){for(be=Math.floor((ne-de)/1),De=Math.floor((ne+1-de)/1),ie=0;ie<ve;ie+=1)ue="█",de<=ie&&ie<ge&&de<=ne&&ne<ge&&H.isDark(be,Math.floor((ie-de)/1))&&(ue=" "),de<=ie&&ie<ge&&de<=ne+1&&ne+1<ge&&H.isDark(De,Math.floor((ie-de)/1))?ue+=" ":ue+="█",Se+=he<1&&ne+1>=ge?Ut[ue]:Re[ue];Se+=`
`}return ve%2&&he>0?Se.substring(0,Se.length-ve-1)+Array(ve+1).join("▀"):Se.substring(0,Se.length-1)}(p);$-=1,p=p===void 0?2*$:p;var w,b,E,F,N=H.getModuleCount()*$+2*p,K=p,W=N-p,Y=Array($+1).join("██"),V=Array($+1).join("  "),se="",pe="";for(w=0;w<N;w+=1){for(E=Math.floor((w-K)/$),pe="",b=0;b<N;b+=1)F=1,K<=b&&b<W&&K<=w&&w<W&&H.isDark(E,Math.floor((b-K)/$))&&(F=0),pe+=F?Y:V;for(E=0;E<$;E+=1)se+=pe+`
`}return se.substring(0,se.length-1)},H.renderTo2dContext=function($,p){p=p||2;for(var w=H.getModuleCount(),b=0;b<w;b++)for(var E=0;E<w;E++)$.fillStyle=H.isDark(b,E)?"black":"white",$.fillRect(b*p,E*p,p,p)},H};u.stringToBytes=(u.stringToBytesFuncs={default:function(P){for(var T=[],S=0;S<P.length;S+=1){var m=P.charCodeAt(S);T.push(255&m)}return T}}).default,u.createStringToBytes=function(P,T){var S=function(){for(var _=j(P),k=function(){var Z=_.read();if(Z==-1)throw"eof";return Z},R=0,U={};;){var H=_.read();if(H==-1)break;var G=k(),Q=k()<<8|k();U[String.fromCharCode(H<<8|G)]=Q,R+=1}if(R!=T)throw R+" != "+T;return U}(),m=63;return function(_){for(var k=[],R=0;R<_.length;R+=1){var U=_.charCodeAt(R);if(U<128)k.push(U);else{var H=S[_.charAt(R)];typeof H=="number"?(255&H)==H?k.push(H):(k.push(H>>>8),k.push(255&H)):k.push(m)}}return k}};var h,d,y,f,g,I={L:1,M:0,Q:3,H:2},O=(h=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],d=1335,y=7973,g=function(P){for(var T=0;P!=0;)T+=1,P>>>=1;return T},(f={}).getBCHTypeInfo=function(P){for(var T=P<<10;g(T)-g(d)>=0;)T^=d<<g(T)-g(d);return 21522^(P<<10|T)},f.getBCHTypeNumber=function(P){for(var T=P<<12;g(T)-g(y)>=0;)T^=y<<g(T)-g(y);return P<<12|T},f.getPatternPosition=function(P){return h[P-1]},f.getMaskFunction=function(P){switch(P){case 0:return function(T,S){return(T+S)%2==0};case 1:return function(T,S){return T%2==0};case 2:return function(T,S){return S%3==0};case 3:return function(T,S){return(T+S)%3==0};case 4:return function(T,S){return(Math.floor(T/2)+Math.floor(S/3))%2==0};case 5:return function(T,S){return T*S%2+T*S%3==0};case 6:return function(T,S){return(T*S%2+T*S%3)%2==0};case 7:return function(T,S){return(T*S%3+(T+S)%2)%2==0};default:throw"bad maskPattern:"+P}},f.getErrorCorrectPolynomial=function(P){for(var T=D([1],0),S=0;S<P;S+=1)T=T.multiply(D([1,B.gexp(S)],0));return T},f.getLengthInBits=function(P,T){if(1<=T&&T<10)switch(P){case 1:return 10;case 2:return 9;case 4:case 8:return 8;default:throw"mode:"+P}else if(T<27)switch(P){case 1:return 12;case 2:return 11;case 4:return 16;case 8:return 10;default:throw"mode:"+P}else{if(!(T<41))throw"type:"+T;switch(P){case 1:return 14;case 2:return 13;case 4:return 16;case 8:return 12;default:throw"mode:"+P}}},f.getLostPoint=function(P){for(var T=P.getModuleCount(),S=0,m=0;m<T;m+=1)for(var _=0;_<T;_+=1){for(var k=0,R=P.isDark(m,_),U=-1;U<=1;U+=1)if(!(m+U<0||T<=m+U))for(var H=-1;H<=1;H+=1)_+H<0||T<=_+H||U==0&&H==0||R==P.isDark(m+U,_+H)&&(k+=1);k>5&&(S+=3+k-5)}for(m=0;m<T-1;m+=1)for(_=0;_<T-1;_+=1){var G=0;P.isDark(m,_)&&(G+=1),P.isDark(m+1,_)&&(G+=1),P.isDark(m,_+1)&&(G+=1),P.isDark(m+1,_+1)&&(G+=1),G!=0&&G!=4||(S+=3)}for(m=0;m<T;m+=1)for(_=0;_<T-6;_+=1)P.isDark(m,_)&&!P.isDark(m,_+1)&&P.isDark(m,_+2)&&P.isDark(m,_+3)&&P.isDark(m,_+4)&&!P.isDark(m,_+5)&&P.isDark(m,_+6)&&(S+=40);for(_=0;_<T;_+=1)for(m=0;m<T-6;m+=1)P.isDark(m,_)&&!P.isDark(m+1,_)&&P.isDark(m+2,_)&&P.isDark(m+3,_)&&P.isDark(m+4,_)&&!P.isDark(m+5,_)&&P.isDark(m+6,_)&&(S+=40);var Q=0;for(_=0;_<T;_+=1)for(m=0;m<T;m+=1)P.isDark(m,_)&&(Q+=1);return S+Math.abs(100*Q/T/T-50)/5*10},f),B=function(){for(var P=new Array(256),T=new Array(256),S=0;S<8;S+=1)P[S]=1<<S;for(S=8;S<256;S+=1)P[S]=P[S-4]^P[S-5]^P[S-6]^P[S-8];for(S=0;S<255;S+=1)T[P[S]]=S;return{glog:function(m){if(m<1)throw"glog("+m+")";return T[m]},gexp:function(m){for(;m<0;)m+=255;for(;m>=256;)m-=255;return P[m]}}}();function D(P,T){if(P.length===void 0)throw P.length+"/"+T;var S=function(){for(var _=0;_<P.length&&P[_]==0;)_+=1;for(var k=new Array(P.length-_+T),R=0;R<P.length-_;R+=1)k[R]=P[R+_];return k}(),m={getAt:function(_){return S[_]},getLength:function(){return S.length},multiply:function(_){for(var k=new Array(m.getLength()+_.getLength()-1),R=0;R<m.getLength();R+=1)for(var U=0;U<_.getLength();U+=1)k[R+U]^=B.gexp(B.glog(m.getAt(R))+B.glog(_.getAt(U)));return D(k,0)},mod:function(_){if(m.getLength()-_.getLength()<0)return m;for(var k=B.glog(m.getAt(0))-B.glog(_.getAt(0)),R=new Array(m.getLength()),U=0;U<m.getLength();U+=1)R[U]=m.getAt(U);for(U=0;U<_.getLength();U+=1)R[U]^=B.gexp(B.glog(_.getAt(U))+k);return D(R,0).mod(_)}};return m}var x=function(){var P=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],T=function(m,_){var k={};return k.totalCount=m,k.dataCount=_,k},S={getRSBlocks:function(m,_){var k=function(re,ce){switch(ce){case I.L:return P[4*(re-1)+0];case I.M:return P[4*(re-1)+1];case I.Q:return P[4*(re-1)+2];case I.H:return P[4*(re-1)+3];default:return}}(m,_);if(k===void 0)throw"bad rs block @ typeNumber:"+m+"/errorCorrectionLevel:"+_;for(var R=k.length/3,U=[],H=0;H<R;H+=1)for(var G=k[3*H+0],Q=k[3*H+1],Z=k[3*H+2],X=0;X<G;X+=1)U.push(T(Q,Z));return U}};return S}(),v=function(){var P=[],T=0,S={getBuffer:function(){return P},getAt:function(m){var _=Math.floor(m/8);return(P[_]>>>7-m%8&1)==1},put:function(m,_){for(var k=0;k<_;k+=1)S.putBit((m>>>_-k-1&1)==1)},getLengthInBits:function(){return T},putBit:function(m){var _=Math.floor(T/8);P.length<=_&&P.push(0),m&&(P[_]|=128>>>T%8),T+=1}};return S},A=function(P){var T=P,S={getMode:function(){return 1},getLength:function(k){return T.length},write:function(k){for(var R=T,U=0;U+2<R.length;)k.put(m(R.substring(U,U+3)),10),U+=3;U<R.length&&(R.length-U==1?k.put(m(R.substring(U,U+1)),4):R.length-U==2&&k.put(m(R.substring(U,U+2)),7))}},m=function(k){for(var R=0,U=0;U<k.length;U+=1)R=10*R+_(k.charAt(U));return R},_=function(k){if("0"<=k&&k<="9")return k.charCodeAt(0)-48;throw"illegal char :"+k};return S},L=function(P){var T=P,S={getMode:function(){return 2},getLength:function(_){return T.length},write:function(_){for(var k=T,R=0;R+1<k.length;)_.put(45*m(k.charAt(R))+m(k.charAt(R+1)),11),R+=2;R<k.length&&_.put(m(k.charAt(R)),6)}},m=function(_){if("0"<=_&&_<="9")return _.charCodeAt(0)-48;if("A"<=_&&_<="Z")return _.charCodeAt(0)-65+10;switch(_){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+_}};return S},M=function(P){var T=u.stringToBytes(P);return{getMode:function(){return 4},getLength:function(S){return T.length},write:function(S){for(var m=0;m<T.length;m+=1)S.put(T[m],8)}}},C=function(P){var T=u.stringToBytesFuncs.SJIS;if(!T)throw"sjis not supported.";(function(_,k){var R=T("友");if(R.length!=2||(R[0]<<8|R[1])!=38726)throw"sjis not supported."})();var S=T(P),m={getMode:function(){return 8},getLength:function(_){return~~(S.length/2)},write:function(_){for(var k=S,R=0;R+1<k.length;){var U=(255&k[R])<<8|255&k[R+1];if(33088<=U&&U<=40956)U-=33088;else{if(!(57408<=U&&U<=60351))throw"illegal char at "+(R+1)+"/"+U;U-=49472}U=192*(U>>>8&255)+(255&U),_.put(U,13),R+=2}if(R<k.length)throw"illegal char at "+(R+1)}};return m},z=function(){var P=[],T={writeByte:function(S){P.push(255&S)},writeShort:function(S){T.writeByte(S),T.writeByte(S>>>8)},writeBytes:function(S,m,_){m=m||0,_=_||S.length;for(var k=0;k<_;k+=1)T.writeByte(S[k+m])},writeString:function(S){for(var m=0;m<S.length;m+=1)T.writeByte(S.charCodeAt(m))},toByteArray:function(){return P},toString:function(){var S="";S+="[";for(var m=0;m<P.length;m+=1)m>0&&(S+=","),S+=P[m];return S+"]"}};return T},j=function(P){var T=P,S=0,m=0,_=0,k={read:function(){for(;_<8;){if(S>=T.length){if(_==0)return-1;throw"unexpected end of file./"+_}var U=T.charAt(S);if(S+=1,U=="=")return _=0,-1;U.match(/^\s$/)||(m=m<<6|R(U.charCodeAt(0)),_+=6)}var H=m>>>_-8&255;return _-=8,H}},R=function(U){if(65<=U&&U<=90)return U-65;if(97<=U&&U<=122)return U-97+26;if(48<=U&&U<=57)return U-48+52;if(U==43)return 62;if(U==47)return 63;throw"c:"+U};return k},q=function(P,T,S){for(var m=function(Q,Z){var X=Q,re=Z,ce=new Array(Q*Z),fe={setPixel:function($,p,w){ce[p*X+$]=w},write:function($){$.writeString("GIF87a"),$.writeShort(X),$.writeShort(re),$.writeByte(128),$.writeByte(0),$.writeByte(0),$.writeByte(0),$.writeByte(0),$.writeByte(0),$.writeByte(255),$.writeByte(255),$.writeByte(255),$.writeString(","),$.writeShort(0),$.writeShort(0),$.writeShort(X),$.writeShort(re),$.writeByte(0);var p=le(2);$.writeByte(2);for(var w=0;p.length-w>255;)$.writeByte(255),$.writeBytes(p,w,255),w+=255;$.writeByte(p.length-w),$.writeBytes(p,w,p.length-w),$.writeByte(0),$.writeString(";")}},le=function($){for(var p=1<<$,w=1+(1<<$),b=$+1,E=ae(),F=0;F<p;F+=1)E.add(String.fromCharCode(F));E.add(String.fromCharCode(p)),E.add(String.fromCharCode(w));var N,K,W,Y=z(),V=(N=Y,K=0,W=0,{write:function(ne,ie){if(ne>>>ie)throw"length over";for(;K+ie>=8;)N.writeByte(255&(ne<<K|W)),ie-=8-K,ne>>>=8-K,W=0,K=0;W|=ne<<K,K+=ie},flush:function(){K>0&&N.writeByte(W)}});V.write(p,b);var se=0,pe=String.fromCharCode(ce[se]);for(se+=1;se<ce.length;){var he=String.fromCharCode(ce[se]);se+=1,E.contains(pe+he)?pe+=he:(V.write(E.indexOf(pe),b),E.size()<4095&&(E.size()==1<<b&&(b+=1),E.add(pe+he)),pe=he)}return V.write(E.indexOf(pe),b),V.write(w,b),V.flush(),Y.toByteArray()},ae=function(){var $={},p=0,w={add:function(b){if(w.contains(b))throw"dup key:"+b;$[b]=p,p+=1},size:function(){return p},indexOf:function(b){return $[b]},contains:function(b){return $[b]!==void 0}};return w};return fe}(P,T),_=0;_<T;_+=1)for(var k=0;k<P;k+=1)m.setPixel(k,_,S(k,_));var R=z();m.write(R);for(var U=function(){var Q=0,Z=0,X=0,re="",ce={},fe=function(ae){re+=String.fromCharCode(le(63&ae))},le=function(ae){if(!(ae<0)){if(ae<26)return 65+ae;if(ae<52)return ae-26+97;if(ae<62)return ae-52+48;if(ae==62)return 43;if(ae==63)return 47}throw"n:"+ae};return ce.writeByte=function(ae){for(Q=Q<<8|255&ae,Z+=8,X+=1;Z>=6;)fe(Q>>>Z-6),Z-=6},ce.flush=function(){if(Z>0&&(fe(Q<<6-Z),Q=0,Z=0),X%3!=0)for(var ae=3-X%3,$=0;$<ae;$+=1)re+="="},ce.toString=function(){return re},ce}(),H=R.toByteArray(),G=0;G<H.length;G+=1)U.writeByte(H[G]);return U.flush(),"data:image/gif;base64,"+U};return u}();l.stringToBytesFuncs["UTF-8"]=function(u){return function(h){for(var d=[],y=0;y<h.length;y++){var f=h.charCodeAt(y);f<128?d.push(f):f<2048?d.push(192|f>>6,128|63&f):f<55296||f>=57344?d.push(224|f>>12,128|f>>6&63,128|63&f):(y++,f=65536+((1023&f)<<10|1023&h.charCodeAt(y)),d.push(240|f>>18,128|f>>12&63,128|f>>6&63,128|63&f))}return d}(u)},(c=typeof(a=function(){return l})=="function"?a.apply(o,[]):a)===void 0||(s.exports=c)},676:(s,o,a)=>{a.d(o,{default:()=>ae});const c="Numeric",l="Alphanumeric",u="Byte";var h=function(){return h=Object.assign||function($){for(var p,w=1,b=arguments.length;w<b;w++)for(var E in p=arguments[w])Object.prototype.hasOwnProperty.call(p,E)&&($[E]=p[E]);return $},h.apply(this,arguments)},d=function(){for(var $=0,p=0,w=arguments.length;p<w;p++)$+=arguments[p].length;var b=Array($),E=0;for(p=0;p<w;p++)for(var F=arguments[p],N=0,K=F.length;N<K;N++,E++)b[E]=F[N];return b},y=function($){return!!$&&typeof $=="object"&&!Array.isArray($)};function f($){for(var p=[],w=1;w<arguments.length;w++)p[w-1]=arguments[w];if(!p.length)return $;var b=p.shift();return b!==void 0&&y($)&&y(b)?($=h({},$),Object.keys(b).forEach(function(E){var F=$[E],N=b[E];Array.isArray(F)&&Array.isArray(N)?$[E]=N:y(F)&&y(N)?$[E]=f(Object.assign({},F),N):$[E]=N}),f.apply(void 0,d([$],p))):$}function g($,p){var w=document.createElement("a");w.download=p,w.href=$,document.body.appendChild(w),w.click(),document.body.removeChild(w)}var I=function($,p,w,b){return new(w||(w=Promise))(function(E,F){function N(Y){try{W(b.next(Y))}catch(V){F(V)}}function K(Y){try{W(b.throw(Y))}catch(V){F(V)}}function W(Y){var V;Y.done?E(Y.value):(V=Y.value,V instanceof w?V:new w(function(se){se(V)})).then(N,K)}W((b=b.apply($,[])).next())})},O=function($,p){var w,b,E,F,N={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return F={next:K(0),throw:K(1),return:K(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function K(W){return function(Y){return function(V){if(w)throw new TypeError("Generator is already executing.");for(;N;)try{if(w=1,b&&(E=2&V[0]?b.return:V[0]?b.throw||((E=b.return)&&E.call(b),0):b.next)&&!(E=E.call(b,V[1])).done)return E;switch(b=0,E&&(V=[2&V[0],E.value]),V[0]){case 0:case 1:E=V;break;case 4:return N.label++,{value:V[1],done:!1};case 5:N.label++,b=V[1],V=[0];continue;case 7:V=N.ops.pop(),N.trys.pop();continue;default:if(!((E=(E=N.trys).length>0&&E[E.length-1])||V[0]!==6&&V[0]!==2)){N=0;continue}if(V[0]===3&&(!E||V[1]>E[0]&&V[1]<E[3])){N.label=V[1];break}if(V[0]===6&&N.label<E[1]){N.label=E[1],E=V;break}if(E&&N.label<E[2]){N.label=E[2],N.ops.push(V);break}E[2]&&N.ops.pop(),N.trys.pop();continue}V=p.call($,N)}catch(se){V=[6,se],b=0}finally{w=E=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([W,Y])}}};function B($){return I(this,void 0,void 0,function(){return O(this,function(p){return[2,new Promise(function(w){var b=new XMLHttpRequest;b.onload=function(){var E=new FileReader;E.onloadend=function(){w(E.result)},E.readAsDataURL(b.response)},b.open("GET",$),b.responseType="blob",b.send()})]})})}const D={L:.07,M:.15,Q:.25,H:.3};var x=function(){return x=Object.assign||function($){for(var p,w=1,b=arguments.length;w<b;w++)for(var E in p=arguments[w])Object.prototype.hasOwnProperty.call(p,E)&&($[E]=p[E]);return $},x.apply(this,arguments)},v=function(){function $(p){var w=p.svg,b=p.type;this._svg=w,this._type=b}return $.prototype.draw=function(p,w,b,E){var F;switch(this._type){case"dots":F=this._drawDot;break;case"classy":F=this._drawClassy;break;case"classy-rounded":F=this._drawClassyRounded;break;case"rounded":F=this._drawRounded;break;case"extra-rounded":F=this._drawExtraRounded;break;default:F=this._drawSquare}F.call(this,{x:p,y:w,size:b,getNeighbor:E})},$.prototype._rotateFigure=function(p){var w,b=p.x,E=p.y,F=p.size,N=p.rotation,K=N===void 0?0:N,W=b+F/2,Y=E+F/2;(0,p.draw)(),(w=this._element)===null||w===void 0||w.setAttribute("transform","rotate("+180*K/Math.PI+","+W+","+Y+")")},$.prototype._basicDot=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(x(x({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","circle"),w._element.setAttribute("cx",String(E+b/2)),w._element.setAttribute("cy",String(F+b/2)),w._element.setAttribute("r",String(b/2))}}))},$.prototype._basicSquare=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(x(x({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","rect"),w._element.setAttribute("x",String(E)),w._element.setAttribute("y",String(F)),w._element.setAttribute("width",String(b)),w._element.setAttribute("height",String(b))}}))},$.prototype._basicSideRounded=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(x(x({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("d","M "+E+" "+F+"v "+b+"h "+b/2+"a "+b/2+" "+b/2+", 0, 0, 0, 0 "+-b)}}))},$.prototype._basicCornerRounded=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(x(x({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("d","M "+E+" "+F+"v "+b+"h "+b+"v "+-b/2+"a "+b/2+" "+b/2+", 0, 0, 0, "+-b/2+" "+-b/2)}}))},$.prototype._basicCornerExtraRounded=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(x(x({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("d","M "+E+" "+F+"v "+b+"h "+b+"a "+b+" "+b+", 0, 0, 0, "+-b+" "+-b)}}))},$.prototype._basicCornersRounded=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(x(x({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("d","M "+E+" "+F+"v "+b/2+"a "+b/2+" "+b/2+", 0, 0, 0, "+b/2+" "+b/2+"h "+b/2+"v "+-b/2+"a "+b/2+" "+b/2+", 0, 0, 0, "+-b/2+" "+-b/2)}}))},$.prototype._drawDot=function(p){var w=p.x,b=p.y,E=p.size;this._basicDot({x:w,y:b,size:E,rotation:0})},$.prototype._drawSquare=function(p){var w=p.x,b=p.y,E=p.size;this._basicSquare({x:w,y:b,size:E,rotation:0})},$.prototype._drawRounded=function(p){var w=p.x,b=p.y,E=p.size,F=p.getNeighbor,N=F?+F(-1,0):0,K=F?+F(1,0):0,W=F?+F(0,-1):0,Y=F?+F(0,1):0,V=N+K+W+Y;if(V!==0)if(V>2||N&&K||W&&Y)this._basicSquare({x:w,y:b,size:E,rotation:0});else{if(V===2){var se=0;return N&&W?se=Math.PI/2:W&&K?se=Math.PI:K&&Y&&(se=-Math.PI/2),void this._basicCornerRounded({x:w,y:b,size:E,rotation:se})}if(V===1)return se=0,W?se=Math.PI/2:K?se=Math.PI:Y&&(se=-Math.PI/2),void this._basicSideRounded({x:w,y:b,size:E,rotation:se})}else this._basicDot({x:w,y:b,size:E,rotation:0})},$.prototype._drawExtraRounded=function(p){var w=p.x,b=p.y,E=p.size,F=p.getNeighbor,N=F?+F(-1,0):0,K=F?+F(1,0):0,W=F?+F(0,-1):0,Y=F?+F(0,1):0,V=N+K+W+Y;if(V!==0)if(V>2||N&&K||W&&Y)this._basicSquare({x:w,y:b,size:E,rotation:0});else{if(V===2){var se=0;return N&&W?se=Math.PI/2:W&&K?se=Math.PI:K&&Y&&(se=-Math.PI/2),void this._basicCornerExtraRounded({x:w,y:b,size:E,rotation:se})}if(V===1)return se=0,W?se=Math.PI/2:K?se=Math.PI:Y&&(se=-Math.PI/2),void this._basicSideRounded({x:w,y:b,size:E,rotation:se})}else this._basicDot({x:w,y:b,size:E,rotation:0})},$.prototype._drawClassy=function(p){var w=p.x,b=p.y,E=p.size,F=p.getNeighbor,N=F?+F(-1,0):0,K=F?+F(1,0):0,W=F?+F(0,-1):0,Y=F?+F(0,1):0;N+K+W+Y!==0?N||W?K||Y?this._basicSquare({x:w,y:b,size:E,rotation:0}):this._basicCornerRounded({x:w,y:b,size:E,rotation:Math.PI/2}):this._basicCornerRounded({x:w,y:b,size:E,rotation:-Math.PI/2}):this._basicCornersRounded({x:w,y:b,size:E,rotation:Math.PI/2})},$.prototype._drawClassyRounded=function(p){var w=p.x,b=p.y,E=p.size,F=p.getNeighbor,N=F?+F(-1,0):0,K=F?+F(1,0):0,W=F?+F(0,-1):0,Y=F?+F(0,1):0;N+K+W+Y!==0?N||W?K||Y?this._basicSquare({x:w,y:b,size:E,rotation:0}):this._basicCornerExtraRounded({x:w,y:b,size:E,rotation:Math.PI/2}):this._basicCornerExtraRounded({x:w,y:b,size:E,rotation:-Math.PI/2}):this._basicCornersRounded({x:w,y:b,size:E,rotation:Math.PI/2})},$}();const A=v;var L=function(){return L=Object.assign||function($){for(var p,w=1,b=arguments.length;w<b;w++)for(var E in p=arguments[w])Object.prototype.hasOwnProperty.call(p,E)&&($[E]=p[E]);return $},L.apply(this,arguments)},M=function(){function $(p){var w=p.svg,b=p.type;this._svg=w,this._type=b}return $.prototype.draw=function(p,w,b,E){var F;switch(this._type){case"square":F=this._drawSquare;break;case"extra-rounded":F=this._drawExtraRounded;break;default:F=this._drawDot}F.call(this,{x:p,y:w,size:b,rotation:E})},$.prototype._rotateFigure=function(p){var w,b=p.x,E=p.y,F=p.size,N=p.rotation,K=N===void 0?0:N,W=b+F/2,Y=E+F/2;(0,p.draw)(),(w=this._element)===null||w===void 0||w.setAttribute("transform","rotate("+180*K/Math.PI+","+W+","+Y+")")},$.prototype._basicDot=function(p){var w=this,b=p.size,E=p.x,F=p.y,N=b/7;this._rotateFigure(L(L({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("clip-rule","evenodd"),w._element.setAttribute("d","M "+(E+b/2)+" "+F+"a "+b/2+" "+b/2+" 0 1 0 0.1 0zm 0 "+N+"a "+(b/2-N)+" "+(b/2-N)+" 0 1 1 -0.1 0Z")}}))},$.prototype._basicSquare=function(p){var w=this,b=p.size,E=p.x,F=p.y,N=b/7;this._rotateFigure(L(L({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("clip-rule","evenodd"),w._element.setAttribute("d","M "+E+" "+F+"v "+b+"h "+b+"v "+-b+"zM "+(E+N)+" "+(F+N)+"h "+(b-2*N)+"v "+(b-2*N)+"h "+(2*N-b)+"z")}}))},$.prototype._basicExtraRounded=function(p){var w=this,b=p.size,E=p.x,F=p.y,N=b/7;this._rotateFigure(L(L({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","path"),w._element.setAttribute("clip-rule","evenodd"),w._element.setAttribute("d","M "+E+" "+(F+2.5*N)+"v "+2*N+"a "+2.5*N+" "+2.5*N+", 0, 0, 0, "+2.5*N+" "+2.5*N+"h "+2*N+"a "+2.5*N+" "+2.5*N+", 0, 0, 0, "+2.5*N+" "+2.5*-N+"v "+-2*N+"a "+2.5*N+" "+2.5*N+", 0, 0, 0, "+2.5*-N+" "+2.5*-N+"h "+-2*N+"a "+2.5*N+" "+2.5*N+", 0, 0, 0, "+2.5*-N+" "+2.5*N+"M "+(E+2.5*N)+" "+(F+N)+"h "+2*N+"a "+1.5*N+" "+1.5*N+", 0, 0, 1, "+1.5*N+" "+1.5*N+"v "+2*N+"a "+1.5*N+" "+1.5*N+", 0, 0, 1, "+1.5*-N+" "+1.5*N+"h "+-2*N+"a "+1.5*N+" "+1.5*N+", 0, 0, 1, "+1.5*-N+" "+1.5*-N+"v "+-2*N+"a "+1.5*N+" "+1.5*N+", 0, 0, 1, "+1.5*N+" "+1.5*-N)}}))},$.prototype._drawDot=function(p){var w=p.x,b=p.y,E=p.size,F=p.rotation;this._basicDot({x:w,y:b,size:E,rotation:F})},$.prototype._drawSquare=function(p){var w=p.x,b=p.y,E=p.size,F=p.rotation;this._basicSquare({x:w,y:b,size:E,rotation:F})},$.prototype._drawExtraRounded=function(p){var w=p.x,b=p.y,E=p.size,F=p.rotation;this._basicExtraRounded({x:w,y:b,size:E,rotation:F})},$}();const C=M;var z=function(){return z=Object.assign||function($){for(var p,w=1,b=arguments.length;w<b;w++)for(var E in p=arguments[w])Object.prototype.hasOwnProperty.call(p,E)&&($[E]=p[E]);return $},z.apply(this,arguments)},j=function(){function $(p){var w=p.svg,b=p.type;this._svg=w,this._type=b}return $.prototype.draw=function(p,w,b,E){(this._type==="square"?this._drawSquare:this._drawDot).call(this,{x:p,y:w,size:b,rotation:E})},$.prototype._rotateFigure=function(p){var w,b=p.x,E=p.y,F=p.size,N=p.rotation,K=N===void 0?0:N,W=b+F/2,Y=E+F/2;(0,p.draw)(),(w=this._element)===null||w===void 0||w.setAttribute("transform","rotate("+180*K/Math.PI+","+W+","+Y+")")},$.prototype._basicDot=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(z(z({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","circle"),w._element.setAttribute("cx",String(E+b/2)),w._element.setAttribute("cy",String(F+b/2)),w._element.setAttribute("r",String(b/2))}}))},$.prototype._basicSquare=function(p){var w=this,b=p.size,E=p.x,F=p.y;this._rotateFigure(z(z({},p),{draw:function(){w._element=document.createElementNS("http://www.w3.org/2000/svg","rect"),w._element.setAttribute("x",String(E)),w._element.setAttribute("y",String(F)),w._element.setAttribute("width",String(b)),w._element.setAttribute("height",String(b))}}))},$.prototype._drawDot=function(p){var w=p.x,b=p.y,E=p.size,F=p.rotation;this._basicDot({x:w,y:b,size:E,rotation:F})},$.prototype._drawSquare=function(p){var w=p.x,b=p.y,E=p.size,F=p.rotation;this._basicSquare({x:w,y:b,size:E,rotation:F})},$}();const q=j,P="circle";var T=function($,p,w,b){return new(w||(w=Promise))(function(E,F){function N(Y){try{W(b.next(Y))}catch(V){F(V)}}function K(Y){try{W(b.throw(Y))}catch(V){F(V)}}function W(Y){var V;Y.done?E(Y.value):(V=Y.value,V instanceof w?V:new w(function(se){se(V)})).then(N,K)}W((b=b.apply($,[])).next())})},S=function($,p){var w,b,E,F,N={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return F={next:K(0),throw:K(1),return:K(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function K(W){return function(Y){return function(V){if(w)throw new TypeError("Generator is already executing.");for(;N;)try{if(w=1,b&&(E=2&V[0]?b.return:V[0]?b.throw||((E=b.return)&&E.call(b),0):b.next)&&!(E=E.call(b,V[1])).done)return E;switch(b=0,E&&(V=[2&V[0],E.value]),V[0]){case 0:case 1:E=V;break;case 4:return N.label++,{value:V[1],done:!1};case 5:N.label++,b=V[1],V=[0];continue;case 7:V=N.ops.pop(),N.trys.pop();continue;default:if(!((E=(E=N.trys).length>0&&E[E.length-1])||V[0]!==6&&V[0]!==2)){N=0;continue}if(V[0]===3&&(!E||V[1]>E[0]&&V[1]<E[3])){N.label=V[1];break}if(V[0]===6&&N.label<E[1]){N.label=E[1],E=V;break}if(E&&N.label<E[2]){N.label=E[2],N.ops.push(V);break}E[2]&&N.ops.pop(),N.trys.pop();continue}V=p.call($,N)}catch(se){V=[6,se],b=0}finally{w=E=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([W,Y])}}},m=[[1,1,1,1,1,1,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,0,0,0,0,0,1],[1,1,1,1,1,1,1]],_=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];const k=function(){function $(p){this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._element.setAttribute("width",String(p.width)),this._element.setAttribute("height",String(p.height)),this._defs=document.createElementNS("http://www.w3.org/2000/svg","defs"),this._element.appendChild(this._defs),this._instanceId=$.instanceCount++,this._options=p}return Object.defineProperty($.prototype,"width",{get:function(){return this._options.width},enumerable:!1,configurable:!0}),Object.defineProperty($.prototype,"height",{get:function(){return this._options.height},enumerable:!1,configurable:!0}),$.prototype.getElement=function(){return this._element},$.prototype.drawQR=function(p){return T(this,void 0,void 0,function(){var w,b,E,F,N,K,W,Y,V,se,pe=this;return S(this,function(he){switch(he.label){case 0:return w=p.getModuleCount(),b=Math.min(this._options.width,this._options.height)-2*this._options.margin,E=this._options.shape===P?b/Math.sqrt(2):b,F=E/w,N={hideXDots:0,hideYDots:0,width:0,height:0},this._qr=p,this._options.image?[4,this.loadImage()]:[3,2];case 1:if(he.sent(),!this._image)return[2];K=this._options,W=K.imageOptions,Y=K.qrOptions,V=W.imageSize*D[Y.errorCorrectionLevel],se=Math.floor(V*w*w),N=function(ne){var ie=ne.originalHeight,be=ne.originalWidth,De=ne.maxHiddenDots,ue=ne.maxHiddenAxisDots,ve=ne.dotSize,de={x:0,y:0},ge={x:0,y:0};if(ie<=0||be<=0||De<=0||ve<=0)return{height:0,width:0,hideYDots:0,hideXDots:0};var Re=ie/be;return de.x=Math.floor(Math.sqrt(De/Re)),de.x<=0&&(de.x=1),ue&&ue<de.x&&(de.x=ue),de.x%2==0&&de.x--,ge.x=de.x*ve,de.y=1+2*Math.ceil((de.x*Re-1)/2),ge.y=Math.round(ge.x*Re),(de.y*de.x>De||ue&&ue<de.y)&&(ue&&ue<de.y?(de.y=ue,de.y%2==0&&de.x--):de.y-=2,ge.y=de.y*ve,de.x=1+2*Math.ceil((de.y/Re-1)/2),ge.x=Math.round(ge.y/Re)),{height:ge.y,width:ge.x,hideYDots:de.y,hideXDots:de.x}}({originalWidth:this._image.width,originalHeight:this._image.height,maxHiddenDots:se,maxHiddenAxisDots:w-14,dotSize:F}),he.label=2;case 2:return this.drawBackground(),this.drawDots(function(ne,ie){var be,De,ue,ve,de,ge;return!(pe._options.imageOptions.hideBackgroundDots&&ne>=(w-N.hideXDots)/2&&ne<(w+N.hideXDots)/2&&ie>=(w-N.hideYDots)/2&&ie<(w+N.hideYDots)/2||!((be=m[ne])===null||be===void 0)&&be[ie]||!((De=m[ne-w+7])===null||De===void 0)&&De[ie]||!((ue=m[ne])===null||ue===void 0)&&ue[ie-w+7]||!((ve=_[ne])===null||ve===void 0)&&ve[ie]||!((de=_[ne-w+7])===null||de===void 0)&&de[ie]||!((ge=_[ne])===null||ge===void 0)&&ge[ie-w+7])}),this.drawCorners(),this._options.image?[4,this.drawImage({width:N.width,height:N.height,count:w,dotSize:F})]:[3,4];case 3:he.sent(),he.label=4;case 4:return[2]}})})},$.prototype.drawBackground=function(){var p,w,b,E=this._element,F=this._options;if(E){var N=(p=F.backgroundOptions)===null||p===void 0?void 0:p.gradient,K=(w=F.backgroundOptions)===null||w===void 0?void 0:w.color;if((N||K)&&this._createColor({options:N,color:K,additionalRotation:0,x:0,y:0,height:F.height,width:F.width,name:"background-color"}),(b=F.backgroundOptions)===null||b===void 0?void 0:b.round){var W=Math.min(F.width,F.height),Y=document.createElementNS("http://www.w3.org/2000/svg","rect");this._backgroundClipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._backgroundClipPath.setAttribute("id","clip-path-background-color"),this._defs.appendChild(this._backgroundClipPath),Y.setAttribute("x",String((F.width-W)/2)),Y.setAttribute("y",String((F.height-W)/2)),Y.setAttribute("width",String(W)),Y.setAttribute("height",String(W)),Y.setAttribute("rx",String(W/2*F.backgroundOptions.round)),this._backgroundClipPath.appendChild(Y)}}},$.prototype.drawDots=function(p){var w,b,E=this;if(!this._qr)throw"QR code is not defined";var F=this._options,N=this._qr.getModuleCount();if(N>F.width||N>F.height)throw"The canvas is too small.";var K=Math.min(F.width,F.height)-2*F.margin,W=(F.shape===P?K/Math.sqrt(2):K)/N,Y=(F.width-N*W)/2,V=(F.height-N*W)/2,se=new A({svg:this._element,type:F.dotsOptions.type});this._dotsClipPath=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),this._dotsClipPath.setAttribute("id","clip-path-dot-color-"+this._instanceId),this._defs.appendChild(this._dotsClipPath),this._createColor({options:(w=F.dotsOptions)===null||w===void 0?void 0:w.gradient,color:F.dotsOptions.color,additionalRotation:0,x:0,y:0,height:F.height,width:F.width,name:"dot-color-"+this._instanceId});for(var pe=function(Se){for(var Sn=function(We){return p&&!p(Se,We)?"continue":!((b=he._qr)===null||b===void 0)&&b.isDark(Se,We)?(se.draw(Y+Se*W,V+We*W,W,function(It,Et){return!(Se+It<0||We+Et<0||Se+It>=N||We+Et>=N)&&!(p&&!p(Se+It,We+Et))&&!!E._qr&&E._qr.isDark(Se+It,We+Et)}),void(se._element&&he._dotsClipPath&&he._dotsClipPath.appendChild(se._element))):"continue"},Ft=0;Ft<N;Ft++)Sn(Ft)},he=this,ne=0;ne<N;ne++)pe(ne);if(F.shape===P){var ie=Math.floor((K/W-N)/2),be=N+2*ie,De=Y-ie*W,ue=V-ie*W,ve=[],de=Math.floor(be/2);for(ne=0;ne<be;ne++){ve[ne]=[];for(var ge=0;ge<be;ge++)ne>=ie-1&&ne<=be-ie&&ge>=ie-1&&ge<=be-ie||Math.sqrt((ne-de)*(ne-de)+(ge-de)*(ge-de))>de?ve[ne][ge]=0:ve[ne][ge]=this._qr.isDark(ge-2*ie<0?ge:ge>=N?ge-2*ie:ge-ie,ne-2*ie<0?ne:ne>=N?ne-2*ie:ne-ie)?1:0}var Re=function(Se){for(var Sn=function(We){if(!ve[Se][We])return"continue";se.draw(De+Se*W,ue+We*W,W,function(It,Et){var Mt;return!!(!((Mt=ve[Se+It])===null||Mt===void 0)&&Mt[We+Et])}),se._element&&Ut._dotsClipPath&&Ut._dotsClipPath.appendChild(se._element)},Ft=0;Ft<be;Ft++)Sn(Ft)},Ut=this;for(ne=0;ne<be;ne++)Re(ne)}},$.prototype.drawCorners=function(){var p=this;if(!this._qr)throw"QR code is not defined";var w=this._element,b=this._options;if(!w)throw"Element code is not defined";var E=this._qr.getModuleCount(),F=Math.min(b.width,b.height)-2*b.margin,N=(b.shape===P?F/Math.sqrt(2):F)/E,K=7*N,W=3*N,Y=(b.width-E*N)/2,V=(b.height-E*N)/2;[[0,0,0],[1,0,Math.PI/2],[0,1,-Math.PI/2]].forEach(function(se){var pe,he,ne,ie,be,De,ue,ve,de,ge,Re,Ut,Se=se[0],Sn=se[1],Ft=se[2],We=Y+Se*N*(E-7),It=V+Sn*N*(E-7),Et=p._dotsClipPath,Mt=p._dotsClipPath;if((!((pe=b.cornersSquareOptions)===null||pe===void 0)&&pe.gradient||!((he=b.cornersSquareOptions)===null||he===void 0)&&he.color)&&((Et=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id","clip-path-corners-square-color-"+Se+"-"+Sn),p._defs.appendChild(Et),p._cornersSquareClipPath=p._cornersDotClipPath=Mt=Et,p._createColor({options:(ne=b.cornersSquareOptions)===null||ne===void 0?void 0:ne.gradient,color:(ie=b.cornersSquareOptions)===null||ie===void 0?void 0:ie.color,additionalRotation:Ft,x:We,y:It,height:K,width:K,name:"corners-square-color-"+Se+"-"+Sn})),(be=b.cornersSquareOptions)===null||be===void 0?void 0:be.type){var al=new C({svg:p._element,type:b.cornersSquareOptions.type});al.draw(We,It,K,Ft),al._element&&Et&&Et.appendChild(al._element)}else for(var vi=new A({svg:p._element,type:b.dotsOptions.type}),PC=function(An){for(var ll=function(_i){if(!(!((De=m[An])===null||De===void 0)&&De[_i]))return"continue";vi.draw(We+An*N,It+_i*N,N,function(ul,hl){var Si;return!!(!((Si=m[An+ul])===null||Si===void 0)&&Si[_i+hl])}),vi._element&&Et&&Et.appendChild(vi._element)},xi=0;xi<m[An].length;xi++)ll(xi)},Ei=0;Ei<m.length;Ei++)PC(Ei);if((!((ue=b.cornersDotOptions)===null||ue===void 0)&&ue.gradient||!((ve=b.cornersDotOptions)===null||ve===void 0)&&ve.color)&&((Mt=document.createElementNS("http://www.w3.org/2000/svg","clipPath")).setAttribute("id","clip-path-corners-dot-color-"+Se+"-"+Sn),p._defs.appendChild(Mt),p._cornersDotClipPath=Mt,p._createColor({options:(de=b.cornersDotOptions)===null||de===void 0?void 0:de.gradient,color:(ge=b.cornersDotOptions)===null||ge===void 0?void 0:ge.color,additionalRotation:Ft,x:We+2*N,y:It+2*N,height:W,width:W,name:"corners-dot-color-"+Se+"-"+Sn})),(Re=b.cornersDotOptions)===null||Re===void 0?void 0:Re.type){var cl=new q({svg:p._element,type:b.cornersDotOptions.type});cl.draw(We+2*N,It+2*N,W,Ft),cl._element&&Mt&&Mt.appendChild(cl._element)}else{vi=new A({svg:p._element,type:b.dotsOptions.type});var TC=function(An){for(var ll=function(_i){if(!(!((Ut=_[An])===null||Ut===void 0)&&Ut[_i]))return"continue";vi.draw(We+An*N,It+_i*N,N,function(ul,hl){var Si;return!!(!((Si=_[An+ul])===null||Si===void 0)&&Si[_i+hl])}),vi._element&&Mt&&Mt.appendChild(vi._element)},xi=0;xi<_[An].length;xi++)ll(xi)};for(Ei=0;Ei<_.length;Ei++)TC(Ei)}})},$.prototype.loadImage=function(){var p=this;return new Promise(function(w,b){var E=p._options,F=new Image;if(!E.image)return b("Image is not defined");typeof E.imageOptions.crossOrigin=="string"&&(F.crossOrigin=E.imageOptions.crossOrigin),p._image=F,F.onload=function(){w()},F.src=E.image})},$.prototype.drawImage=function(p){var w=p.width,b=p.height,E=p.count,F=p.dotSize;return T(this,void 0,void 0,function(){var N,K,W,Y,V,se,pe,he,ne;return S(this,function(ie){switch(ie.label){case 0:return N=this._options,K=(N.width-E*F)/2,W=(N.height-E*F)/2,Y=K+N.imageOptions.margin+(E*F-w)/2,V=W+N.imageOptions.margin+(E*F-b)/2,se=w-2*N.imageOptions.margin,pe=b-2*N.imageOptions.margin,(he=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("x",String(Y)),he.setAttribute("y",String(V)),he.setAttribute("width",se+"px"),he.setAttribute("height",pe+"px"),[4,B(N.image||"")];case 1:return ne=ie.sent(),he.setAttribute("href",ne||""),this._element.appendChild(he),[2]}})})},$.prototype._createColor=function(p){var w=p.options,b=p.color,E=p.additionalRotation,F=p.x,N=p.y,K=p.height,W=p.width,Y=p.name,V=W>K?W:K,se=document.createElementNS("http://www.w3.org/2000/svg","rect");if(se.setAttribute("x",String(F)),se.setAttribute("y",String(N)),se.setAttribute("height",String(K)),se.setAttribute("width",String(W)),se.setAttribute("clip-path","url('#clip-path-"+Y+"')"),w){var pe;if(w.type==="radial")(pe=document.createElementNS("http://www.w3.org/2000/svg","radialGradient")).setAttribute("id",Y),pe.setAttribute("gradientUnits","userSpaceOnUse"),pe.setAttribute("fx",String(F+W/2)),pe.setAttribute("fy",String(N+K/2)),pe.setAttribute("cx",String(F+W/2)),pe.setAttribute("cy",String(N+K/2)),pe.setAttribute("r",String(V/2));else{var he=((w.rotation||0)+E)%(2*Math.PI),ne=(he+2*Math.PI)%(2*Math.PI),ie=F+W/2,be=N+K/2,De=F+W/2,ue=N+K/2;ne>=0&&ne<=.25*Math.PI||ne>1.75*Math.PI&&ne<=2*Math.PI?(ie-=W/2,be-=K/2*Math.tan(he),De+=W/2,ue+=K/2*Math.tan(he)):ne>.25*Math.PI&&ne<=.75*Math.PI?(be-=K/2,ie-=W/2/Math.tan(he),ue+=K/2,De+=W/2/Math.tan(he)):ne>.75*Math.PI&&ne<=1.25*Math.PI?(ie+=W/2,be+=K/2*Math.tan(he),De-=W/2,ue-=K/2*Math.tan(he)):ne>1.25*Math.PI&&ne<=1.75*Math.PI&&(be+=K/2,ie+=W/2/Math.tan(he),ue-=K/2,De-=W/2/Math.tan(he)),(pe=document.createElementNS("http://www.w3.org/2000/svg","linearGradient")).setAttribute("id",Y),pe.setAttribute("gradientUnits","userSpaceOnUse"),pe.setAttribute("x1",String(Math.round(ie))),pe.setAttribute("y1",String(Math.round(be))),pe.setAttribute("x2",String(Math.round(De))),pe.setAttribute("y2",String(Math.round(ue)))}w.colorStops.forEach(function(ve){var de=ve.offset,ge=ve.color,Re=document.createElementNS("http://www.w3.org/2000/svg","stop");Re.setAttribute("offset",100*de+"%"),Re.setAttribute("stop-color",ge),pe.appendChild(Re)}),se.setAttribute("fill","url('#"+Y+"')"),this._defs.appendChild(pe)}else b&&se.setAttribute("fill",b);this._element.appendChild(se)},$.instanceCount=0,$}(),R="canvas";for(var U={},H=0;H<=40;H++)U[H]=H;const G={type:R,shape:"square",width:300,height:300,data:"",margin:0,qrOptions:{typeNumber:U[0],mode:void 0,errorCorrectionLevel:"Q"},imageOptions:{hideBackgroundDots:!0,imageSize:.4,crossOrigin:void 0,margin:0},dotsOptions:{type:"square",color:"#000"},backgroundOptions:{round:0,color:"#fff"}};var Q=function(){return Q=Object.assign||function($){for(var p,w=1,b=arguments.length;w<b;w++)for(var E in p=arguments[w])Object.prototype.hasOwnProperty.call(p,E)&&($[E]=p[E]);return $},Q.apply(this,arguments)};function Z($){var p=Q({},$);if(!p.colorStops||!p.colorStops.length)throw"Field 'colorStops' is required in gradient";return p.rotation?p.rotation=Number(p.rotation):p.rotation=0,p.colorStops=p.colorStops.map(function(w){return Q(Q({},w),{offset:Number(w.offset)})}),p}function X($){var p=Q({},$);return p.width=Number(p.width),p.height=Number(p.height),p.margin=Number(p.margin),p.imageOptions=Q(Q({},p.imageOptions),{hideBackgroundDots:!!p.imageOptions.hideBackgroundDots,imageSize:Number(p.imageOptions.imageSize),margin:Number(p.imageOptions.margin)}),p.margin>Math.min(p.width,p.height)&&(p.margin=Math.min(p.width,p.height)),p.dotsOptions=Q({},p.dotsOptions),p.dotsOptions.gradient&&(p.dotsOptions.gradient=Z(p.dotsOptions.gradient)),p.cornersSquareOptions&&(p.cornersSquareOptions=Q({},p.cornersSquareOptions),p.cornersSquareOptions.gradient&&(p.cornersSquareOptions.gradient=Z(p.cornersSquareOptions.gradient))),p.cornersDotOptions&&(p.cornersDotOptions=Q({},p.cornersDotOptions),p.cornersDotOptions.gradient&&(p.cornersDotOptions.gradient=Z(p.cornersDotOptions.gradient))),p.backgroundOptions&&(p.backgroundOptions=Q({},p.backgroundOptions),p.backgroundOptions.gradient&&(p.backgroundOptions.gradient=Z(p.backgroundOptions.gradient))),p}var re=a(192),ce=a.n(re),fe=function($,p,w,b){return new(w||(w=Promise))(function(E,F){function N(Y){try{W(b.next(Y))}catch(V){F(V)}}function K(Y){try{W(b.throw(Y))}catch(V){F(V)}}function W(Y){var V;Y.done?E(Y.value):(V=Y.value,V instanceof w?V:new w(function(se){se(V)})).then(N,K)}W((b=b.apply($,[])).next())})},le=function($,p){var w,b,E,F,N={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return F={next:K(0),throw:K(1),return:K(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function K(W){return function(Y){return function(V){if(w)throw new TypeError("Generator is already executing.");for(;N;)try{if(w=1,b&&(E=2&V[0]?b.return:V[0]?b.throw||((E=b.return)&&E.call(b),0):b.next)&&!(E=E.call(b,V[1])).done)return E;switch(b=0,E&&(V=[2&V[0],E.value]),V[0]){case 0:case 1:E=V;break;case 4:return N.label++,{value:V[1],done:!1};case 5:N.label++,b=V[1],V=[0];continue;case 7:V=N.ops.pop(),N.trys.pop();continue;default:if(!((E=(E=N.trys).length>0&&E[E.length-1])||V[0]!==6&&V[0]!==2)){N=0;continue}if(V[0]===3&&(!E||V[1]>E[0]&&V[1]<E[3])){N.label=V[1];break}if(V[0]===6&&N.label<E[1]){N.label=E[1],E=V;break}if(E&&N.label<E[2]){N.label=E[2],N.ops.push(V);break}E[2]&&N.ops.pop(),N.trys.pop();continue}V=p.call($,N)}catch(se){V=[6,se],b=0}finally{w=E=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([W,Y])}}};const ae=function(){function $(p){this._options=p?X(f(G,p)):G,this.update()}return $._clearContainer=function(p){p&&(p.innerHTML="")},$.prototype._setupSvg=function(){var p=this;if(this._qr){var w=new k(this._options);this._svg=w.getElement(),this._svgDrawingPromise=w.drawQR(this._qr).then(function(){var b;p._svg&&((b=p._extension)===null||b===void 0||b.call(p,w.getElement(),p._options))})}},$.prototype._setupCanvas=function(){var p,w=this;this._qr&&(this._canvas=document.createElement("canvas"),this._canvas.width=this._options.width,this._canvas.height=this._options.height,this._setupSvg(),this._canvasDrawingPromise=(p=this._svgDrawingPromise)===null||p===void 0?void 0:p.then(function(){if(w._svg){var b=w._svg,E=new XMLSerializer().serializeToString(b),F="data:image/svg+xml;base64,"+btoa(E),N=new Image;return new Promise(function(K){N.onload=function(){var W,Y;(Y=(W=w._canvas)===null||W===void 0?void 0:W.getContext("2d"))===null||Y===void 0||Y.drawImage(N,0,0),K()},N.src=F})}}))},$.prototype._getElement=function(p){return p===void 0&&(p="png"),fe(this,void 0,void 0,function(){return le(this,function(w){switch(w.label){case 0:if(!this._qr)throw"QR code is empty";return p.toLowerCase()!=="svg"?[3,2]:(this._svg&&this._svgDrawingPromise||this._setupSvg(),[4,this._svgDrawingPromise]);case 1:return w.sent(),[2,this._svg];case 2:return this._canvas&&this._canvasDrawingPromise||this._setupCanvas(),[4,this._canvasDrawingPromise];case 3:return w.sent(),[2,this._canvas]}})})},$.prototype.update=function(p){$._clearContainer(this._container),this._options=p?X(f(this._options,p)):this._options,this._options.data&&(this._qr=ce()(this._options.qrOptions.typeNumber,this._options.qrOptions.errorCorrectionLevel),this._qr.addData(this._options.data,this._options.qrOptions.mode||function(w){switch(!0){case/^[0-9]*$/.test(w):return c;case/^[0-9A-Z $%*+\-./:]*$/.test(w):return l;default:return u}}(this._options.data)),this._qr.make(),this._options.type===R?this._setupCanvas():this._setupSvg(),this.append(this._container))},$.prototype.append=function(p){if(p){if(typeof p.appendChild!="function")throw"Container should be a single DOM node";this._options.type===R?this._canvas&&p.appendChild(this._canvas):this._svg&&p.appendChild(this._svg),this._container=p}},$.prototype.applyExtension=function(p){if(!p)throw"Extension function should be defined.";this._extension=p,this.update()},$.prototype.deleteExtension=function(){this._extension=void 0,this.update()},$.prototype.getRawData=function(p){return p===void 0&&(p="png"),fe(this,void 0,void 0,function(){var w,b,E;return le(this,function(F){switch(F.label){case 0:if(!this._qr)throw"QR code is empty";return[4,this._getElement(p)];case 1:return(w=F.sent())?p.toLowerCase()==="svg"?(b=new XMLSerializer,E=b.serializeToString(w),[2,new Blob([`<?xml version="1.0" standalone="no"?>\r
`+E],{type:"image/svg+xml"})]):[2,new Promise(function(N){return w.toBlob(N,"image/"+p,1)})]:[2,null]}})})},$.prototype.download=function(p){return fe(this,void 0,void 0,function(){var w,b,E,F,N;return le(this,function(K){switch(K.label){case 0:if(!this._qr)throw"QR code is empty";return w="png",b="qr",typeof p=="string"?(w=p,console.warn("Extension is deprecated as argument for 'download' method, please pass object { name: '...', extension: '...' } as argument")):typeof p=="object"&&p!==null&&(p.name&&(b=p.name),p.extension&&(w=p.extension)),[4,this._getElement(w)];case 1:return(E=K.sent())?(w.toLowerCase()==="svg"?(F=new XMLSerializer,N=`<?xml version="1.0" standalone="no"?>\r
`+(N=F.serializeToString(E)),g("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(N),b+".svg")):g(E.toDataURL("image/"+w),b+"."+w),[2]):[2]}})})},$}()}},i={};function r(s){if(i[s])return i[s].exports;var o=i[s]={exports:{}};return n[s](o,o.exports,r),o.exports}return r.n=s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return r.d(o,{a:o}),o},r.d=(s,o)=>{for(var a in o)r.o(o,a)&&!r.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:o[a]})},r.o=(s,o)=>Object.prototype.hasOwnProperty.call(s,o),r(676)})().default})}(fo)),fo.exports}var AC=SC();const IC=ts(AC),ol={contractAddress:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",abi:[{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],type:"function"}],multiplier:1e6};function DC({fromAddress:t,toAddress:e,uint256:n}){return{from:t,to:ol.contractAddress,data:h0({abi:ol.abi,functionName:"transfer",args:[e,n]})}}class CC extends HTMLElement{constructor(){super(),this.initOptions=null,this.API=null,this.sdkConfig=null,this.cryptoTransaction=null,this.getCryptoTransactionIntervalID=null,this.lydianTransaction=null,this.getLydianTransactionIntervalID=null,this.walletConnectService=null,this.containerPaymentSuccess=null,this.containerPaymentFailure=null,this.containerQRCode=null,this.lydianProcessingContainer=null,this.lydianProcessingText=null,this.lydianUsdtPaymentContainer=null,this.containerMoreNetworks=null,this.containerNetworks=null,this.containerNetworkList=null,this.assetImg=null,this.assetTitle=null,this.containerCryptoPayment=null,this.containerAssets=null,this.containerAssetsMore=null,this.btnMoreAssets=null,this.canvasQRCode=null,this.displayTotalAmount=null,this.displayTransactionID=null,this.displayAssetTotal=null,this.displayScanText=null,this.displayExpirationLeft=null,this.btnAppPayment=null,this.btnCryptoPayment=null,this.btnMoreNetworks=null,this.btnCancelCryptoPayment=null,this.lydianBtnCancelCryptoPayment=null,this.lydianBtnCancelUsdtPayment=null,this.lydianBtnCancelWalletConnect=null,this.selectedAsset=null,this.selectedAssetNetworks=null,this.selectedNetwork=null,this.connectWalletButtonsContainer=null,this.containerMoreWallets=null,this.containerWalletList=null,this.btnMoreWallets=null,this.containerWalletManual=null,this.modal=null,this.modalBtnBack=null,this.modalContainerPaymentSuccess=null,this.modalContainerPaymentFailure=null,this.modalContainerQRCode=null,this.modalLydianProcessingContainer=null,this.modalLydianProcessingText=null,this.modalContainerMoreNetworks=null,this.modalContainerNetworks=null,this.modalContainerNetworkList=null,this.modalBtnMoreNetworks=null,this.modalAssetImg=null,this.modalAssetTitle=null,this.modalContainerCryptoPayment=null,this.modalContainerAssets=null,this.modalCanvasQRCode=null,this.modalDisplayAssetTotal=null,this.modalDisplayScanText=null,this.modalDisplayExpirationLeft=null,this.modalTitle=null,this.modalDisplayNetwork=null,this.modalDisplayWalletAddress=null,this.modalButtonCopyAssetTotal=null,this.modalButtonCopyWalletAddress=null,this.timeInterval=null,this.shadow=this.attachShadow({mode:"open"}),this.walletConnectService=new BD({shadow:this.shadow})}async getMerchantConfiguration(e){var n;this.initOptions=e,this.API=new Ll(e.sandbox?x0:_0,this.initOptions.publishableKey),this.render(),await this.getSDKConfig(),this.initializeComponents(),this.setAssetButtons(),this.attachListeners(),this.loadInitialState(),await((n=this.walletConnectService)==null?void 0:n.init())}async updateTransaction(e){if(!this.initOptions)throw new Error("Tether Pay not initialized.");if(!e.amount||!e.currency)throw new Error("Amount and currency are required.");if(!fl(e.currency))throw new Error("Invalid value for currency, valid values are: "+po.join(", "));this.initOptions.transaction=e,this.loadInitialState()}loadInitialState(){var e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I,O,B,D,x,v,A;this.setSelectedAsset(null),this.setSelectedNetwork(null),this.clearInterval(),this.hideQRCode(),this.hidePaymentSuccess(),this.showButtons(),(e=this.btnAppPayment)==null||e.classList.add("hidden"),(n=this.sdkConfig)!=null&&n.appPayEnabled&&((i=this.btnAppPayment)==null||i.classList.remove("hidden")),(r=this.btnCryptoPayment)==null||r.classList.add("hidden"),(s=this.sdkConfig)!=null&&s.cryptoPayEnabled&&((o=this.btnCryptoPayment)==null||o.classList.remove("hidden")),(a=this.lydianUsdtPaymentContainer)==null||a.classList.add("hidden"),(c=this.containerCryptoPayment)==null||c.classList.add("hidden"),(l=this.containerAssetsMore)==null||l.classList.add("hidden"),(u=this.btnMoreAssets)==null||u.classList.remove("hidden"),(h=this.containerNetworks)==null||h.classList.add("hidden"),(d=this.containerMoreNetworks)==null||d.classList.add("hidden"),(y=this.btnMoreNetworks)==null||y.classList.remove("hidden"),(f=this.containerMoreWallets)==null||f.classList.add("hidden"),(g=this.btnMoreWallets)==null||g.classList.remove("hidden"),(I=this.connectWalletButtonsContainer)==null||I.classList.add("hidden"),(O=this.modalContainerNetworks)==null||O.classList.add("hidden"),(B=this.modalContainerMoreNetworks)==null||B.classList.add("hidden"),(D=this.modalBtnMoreNetworks)==null||D.classList.remove("hidden"),(x=this.modalContainerCryptoPayment)==null||x.classList.add("hidden"),this.modalTitle&&(this.modalTitle.innerText="Select an Asset"),this.timeInterval&&(clearInterval(this.timeInterval),this.timeInterval=null,(v=this.displayExpirationLeft)!=null&&v.innerHTML&&(this.displayExpirationLeft.innerHTML="15:00"),(A=this.modalDisplayExpirationLeft)!=null&&A.innerHTML&&(this.modalDisplayExpirationLeft.innerHTML="15:00"))}setSelectedAsset(e){switch(e){case gl:this.selectedAsset=Cl;break;case wl:this.selectedAsset=Dl;break;case Sl:this.selectedAsset=Al;break;case vl:this.selectedAsset=Il;break;case W0:this.selectedAsset=ry;break;case G0:this.selectedAsset=sy;break;case Q0:this.selectedAsset=oy;break;case Y0:this.selectedAsset=ay;break;case Z0:this.selectedAsset=cy;break;case J0:this.selectedAsset=ly;break;case ey:this.selectedAsset=uy;break;case ty:this.selectedAsset=hy;break;case ny:this.selectedAsset=dy;break;case bl:this.selectedAsset=Ol;break;case ml:this.selectedAsset=$l;break;case El:this.selectedAsset=Pl;break;case _l:this.selectedAsset=Tl;break;case yl:this.selectedAsset=Bl;break;case xl:this.selectedAsset=kl;break;default:this.selectedAsset=null;break}}setSelectedNetwork(e){this.selectedNetwork=e}setSelectedWallet(e){this.selectedWallet=e}showPaymentSuccess(){var e,n,i;(e=this.initOptions)!=null&&e.isEmbedded?(n=this.containerPaymentSuccess)==null||n.classList.remove("hidden"):(i=this.modalContainerPaymentSuccess)==null||i.classList.remove("hidden"),this.hideButtons(),this.hideQRCode()}showPaymentFailure(){var e,n,i;(e=this.initOptions)!=null&&e.isEmbedded?(n=this.containerPaymentFailure)==null||n.classList.remove("hidden"):(i=this.modalContainerPaymentFailure)==null||i.classList.remove("hidden"),this.hideButtons(),this.hideQRCode()}hidePaymentSuccess(){var e,n,i;(e=this.initOptions)!=null&&e.isEmbedded?(n=this.containerPaymentSuccess)==null||n.classList.add("hidden"):(i=this.modalContainerPaymentSuccess)==null||i.classList.add("hidden")}showProcessing(e="Processing..."){var n,i,r,s;(n=this.initOptions)!=null&&n.isEmbedded&&this.lydianProcessingText?this.lydianProcessingText.innerHTML=e:this.modalLydianProcessingText&&(this.modalLydianProcessingText.innerHTML=e),(i=this.initOptions)!=null&&i.isEmbedded?(r=this.lydianProcessingContainer)==null||r.classList.remove("hidden"):(s=this.modalLydianProcessingContainer)==null||s.classList.remove("hidden")}hideProcessing(){var e,n,i,r;(e=this.initOptions)!=null&&e.isEmbedded&&this.lydianProcessingText?this.lydianProcessingText.innerHTML="":this.modalLydianProcessingText&&(this.modalLydianProcessingText.innerHTML=""),(n=this.initOptions)!=null&&n.isEmbedded?(i=this.lydianProcessingContainer)==null||i.classList.add("hidden"):(r=this.modalLydianProcessingContainer)==null||r.classList.add("hidden")}showButtons(){var e,n,i,r;(e=this.sdkConfig)!=null&&e.appPayEnabled&&((n=this.btnAppPayment)==null||n.classList.remove("hidden")),(i=this.sdkConfig)!=null&&i.cryptoPayEnabled&&((r=this.btnCryptoPayment)==null||r.classList.remove("hidden"))}hideButtons(){var e,n,i,r,s,o,a,c,l;(e=this.btnAppPayment)==null||e.classList.add("hidden"),(n=this.btnCryptoPayment)==null||n.classList.add("hidden"),(i=this.lydianUsdtPaymentContainer)==null||i.classList.add("hidden"),(r=this.containerCryptoPayment)==null||r.classList.add("hidden"),(s=this.containerNetworks)==null||s.classList.add("hidden"),(o=this.connectWalletButtonsContainer)==null||o.classList.add("hidden"),(a=this.containerWalletManual)==null||a.classList.add("hidden"),(c=this.modalContainerCryptoPayment)==null||c.classList.add("hidden"),(l=this.modalContainerNetworks)==null||l.classList.add("hidden")}showQRCode(e,n,i){var d,y,f,g,I,O,B,D,x;if(!this.selectedAsset)return;const r=n+" "+this.selectedAsset.code.toUpperCase(),s=this.selectedNetwork?ND(this.selectedNetwork):this.selectedAsset.networks[0],o=(d=this.initOptions)==null?void 0:d.transaction.referenceNumber,a=(f=this.initOptions)==null?void 0:f.transaction.amount.toLocaleString("en-US",{style:"currency",currency:(y=this.initOptions)==null?void 0:y.transaction.currency});(g=this.initOptions)!=null&&g.isEmbedded?((I=this.containerQRCode)==null||I.classList.remove("hidden"),this.displayAssetTotal&&(this.displayAssetTotal.innerText=r),this.displayTransactionID&&(this.displayTransactionID.innerText=o),this.displayTotalAmount&&(this.displayTotalAmount.innerText=a)):((O=this.modalContainerQRCode)==null||O.classList.remove("hidden"),this.modalDisplayAssetTotal&&(this.modalDisplayAssetTotal.innerText=r),this.modalTitle&&(this.modalTitle.innerText="Scan with Your Wallet"),this.modalDisplayNetwork&&(this.modalDisplayNetwork.innerText=s),this.modalDisplayWalletAddress&&(this.modalDisplayWalletAddress.innerText=i));let c=null;if((B=this.initOptions)!=null&&B.isEmbedded&&this.displayExpirationLeft?c=this.displayExpirationLeft:this.modalDisplayExpirationLeft&&(c=this.modalDisplayExpirationLeft),c){const v=new Date().getTime()+9e5;this.timeInterval=setInterval(()=>{const A=new Date().getTime(),L=v-A,M=Math.floor(L%(1e3*60*60)/(1e3*60)),C=Math.floor(L%(1e3*60)/1e3);c.innerHTML=String(M).padStart(2,"0")+":"+String(C).padStart(2,"0"),L<=0&&this.timeInterval&&clearInterval(this.timeInterval)},1e3)}const l="Scan the code below using your <br />CAMERA, CRYPTO WALLET, or QR READER";(D=this.initOptions)!=null&&D.isEmbedded&&this.displayScanText&&this.selectedWallet.code=="manual"?this.displayScanText.innerHTML=l:this.modalDisplayScanText&&this.selectedWallet.code=="manual"&&(this.modalDisplayScanText.innerHTML=l);let u="";switch(this.selectedWallet.code){case"manual":u="https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/7065960c-8ebd-4d80-f352-8027ff2bb600/public";break;case"metamask":u="https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/a0ddd685-4a84-4f5c-ab6d-9796994cf500/public";break;case"trustwallet":u="https://imagedelivery.net/PC9Gitw-w-Qpo5uwdjlmgw/327c5e87-ea96-4b84-aa1f-8f99c2c70f00/public";break}const h=new IC({width:238,height:238,type:"canvas",data:e,image:u,dotsOptions:{color:"#000000",type:"extra-rounded"},backgroundOptions:{color:"#ffffff"}});(x=this.initOptions)!=null&&x.isEmbedded&&this.canvasQRCode?h.append(this.canvasQRCode):this.modalCanvasQRCode&&h.append(this.modalCanvasQRCode)}hideQRCode(){var e,n,i;(e=this.initOptions)!=null&&e.isEmbedded?((n=this.containerQRCode)==null||n.classList.add("hidden"),this.canvasQRCode&&(this.canvasQRCode.innerHTML="")):((i=this.modalContainerQRCode)==null||i.classList.add("hidden"),this.modalCanvasQRCode&&(this.modalCanvasQRCode.innerHTML=""))}render(){this.shadow.innerHTML=`<style>${b0}</style>${v0}`}initializeComponents(){var e,n,i,r,s,o,a,c,l,u,h,d,y,f,g,I,O,B,D,x,v,A,L,M,C,z,j,q,P,T,S,m,_,k,R,U,H,G,Q,Z,X,re,ce,fe,le,ae,$,p,w,b,E,F,N,K,W,Y,V,se;this.lydianUsdtPaymentContainer=(e=this.shadowRoot)==null?void 0:e.getElementById("lydianUsdtPaymentContainer"),this.containerMoreNetworks=(n=this.shadowRoot)==null?void 0:n.getElementById("containerMoreNetworks"),this.containerNetworks=(i=this.shadowRoot)==null?void 0:i.getElementById("containerNetworks"),this.containerNetworkList=(r=this.shadowRoot)==null?void 0:r.getElementById("containerNetworkList"),this.containerPaymentSuccess=(s=this.shadowRoot)==null?void 0:s.getElementById("containerPaymentSuccess"),this.containerPaymentFailure=(o=this.shadowRoot)==null?void 0:o.getElementById("containerPaymentFailure"),this.containerQRCode=(a=this.shadowRoot)==null?void 0:a.getElementById("containerQRCode"),this.lydianProcessingContainer=(c=this.shadowRoot)==null?void 0:c.getElementById("lydianProcessingContainer"),this.lydianProcessingText=(l=this.shadowRoot)==null?void 0:l.getElementById("lydianProcessingText"),this.assetImg=(u=this.shadowRoot)==null?void 0:u.getElementById("assetImg"),this.assetTitle=(h=this.shadowRoot)==null?void 0:h.getElementById("assetTitle"),this.containerCryptoPayment=(d=this.shadowRoot)==null?void 0:d.getElementById("containerCryptoPayment"),this.containerAssets=(y=this.shadowRoot)==null?void 0:y.getElementById("containerAssets"),this.containerAssetsMore=(f=this.shadowRoot)==null?void 0:f.getElementById("containerAssetsMore"),this.canvasQRCode=(g=this.shadowRoot)==null?void 0:g.getElementById("canvasQRCode"),this.displayTotalAmount=(I=this.shadowRoot)==null?void 0:I.getElementById("displayTotalAmount"),this.displayTransactionID=(O=this.shadowRoot)==null?void 0:O.getElementById("displayTransactionID"),this.displayAssetTotal=(B=this.shadowRoot)==null?void 0:B.getElementById("displayAssetTotal"),this.displayScanText=(D=this.shadowRoot)==null?void 0:D.getElementById("displayScanText"),this.displayExpirationLeft=(x=this.shadowRoot)==null?void 0:x.getElementById("displayExpirationLeft"),this.btnAppPayment=(v=this.shadowRoot)==null?void 0:v.getElementById("btnAppPayment"),this.btnCryptoPayment=(A=this.shadowRoot)==null?void 0:A.getElementById("btnCryptoPayment"),this.btnMoreNetworks=(L=this.shadowRoot)==null?void 0:L.getElementById("btnMoreNetworks"),this.btnMoreAssets=(M=this.shadowRoot)==null?void 0:M.getElementById("btnMoreAssets"),this.btnMoreWallets=(C=this.shadowRoot)==null?void 0:C.getElementById("btnMoreWallets"),this.btnCancelCryptoPayment=(z=this.shadowRoot)==null?void 0:z.getElementById("btnCancelCryptoPayment"),this.lydianBtnCancelCryptoPayment=(j=this.shadowRoot)==null?void 0:j.getElementById("lydianBtnCancelCryptoPayment"),this.lydianBtnCancelUsdtPayment=(q=this.shadowRoot)==null?void 0:q.getElementById("lydianBtnCancelUsdtPayment"),this.lydianBtnCancelWalletConnect=(P=this.shadowRoot)==null?void 0:P.getElementById("lydianBtnCancelWalletConnect"),this.connectWalletButtonsContainer=(T=this.shadowRoot)==null?void 0:T.getElementById("connectWalletContainer"),this.containerMoreWallets=(S=this.shadowRoot)==null?void 0:S.getElementById("containerMoreWallets"),this.containerWalletList=(m=this.shadowRoot)==null?void 0:m.getElementById("containerWalletList"),this.containerWalletManual=(_=this.shadowRoot)==null?void 0:_.getElementById("containerWalletManual"),this.modal=(k=this.shadowRoot)==null?void 0:k.getElementById("modal"),this.modalBtnBack=(R=this.shadowRoot)==null?void 0:R.getElementById("modalBtnBack"),this.modalContainerNetworks=(U=this.shadowRoot)==null?void 0:U.getElementById("modalContainerNetworks"),this.modalContainerMoreNetworks=(H=this.shadowRoot)==null?void 0:H.getElementById("modalContainerMoreNetworks"),this.modalContainerNetworks=(G=this.shadowRoot)==null?void 0:G.getElementById("modalContainerNetworks"),this.modalContainerNetworkList=(Q=this.shadowRoot)==null?void 0:Q.getElementById("modalContainerNetworkList"),this.modalBtnMoreNetworks=(Z=this.shadowRoot)==null?void 0:Z.getElementById("modalBtnMoreNetworks"),this.modalContainerPaymentSuccess=(X=this.shadowRoot)==null?void 0:X.getElementById("modalContainerPaymentSuccess"),this.modalContainerPaymentFailure=(re=this.shadowRoot)==null?void 0:re.getElementById("modalContainerPaymentFailure"),this.modalContainerQRCode=(ce=this.shadowRoot)==null?void 0:ce.getElementById("modalContainerQRCode"),this.modalLydianProcessingContainer=(fe=this.shadowRoot)==null?void 0:fe.getElementById("modalLydianProcessingContainer"),this.modalLydianProcessingText=(le=this.shadowRoot)==null?void 0:le.getElementById("modalLydianProcessingText"),this.modalContainerCryptoPayment=(ae=this.shadowRoot)==null?void 0:ae.getElementById("modalContainerCryptoPayment"),this.modalContainerAssets=($=this.shadowRoot)==null?void 0:$.getElementById("modalContainerAssets"),this.modalCanvasQRCode=(p=this.shadowRoot)==null?void 0:p.getElementById("modalCanvasQRCode"),this.modalDisplayAssetTotal=(w=this.shadowRoot)==null?void 0:w.getElementById("modalDisplayAssetTotal"),this.modalDisplayScanText=(b=this.shadowRoot)==null?void 0:b.getElementById("modalDisplayScanText"),this.modalDisplayExpirationLeft=(E=this.shadowRoot)==null?void 0:E.getElementById("modalDisplayExpirationLeft"),this.modalAssetImg=(F=this.shadowRoot)==null?void 0:F.getElementById("modalAssetImg"),this.modalAssetTitle=(N=this.shadowRoot)==null?void 0:N.getElementById("modalAssetTitle"),this.modalTitle=(K=this.shadowRoot)==null?void 0:K.getElementById("modalTitle"),this.modalDisplayNetwork=(W=this.shadowRoot)==null?void 0:W.getElementById("modalDisplayNetwork"),this.modalDisplayWalletAddress=(Y=this.shadowRoot)==null?void 0:Y.getElementById("modalDisplayWalletAddress"),this.modalButtonCopyAssetTotal=(V=this.shadowRoot)==null?void 0:V.getElementById("modalButtonCopyAssetTotal"),this.modalButtonCopyWalletAddress=(se=this.shadowRoot)==null?void 0:se.getElementById("modalButtonCopyWalletAddress")}attachListeners(){var e,n,i,r,s,o,a,c,l,u,h,d;(e=this.btnAppPayment)==null||e.addEventListener("click",y=>{console.log("TODO: NOT IMPLEMENTED")}),(n=this.btnCryptoPayment)==null||n.addEventListener("click",()=>{var y,f,g,I,O;(y=this.btnCryptoPayment)==null||y.classList.toggle("hidden"),(f=this.initOptions)!=null&&f.isEmbedded?(g=this.containerCryptoPayment)==null||g.classList.toggle("hidden"):((I=this.modal)==null||I.showModal(),(O=this.modalContainerCryptoPayment)==null||O.classList.toggle("hidden"))}),(i=this.modalBtnBack)==null||i.addEventListener("click",()=>{var y;(y=this.modal)==null||y.close(),this.loadInitialState()}),(r=this.modal)==null||r.addEventListener("click",y=>{var I,O;const f=(I=this.modal)==null?void 0:I.getBoundingClientRect();let g=null;f!=null&&(g=y.clientX>=f.left&&y.clientX<=f.right&&y.clientY>=f.top&&y.clientY<=f.bottom),g||((O=this.modal)==null||O.close(),this.loadInitialState())}),(s=this.btnMoreNetworks)==null||s.addEventListener("click",()=>{var y,f;(y=this.containerMoreNetworks)==null||y.classList.toggle("hidden"),(f=this.btnMoreNetworks)==null||f.classList.toggle("hidden")}),(o=this.modalBtnMoreNetworks)==null||o.addEventListener("click",()=>{var y,f;(y=this.modalContainerMoreNetworks)==null||y.classList.toggle("hidden"),(f=this.modalBtnMoreNetworks)==null||f.classList.toggle("hidden")}),(a=this.btnMoreAssets)==null||a.addEventListener("click",()=>{var y,f;(y=this.containerAssetsMore)==null||y.classList.toggle("hidden"),(f=this.btnMoreAssets)==null||f.classList.toggle("hidden")}),(c=this.btnMoreWallets)==null||c.addEventListener("click",()=>{var y,f;(y=this.containerMoreWallets)==null||y.classList.toggle("hidden"),(f=this.btnMoreWallets)==null||f.classList.toggle("hidden")}),(l=this.btnCancelCryptoPayment)==null||l.addEventListener("click",()=>{this.loadInitialState()}),(u=this.lydianBtnCancelCryptoPayment)==null||u.addEventListener("click",()=>{this.loadInitialState()}),(h=this.modalButtonCopyAssetTotal)==null||h.addEventListener("click",y=>{var g;const f=((g=this.modalDisplayAssetTotal)==null?void 0:g.innerText)??"";navigator.clipboard.writeText(f)}),(d=this.modalButtonCopyWalletAddress)==null||d.addEventListener("click",()=>{var f;const y=((f=this.modalDisplayWalletAddress)==null?void 0:f.innerText)??"";navigator.clipboard.writeText(y)})}async createCryptoTransaction(){var e,n,i,r,s,o;if(!this.selectedAsset||!this.selectedNetwork){(n=(e=this.initOptions)==null?void 0:e.paymentFailedListener)==null||n.call(e,"Asset and network selection required.");return}if(this.initOptions&&this.API){this.clearInterval(),this.hideButtons();try{this.cryptoTransaction=await this.API.createCryptoTransaction({descriptor:this.initOptions.transaction.descriptor,referenceNumber:this.initOptions.transaction.referenceNumber,amount:this.initOptions.transaction.amount,amountCurrency:this.initOptions.transaction.currency,asset:this.selectedAsset.code,network:this.selectedNetwork}),console.log("transaction",this.cryptoTransaction)}catch{(r=(i=this.initOptions)==null?void 0:i.paymentFailedListener)==null||r.call(i,"Unable to create transaction.")}}else(o=(s=this.initOptions)==null?void 0:s.paymentFailedListener)==null||o.call(s,"Lydian not initialized.")}startListeningCryptoTransaction(){this.clearInterval(),this.getCryptoTransactionIntervalID=setInterval(async()=>{var e,n,i,r,s,o,a;if((e=this.cryptoTransaction)!=null&&e.transactionId){const c=await((i=this.API)==null?void 0:i.getCryptoTransaction((n=this.cryptoTransaction)==null?void 0:n.transactionId));if(c){c.status===pl&&(this.showPaymentSuccess(),this.clearInterval(),(s=(r=this.initOptions)==null?void 0:r.paymentSuccessListener)==null||s.call(r));const l=Date.parse(c.expiration),u=Date.now();l<u&&(this.showPaymentFailure(),this.clearInterval(),(a=(o=this.initOptions)==null?void 0:o.paymentFailedListener)==null||a.call(o,"Transaction Timed Out / Failed!"))}}},2e3)}startListeningLydianTransaction(){this.clearInterval(),this.getLydianTransactionIntervalID=setInterval(async()=>{var e,n,i,r,s,o,a;if((e=this.lydianTransaction)!=null&&e.transactionId){const c=await((i=this.API)==null?void 0:i.getClusterTransaction((n=this.lydianTransaction)==null?void 0:n.transactionId));if(c){c.status===pl&&(this.showPaymentSuccess(),this.clearInterval(),(s=(r=this.initOptions)==null?void 0:r.paymentSuccessListener)==null||s.call(r));const l=Date.parse(c.expiration),u=Date.now();l<u&&(this.showPaymentFailure(),this.clearInterval(),(a=(o=this.initOptions)==null?void 0:o.paymentFailedListener)==null||a.call(o,"Transaction Timed Out / Failed!"))}}},2e3)}clearInterval(){this.getCryptoTransactionIntervalID&&(clearInterval(this.getCryptoTransactionIntervalID),this.getCryptoTransactionIntervalID=null),this.getLydianTransactionIntervalID&&(clearInterval(this.getLydianTransactionIntervalID),this.getLydianTransactionIntervalID=null)}setAssetButtons(){var n,i,r,s,o,a;if((n=this.initOptions)!=null&&n.isEmbedded&&(!this.containerAssets||!this.containerAssetsMore))return;if(!this.modalContainerAssets)return;const e=(r=(i=this.sdkConfig)==null?void 0:i.allowedAssets)==null?void 0:r.map((c,l)=>{switch(c.code){case gl:return zt(Cl);case wl:return zt(Dl);case Sl:return zt(Al);case vl:return zt(Il);case X0:return zt(iy);case bl:return zt(Ol);case ml:return zt($l);case El:return zt(Pl);case _l:return zt(Tl);case yl:return zt(Bl);case xl:return zt(kl)}});(s=this.initOptions)!=null&&s.isEmbedded?(this.containerAssets.innerHTML="",this.containerAssetsMore.innerHTML="",e==null||e.filter(c=>c).forEach((c,l)=>{l>=2&&this.containerAssetsMore?this.containerAssetsMore.innerHTML+=c:this.containerAssets&&(this.containerAssets.innerHTML+=c)})):(this.modalContainerAssets.innerHTML="",e==null||e.filter(c=>c).forEach((c,l)=>{this.modalContainerAssets&&(this.modalContainerAssets.innerHTML+=c)})),(o=this.sdkConfig)!=null&&o.allowedAssets&&this.sdkConfig.allowedAssets.length<=2&&((a=this.btnMoreAssets)==null||a.classList.add("hidden")),this.attachListenersOnAssets()}attachListenersOnAssets(){var e,n;(n=(e=this.sdkConfig)==null?void 0:e.allowedAssets)==null||n.forEach(i=>{var s;const r=(s=this.shadowRoot)==null?void 0:s.getElementById("btnAsset"+i.code);r==null||r.addEventListener("click",async()=>{var o,a,c;this.setSelectedAsset(i.code),(o=this.initOptions)!=null&&o.isEmbedded?(a=this.containerCryptoPayment)==null||a.classList.add("hidden"):(c=this.modalContainerCryptoPayment)==null||c.classList.add("hidden"),i.type=="token"?(this.setNetworkButtons(),this.modalTitle&&(this.modalTitle.innerText="Select a Network")):(this.setSelectedNetwork(i.networks[0]),this.showWalletConnectButtons())})})}setNetworkButtons(){var i,r,s,o,a,c,l,u,h,d,y,f,g,I,O,B;if((i=this.initOptions)!=null&&i.isEmbedded&&(!this.containerNetworkList||!this.containerMoreNetworks||!this.assetTitle)||!((r=this.initOptions)!=null&&r.isEmbedded)&&(!this.modalContainerNetworkList||!this.modalContainerMoreNetworks||!this.modalAssetTitle)||(s=this.initOptions)!=null&&s.isEmbedded&&!this.assetImg||!((o=this.initOptions)!=null&&o.isEmbedded)&&!this.modalAssetImg)return;(a=this.initOptions)!=null&&a.isEmbedded?(this.containerNetworkList.innerHTML="",this.containerMoreNetworks.innerHTML="",this.assetTitle.innerHTML=(c=this.selectedAsset)==null?void 0:c.title,this.assetImg.src=(l=this.selectedAsset)==null?void 0:l.img):(this.modalContainerNetworkList.innerHTML="",this.modalContainerMoreNetworks.innerHTML="",this.modalAssetTitle.innerHTML=(u=this.selectedAsset)==null?void 0:u.title,this.modalAssetImg.src=(h=this.selectedAsset)==null?void 0:h.img);let e=(d=this.sdkConfig)==null?void 0:d.allowedAssets;const n=e==null?void 0:e.find(D=>{var x;return D.code===((x=this.selectedAsset)==null?void 0:x.code)});if(n==null){console.log("Unknown asset: ",(y=this.selectedAsset)==null?void 0:y.code);return}console.log("asset",n),n==null||n.networks.forEach((D,x)=>{var A,L,M;let v;switch(D){case C0:v=Pe(fy);break;case P0:v=Pe(py);break;case q0:v=Pe(gy);break;case U0:v=Pe(yy);break;case j0:v=Pe(wy);break;case I0:v=Pe(my);break;case S0:v=Pe(by);break;case A0:v=Pe(vy);break;case D0:v=Pe(Ey);break;case O0:v=Pe(xy);break;case k0:v=Pe(_y);break;case R0:v=Pe(Sy);break;case L0:v=Pe(Ay);break;case F0:v=Pe(Iy);break;case H0:v=Pe(Dy);break;case K0:v=Pe(Cy);break;case M0:v=Pe(Oy);break;case z0:v=Pe($y);break;case B0:v=Pe(Py);break;case $0:v=Pe(Ty);break;case V0:v=Pe(By);break;case T0:v=Pe(ky);break;case N0:v=Pe(Ny);break}x>=4&&((A=this.initOptions)!=null&&A.isEmbedded)&&this.containerMoreNetworks?this.containerMoreNetworks.innerHTML+=v:x>=4&&!((L=this.initOptions)!=null&&L.isEmbedded)&&this.modalContainerMoreNetworks?this.modalContainerMoreNetworks.innerHTML+=v:(M=this.initOptions)!=null&&M.isEmbedded&&this.containerNetworkList?this.containerNetworkList.innerHTML+=v:this.modalContainerNetworkList&&(this.modalContainerNetworkList.innerHTML+=v)}),n!=null&&n.networks&&(n==null?void 0:n.networks.length)<=2&&((f=this.btnMoreNetworks)==null||f.classList.add("hidden"),(g=this.modalBtnMoreNetworks)==null||g.classList.add("hidden")),(I=this.initOptions)!=null&&I.isEmbedded?(O=this.containerNetworks)==null||O.classList.remove("hidden"):(B=this.modalContainerNetworks)==null||B.classList.remove("hidden"),this.attachListenerOnNetworks(n.networks)}attachListenerOnNetworks(e){var n;e==null||e.forEach(i=>{var s;const r=(s=this.shadowRoot)==null?void 0:s.getElementById("btnNetwork"+i);r==null||r.addEventListener("click",async()=>{this.setSelectedNetwork(i),this.showWalletConnectButtons()})}),(n=this.lydianBtnCancelUsdtPayment)==null||n.addEventListener("click",async()=>{this.loadInitialState()})}async getSDKConfig(){var e,n,i,r;if(this.API)try{this.sdkConfig=await this.API.getSDKConfig(),this.API.setClusterBaseUri(this.sdkConfig.lydianPayCluster)}catch{(n=(e=this.initOptions)==null?void 0:e.paymentFailedListener)==null||n.call(e,"Unable to load SDK configuration.")}else(r=(i=this.initOptions)==null?void 0:i.paymentFailedListener)==null||r.call(i,"SDK not initialized.")}async showWalletConnectButtons(){var i,r,s,o,a,c,l;if(!this.connectWalletButtonsContainer||!this.containerMoreWallets||!this.containerWalletList)return;this.containerWalletList.innerHTML="",this.containerMoreWallets.innerHTML="",(i=this.initOptions)!=null&&i.isEmbedded?(r=this.containerNetworks)==null||r.classList.add("hidden"):(s=this.modalContainerNetworks)==null||s.classList.add("hidden"),this.connectWalletButtonsContainer.classList.remove("hidden");const e={id:"manual",name:"Manual QR Code",img:"https://tetherpay.com/images/95de9fd2-da4f-4415-3ec7-bb1befdbc500/public"};(o=this.sdkConfig)!=null&&o.walletConnectEnabled||(this.setSelectedWallet(e),this.beginWalletConnectTransaction(),(a=this.lydianBtnCancelWalletConnect)==null||a.addEventListener("click",async()=>{this.loadInitialState()})),this.containerWalletManual&&(this.containerWalletManual.innerHTML="",this.containerWalletManual.innerHTML+=f0(e));const n=[{id:"metamask",name:"MetaMask",img:"https://tetherpay.com/images/a0ddd685-4a84-4f5c-ab6d-9796994cf500/public",wcPeerName:"MetaMask Wallet"},{id:"trustwallet",name:"Trust Wallet",img:"https://logowik.com/content/uploads/images/trust-wallet-shield4830.logowik.com.webp",wcPeerName:"Trust Wallet"}];n.forEach((u,h)=>{var y;const d=f0(u,!!((y=this.walletConnectService)!=null&&y.findSession(u)));h>=3&&this.containerMoreWallets?this.containerMoreWallets.innerHTML+=d:this.containerWalletList&&(this.containerWalletList.innerHTML+=d)}),n.length<=3&&((c=this.containerMoreWallets)==null||c.classList.add("hidden")),(l=this.containerWalletList)==null||l.classList.remove("hidden"),this.attachListenerOnWallets([...n,e])}attachListenerOnWallets(e){var n;e.forEach(i=>{var s;const r=(s=this.shadowRoot)==null?void 0:s.getElementById("btnWallet"+i.id);r==null||r.addEventListener("click",async()=>{this.setSelectedWallet(i),this.beginWalletConnectTransaction()})}),(n=this.lydianBtnCancelWalletConnect)==null||n.addEventListener("click",async()=>{this.loadInitialState()})}async beginWalletConnectTransaction(){var e,n,i,r,s,o,a,c,l,u,h,d,y;if(!this.selectedAsset||!this.selectedNetwork){(n=(e=this.initOptions)==null?void 0:e.paymentFailedListener)==null||n.call(e,"Asset and network selection required.");return}if(!this.initOptions||!this.API){(r=(i=this.initOptions)==null?void 0:i.paymentFailedListener)==null||r.call(i,"Lydian not initialized.");return}if(!this.walletConnectService){(o=(s=this.initOptions)==null?void 0:s.paymentFailedListener)==null||o.call(s,"Wallet Connect not initialized.");return}(a=this.connectWalletButtonsContainer)==null||a.classList.add("hidden"),this.showProcessing("Generating QR Code");try{if(this.cryptoTransaction=await this.API.createCryptoTransaction({descriptor:this.initOptions.transaction.descriptor,referenceNumber:this.initOptions.transaction.referenceNumber,amount:this.initOptions.transaction.amount,amountCurrency:this.initOptions.transaction.currency,asset:this.selectedAsset.code,network:this.selectedNetwork}),console.log("transaction",this.cryptoTransaction),this.hideProcessing(),this.selectedWallet.id=="manual")this.showQRCode(this.cryptoTransaction.qrData,this.cryptoTransaction.assetAmount,this.cryptoTransaction.address);else{let f=(c=this.walletConnectService)==null?void 0:c.findSession(this.selectedWallet);if(console.log("selected wallet",this.selectedWallet),console.log("matching wallet session",f),!f){const{uri:B,approval:D}=await((l=this.walletConnectService)==null?void 0:l.connectWalletWithQrCode());B&&this.showQRCode(B,this.cryptoTransaction.assetAmount,this.cryptoTransaction.address),f=await D(),console.log("Session established:",f),this.walletConnectService.currentSession=f,this.hideQRCode()}const g=this.walletConnectService.getSessionAddress(f,"eip155:1");if(!g)throw new Error("failed to find wallet address from current session");const I=kD(this.cryptoTransaction.qrData);console.log("parsedQrCodeData",I);let O;if(this.selectedAsset.code==="USDT")O=xC({fromAddress:g,toAddress:I.address,uint256:parseInt(I.uint256)});else if(this.selectedAsset.code==="USDC")O=DC({fromAddress:g,toAddress:I.address,uint256:parseFloat(I.uint256)*ol.multiplier});else throw new Error(`unable to encode unkown asset code "${this.selectedAsset.code}"`);try{this.showProcessing(`Waiting for transaction approval from ${f.peer.metadata.name}...`);const B=await this.walletConnectService.sendEthTransaction(O,f);this.hideProcessing(),this.showPaymentSuccess(),this.clearInterval(),(h=(u=this.initOptions)==null?void 0:u.paymentSuccessListener)==null||h.call(u)}catch{this.hideProcessing(),this.showPaymentFailure(),this.clearInterval()}}this.startListeningCryptoTransaction(),qy()&&(window.location.href=this.cryptoTransaction.qrData)}catch{this.hideProcessing(),(y=(d=this.initOptions)==null?void 0:d.paymentFailedListener)==null||y.call(d,"Unable to create cryptotransaction.")}}}customElements.get("lydian-checkout")||customElements.define("lydian-checkout",CC);async function OC(t){const e=document.querySelector("lydian-checkout");if(!t.publishableKey||!t.transaction.amount||!t.transaction.currency)throw new Error("SDK initialization requires a baseURI, publishableKey, and transaction");if(!fl(t.transaction.currency))throw new Error("Invalid value for currency, valid values are: "+po.join(", "));await e.getMerchantConfiguration(t)}async function $C(t){await document.querySelector("lydian-checkout").updateTransaction(t)}window.Lydian={init:OC,updateTransaction:$C}})();
